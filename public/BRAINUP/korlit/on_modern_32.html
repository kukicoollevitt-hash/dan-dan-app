<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Îã®Îã®Íµ≠Ïñ¥ | study_voca</title>
  
  <!-- Í≥µÌÜµ CSS -->
  <link rel="stylesheet" href="/assets/css/learning-common.css">

<style>
  /* === Ï†ïÎãµ Í∑ºÍ±∞ ÌïòÏù¥ÎùºÏù¥Ìä∏ Ïä§ÌÉÄÏùº === */
  .evidence-highlight {
    padding: 2px 4px;
    border-radius: 4px;
    position: relative;
    cursor: pointer;
    transition: all 0.2s ease;
    border-bottom: 2px solid;
  }
  .evidence-highlight .evidence-tag {
    display: inline-block;
    font-size: 10px;
    font-weight: bold;
    color: white;
    padding: 1px 5px;
    border-radius: 8px;
    margin-left: 4px;
    vertical-align: middle;
  }
  /* 1Î≤à - Î∂ÑÌôç */
  .evidence-q1 { background: rgba(233, 30, 99, 0.15); border-bottom-color: #e91e63; }
  .evidence-q1 .evidence-tag { background: #e91e63; }
  /* 2Î≤à - ÌïòÎäò */
  .evidence-q2 { background: rgba(33, 150, 243, 0.15); border-bottom-color: #2196f3; }
  .evidence-q2 .evidence-tag { background: #2196f3; }
  /* 3Î≤à - Ïó∞Îëê */
  .evidence-q3 { background: rgba(76, 175, 80, 0.15); border-bottom-color: #4caf50; }
  .evidence-q3 .evidence-tag { background: #4caf50; }
  /* 4Î≤à - ÏÇ¥Íµ¨ */
  .evidence-q4 { background: rgba(255, 152, 0, 0.15); border-bottom-color: #ff9800; }
  .evidence-q4 .evidence-tag { background: #ff9800; }
  /* 5Î≤à - Î≥¥Îùº */
  .evidence-q5 { background: rgba(156, 39, 176, 0.15); border-bottom-color: #9c27b0; }
  .evidence-q5 .evidence-tag { background: #9c27b0; }
</style>

  
  <!-- ÌååÎπÑÏΩò 404 Î∞©ÏßÄ -->
  <link rel="icon" href="data:,">
  
  <!-- Í≥µÌÜµ JavaScript -->
  <script src="/assets/js/learning-common.js?v=20251218c"></script>

  <!-- AI Í≥ºÏ†ú Î≥µÏäµ ÏôÑÎ£å Ï≤òÎ¶¨ -->
  <script src="./ai-task-common.js"></script>
   <!-- ‚úÖ Ïù¥ ÏïÑÎûòÏóê Ïä§ÌÉÄÏùº ÎÑ£Í∏∞ -->
 <style>
        #vocab-fill p {
      display: inline;
      margin: 0;
    }
    #vocab-fill p + p::before {
      content: " ";
    }
  /* === Ïñ¥Ìúò ÌÉ≠ v1 ÎîîÏûêÏù∏ (Ïä§ÏΩîÌîÑ + Ïö∞ÏÑ†ÏàúÏúÑ Í∞ïÌôî) === */
  #tab-vocab .vocab-fill-text p { margin: 12px 0 16px; line-height: 1.9; }

  #tab-vocab .vocab-fill-text .blank-wrap {
    display: inline-flex; align-items: center; gap: 8px;
    padding: 10px 16px;
    background: url('https://cdn.jsdelivr.net/gh/kukicoollevitt-hash/dan-dan-app@main/public/images/vocab-box-bg.jpg') center center / cover no-repeat;
    border: none;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    position: relative;
  }
  #tab-vocab .vocab-fill-text .blank-wrap::before {
    display: none;
  }
  #tab-vocab .vocab-fill-text .blank-icon {
    display:inline-flex; align-items:center; justify-content:center;
    width:24px; height:24px; border-radius:50%;
    border:2px solid rgba(139, 117, 87, 0.4);
    background: rgba(255, 255, 255, 0.8);
    font-size:13px;
    font-weight: 600;
    color: #6b5842;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
  }
  #tab-vocab .vocab-fill-text .blank-input {
    border: none !important; outline: none !important;
    min-width: 120px; padding: 6px 8px; font-size: 16px;
    background: transparent !important;
    font-weight: 500;
    color: #3b2f27;
  }

  /* ÌòπÏãú Î¶¨Ïä§Ìä∏ÌòïÏù¥ ÎÇ®ÏïÑÏûàÎäî Í≤ΩÏö∞ÏóêÎèÑ Î≥¥Í∏∞ Ï¢ãÍ≤å(Ìè¥Î∞±) */
  #tab-vocab .vocab-fill-text ol { list-style: none; padding-left: 0; }
  #tab-vocab .vocab-fill-text li { margin: 12px 0; }
  #tab-vocab .vocab-fill-text li input[type="text"] {
    padding: 8px 12px; border: 1px solid #e8d5bf; border-radius: 24px; background: #fff;
  }
      #vocab-fill p {
      display: inline;
      margin: 0;
    }
    #vocab-fill p + p::before {
      content: " ";
    }

    body {
  background: url("https://cdn.jsdelivr.net/gh/kukicoollevitt-hash/dan-dan-app@main/public/images/learning-bg.jpg") center center / cover no-repeat fixed;
}
</style>

  <!-- ÌååÎπÑÏΩò 404 Î∞©ÏßÄ(ÏÑ†ÌÉù ÏÇ¨Ìï≠Ïù¥ÏßÄÎßå Ï†ÅÏö©) -->
  <link rel="icon" href="data:,">

  <script>
  /* =========================================================
     Îã®Ïõê ÏûêÎèô Ïù∏Ïãù (Í∞ïÌôî)
     Ïö∞ÏÑ†ÏàúÏúÑ: ?unit=modern_XX ‚Üí ÌååÏùºÎ™Ö modern_XX.html ‚Üí Ï†úÎ™© Ïà´Ïûê
  ========================================================= */
  (function () {
    const qs = new URLSearchParams(location.search).get('unit');
    let unit = null;

    if (qs) {
      const m = qs.toLowerCase().match(/on_modern[_-]?(\d{1,2})/);
      if (m) unit = `on_modern_${m[1].padStart(2,'0')}`;
    }

    if (!unit) {
      const m2 = location.pathname.toLowerCase().match(/on_modern[_-]?(\d{1,2})\.html/);
      if (m2) unit = `on_modern_${m2[1].padStart(2,'0')}`;
    }

    if (!unit && document.title) {
      const m3 = document.title.match(/(\d{1,2})/);
      if (m3) unit = `on_modern_${m3[1].padStart(2,'0')}`;
    }

    window.CUR_UNIT = unit || 'on_modern_32';
    console.log('[study page] CUR_UNIT =', window.CUR_UNIT);

    // Î∂ÑÏÑùÎ¶¨Ìè¨Ìä∏ ÌÉ≠ÏúºÎ°ú ÏÉàÎ°úÍ≥†Ïπ®Îêú Í≤ΩÏö∞ Î°úÎî© ÌÖçÏä§Ìä∏ Î≥ÄÍ≤Ω
    const savedTab = localStorage.getItem(`current-modern-tab:${window.CUR_UNIT}`);
    if (savedTab === 'report') {
      document.addEventListener('DOMContentLoaded', () => {
        const loadingText = document.querySelector('.loading-text');
        if (loadingText) loadingText.textContent = 'AI ÌïôÏäµ Î∂ÑÏÑù Ï§ë...';
      });
    }
  })();

  /* =========================================================
     PAGE_KEY ÏûêÎèô ÏÉùÏÑ± (Îã®Ïõê Î≤àÌò∏ Í∏∞Î∞ò)  ‚Üê Ïù¥ Î∏îÎ°ùÎßå ÎÇ®ÍπÄ
  ========================================================= */
  (function () {
    const cur = (window.CUR_UNIT || 'on_modern_32');
    const m = cur.match(/modern_(\d{1,2})/);
    const no = m ? m[1].padStart(2,'0') : '01';

    window.PAGE_KEY = `BRAINUP_korlit_on_modern_${no}`;
    console.log('[study page] PAGE_KEY =', window.PAGE_KEY);
  })();
  </script>

  <!-- ‚úÖ Í≥µÌÜµ: Î°úÍ∑∏Ïù∏ÏóêÏÑú Î™ª ÎÑ£ÏóàÏùÑ Îïå Ìïú Î≤à Îçî Ïû°ÏïÑÏ£ºÍ∏∞ + ÌïôÏÉùÌÇ§ ÏÉùÏÑ± -->
  <script>
    // üîÅ Í≥µÌÜµ ÌÇ§ ÎßåÎìúÎäî Ìï®Ïàò
    function buildStudentKey(stu) {
      const cleanPhone = (stu.phone || '').replace(/\D/g, '');
      const cleanName = (stu.name || '').trim();
      const cleanGrade = (stu.grade || '').trim();
      return `${cleanGrade}_${cleanName}_${cleanPhone}`;
    }

    // üîÅ ÌòÑÏû¨ ÌïôÏÉù Í∞ÄÏ†∏Ïò§Í∏∞ (Î°úÍ∑∏Ïù∏ÏóêÏÑú Ï†ÄÏû•Ìï¥Îëî Í±∞)
    function getCurrentStudent() {
      const saved = localStorage.getItem('currentStudent');
      if (!saved) return null;
      try {
        return JSON.parse(saved);
      } catch (e) {
        return null;
      }
    }

    // ÌéòÏù¥ÏßÄ Îì§Ïñ¥Ïò¨ Îïå Î°úÍ∑∏Ïù∏ Ï†ïÎ≥¥ ÏûàÏúºÎ©¥ ÌïôÎÖÑ/Ïù¥Î¶Ñ ÏûêÎèô Ï±ÑÏö∞Í∏∞(Ï†ÑÌôî ÏûÖÎ†•Ïπ∏ Ïà®ÍπÄ)
    document.addEventListener('DOMContentLoaded', () => {
      const stu = getCurrentStudent();
      const gradeInput = document.querySelector('#student-grade');
      const nameInput = document.querySelector('#student-name');
      const phoneWrap = document.querySelector('#student-phone-wrap'); // ÏûàÏúºÎ©¥ Ïà®ÍπÄ

      if (stu) {
        if (gradeInput) gradeInput.value = stu.grade || '';
        if (nameInput) nameInput.value = stu.name || '';
        if (phoneWrap) phoneWrap.style.display = 'none';
      } else {
        if (phoneWrap) phoneWrap.style.display = 'none';
      }

      // ÌòÑÏû¨ ÎÇ†ÏßúÎ°ú Ïõî/Ïùº ÏûêÎèô Ï±ÑÏö∞Í∏∞
      const today = new Date();
      const monthInput = document.querySelector('#month-input');
      const dayInput = document.querySelector('#day-input');

      if (monthInput) monthInput.value = today.getMonth() + 1; // ÏõîÏùÄ 0Î∂ÄÌÑ∞ ÏãúÏûëÌïòÎØÄÎ°ú +1
      if (dayInput) dayInput.value = today.getDate();
    });
  </script>

  <script>
    // ÌÉ≠ Ïù¥Î¶Ñ Í≥†Ï†ï
    document.title = "BRAINÏóÖ | ÌòÑÎåÄÎ¨∏Ìïô 32 Îã¨Îπõ ÏïÑÎûòÏÑú Ïù¥Ïñ¥ÏßÑ Ïù∏Ïó∞";

    // ===== ÌÉÄÏù¥Î®∏ Í∏∞Îä• =====
    var timerInterval = null;
    var totalSeconds = 0;
    var isTimerRunning = false;

    function toggleTimer() {
      const timerIcon = document.getElementById('timer-icon');
      if (!timerIcon) return;

      if (isTimerRunning) {
        // ÌÉÄÏù¥Î®∏ Ï§ëÏßÄ
        isTimerRunning = false;
        clearInterval(timerInterval);
        timerIcon.classList.remove('running');
        updateTimerDisplay();
      } else {
        // ÌÉÄÏù¥Î®∏ ÏãúÏûë
        isTimerRunning = true;
        timerIcon.classList.add('running');
        timerInterval = setInterval(function() {
          totalSeconds++;
          updateTimerDisplay();
        }, 1000);
      }
    }

    function updateTimerDisplay() {
      const minutes = Math.floor(totalSeconds / 60);
      const seconds = totalSeconds % 60;
      const minuteInput = document.getElementById('minute-input');
      const secondInput = document.getElementById('second-input');

      if (minuteInput) minuteInput.value = String(minutes).padStart(2, '0');
      if (secondInput) secondInput.value = String(seconds).padStart(2, '0');
    }

    // ===== Îã¨Î†• ÌåùÏóÖ Í¥ÄÎ†® Ìï®ÏàòÎì§ =====
    var currentCalendarYear = new Date().getFullYear();
    var currentCalendarMonth = new Date().getMonth();
    var selectedDate = null;

    function toggleCalendar() {
      const popup = document.getElementById('calendar-popup');
      const overlay = document.getElementById('calendar-overlay');

      if (popup.classList.contains('show')) {
        closeCalendar();
      } else {
        currentCalendarYear = new Date().getFullYear();
        currentCalendarMonth = new Date().getMonth();
        renderCalendar();
        popup.classList.add('show');
        overlay.classList.add('show');
      }
    }

    function closeCalendar() {
      const popup = document.getElementById('calendar-popup');
      const overlay = document.getElementById('calendar-overlay');
      popup.classList.remove('show');
      overlay.classList.remove('show');
    }

    function changeMonth(direction) {
      currentCalendarMonth += direction;
      if (currentCalendarMonth < 0) {
        currentCalendarMonth = 11;
        currentCalendarYear--;
      } else if (currentCalendarMonth > 11) {
        currentCalendarMonth = 0;
        currentCalendarYear++;
      }
      renderCalendar();
    }

    function renderCalendar() {
      const grid = document.getElementById('calendar-grid');
      const title = document.getElementById('calendar-title');

      // Ï†úÎ™© ÏóÖÎç∞Ïù¥Ìä∏
      title.textContent = currentCalendarYear + 'ÎÖÑ ' + (currentCalendarMonth + 1) + 'Ïõî';

      // Í∏∞Ï°¥ ÎÇ†Ïßú Ï†úÍ±∞ (ÏöîÏùº Ìó§ÎçîÎäî Ïú†ÏßÄ)
      const dayElements = grid.querySelectorAll('.calendar-day');
      dayElements.forEach(function(el) { el.remove(); });

      // Ìï¥Îãπ ÏõîÏùò Ï≤´ÎÇ†Í≥º ÎßàÏßÄÎßâÎÇ†
      const firstDay = new Date(currentCalendarYear, currentCalendarMonth, 1);
      const lastDay = new Date(currentCalendarYear, currentCalendarMonth + 1, 0);
      const prevLastDay = new Date(currentCalendarYear, currentCalendarMonth, 0);

      const firstDayOfWeek = firstDay.getDay();
      const lastDate = lastDay.getDate();
      const prevLastDate = prevLastDay.getDate();

      const today = new Date();
      const isCurrentMonth = today.getFullYear() === currentCalendarYear && today.getMonth() === currentCalendarMonth;
      const todayDate = today.getDate();

      // Ïù¥Ï†Ñ Îã¨ ÎÇ†ÏßúÎì§
      for (var i = firstDayOfWeek - 1; i >= 0; i--) {
        var day = document.createElement('div');
        day.className = 'calendar-day other-month';
        day.textContent = prevLastDate - i;
        grid.appendChild(day);
      }

      // ÌòÑÏû¨ Îã¨ ÎÇ†ÏßúÎì§
      for (var date = 1; date <= lastDate; date++) {
        var day = document.createElement('div');
        day.className = 'calendar-day';
        day.textContent = date;

        if (isCurrentMonth && date === todayDate) {
          day.classList.add('today');
        }

        if (selectedDate && selectedDate.year === currentCalendarYear &&
            selectedDate.month === currentCalendarMonth && selectedDate.date === date) {
          day.classList.add('selected');
        }

        (function(d) {
          day.onclick = function() { selectDate(d); };
        })(date);

        grid.appendChild(day);
      }

      // Îã§Ïùå Îã¨ ÎÇ†ÏßúÎì§ (7Ïùò Î∞∞ÏàòÍ∞Ä ÎêòÎèÑÎ°ù)
      const totalCells = firstDayOfWeek + lastDate;
      const remainingCells = 7 - (totalCells % 7);
      if (remainingCells < 7) {
        for (var i = 1; i <= remainingCells; i++) {
          var day = document.createElement('div');
          day.className = 'calendar-day other-month';
          day.textContent = i;
          grid.appendChild(day);
        }
      }
    }

    function selectDate(date) {
      selectedDate = {
        year: currentCalendarYear,
        month: currentCalendarMonth,
        date: date
      };

      // Ïõî/Ïùº ÏûÖÎ†• ÌïÑÎìú ÏóÖÎç∞Ïù¥Ìä∏
      const monthInput = document.getElementById('month-input');
      const dayInput = document.getElementById('day-input');

      if (monthInput) monthInput.value = currentCalendarMonth + 1;
      if (dayInput) dayInput.value = date;

      closeCalendar();
    }

    // ===== ÏûêÎèô ÌîºÎìúÎ∞± ÏÉùÏÑ± Ìï®Ïàò =====
    function generateFeedback(scores) {
      const feedback = [];

      if (scores.literal < 7) {
        feedback.push("ÏßÄÎ¨∏Ïùò ÌïµÏã¨ Î¨∏Ïû•ÏùÑ Î®ºÏ†Ä Ï∞æÍ≥†, Í∑∏ Î¨∏Ïû•ÏùÑ Ï§ëÏã¨ÏúºÎ°ú ÏÑ∏Î∂Ä ÎÇ¥Ïö©ÏùÑ Ï†ïÎ¶¨Ìï¥ Î≥¥ÏÑ∏Ïöî.");
      }
      if (scores.structural < 7) {
        feedback.push("Î¨∏Îã®Ïùò ÏïûÎí§ Ïó∞Í≤∞Ïñ¥Î•º ÌëúÏãúÌïòÎ©¥ÏÑú ÏùΩÏúºÎ©¥ Íµ¨Ï°∞ ÌååÏïÖÏù¥ Ïâ¨ÏõåÏßëÎãàÎã§.");
      }
      if (scores.lexical < 7) {
        feedback.push("Î™®Î•¥Îäî ÎÇ±ÎßêÏùÄ Î¨∏Îß•ÏúºÎ°ú ÎúªÏùÑ ÏßêÏûëÌïú Îí§ Ïñ¥ÌúòÏπ∏Ïóê Ï†ïÎ¶¨Ìï¥ Î≥¥ÏÑ∏Ïöî.");
      }
      if (scores.inferential < 7) {
        feedback.push("Í∏ÄÏì¥Ïù¥Ïùò ÏùòÎèÑÎÇò Ïà®ÏùÄ ÏùòÎØ∏Î•º 'Ïôú Ïù¥Î†áÍ≤å ÎßêÌñàÏßÄ?' ÌïòÍ≥† Ï∂îÎ°†ÌïòÎäî Ïó∞ÏäµÏùÑ Ìï¥Î≥¥ÏÑ∏Ïöî.");
      }
      if (scores.critical < 7) {
        feedback.push("Ï£ºÏû•Í≥º Í∑ºÍ±∞Î•º ÎÇòÎàÑÏñ¥ ÌëúÏãúÌïòÍ≥†, Í∑ºÍ±∞Í∞Ä Ï∂©Î∂ÑÌïúÏßÄ ÏÇ¥Ìé¥Î≥¥Îäî ÎπÑÌåêÏ†Å ÏùΩÍ∏∞Î•º Ìï¥Î≥¥ÏÑ∏Ïöî.");
      }

      if (feedback.length === 0) {
        feedback.push("Î™®Îì† ÏòÅÏó≠Ïù¥ Í≥†Î•¥Í≤å Ïûò ÎÇòÏôîÏñ¥Ïöî. ÏßÄÍ∏àÏ≤òÎüº Îã®Í≥ÑÎ≥Ñ ÌïôÏäµÏùÑ Ïù¥Ïñ¥Í∞ÄÎ©¥ Îê©ÎãàÎã§ üëç");
      }
      return feedback;
    }

    function renderFeedback(scores) {
      const box = document.getElementById('report-feedback');
      if (!box) return;
      const feedbackList = generateFeedback(scores);
      let html = '<h3>Î≥¥ÏôÑÏù¥ ÌïÑÏöîÌïú ÏòÅÏó≠</h3><ul>';
      feedbackList.forEach(msg => {
        html += '<li>' + msg + '</li>';
      });
      html += '</ul>';
      box.innerHTML = html;
    }

    /* ======= (ÏûÑÏãú alert Î≤ÑÏ†Ñ openRemedial ÏÇ≠Ï†ú) ======= */
    // ===== Î≥¥ÏôÑÌïôÏäµ Î¨∏Ï†ú Î±ÖÌÅ¨ (ÎÇúÏèòÍ≥µ) =====
    const REMEDIAL_BANK = {
      literal: {
        title: "Î≥¥ÏôÑÌïôÏäµ | ÌïµÏã¨ Ïù¥Ìï¥Î†•",
        problems: [{ type: "mc", q: "'Í≤ΩÌù¨'Ïùò ÍøàÏùÄ?", options: ["Í∞ÄÏàò","ÎÇúÏû•Ïù¥Í∞Ä ÏèòÏïÑ Ïò¨Î¶∞ ÏûëÏùÄ Í≥µÏ≤òÎüº ÎÜíÏù¥ Ïò¨ÎùºÍ∞ÄÎäî Í≤É","ÏÇ¨ÏóÖÍ∞Ä","ÏùòÏÇ¨"], answer: 1, explanation: "ÏñµÏïïÎ∞õÎäî ÌòÑÏã§ÏóêÏÑú Î≤óÏñ¥ÎÇòÍ≥† Ïã∂ÏùÄ ÍøàÏûÖÎãàÎã§." }]
      },
      structural: {
        title: "Î≥¥ÏôÑÌïôÏäµ | Íµ¨Ï°∞ ÌååÏïÖÎ†•",
        problems: [{ type: "mc", q: "'ÎÇúÏû•Ïù¥'Í∞Ä ÏÉÅÏßïÌïòÎäî Í≤ÉÏùÄ?", options: ["ÌÇ§ ÏûëÏùÄ ÏÇ¨Îûå","ÏÇ∞ÏóÖÌôî Í≥ºÏ†ïÏóêÏÑú ÏÜåÏô∏Îêú ÎÖ∏ÎèôÏûê Í≥ÑÏ∏µ","ÎèôÌôî Ï∫êÎ¶≠ÌÑ∞","Ïô∏Íµ≠Ïù∏"], answer: 1, explanation: "ÎÇúÏû•Ïù¥Îäî ÏÜåÏô∏Îêú ÎÖ∏ÎèôÏûê Í≥ÑÏ∏µÏùÑ ÏÉÅÏßïÌï©ÎãàÎã§." }]
      },
      lexical: {
        title: "Î≥¥ÏôÑÌïôÏäµ | Ïñ¥Ìúò Îß•ÎùΩÎ†•",
        problems: [{ type: "mc", q: "'ÏûëÏùÄ Í≥µ'Ïù¥ ÏÉÅÏßïÌïòÎäî Í≤ÉÏùÄ?", options: ["Ïû•ÎÇúÍ∞ê","Ìù¨ÎßùÍ≥º Íøà","Ïä§Ìè¨Ï∏†","ÌíçÏÑ†"], answer: 1, explanation: "ÏûëÏùÄ Í≥µÏùÄ ÏÜåÏô∏Îêú Ïù¥Îì§Ïùò ÏûëÏùÄ Ìù¨ÎßùÏùÑ ÏÉÅÏßïÌï©ÎãàÎã§." }]
      },
      inferential: {
        title: "Î≥¥ÏôÑÌïôÏäµ | Ï∂îÎ°†¬∑ÌÜµÌï©Î†•",
        problems: [{ type: "mc", q: "ÎÇúÏû•Ïù¥ Í∞ÄÏ°±Ïù¥ Í≥†ÌÜµÎ∞õÎäî Ïù¥Ïú†Îäî?", options: ["Í∞úÏù∏Ïùò ÏûòÎ™ª","ÏÇ∞ÏóÖÌôîÍ∞Ä Í∞ÄÏ†∏Ïò® ÎπàÎ∂ÄÍ≤©Ï∞®ÏôÄ ÏÜåÏô∏","ÏûêÏó∞Ïû¨Ìï¥","Ï†ÑÏüÅ"], answer: 1, explanation: "Í∏âÍ≤©Ìïú ÏÇ∞ÏóÖÌôîÎ°ú Ïù∏Ìïú ÏÜåÏô∏ÏôÄ ÎπàÍ≥§ ÎïåÎ¨∏ÏûÖÎãàÎã§." }]
      },
      critical: {
        title: "Î≥¥ÏôÑÌïôÏäµ | ÎπÑÌåê¬∑Ï†ÅÏö©Î†•",
        problems: [{ type: "mc", q: "Ïù¥ ÏûëÌíàÏù¥ ÎπÑÌåêÌïòÎäî Í≤ÉÏùÄ?", options: ["ÏûêÏó∞","ÏÇ∞ÏóÖÌôî Í≥ºÏ†ïÏùò ÎπÑÏù∏Í∞ÑÌôîÏôÄ ÏñëÍ∑πÌôî","ÎÜçÏ¥å","Ï†ÑÌÜµ"], answer: 1, explanation: "ÏÇ∞ÏóÖÌôîÏùò Ïñ¥ÎëêÏö¥ Î©¥Í≥º Ïù∏Í∞Ñ ÏÜåÏô∏Î•º ÎπÑÌåêÌï©ÎãàÎã§." }]
      }
    };

    // ===== Î≥¥ÏôÑÌïôÏäµ Ïó¥Í∏∞ =====
    const NUM_CIRCLE = ['‚ë†', '‚ë°', '‚ë¢', '‚ë£'];
    function openRemedial() {
      // Î™®Îì† ÏòÅÏó≠ Î≥¥ÏôÑÌïôÏäµ Î¨∏Ï†ú ÌëúÏãú (Îã§ ÎßûÏ∂∞ÎèÑ ÎÇòÏò¥)
      const needKeys = ['literal', 'structural', 'lexical', 'inferential', 'critical'];

      const panel = document.getElementById('remedial-panel');
      const body = document.getElementById('remedial-panel-body');
      if (!panel || !body) return;

      let html = "";
      needKeys.forEach(key => {
        const data = REMEDIAL_BANK[key];
        if (!data) return;
        const p = data.problems[0];
        html += `<div class="remed-question" data-key="${key}" style="margin-bottom:20px; padding:12px; background:#fefefe; border-radius:8px; border:1px solid #e5d0ac;">
          <h4 style="margin:0 0 10px; color:#7b3d1a; font-size:14px; border-bottom:1px solid #e5d0ac; padding-bottom:6px;">${data.title}</h4>
          <p style="margin:0 0 10px; font-size:14px; color:#333; line-height:1.6;">${p.q}</p>
          <div style="display:flex; flex-direction:column; gap:6px;">`;
        p.options.forEach((opt, i) => {
          html += `<label style="display:flex; align-items:flex-start; gap:6px; font-weight:normal; cursor:pointer; padding:6px 8px; border-radius:6px; transition:background 0.2s;"
                          onmouseover="this.style.background='#fff8f0'" onmouseout="this.style.background='transparent'">
            <input type="radio" name="${key}" value="${i}" style="margin-top:3px;">
            <span style="font-size:13px; line-height:1.5;"><strong style="color:#7b3d1a;">${NUM_CIRCLE[i]}</strong> ${opt}</span>
          </label>`;
        });
        html += `</div>
          <div class="remed-result" style="display:none; margin-top:10px; padding:10px; border-radius:6px; font-size:13px; line-height:1.6;"></div>
        </div>`;
      });

      body.innerHTML = html;
      panel.style.display = 'flex';
    }

    // Î≥¥ÏôÑÌïôÏäµ Ï±ÑÏ†ê
    function gradeRemedial() {
      const body = document.getElementById('remedial-panel-body');
      if (!body) return;

      const questions = body.querySelectorAll('.remed-question');
      questions.forEach(qDiv => {
        const key = qDiv.dataset.key;
        const data = REMEDIAL_BANK[key];
        if (!data) return;

        const p = data.problems[0];
        const inputs = qDiv.querySelectorAll(`input[name="${key}"]`);
        let selected = -1;
        inputs.forEach((inp, i) => { if (inp.checked) selected = i; });

        const resultDiv = qDiv.querySelector('.remed-result');
        if (!resultDiv) return;

        if (selected === -1) {
          resultDiv.style.display = 'block';
          resultDiv.style.background = '#fff3cd';
          resultDiv.style.color = '#856404';
          resultDiv.innerHTML = '‚ö†Ô∏è ÎãµÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.';
          return;
        }

        const explanation = p.explanation || '';

        if (selected === p.answer) {
          resultDiv.style.display = 'block';
          resultDiv.style.background = '#d4edda';
          resultDiv.style.color = '#155724';
          resultDiv.innerHTML = `‚úÖ Ï†ïÎãµ: ${NUM_CIRCLE[p.answer]} | Ìï¥ÏÑ§: ${explanation}`;
        } else {
          resultDiv.style.display = 'block';
          resultDiv.style.background = '#f8d7da';
          resultDiv.style.color = '#721c24';
          resultDiv.innerHTML = `‚ùå Ï†ïÎãµ: ${NUM_CIRCLE[p.answer]} | Ìï¥ÏÑ§: ${explanation}`;
        }
      });
    }

    function resetRemedial() {
      const body = document.getElementById('remedial-panel-body');
      if (!body) return;
      body.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
      body.querySelectorAll('.remed-result').forEach(el => { el.style.display = 'none'; el.innerHTML = ''; });
    }
  </script>

  <style>
    body {
      margin: 0;
      background: url("https://cdn.jsdelivr.net/gh/kukicoollevitt-hash/dan-dan-app@main/public/images/learning-bg.jpg") center center / cover no-repeat fixed;
      font-family: "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
      min-height: 100vh;
    }
    /* ===== ÏÉÅÎã® ÌÉ≠ ===== */
    .top-tabs {
      background: transparent;
      backdrop-filter: none;
      border-bottom: none;
      display: flex;
      gap: 8px;
      padding: 12px 24px 0;
      align-items: center;
      box-shadow: none;
    }
    .tab-btn {
      position: relative;
      color: #2d2d2d;
      padding: 14px 28px 16px;
      border: none;
      border-radius: 12px 12px 0 0;
      font-weight: 600;
      cursor: pointer;
      font-size: 15px;
      transition: all 0.3s ease;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.08));
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-bottom: none;
      box-shadow:
        0 -3px 12px rgba(0, 0, 0, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.25);
    }

    /* ÎèôÌôîÏ±Ö ÎäêÎÇåÏùò Ïû•Ïãù */
    .tab-btn::before {
      display: none;
    }

    .tab-btn::after {
      content: '';
      position: absolute;
      bottom: -3px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      border-bottom: 8px solid transparent;
      opacity: 0;
      transition: all 0.3s ease;
    }

    .tab-btn:hover {
      color: #ffffff;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.15));
      transform: translateY(-3px);
      box-shadow:
        0 -5px 20px rgba(255, 215, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.35);
    }

    .tab-btn:hover::before {
      opacity: 1;
      transform: translateY(-50%) scale(1.2);
    }

    .tab-btn.active {
      color: #ffffff;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.2));
      border: 2px solid rgba(255, 215, 0, 0.5);
      box-shadow:
        0 -6px 24px rgba(255, 215, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.4),
        inset 0 -2px 10px rgba(0, 0, 0, 0.15);
    }

    .tab-btn.active::before {
      opacity: 1;
      animation: twinkle 2s ease-in-out infinite;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 1; transform: translateY(-50%) scale(1.3); }
    }

    /* Î≥∏Î¨∏ÌïôÏäµ - Î∂âÏùÄ ÌÜ§ */
    .tab-btn[data-tab="reading"].active {
      background: linear-gradient(135deg, rgba(220, 94, 78, 0.85), rgba(201, 74, 58, 0.9)) !important;
      color: #ffffff !important;
      font-weight: 700;
      text-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(255, 150, 130, 0.6) !important;
      box-shadow:
        0 -6px 24px rgba(220, 94, 78, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.4),
        inset 0 -2px 10px rgba(0, 0, 0, 0.2) !important;
    }

    /* Ïñ¥ÌúòÌïôÏäµ - Ìô©Í∏à ÌÜ§ */
    .tab-btn[data-tab="vocab"].active {
      background: linear-gradient(135deg, rgba(245, 175, 50, 0.85), rgba(223, 90, 18, 0.9)) !important;
      color: #ffffff !important;
      font-weight: 700;
      text-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(255, 215, 100, 0.6) !important;
      box-shadow:
        0 -6px 24px rgba(245, 175, 50, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.4),
        inset 0 -2px 10px rgba(0, 0, 0, 0.2) !important;
    }

    /* Ï∞ΩÏùòÌôúÎèô - Ï≤≠Î°ù ÌÜ§ */
    .tab-btn[data-tab="creative"].active {
      background: linear-gradient(135deg, rgba(78, 179, 142, 0.85), rgba(58, 159, 122, 0.9)) !important;
      color: #ffffff !important;
      font-weight: 700;
      text-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(66, 205, 143, 0.6) !important;
      box-shadow:
        0 -6px 24px rgba(78, 179, 142, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.4),
        inset 0 -2px 10px rgba(0, 0, 0, 0.2) !important;
    }

    /* Î∂ÑÏÑùÎ¶¨Ìè¨Ìä∏ - Î≥¥Îùº ÌÜ§ */
    .tab-btn[data-tab="report"].active {
      background: linear-gradient(135deg, rgba(145, 126, 188, 0.85), rgba(125, 106, 168, 0.9)) !important;
      color: #ffffff !important;
      font-weight: 700;
      text-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(93, 38, 202, 0.6) !important;
      box-shadow:
        0 -6px 24px rgba(145, 126, 188, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.4),
        inset 0 -2px 10px rgba(0, 0, 0, 0.2) !important;
    }

    /* Ïò§Î•∏Ï™Ω Í≥†Ï†ï ÌïôÏÉùÏ†ïÎ≥¥ */
    .student-info {
      margin-left: auto;
      display: flex;
      gap: 16px;
      align-items: center;
      font-size: 14px;
      color: rgba(255, 255, 255, 0.9);
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0.08));
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 14px;
      padding: 12px 20px;
      box-shadow:
        0 4px 15px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }
    .student-info label {
      white-space: nowrap;
      font-weight: 600;
      color: #2d2d2d;
      font-size: 13px;
    }
    .student-info input {
      width: 90px;
      border: none;
      border-bottom: 2px solid rgba(139, 117, 87, 0.5);
      border-radius: 0;
      padding: 8px 12px;
      background: rgba(255, 255, 255, 0.1);
      font-size: 14px;
      outline: none;
      transition: all 0.3s ease;
      text-align: center;
      color: #2d2d2d;
      font-weight: 500;
    }
    .student-info input:focus {
      border-bottom-color: rgba(139, 117, 87, 0.9);
      background: rgba(255, 255, 255, 0.2);
      box-shadow: 0 2px 8px rgba(139, 117, 87, 0.3);
    }
    .student-info input::placeholder {
      color: rgba(0, 0, 0, 0.4);
      text-align: center;
    }

    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    /* ===== Î≥∏Î¨∏ÌïôÏäµ Î†àÏù¥ÏïÑÏõÉ ===== */
    .learning-layout {
      display: flex;
      gap: 18px;
      max-width: 1200px;
      margin: 0 auto;
      padding: 16px;
      box-sizing: border-box;
    }
    .left-passage { flex: 0 0 58%; }
    .right-quiz {
      flex: 0 0 42%;
      background:
        repeating-linear-gradient(
          0deg,
          transparent,
          transparent 39px,
          rgba(200, 200, 200, 0.15) 39px,
          rgba(200, 200, 200, 0.15) 40px
        ),
        rgba(255, 255, 255, 0.95);
      border: 2px solid #d0d0d0;
      border-top: 4px double #999;
      border-radius: 4px;
      padding: 20px 20px 70px;
      position: relative;
      box-sizing: border-box;
      box-shadow:
        0 1px 3px rgba(0, 0, 0, 0.1),
        0 4px 12px rgba(0, 0, 0, 0.08),
        inset 0 1px 0 rgba(255, 255, 255, 0.6);
    }

    /* ===== Î≥∏Î¨∏ ÏßÄÎ¨∏ ===== */
    .passage-wrap {
      background: rgba(255, 255, 255, 0.7);
      border: none;
      border-radius: 8px;
      padding: 32px 40px;
      color: #2d2d2d;
      position: relative;
      box-shadow
        0 1px 3px rgba(0, 0, 0, 0.08),
        0 3px 8px rgba(0, 0, 0, 0.06);
    }
    /* Îí∑Î∞∞Í≤Ω Ï¢ÖÏù¥ 1 (Í∞ÄÏû• Îí§) */
    .passage-wrap::before {
      content: '';
      position: absolute;
      left: -6px;
      top: 8px;
      right: 6px;
      bottom: -8px;
      background: #faf8f5;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
      z-index: -2;
      transform: rotate(-0.5deg);
    }
    /* Îí∑Î∞∞Í≤Ω Ï¢ÖÏù¥ 2 (Ï§ëÍ∞Ñ) */
    .passage-wrap::after {
      content: '';
      position: absolute;
      left: -3px;
      top: 4px;
      right: 3px;
      bottom: -4px;
      background: #fefdfb;
      border-radius: 8px;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
      z-index: -1;
      transform: rotate(0.3deg);
    }
    .passage-label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: linear-gradient(135deg, rgba(220, 94, 78, 0.95), rgba(192, 74, 59, 0.95));
      border: 1px solid rgba(255, 150, 130, 0.6);
      border-radius: 999px;
      padding: 5px 16px;
      font-size: 14px;
      margin-bottom: 12px;
      box-shadow: 0 2px 6px rgba(220, 94, 78, 0.3);
      font-weight: 600;
      color: #fff;
    }
    .passage-title { font-size: 30px; font-weight: 700; margin: 0 0 18px; }

    /* ===== ÏõπÌà∞ÌûåÌä∏ ÎìúÎ°≠Îã§Ïö¥ Ïª®ÌÖåÏù¥ÎÑà ===== */
    .webtoon-hint-container {
      position: absolute;
      top: 12px;
      right: 12px;
      z-index: 100;
    }
    .webtoon-hint-btn {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      background: linear-gradient(135deg, #FFED4A 0%, #FFC800 100%);
      color: #6b5000;
      font-size: 13px;
      font-weight: 700;
      padding: 8px 15px;
      border-radius: 20px;
      border: 2px solid #e6b800;
      box-shadow: 0 3px 10px rgba(255, 180, 0, 0.35);
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
    }
    .webtoon-hint-btn:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 5px 15px rgba(255, 180, 0, 0.45);
      background: linear-gradient(135deg, #FFF080 0%, #FFD833 100%);
    }
    .webtoon-hint-btn::before {
      content: 'üí°';
      font-size: 14px;
    }
    .webtoon-hint-btn.active {
      border-radius: 20px 20px 0 0;
      box-shadow: 0 -3px 10px rgba(255, 180, 0, 0.35);
    }
    .webtoon-hint-btn .arrow {
      font-size: 10px;
      transition: transform 0.3s ease;
      margin-left: 2px;
    }
    .webtoon-hint-btn.active .arrow {
      transform: rotate(180deg);
    }

    /* ===== ÏõπÌà∞ÌûåÌä∏ ÎìúÎ°≠Îã§Ïö¥ Ìå®ÎÑê ===== */
    .webtoon-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      width: 600px;
      max-height: 0;
      overflow: hidden;
      background: #fffbe6;
      border-radius: 0 0 16px 16px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      transition: max-height 0.4s ease, opacity 0.3s ease;
      opacity: 0;
    }
    .webtoon-dropdown.active {
      max-height: 70vh;
      opacity: 1;
      border: 2px solid #e6b800;
      border-top: none;
    }
    .webtoon-dropdown-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      background: #fff8cc;
      border-bottom: 1px solid #e6b800;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    .webtoon-dropdown-header span {
      font-weight: 600;
      color: #6b5000;
    }
    .webtoon-dropdown-close {
      background: none;
      border: none;
      font-size: 24px;
      color: #999;
      cursor: pointer;
      line-height: 1;
      padding: 0 4px;
    }
    .webtoon-dropdown-close:hover {
      color: #333;
    }
    .webtoon-dropdown-body {
      padding: 16px;
      max-height: calc(70vh - 50px);
      overflow-y: auto;
    }
    .webtoon-dropdown-body img {
      width: 100%;
      border-radius: 8px;
      margin-bottom: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    .webtoon-dropdown-body img:last-child {
      margin-bottom: 0;
    }

    .passage-text { line-height: 1.7; font-size: 16px; }
    .passage-text p { margin-bottom: 14px; }
    .passage-text b { color: #d35a1a; }

    .passage-vocab {
      margin-top: 22px;
      background: linear-gradient(to bottom, #ffffff 0%, #fffefb 100%);
      border-radius: 14px;
      border: 1px solid #f3e5d4;
      padding: 18px 22px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
    }
    .passage-vocab ol { margin: 0; padding-left: 20px; }
    .passage-vocab li { margin-bottom: 6px; font-size: 14px; }

    /* ===== Î≥∏Î¨∏ÌïôÏäµ ÌÉÄÏù¥Î®∏ ===== */
    .quiz-header {
      display: flex;
      gap: 10px;
      margin-bottom: 18px;
      justify-content: center;
    }
    /* ÎÇ†Ïßú Î∞ïÏä§ (Ïõî/Ïùº) */
    .date-box {
      position: relative;
      display: flex;
      gap: 8px;
      background: linear-gradient(135deg, #fef0e0 0%, #fde7d6 100%);
      border-radius: 12px;
      padding: 8px 14px 8px 42px;
      box-shadow: 0 2px 6px rgba(192, 74, 59, 0.08);
      border: 1px solid rgba(242, 197, 154, 0.4);
    }
    /* Îã¨Î†• ÏïÑÏù¥ÏΩò */
    .calendar-icon {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 22px;
      cursor: pointer;
      transition: transform 0.2s ease;
      user-select: none;
    }
    .calendar-icon:hover {
      transform: translateY(-50%) scale(1.1);
    }
    /* ÌÉÄÏù¥Î®∏ Î∞ïÏä§ (Î∂Ñ/Ï¥à) */
    .timer-box {
      position: relative;
      display: flex;
      gap: 8px;
      background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
      border-radius: 12px;
      padding: 8px 14px 8px 42px;
      box-shadow: 0 2px 6px rgba(76, 175, 80, 0.15);
      border: 1px solid rgba(129, 199, 132, 0.4);
    }
    /* ÌÉÅÏÉÅ ÏãúÍ≥Ñ ÏïÑÏù¥ÏΩò */
    .timer-icon {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 22px;
      cursor: pointer;
      transition: transform 0.2s ease;
      user-select: none;
    }
    .timer-icon:hover {
      transform: translateY(-50%) scale(1.1);
    }
    .timer-icon.running {
      animation: bump 0.8s ease-in-out infinite;
    }
    @keyframes bump {
      0%, 100% {
        transform: translateY(-50%) scale(1);
      }
      50% {
        transform: translateY(-50%) scale(1.3);
      }
    }
    /* Îã¨Î†• ÌåùÏóÖ */
    .calendar-popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
      padding: 20px;
      z-index: 1000;
      min-width: 320px;
    }
    .calendar-popup.show {
      display: block;
      animation: popupFadeIn 0.2s ease;
    }
    @keyframes popupFadeIn {
      from {
        opacity: 0;
        transform: translate(-50%, -45%);
      }
      to {
        opacity: 1;
        transform: translate(-50%, -50%);
      }
    }
    .calendar-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.3);
      z-index: 999;
    }
    .calendar-overlay.show {
      display: block;
    }
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      font-weight: 600;
      color: #c04a3b;
      font-size: 16px;
    }
    .calendar-nav {
      cursor: pointer;
      padding: 4px 10px;
      border-radius: 6px;
      transition: background 0.2s;
      user-select: none;
    }
    .calendar-nav:hover {
      background: #fef0e0;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
    }
    .calendar-day-header {
      text-align: center;
      font-size: 12px;
      color: #999;
      padding: 8px 0;
      font-weight: 500;
    }
    .calendar-day {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
    }
    .calendar-day:hover:not(.empty):not(.other-month) {
      background: #fef0e0;
      transform: scale(1.05);
    }
    .calendar-day.today {
      background: linear-gradient(135deg, #c04a3b 0%, #d46b5a 100%);
      color: white;
      font-weight: 600;
    }
    .calendar-day.selected {
      background: linear-gradient(135deg, #fef0e0 0%, #fde7d6 100%);
      border: 2px solid #c04a3b;
      font-weight: 600;
    }
    .calendar-day.other-month {
      color: #ccc;
    }
    .calendar-day.empty {
      cursor: default;
    }
    .time-group { display: flex; flex-direction: row-reverse; align-items: center; gap: 4px; }
    .time-group label { font-size: 13px; color: #7a5647; font-weight: 500; }
    .time-group input {
      width: 42px;
      border: 1px solid #f4bfa2;
      border-radius: 8px;
      padding: 4px 6px;
      font-size: 13px;
      text-align: center;
      background: #fff;
      outline: none;
    }
    /* Ïõî/Ïùº ÏûêÎèô ÏûÖÎ†• (ÎÇ†Ïßú) - ÏùΩÍ∏∞ Ï†ÑÏö© Ïä§ÌÉÄÏùº */
    .time-group.date-group input {
      background: #fff;
      color: #7a5647;
      border-color: #f4bfa2;
      cursor: default;
    }
    /* Î∂Ñ/Ï¥à Ïã§Ï†ú ÎèÖÏÑú ÏãúÍ∞Ñ - Í∞ïÏ°∞ Ïä§ÌÉÄÏùº */
    .time-group.timer-group input {
      background: #fff;
      border: 1.5px solid #66bb6a;
      color: #2e7d32;
      font-weight: 600;
    }
    .time-group.timer-group label {
      color: #2e7d32;
      font-weight: 600;
    }

    /* === ÏÉà ÏõêÌòï ÌÉÄÏù¥Î®∏ === */
    .quiz-timer-badge {
      position: absolute;
      top: -22px;
      right: 16px;
      width: 90px;
      height: 90px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    .quiz-timer-badge span {
      position: absolute;
      z-index: 2;
      font-weight: 700;
      color: #4a3228;
      font-size: 18px;
      letter-spacing: 0.04em;
    }
    .timer-ring { transform: rotate(-90deg); width: 100%; height: 100%; position: absolute; top: 0; left: 0; }
    .timer-ring circle { fill: none; stroke-width: 6; stroke-linecap: round; }
    .timer-ring .bg { stroke: #f2e1cb; }
    .timer-ring .progress { stroke: #c04a3b; stroke-dasharray: 283; stroke-dashoffset: 283; transition: stroke-dashoffset 0.25s linear; }
    @keyframes timerPulse {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(192,74,59,0.25); }
      50% { transform: scale(1.05); box-shadow: 0 0 10px 6px rgba(192,74,59,0.15); }
      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(192,74,59,0.25); }
    }
    .quiz-timer-badge.active { animation: timerPulse 1.6s infinite; }
    .quiz-timer-badge.paused .progress { stroke: #b99b88; }
    .quiz-timer-badge.reset .progress { stroke: #c04a3b; stroke-dashoffset: 283; }

    /* ===== Î≥∏Î¨∏ Î¨∏Ï†ú ===== */
    .quiz-section { display: flex; flex-direction: column; gap: 14px; }
    .quiz-block { display: flex; gap: 10px; align-items: flex-start; }
    .quiz-block.small .quiz-q {
      font-size: 14px;
      line-height: 1.8;
    }

    .quiz-q {
      max-width: 650px;
      width: auto;
    }

    .quiz-num {
      position: relative;
      width: 30px;
      min-width: 30px;
      height: 30px;
      background: linear-gradient(135deg, #0a9068 0%, #08775b 100%);
      color: #fff;
      border-radius: 10px;
      text-align: center;
      line-height: 30px;
      font-weight: 700;
      font-size: 13px;
      transition: all 0.2s ease;
      box-shadow: 3px 3px 8px rgba(8, 119, 91, 0.4);
      flex-shrink: 0;
      margin-top: 2px;
    }
    .quiz-num .mark {
      position: absolute;
      top: -14px;
      right: -14px;
      width: 28px;
      height: 28px;
      background: #fff;
      border-radius: 50%;
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 700;
      box-shadow: 0 3px 6px rgba(0,0,0,0.15);
    }
    .quiz-num.correct .mark { display: flex; color: #1e8a42; border: 2px solid #1e8a42; }
    .quiz-num.wrong .mark { display: flex; color: #d52424; border: 2px solid #d52424; }

    /* ===== Î¨∏Ï†ú Ïú†Ìòï ÎùºÎ≤® ===== */
    .quiz-subtitle {
      display: inline-block;
      padding: 6px 16px;
      background: linear-gradient(to bottom, #fff9f5 0%, #fff3eb 100%);
      border: 1.5px solid #e8d5c0;
      border-radius: 18px;
      font-size: 13px;
      font-weight: 600;
      color: #8b4513;
      margin-top: 8px;
      margin-bottom: 1px;
      box-shadow: 0 2px 6px rgba(139, 69, 19, 0.1);
      width: fit-content;
    }

    ul.quiz-options {
      list-style: none !important;
      padding-left: 0 !important;
      margin: 12px 0 0 0 !important;
      display: flex !important;
      flex-direction: column !important;
      gap: 10px !important;
    }
    ul.quiz-options li {
      list-style: none !important;
      padding: 0 !important;
      margin: 0 !important;
    }
    ul.quiz-options li label {
      display: flex !important;
      align-items: flex-start !important;
      padding: 6px 18px !important;
      background: linear-gradient(to bottom, #ffffff 0%, #fffefb 100%) !important;
      border: 1.5px solid #e8d5c0 !important;
      border-radius: 14px !important;
      font-size: 14px !important;
      line-height: 1.4 !important;
      cursor: pointer !important;
      transition: all 0.2s ease !important;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05) !important;
      color: #4a3228 !important;
    }
    ul.quiz-options li:nth-child(1) label::before { content: '‚ë†' !important; }
    ul.quiz-options li:nth-child(2) label::before { content: '‚ë°' !important; }
    ul.quiz-options li:nth-child(3) label::before { content: '‚ë¢' !important; }
    ul.quiz-options li:nth-child(4) label::before { content: '‚ë£' !important; }
    ul.quiz-options li label::before {
      display: inline-flex !important;
      align-items: center !important;
      justify-content: center !important;
      font-size: 16px !important;
      color: #333 !important;
      margin-right: 8px !important;
      flex-shrink: 0 !important;
    }
    ul.quiz-options li label:hover {
      border-color: rgba(192, 74, 59, 0.5) !important;
      background: rgba(255, 248, 240, 0.8) !important;
      transform: translateY(-2px) !important;
      box-shadow: 0 4px 12px rgba(192, 74, 59, 0.15) !important;
    }
    ul.quiz-options li input[type="radio"] {
      display: none !important;
    }
    ul.quiz-options li label:has(input:checked) {
      background: linear-gradient(135deg, #ffeee0 0%, #ffd9bf 100%) !important;
      border-color: #c04a3b !important;
      box-shadow: 0 4px 14px rgba(192, 74, 59, 0.25) !important;
      font-weight: 600 !important;
      color: #8b2f2f !important;
    }

    .inline-input {
      display: inline-block;
      width: 140px;
      border: 1px solid #f2c4aa;
      background: #fffdfa;
      border-radius: 8px;
      padding: 4px 8px;
      font-size: 14px;
      margin: 0 8px;
      transition: all 0.2s ease;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }
    .inline-input:focus {
      outline: none;
      border-color: #c04a3b;
      box-shadow: 0 2px 6px rgba(192, 74, 59, 0.15);
    }

    .answer-box textarea {
      width: 100%;
      height: 130px;
      border: 1px solid #f6d0c1;
      background: #fffefb;
      border-radius: 12px;
      padding: 10px;
      resize: vertical;
      font-family: inherit;
      font-size: 14px;
      box-sizing: border-box;
      transition: all 0.2s ease;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }
    .answer-box textarea:focus {
      outline: none;
      border-color: #c04a3b;
      box-shadow: 0 2px 6px rgba(192, 74, 59, 0.15);
    }

    .grade-area {
      position: absolute;
      right: 18px;
      bottom: 18px;
      text-align: right;
      width: calc(100% - 36px);
      display: flex;
      gap: 8px;
      justify-content: flex-end;
      align-items: center;
    }
    .grade-btn, .reset-btn, .submit-btn {
      background: linear-gradient(135deg, #d35a48 0%, #c04a3b 100%);
      color: #fff;
      border: none;
      border-radius: 12px;
      padding: 10px 20px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow:
        0 2px 8px rgba(192, 74, 59, 0.25),
        0 1px 3px rgba(192, 74, 59, 0.15);
      position: relative;
      overflow: hidden;
    }
    .grade-btn::before, .reset-btn::before, .submit-btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    .grade-btn:hover::before, .reset-btn:hover::before, .submit-btn:hover::before {
      width: 300px;
      height: 300px;
    }
    .grade-btn:hover, .reset-btn:hover, .submit-btn:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow:
        0 6px 16px rgba(192, 74, 59, 0.3),
        0 3px 8px rgba(192, 74, 59, 0.2);
    }
    .grade-btn:active, .reset-btn:active, .submit-btn:active {
      transform: translateY(0) scale(0.98);
      box-shadow:
        0 2px 6px rgba(192, 74, 59, 0.2),
        0 1px 3px rgba(192, 74, 59, 0.1);
    }
    .reset-btn {
      background: linear-gradient(135deg, #999 0%, #888 100%);
      box-shadow:
        0 2px 8px rgba(136, 136, 136, 0.25),
        0 1px 3px rgba(136, 136, 136, 0.15);
    }
    .reset-btn:hover {
      box-shadow:
        0 6px 16px rgba(136, 136, 136, 0.3),
        0 3px 8px rgba(136, 136, 136, 0.2);
    }
    .reset-btn:active {
      box-shadow:
        0 2px 6px rgba(136, 136, 136, 0.2),
        0 1px 3px rgba(136, 136, 136, 0.1);
    }
    .submit-btn {
      background: linear-gradient(135deg, #9d3838 0%, #8b2f2f 100%);
      box-shadow:
        0 2px 8px rgba(139, 47, 47, 0.25),
        0 1px 3px rgba(139, 47, 47, 0.15);
    }
    .submit-btn:hover {
      box-shadow:
        0 6px 16px rgba(139, 47, 47, 0.3),
        0 3px 8px rgba(139, 47, 47, 0.2);
    }
    .submit-btn:active {
      box-shadow:
        0 2px 6px rgba(139, 47, 47, 0.2),
        0 1px 3px rgba(139, 47, 47, 0.1);
    }

    .grade-result {
      position: static;
      background: #fff4ee;
      border: 1px solid #f3c8b4;
      border-radius: 10px;
      padding: 10px 12px;
      font-size: 13px;
      max-height: 400px;
      overflow-y: auto;
      display: none;
      margin-top: 20px;
      margin-bottom: 20px;
    }

    /* ===== Ïñ¥ÌúòÌïôÏäµ ===== */
    #tab-vocab { max-width: 980px; margin: 18px auto 40px; }
    .vocab-box {
      background: #ffffff;
      border: none;
      border-radius: 8px;
      padding: 28px 32px 70px;
      position: relative;
      box-shadow:
        0 1px 3px rgba(0, 0, 0, 0.08),
        0 3px 8px rgba(0, 0, 0, 0.06);
    }
    /* Îí∑Î∞∞Í≤Ω Ï¢ÖÏù¥ 1 (Í∞ÄÏû• Îí§) */
    .vocab-box::before {
      content: '';
      position: absolute;
      left: -6px;
      top: 8px;
      right: 6px;
      bottom: -8px;
      background: #faf8f5;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
      z-index: -2;
      transform: rotate(-0.5deg);
    }
    /* Îí∑Î∞∞Í≤Ω Ï¢ÖÏù¥ 2 (Ï§ëÍ∞Ñ) */
    .vocab-box::after {
      content: '';
      position: absolute;
      left: -3px;
      top: 4px;
      right: 3px;
      bottom: -4px;
      background: #fefdfb;
      border-radius: 8px;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
      z-index: -1;
      transform: rotate(0.3deg);
    }
    .vocab-header { display:flex; align-items:center; gap:16px; margin-bottom:20px; }
    .vocab-badge {
      display: none;
    }

    /* ÏãúÍ≥Ñ ÏÉÅÎã® ÎßÅ Ï†úÍ±∞ */
    .vocab-badge::before {
      display: none;
    }

    /* ÏãúÍ≥Ñ Ï§ëÏïô Ï†ê Ï†úÍ±∞ */
    .vocab-badge::after {
      display: none;
    }
    .vocab-badge-timer {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100%;
      height: 100%;
      z-index: 1;
    }
    .vocab-badge-timer circle {
      fill: none;
      stroke: #e74c3c;
      stroke-width: 8;
      stroke-dasharray: 346;
      stroke-dashoffset: 346;
      animation: vocabTimerFill 300s linear forwards;
      transform: rotate(-90deg);
      transform-origin: center;
      stroke-linecap: round;
    }
    @keyframes vocabTimerFill {
      to {
        stroke-dashoffset: 0;
      }
    }
    .vocab-badge-text {
      position: relative;
      z-index: 2;
      color: #2d2d2d;
      font-size: 13px;
      font-weight: 600;
      line-height: 1.4;
    }

    .vocab-badge-text .time-big {
      display: block;
      font-size: 28px;
      font-weight: 800;
      margin-top: 2px;
      color: #e74c3c;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    .vocab-message {
      background: #ea720f;
      border: none;
      border-radius: 16px;
      padding: 16px 32px;
      color: #fff;
      font-size: 18px;
      font-weight: 700;
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      text-align: center;
    }
    .vocab-char-box { display: none; }
    .vocab-char-img { display: none; }

    .vocab-fill-text { line-height:1.9; color:#444; font-size:17px; }
    .vocab-fill-text p { margin-bottom:14px; }

    .blank-wrap {
      position: relative; display: inline-flex; align-items: center;
      background: #fff; border: 1px solid #f0c9a0; border-radius: 999px;
      padding: 2px 14px 2px 46px; vertical-align: baseline; min-height: 38px; gap: 6px;
    }
    .blank-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); width: 24px; height: 24px; background: #f8d2aa; border-radius: 999px; display: flex; align-items: center; justify-content: center; font-size: 14px; }
    .blank-input { border: none; outline: none; background: transparent; width: 120px; font-size: 18px; text-align: center; }
    .blank-mark {
      position: absolute; top: -10px; left: -10px; width: 26px; height: 26px; background: #fff;
      border-radius: 50%; border: 2px solid #1e8a42; color: #1e8a42;
      display: none; align-items: center; justify-content: center; font-size: 14px; font-weight: 700; box-shadow: 0 2px 4px rgba(0,0,0,0.07); pointer-events: none;
    }
    .blank-wrap.correct .blank-mark { display:flex; }
    .blank-wrap.wrong .blank-mark { display:flex; border-color:#d52424; color:#d52424; }

    .vocab-actions { position: absolute; right: 20px; bottom: 20px; display: flex; gap: 12px; }
    .vocab-btn {
      background: linear-gradient(135deg, #e67e50 0%, #c04a3b 100%);
      color: #fff;
      border: none;
      border-radius: 12px;
      padding: 12px 24px;
      cursor: pointer;
      font-weight: 700;
      font-size: 15px;
      box-shadow: 0 4px 12px rgba(192, 74, 59, 0.25);
      transition: all 0.3s ease;
    }
    .vocab-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(192, 74, 59, 0.35);
    }
    .vocab-btn.secondary {
      background: linear-gradient(135deg, #a0a0a0 0%, #707070 100%);
      box-shadow: 0 4px 12px rgba(112, 112, 112, 0.25);
    }
    .vocab-btn.secondary:hover {
      box-shadow: 0 6px 16px rgba(112, 112, 112, 0.35);
    }

    /* Î∂ÑÏÑùÎ¶¨Ìè¨Ìä∏ Î≤ÑÌäº Ïä§ÌÉÄÏùº */
    .report-actions {
      text-align: right;
      margin-top: 20px;
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }
    .report-btn-remedial {
      background: linear-gradient(135deg, #4a9d6b 0%, #3a8755 100%) !important;
      color: #fff !important;
      border: none !important;
      border-radius: 12px !important;
      padding: 12px 24px !important;
      cursor: pointer !important;
      font-weight: 600 !important;
      font-size: 15px !important;
      box-shadow: 0 4px 12px rgba(58, 135, 85, 0.3) !important;
      transition: all 0.3s ease !important;
    }
    .report-btn-remedial:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(58, 135, 85, 0.4) !important;
    }
    .report-btn-submit {
      background: linear-gradient(135deg, #917ebc 0%, #7d6aa8 100%) !important;
      color: #fff !important;
      border: none !important;
      border-radius: 12px !important;
      padding: 12px 24px !important;
      cursor: pointer !important;
      font-weight: 600 !important;
      font-size: 15px !important;
      box-shadow: 0 4px 12px rgba(125, 106, 168, 0.3) !important;
      transition: all 0.3s ease !important;
    }
    .report-btn-submit:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(125, 106, 168, 0.4) !important;
    }

    .vocab-result { margin-top: 20px; background: #fff4ee; border: 1px solid #f3c8b4; border-radius: 10px; padding: 10px 12px; font-size: 13px; display: none; }

    /* ===== Ï∞ΩÏùòÌôúÎèô ===== */
    #tab-creative {
      max-width: 900px;
      margin: 20px auto 50px;
      background:
        repeating-linear-gradient(
          0deg,
          transparent,
          transparent 29px,
          #e8ddd0 29px,
          #e8ddd0 30px
        ),
        repeating-linear-gradient(
          90deg,
          transparent,
          transparent 29px,
          #e8ddd0 29px,
          #e8ddd0 30px
        ),
        #faf7f2;
      border: 2px solid #d4c4b0;
      border-radius: 8px;
      padding: 24px;
      box-shadow:
        0 2px 8px rgba(0, 0, 0, 0.08),
        inset 0 0 0 1px rgba(255, 255, 255, 0.5);
    }
    .creative-box { background:#fff; border:1px solid #f1dcc4; border-radius:14px; padding:22px 24px 60px; position: relative; }
    .creative-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 20px;
      color: #fff;
      background: linear-gradient(135deg, rgba(78, 179, 142, 0.95), rgba(58, 159, 122, 0.95));
      padding: 16px 24px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(78, 179, 142, 0.3);
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    /* Ï£ºÏ†ú/ÌûåÌä∏ Î∞ïÏä§ */
    .creative-topic-box {
      background: linear-gradient(135deg, #fff9f0 0%, #fef5e8 100%);
      border: 2px solid #f4d8b8;
      border-left: 5px solid #e8a060;
      border-radius: 12px;
      padding: 16px 20px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(192, 74, 59, 0.08);
    }
    .creative-topic-box strong {
      color: #c04a3b;
      font-size: 17px;
    }
    .creative-hint {
      margin-top: 8px;
      padding: 10px 14px;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 8px;
      font-size: 15px;
      color: #6c5a50;
      line-height: 1.6;
    }

    /* ÏòàÏãú Î∞ïÏä§ */
    .creative-examples-box {
      background: linear-gradient(135deg, #f0faf8 0%, #e8f5f3 100%);
      border: 2px solid #b8d8d0;
      border-left: 5px solid #6fb399;
      border-radius: 12px;
      padding: 16px 20px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(111, 179, 153, 0.08);
    }
    .creative-examples-box .example-title {
      font-weight: 700;
      color: #3a8755;
      font-size: 16px;
      margin-bottom: 10px;
    }
    .creative-examples-box div {
      margin: 8px 0;
      padding-left: 8px;
      color: #4a6a5e;
      line-height: 1.7;
    }
    .creative-textarea {
      width: 100%; min-height: 180px; border: 1px solid #f3d2c3; border-radius: 10px;
      padding: 10px; font-family: inherit; font-size: 16px; resize: vertical; box-sizing: border-box; background:#fffefb; line-height: 1.5;
    }
    .creative-actions { position: absolute; right: 20px; bottom: 18px; display: flex; gap: 12px; }
    .creative-btn {
      color: #fff;
      border: none;
      border-radius: 12px;
      padding: 12px 24px;
      cursor: pointer;
      font-weight: 600;
      font-size: 15px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      transition: all 0.3s ease;
    }
    .creative-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    }
    .creative-btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    }
    #creative-check-btn {
      background: linear-gradient(135deg, #4a9d6b 0%, #3a8755 100%);
    }
    #creative-submit-btn {
      background: linear-gradient(135deg, #d16355 0%, #c04a3b 100%);
    }
    .creative-result { margin-top: 18px; background:#fff4ee; border:1px solid #f3c8b4; border-radius:10px; padding:12px 14px; font-size:15px; line-height: 1.7; display:none; }
    .highlight-wrong { color:#d52424; text-decoration: underline wavy #d52424; text-underline-offset: 3px; font-size: 17px; font-weight: 600; }
    .highlight-correct { color:#3a8755; text-decoration: underline solid #3a8755; text-underline-offset: 3px; font-weight: 700; font-size: 17px; }
    .correct-block { background:#fff; border:1px solid #f1d2bf; border-radius:8px; padding:8px 10px; margin-top:10px; }

    /* ===== ÎßûÏ∂§Î≤ï Í≤ÄÏÇ¨ Î°úÎî© ÌåùÏóÖ ===== */
    .spell-check-loading {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 9999;
      justify-content: center;
      align-items: center;
    }
    .spell-check-loading-content {
      background: #fff;
      border-radius: 16px;
      padding: 40px 50px;
      text-align: center;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    }
    .spell-check-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid #f3e5d8;
      border-top: 4px solid #c04a3b;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .spell-check-loading-text {
      font-size: 16px;
      font-weight: 600;
      color: #3b2f27;
    }

    /* ===== Î∂ÑÏÑùÎ¶¨Ìè¨Ìä∏ ÌÉ≠ ===== */
    #tab-report { max-width: 900px; margin: 20px auto 50px; }
    .report-wrap { background: #fffefb; border: 1px solid #f3dcc5; border-radius: 16px; padding: 20px 24px 28px; }
    .report-title {
      margin: 0 0 20px;
      font-size: 20px;
      font-weight: 700;
      color: #fff;
      background: linear-gradient(135deg, #917ebc 0%, #7d6aa8 100%);
      padding: 16px 24px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(125, 106, 168, 0.3);
      text-align: center;
    }
    .report-desc { margin-bottom: 20px; font-size: 16px; color: #7a5647; }

    .report-chart-box { width: 360px; margin: 0 auto 24px; }
    #report-radar { width: 100%; display: block; }

    .report-pentagon { position: relative; width: 280px; height: 240px; margin: 0 auto 22px; display:none; }
    .report-pentagon .rp {
      position: absolute; width: 120px; min-height: 60px; background: #fde7d6; border: 1px solid #f3c1aa;
      border-radius: 14px; text-align: center; padding: 6px 8px 8px; box-sizing: border-box;
      display: flex; flex-direction: column; gap: 2px; justify-content: center; align-items: center; font-size: 15px; color: #4a3228;
    }
    .report-pentagon .rp-label { font-weight: 700; }
    .report-pentagon .rp-sub { font-size: 13px; color: #8b6f61; }
    .report-pentagon .rp-1 { top: 0; left: 50%; transform: translateX(-50%); }
    .report-pentagon .rp-2 { top: 65px; left: 5px; }
    .report-pentagon .rp-3 { top: 65px; right: 5px; }
    .report-pentagon .rp-4 { bottom: 10px; left: 45px; }
    .report-pentagon .rp-5 { bottom: 10px; right: 45px; }
    .report-pentagon .rp.ok { background: #fff4ee; border-color: #c04a3b; box-shadow: 0 3px 8px rgba(192,74,59,0.08); color: #c04a3b; }

    .report-log { display: flex; flex-direction: column; gap: 10px; }
    .report-log-item {
      padding: 10px 14px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
    }
    .report-log-item.success {
      background: #ffffff;
      border: 2px solid #4A90E2;
      color: #2563EB;
    }
    .report-log-item.warning {
      background: #ffffff;
      border: 2px solid #e57373;
      color: #c62828;
    }
    .report-log-item .icon {
      font-size: 16px;
      flex-shrink: 0;
    }

    /* ===== Ï§ëÏïô Ï†úÏ∂ú ÏôÑÎ£å Ïò§Î≤ÑÎ†àÏù¥ ===== */
    #submit-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 999; align-items: center; justify-content: center; }
    #submit-overlay.show { display: flex; }
    #submit-overlay .box {
      background: #fff; color: #2c2c2c; font-size: 28px; font-weight: 700; padding: 32px 54px;
      border-radius: 16px; box-shadow: 0 8px 20px rgba(0,0,0,0.3); text-align: center; opacity: 0;
    }
    @keyframes popFade {
      0% { transform: scale(0.9); opacity: 0; }
      15% { transform: scale(1); opacity: 1; }
      80% { transform: scale(1); opacity: 1; }
      100% { transform: scale(1); opacity: 0; }
    }
    #submit-overlay.show .box { animation: popFade 2.5s ease forwards; }

    /* ===== Îí§Î°ú Í∞ÄÍ∏∞ ÌôïÏù∏ ÌåùÏóÖ ===== */
    #back-confirm-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    #back-confirm-overlay.show {
      display: flex;
    }
    .back-confirm-box {
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      border-radius: 20px;
      padding: 40px 50px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      text-align: center;
      max-width: 450px;
      animation: slideIn 0.3s ease;
    }
    @keyframes slideIn {
      from {
        transform: translateY(-30px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    .back-confirm-icon {
      font-size: 80px;
      margin-bottom: 20px;
    }
    .back-confirm-title {
      font-size: 24px;
      font-weight: 700;
      color: #2c2c2c;
      margin-bottom: 12px;
    }
    .back-confirm-message {
      font-size: 16px;
      color: #666;
      margin-bottom: 30px;
      line-height: 1.5;
    }
    .back-confirm-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
    }
    .back-confirm-btn {
      padding: 12px 30px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .back-confirm-btn.cancel {
      background: #e0e0e0;
      color: #555;
    }
    .back-confirm-btn.cancel:hover {
      background: #d0d0d0;
    }
    .back-confirm-btn.confirm {
      background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
    }
    .back-confirm-btn.confirm:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(76, 175, 80, 0.4);
    }

    @media (max-width: 900px) {
      .learning-layout { flex-direction: column; }
      .right-quiz { padding-bottom: 140px; }
      .grade-area { bottom: 12px; }      .vocab-header { flex-wrap: wrap; }
      .vocab-actions { position: static; margin-top: 20px; justify-content: flex-end; }
      .creative-actions { position: static; margin-top: 12px; justify-content: flex-end; }
      .student-info input { width: 70px; }
      .report-chart-box { width: 100%; }
    }

    /* ‚úÖ 03, 04Î≤à ÎπàÏπ∏ ÏûÖÎ†•Ïπ∏/placeholder Í∞ÄÏö¥Îç∞ Ï†ïÎ†¨ */
    #q3-1, #q3-2, #q4-1, #q4-2 { text-align: center !important; }
    #q3-1::placeholder, #q3-2::placeholder, #q4-1::placeholder, #q4-2::placeholder,
    #q3-1::-webkit-input-placeholder, #q3-2::-webkit-input-placeholder, #q4-1::-webkit-input-placeholder, #q4-2::-webkit-input-placeholder,
    #q3-1::-moz-placeholder, #q3-2::-moz-placeholder, #q4-1::-moz-placeholder, #q4-2::-moz-placeholder { text-align: center !important; }

    /* ===== ÏûêÎèô ÌîºÎìúÎ∞± Î∞ïÏä§ ===== */
    .feedback-section { margin-top: 18px; background: #fffaf1; border: 1px solid #e6c9a4; border-radius: 10px; padding: 14px 16px; line-height: 1.5; }
    .feedback-section h3 { margin: 0 0 8px; font-size: 15px; color: #8b2f2f; }
    .feedback-section ul { margin: 0; padding-left: 18px; }
    .feedback-section li { margin-bottom: 4px; }

    /* ===== Î°úÎî© Ïò§Î≤ÑÎ†àÏù¥ ===== */
    #loadingOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #fffefb;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }
    #loadingOverlay.show {
      opacity: 1;
      pointer-events: all;
    }
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid #f3dcc5;
      border-top: 4px solid #c04a3b;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .loading-text {
      margin-top: 20px;
      font-size: 16px;
      color: #8b2f2f;
      font-weight: 600;
    }
  </style>

  <!-- Ï∫°Ï≤ò ÎùºÏù¥Î∏åÎü¨Î¶¨ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

  <!-- Î°úÎî© Ïò§Î≤ÑÎ†àÏù¥ -->
  <div id="loadingOverlay" class="show">
    <div class="loading-spinner"></div>
    <div class="loading-text">ÏΩòÌÖêÏ∏†Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</div>
  </div>

  <!-- ÏÉÅÎã® ÌÉ≠ -->
  <div class="top-tabs">
    <div class="tab-btn active" data-tab="reading">‚úèÔ∏è Î≥∏Î¨∏ÌïôÏäµ</div>
    <div class="tab-btn" data-tab="vocab">üìñ Ïñ¥ÌúòÌïôÏäµ</div>
    <div class="tab-btn" data-tab="creative">üí° Ï∞ΩÏùòÌôúÎèô</div>
    <div class="tab-btn tab-report" data-tab="report">üîç Î∂ÑÏÑùÎ¶¨Ìè¨Ìä∏</div>

    <!-- Ïò§Î•∏Ï™Ω Í≥†Ï†ï ÌïôÏÉùÏ†ïÎ≥¥ -->
    <div class="student-info">
      <label>ÌïôÎÖÑ :</label>
      <input type="text" id="student-grade" placeholder="Ïòà: 5ÌïôÎÖÑ">
      <label>Ïù¥Î¶Ñ :</label>
      <input type="text" id="student-name" placeholder="Ïù¥Î¶Ñ">
    </div>
  </div>

  <!-- ===== Î≥∏Î¨∏ÌïôÏäµ ÌÉ≠ ===== -->
  <div id="tab-reading" class="tab-panel active">
    <div class="learning-layout" id="capture-reading">
      <!-- ÏôºÏ™Ω ÏßÄÎ¨∏ -->
      <div class="left-passage">
        <div class="passage-wrap">
          <!-- ÏõπÌà∞ÌûåÌä∏ ÎìúÎ°≠Îã§Ïö¥ -->
          <div class="webtoon-hint-container">
            <a href="#" class="webtoon-hint-btn" id="webtoonHintBtn" onclick="toggleWebtoonDropdown(); return false;">ÏõπÌà∞ÌûåÌä∏ <span class="arrow">‚ñº</span></a>
            <div class="webtoon-dropdown" id="webtoonDropdown">
              <div class="webtoon-dropdown-header">
                <span>üìñ Î∞∞Í≤ΩÏßÄÏãù ÏâΩÍ≤å ÏùµÌûàÍ∏∞</span>
                <button class="webtoon-dropdown-close" onclick="closeWebtoonDropdown()">&times;</button>
              </div>
              <div class="webtoon-dropdown-body" id="webtoonBody">
                <img data-src="/images/ÏõπÌà∞/ÌòÑÎåÄÎ¨∏Ìïô32/ÌòÑÎåÄÎ¨∏Ìïô_01.jpg" alt="ÏõπÌà∞ÌûåÌä∏ 1">
                <img data-src="/images/ÏõπÌà∞/ÌòÑÎåÄÎ¨∏Ìïô32/ÌòÑÎåÄÎ¨∏Ìïô_02.jpg" alt="ÏõπÌà∞ÌûåÌä∏ 2">
                <img data-src="/images/ÏõπÌà∞/ÌòÑÎåÄÎ¨∏Ìïô32/ÌòÑÎåÄÎ¨∏Ìïô_03.jpg" alt="ÏõπÌà∞ÌûåÌä∏ 3">
                <img data-src="/images/ÏõπÌà∞/ÌòÑÎåÄÎ¨∏Ìïô32/ÌòÑÎåÄÎ¨∏Ìïô_04.jpg" alt="ÏõπÌà∞ÌûåÌä∏ 4">
                <img data-src="/images/ÏõπÌà∞/ÌòÑÎåÄÎ¨∏Ìïô32/ÌòÑÎåÄÎ¨∏Ìïô_05.jpg" alt="ÏõπÌà∞ÌûåÌä∏ 5">
              </div>
            </div>
          </div>
          <!-- ‚úÖ ÎùºÎ≤® Î≤àÌò∏ 01Î°ú ÏàòÏ†ï -->
          <div class="passage-label"><span>BRAINÏóÖ„Ö£ÌòÑÎåÄÎ¨∏Ìïô</span><strong>32</strong></div>
          <h1 class="passage-title"></h1>
          <div class="passage-text">
          </div>
          <div class="passage-vocab">
            <ol>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ol>
          </div>
        </div>
      </div>

      <!-- Ïò§Î•∏Ï™Ω Î¨∏Ï†ú -->
      <div class="right-quiz">
        <!-- ÏãúÍ∞Ñ ÏûÖÎ†• -->
        <div class="quiz-header">
          <div class="date-box">
            <span class="calendar-icon" id="calendar-icon" onclick="toggleCalendar()">üìÖ</span>
            <div class="time-group date-group"><label>Ïõî</label><input id="month-input" type="number" placeholder="11"></div>
            <div class="time-group date-group"><label>Ïùº</label><input id="day-input" type="number" placeholder="10"></div>
          </div>
          <div class="timer-box">
            <span class="timer-icon" id="timer-icon" onclick="toggleTimer()">‚è∞</span>
            <div class="time-group timer-group"><label>Î∂Ñ</label><input id="minute-input" type="number" placeholder="05"></div>
            <div class="time-group timer-group"><label>Ï¥à</label><input id="second-input" type="number" placeholder="00"></div>
          </div>
        </div>

        <!-- Î¨∏Ï†úÎì§ -->
        <div class="quiz-section">
          <div class="quiz-subtitle">Í∞ùÍ¥ÄÏãù Î¨∏Ï†ú</div>

          <!-- 1 -->
          <div class="quiz-block">
            <div class="quiz-num">01<div class="mark"></div></div>
            <div class="quiz-content">
              <p class="quiz-q" id="quiz-q1-text"></p>
              <ul class="quiz-options" id="quiz-q1-opts">
                <li><label><input type="radio" name="q1" value="1"><span></span></label></li>
                <li><label><input type="radio" name="q1" value="2"><span></span></label></li>
                <li><label><input type="radio" name="q1" value="3"><span></span></label></li>
                <li><label><input type="radio" name="q1" value="4"><span></span></label></li>
              </ul>
            </div>
          </div>

          <!-- 2 -->
          <div class="quiz-block">
            <div class="quiz-num">02<div class="mark"></div></div>
            <div class="quiz-content">
              <p class="quiz-q" id="quiz-q2-text"></p>
              <ul class="quiz-options" id="quiz-q2-opts">
                <li><label><input type="radio" name="q2" value="1"><span></span></label></li>
                <li><label><input type="radio" name="q2" value="2"><span></span></label></li>
                <li><label><input type="radio" name="q2" value="3"><span></span></label></li>
                <li><label><input type="radio" name="q2" value="4"><span></span></label></li>
              </ul>
            </div>
          </div>

          <!-- 3 (Í∞ùÍ¥ÄÏãù) -->
          <div class="quiz-block">
            <div class="quiz-num">03<div class="mark"></div></div>
            <div class="quiz-content">
              <p class="quiz-q" id="quiz-q3-text"></p>
              <ul class="quiz-options" id="quiz-q3-opts">
                <li><label><input type="radio" name="q3" value="1"><span></span></label></li>
                <li><label><input type="radio" name="q3" value="2"><span></span></label></li>
                <li><label><input type="radio" name="q3" value="3"><span></span></label></li>
                <li><label><input type="radio" name="q3" value="4"><span></span></label></li>
              </ul>
            </div>
          </div>

          <!-- 4 (Í∞ùÍ¥ÄÏãù) -->
          <div class="quiz-block">
            <div class="quiz-num">04<div class="mark"></div></div>
            <div class="quiz-content">
              <p class="quiz-q" id="quiz-q4-text"></p>
              <ul class="quiz-options" id="quiz-q4-opts">
                <li><label><input type="radio" name="q4" value="1"><span></span></label></li>
                <li><label><input type="radio" name="q4" value="2"><span></span></label></li>
                <li><label><input type="radio" name="q4" value="3"><span></span></label></li>
                <li><label><input type="radio" name="q4" value="4"><span></span></label></li>
              </ul>
            </div>
          </div>

          <div class="quiz-subtitle">ÏÑúÏà†Ìòï Î¨∏Ï†ú</div>
          <!-- 5 -->
          <div class="quiz-block">
            <div class="quiz-num">05<div class="mark"></div></div>
            <div class="quiz-content">
              <p class="quiz-q" id="quiz-q5-text"></p>
              <div class="answer-box">
                <textarea id="q5"></textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- Ïö∞Ï∏° ÌïòÎã® Ï±ÑÏ†ê -->
        <div id="grade-result" class="grade-result"></div>
        <div class="grade-area">
          <button id="reset-btn" class="reset-btn" style="display:none;" onclick="resetQuiz()">Îã§ÏãúÌíÄÍ∏∞</button>
          <button id="save-progress-btn" class="grade-btn" style="background:#d32f2f;" onclick="saveReadingProgress()">üìã Ï±ÑÏ†ê Î∞è Ï†úÏ∂úÌïòÍ∏∞</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Ïñ¥ÌúòÌïôÏäµ ÌÉ≠ ===== -->
  <div id="tab-vocab" class="tab-panel">
    <div class="vocab-box" id="capture-vocab">
      <div class="vocab-header">
        <div class="vocab-badge">
          <svg class="vocab-badge-timer" viewBox="0 0 110 110">
            <circle cx="55" cy="55" r="51"></circle>
          </svg>
          <div class="vocab-badge-text">Ï†úÌïúÏãúÍ∞Ñ<br><span class="time-big">3Î∂Ñ</span></div>
        </div>
        <div class="vocab-message">‚úèÔ∏è Î≥∏Î¨∏ÌïôÏäµ ÏßÄÎ¨∏Ïóê Ìï¥ÎãπÌïòÎäî Ïñ¥ÌúòÎ•º Ï±ÑÏõå Î¥ÖÏãúÎã§.</div>
        <div class="vocab-char-box">
        </div>
      </div>

      <div class="vocab-fill-text">
        
      </div>

      <div id="vocab-result" class="vocab-result"></div>

      <script>
        // Ïñ¥ÌúòÌïôÏäµ Ï±ÑÏ†ê Î∞è Ï†úÏ∂úÌïòÍ∏∞ Ìï®Ïàò
        window.vocabSaveToServer = async function() {
          console.log('[vocabSaveToServer] Î≤ÑÌäº ÌÅ¥Î¶≠Îê®');

          // 1. ÌïôÏÉù Ï†ïÎ≥¥ ÌôïÏù∏
          if (typeof ensureStudentInfo === 'function' && !ensureStudentInfo()) {
            if (typeof showSubmitOverlay === 'function') {
              showSubmitOverlay('ÌïôÎÖÑÍ≥º Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
            } else {
              alert('ÌïôÎÖÑÍ≥º Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
            }
            return;
          }

          try {
            const blanks = document.querySelectorAll('#tab-vocab .blank-wrap');
            const vocabResultBox = document.getElementById('vocab-result');
            let correctCnt = 0;
            const total = blanks.length;
            let fullMsgs = [];

            // 2. Ï±ÑÏ†êÌïòÍ∏∞ Î°úÏßÅ - Ï±ÑÏ†ê Ï¶âÏãú Ï†ïÎãµ(Ìï¥ÏÑ§) ÌëúÏãú
            blanks.forEach((bw, idx) => {
              const ans = bw.dataset.answer ? bw.dataset.answer.trim() : '';
              const inputEl = bw.querySelector('.blank-input');
              const input = inputEl ? inputEl.value.trim() : '';
              const mark = bw.querySelector('.blank-mark');

              const normIn = input.replace(/\s+/g,"").toLowerCase();
              const normAns = ans.replace(/\s+/g,"").toLowerCase();

              let ok = (normIn === normAns);

              bw.classList.remove('correct','wrong');
              if (ok) {
                bw.classList.add('correct');
                if (mark) mark.textContent = "‚≠ï";
                correctCnt++;
                fullMsgs.push(`<span style="color:#2e7d32">${idx+1}Î≤à: Ï†ïÎãµ ‚úÖ</span> <span style="color:#666">(${ans})</span>`);
              } else {
                bw.classList.add('wrong');
                if (mark) mark.textContent = "‚úñ";
                fullMsgs.push(`<span style="color:#c62828">${idx+1}Î≤à: Ïò§Îãµ ‚ùå</span> <span style="color:#1565c0; font-weight:bold">(Ï†ïÎãµ: ${ans})</span>`);
              }
            });

            // Í≤∞Í≥º + Ï†ïÎãµ(Ìï¥ÏÑ§) Î∞îÎ°ú ÌëúÏãú
            if (vocabResultBox) {
              vocabResultBox.style.display = "block";
              const scorePercent = Math.round((correctCnt / total) * 100);
              vocabResultBox.innerHTML =
                `<div style="background:#f5f5f5; padding:12px; border-radius:8px; margin-bottom:10px;">
                  <p style="font-size:18px; margin:0;"><strong>üìä Ï±ÑÏ†ê Í≤∞Í≥º: ${correctCnt} / ${total} (${scorePercent}Ï†ê)</strong></p>
                </div>
                <div style="background:#fff; padding:10px; border:1px solid #ddd; border-radius:8px;">
                  <p style="font-weight:bold; margin:0 0 8px; color:#333;">üìù Ï†ïÎãµ Ìï¥ÏÑ§</p>
                  ${fullMsgs.map(m => `<p style="margin:4px 0;">${m}</p>`).join("")}
                </div>`;
            }

            // 3. PDF Îã§Ïö¥Î°úÎìú
            if (typeof captureElementToPDF === 'function') {
              await captureElementToPDF('capture-vocab', 'Îã®Îã®Íµ≠Ïñ¥_Ïñ¥ÌúòÌïôÏäµ.pdf', { withStudentInfo: true });
            }

            // 4. ÏÑúÎ≤Ñ Ï†ÄÏû•
            const saveFn = window.saveUnitProgressToServer;
            if (typeof saveFn === 'function') {
              const vocabDataArr = [];
              blanks.forEach(bw => {
                const input = bw.querySelector('.blank-input');
                const mark = bw.querySelector('.blank-mark');
                vocabDataArr.push({
                  value: input ? input.value : '',
                  isCorrect: bw.classList.contains('correct'),
                  isWrong: bw.classList.contains('wrong'),
                  markText: mark ? mark.textContent : ''
                });
              });

              const dataToSave = {
                vocabState: {
                  vocabData: vocabDataArr,
                  resultHTML: vocabResultBox ? vocabResultBox.innerHTML : '',
                  isGraded: true
                }
              };

              await saveFn(dataToSave);
              console.log('[vocabSaveToServer] ÏÑúÎ≤Ñ Ï†ÄÏû• ÏôÑÎ£å!');
            }

            // 5. Îã§ÏãúÌíÄÍ∏∞ Î≤ÑÌäº ÌëúÏãú
            const vocabResetBtn = document.getElementById('vocab-reset');
            if (vocabResetBtn) vocabResetBtn.style.display = 'inline-block';

            // 6. ÏôÑÎ£å ÏïåÎ¶º
            if (typeof showSubmitSuccess === 'function') {
              showSubmitSuccess('Ïñ¥ÌúòÌïôÏäµ');
            } else {
              alert('Ï±ÑÏ†ê Î∞è Ï†ÄÏû• ÏôÑÎ£å!');
            }

          } catch (err) {
            console.error('[vocabSaveToServer] Ïã§Ìå®:', err);
            alert('Ï≤òÎ¶¨ Ïã§Ìå®: ' + err.message);
          }
        };
      </script>

      <div class="vocab-actions" style="justify-content: flex-end;">
        <button id="vocab-reset" class="vocab-btn secondary" style="display:none;" onclick="vocabReset()">Îã§ÏãúÌíÄÍ∏∞</button>
        <button id="vocab-save-server" class="vocab-btn" style="background:#8b2f2f;" onclick="vocabSaveToServer()">Ï±ÑÏ†ê Î∞è Ï†úÏ∂úÌïòÍ∏∞</button>
      </div>
      <script>
        // Îã§ÏãúÌíÄÍ∏∞ Ìï®Ïàò
        window.vocabReset = function() {
          document.querySelectorAll('#tab-vocab .blank-wrap').forEach(bw => {
            bw.classList.remove('correct', 'wrong');
            const input = bw.querySelector('.blank-input');
            if (input) {
              input.value = '';
              input.disabled = false;  // ÏûÖÎ†•Ï∞Ω Îã§Ïãú ÌôúÏÑ±Ìôî
            }
            const mark = bw.querySelector('.blank-mark');
            if (mark) mark.textContent = '';
          });
          const vocabResultBox = document.getElementById('vocab-result');
          if (vocabResultBox) {
            vocabResultBox.style.display = 'none';
            vocabResultBox.innerHTML = '';
          }
          const vocabResetBtn = document.getElementById('vocab-reset');
          if (vocabResetBtn) vocabResetBtn.style.display = 'none';
          const vocabGradeBtn = document.getElementById('vocab-grade');
          if (vocabGradeBtn) vocabGradeBtn.style.display = 'inline-block';
          console.log('[vocabReset] Îã§ÏãúÌíÄÍ∏∞ ÏôÑÎ£å');
        };
      </script>
    </div>
  </div>

  <!-- ===== Ï∞ΩÏùòÌôúÎèô ÌÉ≠ ===== -->
  <div id="tab-creative" class="tab-panel">
    <div class="creative-box" id="capture-creative">
      <div class="creative-title">AiÍ≥†ÎûòÏå§Í≥º Ìï®ÍªòÌïòÎäî Ï∞ΩÏùòÌôúÎèô ‚Äî ÎÇòÎßåÏùò Ï∞ΩÏùòÏ†ÅÏù∏ Ï£ºÏ†úÎ°ú ÏÜåÍ∞úÌïòÍ∏∞</div>
      <div style="text-align: left; color: #666; font-size: 14px; margin-top: 8px; margin-bottom: 12px;">
        Í∏ÄÏì∞Í∏∞ Ï§ë Í∂ÅÍ∏àÌïòÍ±∞ÎÇò Ïñ¥Î†§Ïö¥ Ï†êÏù¥ ÏûàÏúºÎ©¥ Ïö∞Ï∏° ÌïòÎã® AiÍ≥†ÎûòÏå§ÏùÑ ÌÅ¥Î¶≠ ÌõÑ 'Í∏ÄÏì∞Í∏∞' ÏÑ†ÌÉùÌï¥ÏÑú Î¨ºÏñ¥Î≥¥ÏÑ∏Ïöî!
      </div>

      <!-- Ï£ºÏ†ú/ÌûåÌä∏ Î∞ïÏä§ -->
      <div class="creative-topic-box">
        <div>
          <strong>üåü Ï£ºÏ†ú:</strong>
          <strong id="creative-title"></strong>
        </div>
        <div class="creative-hint" id="creative-hint"></div>
      </div>

      <!-- ÏòàÏãú Î∞ïÏä§ -->
      <div class="creative-examples-box">
        <div class="example-title">üìù ÏûëÏÑ± ÏòàÏãú</div>
        <div id="creative-ex1"></div>
        <div id="creative-ex2"></div>
        <div id="creative-ex3"></div>
      </div>

      <!-- üî∂ Ï∞ΩÏùòÌôúÎèô ÏûÖÎ†•/Ï†úÏ∂ú ÏòÅÏó≠ (ÍµêÏ≤¥Î≥∏) -->
      <div id="creative-input-wrap">
        <!-- üî∏ Ï∞ΩÏùòÌôúÎèô textarea -->
        <textarea id="creative-input"
                  class="creative-textarea"
                  rows="10"
                  placeholder="ÎßûÏ∂§Î≤ïÍ≥º ÎùÑÏñ¥Ïì∞Í∏∞Ïóê ÎßûÍ≤å ÏûêÏú†Î°≠Í≤å Ï†ÅÏñ¥Î≥¥ÏÑ∏Ïöî."></textarea>

        <!-- üî∏ PDF Ï†ÑÏö© Î†åÎçî Î∞ïÏä§ -->
        <div id="creative-render"
             style="display:none; white-space:pre-wrap; font-size:16px; line-height:1.8;"></div>

        <!-- üî∏ ÎßûÏ∂§Î≤ï Í≤ÄÏÇ¨ Í≤∞Í≥º ÏòÅÏó≠ -->
        <div id="spelling-result" class="creative-result">
          <div id="spelling-errors"></div>
        </div>

        <!-- üî∏ Ïò¨Î∞îÎ•∏ ÎßûÏ∂§Î≤ï ÏòÅÏó≠ -->
        <div id="spelling-correct" class="creative-result">
          <div id="spelling-corrected"></div>
        </div>

        <!-- üî∏ ÎßûÏ∂§Î≤ï Í≤ÄÏÇ¨ & Ï†úÏ∂ú Î≤ÑÌäº -->
        <div class="creative-actions">
          <button type="button" id="creative-check-btn" class="creative-btn">AI Í∏Ä Îã§Îì¨Í∏∞</button>
          <button type="button" id="creative-submit-btn" class="creative-btn">Ï†úÏ∂úÌïòÍ∏∞</button>
        </div>
      </div>

    </div>
  </div>

  <!-- ÎßûÏ∂§Î≤ï Í≤ÄÏÇ¨ Î°úÎî© ÌåùÏóÖ -->
  <div id="spell-check-loading" class="spell-check-loading">
    <div class="spell-check-loading-content">
      <div class="spell-check-spinner"></div>
      <div class="spell-check-loading-text">ÎßûÏ∂§Î≤ï Í≤ÄÏÇ¨ Ï§ëÏûÖÎãàÎã§...</div>
    </div>
  </div>

  <!-- ===== Î∂ÑÏÑùÎ¶¨Ìè¨Ìä∏ ÌÉ≠ ===== -->
  <div id="tab-report" class="tab-panel">
    <!-- ‚úÖ Ï∫°Ï≤òÏö© ÎûòÌçº -->
    <div class="report-wrap" id="capture-report">
      <h2 class="report-title">Î∂ÑÏÑùÎ¶¨Ìè¨Ìä∏</h2>
      <p class="report-desc">
        Î≥∏Î¨∏ÌïôÏäµ Í∞ùÍ¥ÄÏãù + Îπà Ïπ∏ + ÏÑúÏà†Ìòï + Ïñ¥ÌúòÌïôÏäµÏúºÎ°ú ÏïÑÎûò 5Í∞ÄÏßÄ Î¨∏Ìï¥Ïó≠ÎüâÏùÑ ÏßÑÎã®Ìï©ÎãàÎã§.
      </p>

      <!-- Î†àÏù¥Îçî Ï∞®Ìä∏ -->
      <div class="report-chart-box">
        <canvas id="report-radar" width="360" height="360"></canvas>
      </div>

      <!-- Í∏∞Ï°¥ Ïò§Í∞ÅÌòï ÏÑ§Î™Ö (UI Î≥¥Ï°¥) -->
      <div class="report-pentagon">
        <div class="rp rp-1"><span class="rp-label">ÌïµÏã¨ Ïù¥Ìï¥Î†•</span><span class="rp-sub">(Í∞ùÍ¥ÄÏãù)</span></div>
        <div class="rp rp-2"><span class="rp-label">Íµ¨Ï°∞ ÌååÏïÖÎ†•</span><span class="rp-sub">(Í∞ùÍ¥ÄÏãù)</span></div>
        <div class="rp rp-3"><span class="rp-label">Ïñ¥Ìúò Îß•ÎùΩÎ†•</span><span class="rp-sub">(Ïñ¥ÌúòÌïôÏäµ)</span></div>
        <div class="rp rp-4"><span class="rp-label">Ï∂îÎ°†¬∑ÌÜµÌï©Î†•</span><span class="rp-sub">(ÎπàÏπ∏)</span></div>
        <div class="rp rp-5"><span class="rp-label">ÎπÑÌåê¬∑Ï†ÅÏö©Î†•</span><span class="rp-sub">(ÏÑúÏà†Ìòï)</span></div>
      </div>

      <!-- Í≤∞Í≥º Î°úÍ∑∏ -->
      <div class="report-log" id="report-log">
        ÏïÑÏßÅ Ï±ÑÏ†ê Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§. Î®ºÏ†Ä ‚ÄòÎ≥∏Î¨∏ÌïôÏäµ‚ÄôÏóêÏÑú Ï±ÑÏ†êÏùÑ Ìï¥Ï£ºÏÑ∏Ïöî.
      </div>

      <!-- ‚úÖ Ï†úÏ∂úÌïòÍ∏∞ Î≤ÑÌäº -->
      <div class="report-actions">
        <button class="report-btn-remedial" onclick="openRemedial && openRemedial()">
          Î≥¥ÏôÑÌïôÏäµ ÌïòÍ∏∞
        </button>
        <button class="report-btn-submit" onclick="submitReport()">
          ÌïôÏäµÏôÑÎ£å Î∞è Ï†úÏ∂úÌïòÍ∏∞
        </button>
      </div>
    </div>
  </div>

  <!-- Ï†úÏ∂ú Ïò§Î≤ÑÎ†àÏù¥ -->
  <div id="submit-overlay">
    <div class="box" id="submit-overlay-text">Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§ ‚úÖ</div>
  </div>

  <!-- Îí§Î°ú Í∞ÄÍ∏∞ ÌôïÏù∏ ÌåùÏóÖ -->
  <div id="back-confirm-overlay">
    <div class="back-confirm-box">
      <div class="back-confirm-icon">üê¨</div>
      <div class="back-confirm-title">ÌïôÏäµÏùÑ Ï¢ÖÎ£åÌïòÏãúÍ≤†Ïñ¥Ïöî?</div>
      <div class="back-confirm-message">
        ÏßÄÍ∏àÍπåÏßÄ ÏûëÏÑ±Ìïú ÎÇ¥Ïö©Ïù¥<br>Ï†ÄÏû•ÎêòÏßÄ ÏïäÏùÑ Ïàò ÏûàÏäµÎãàÎã§.
      </div>
      <div class="back-confirm-buttons">
        <button class="back-confirm-btn cancel" onclick="hideBackConfirm()">Í≥ÑÏÜç ÌïôÏäµÌïòÍ∏∞</button>
        <button class="back-confirm-btn confirm" onclick="goToMenu()">Î©îÎâ¥Î°ú Ïù¥Îèô</button>
      </div>
    </div>
  </div>

  <script>
    /* ===== Ï†ÑÏó≠ Î¶¨Ìè¨Ìä∏ ÏÉÅÌÉú ===== */
    window.reportState = { q1ok:false, q2ok:false, q3ok:false, q4ok:false, q5ok:false, vocabScoreRatio:0 };
    var reportState = window.reportState;  // Î°úÏª¨ Ï∞∏Ï°∞ (ÎèôÍ∏∞Ìôî Ïú†ÏßÄ)

    /* ===== ÌÉ≠ Ï†ÑÌôò ===== */
    // Î∂ÑÏÑùÎ¶¨Ìè¨Ìä∏ ÏÉàÎ°úÍ≥†Ïπ® Ìï®Ïàò (ÏÑúÎ≤ÑÏóêÏÑú ÏµúÏã† Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞)
    async function refreshReportTab() {
      const reportPanel = document.getElementById('tab-report');
      if (!reportPanel) return;


      // ‚òÖ 1ÏàúÏúÑ: ÌòÑÏû¨ ÏÑ∏ÏÖòÏùò Ï±ÑÏ†ê Í≤∞Í≥º (window.reportState.radarScores)
      if (window.reportState && window.reportState.radarScores) {
        console.log('[refreshReportTab] ÌòÑÏû¨ ÏÑ∏ÏÖò Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©:', window.reportState.radarScores);

        if (typeof drawRadarChart === 'function') {
          drawRadarChart(window.reportState.radarScores);
        }
        if (typeof updateReportPanel === 'function') {
          updateReportPanel({
            q1ok: reportState.q1ok,
            q2ok: reportState.q2ok,
            q3ok: reportState.q3ok,
            q4ok: reportState.q4ok,
            q5ok: reportState.q5ok
          });
        }
        return;
      }

      // ‚òÖ 2ÏàúÏúÑ: localStorage (dan-modern-report-state)
      try {
        const saved = localStorage.getItem(`dan-modern-report-state:${window.CUR_UNIT || 'on_modern_32'}`);
        if (saved) {
          const rs = JSON.parse(saved);
          console.log('[refreshReportTab] localStorage Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©:', rs);

          if (typeof drawRadarChart === 'function') {
            drawRadarChart({
              literal: rs.literal || (rs.q1ok ? 10 : 6),
              structural: rs.structural || (rs.q2ok ? 10 : 6),
              lexical: rs.lexical || (rs.q3ok ? 10 : 6),
              inferential: rs.inferential || (rs.q4ok ? 10 : 6),
              critical: rs.critical || (rs.q5ok ? 10 : 6)
            });
          }
          if (typeof updateReportPanel === 'function') {
            updateReportPanel({
              q1ok: rs.q1ok || false,
              q2ok: rs.q2ok || false,
              q3ok: rs.q3ok || false,
              q4ok: rs.q4ok || false,
              q5ok: rs.q5ok || false
            });
          }
          return;
        }
      } catch (e) {
        console.warn('[refreshReportTab] localStorage ÏùΩÍ∏∞ Ïã§Ìå®:', e);
      }

      // ‚òÖ 3ÏàúÏúÑ: ÏÑúÎ≤Ñ API
      const stu = typeof getCurrentStudent === 'function' ? getCurrentStudent() : null;
      if (!stu) {
        console.log('[refreshReportTab] ÌïôÏÉù Ï†ïÎ≥¥ ÏóÜÏùå');
        return;
      }

      try {
        console.log(`[refreshReportTab] ÏÑúÎ≤Ñ ÏöîÏ≤≠: unit=${window.CUR_UNIT}, grade=${stu.grade}, name=${stu.name}`);
        const res = await fetch(`/api/unit-grades?grade=${encodeURIComponent(stu.grade)}&name=${encodeURIComponent(stu.name)}`);
        const unitGradesMap = await res.json();
        const unitData = unitGradesMap[window.CUR_UNIT];

        if (unitData && unitData.radar) {
          console.log('[refreshReportTab] ÏÑúÎ≤Ñ Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©:', unitData);

          if (typeof drawRadarChart === 'function') {
            drawRadarChart({
              literal: unitData.radar.literal || 0,
              structural: unitData.radar.structural || 0,
              lexical: unitData.radar.lexical || 0,
              inferential: unitData.radar.inferential || 0,
              critical: unitData.radar.critical || 0
            });
          }
          if (typeof updateReportPanel === 'function') {
            updateReportPanel({
              q1ok: unitData.radar.literal >= 10,
              q2ok: unitData.radar.structural >= 10,
              q3ok: unitData.radar.lexical >= 7,
              q4ok: unitData.radar.inferential >= 10,
              q5ok: unitData.radar.critical >= 10
            });
          }
        } else {
          console.log('[refreshReportTab] ÏÑúÎ≤ÑÏóê Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå');
        }
      } catch(e) {
        console.error('[refreshReportTab] ÏÑúÎ≤Ñ ÏöîÏ≤≠ Ïò§Î•ò:', e);
      }
    }

    // ÌÉ≠ ÌôúÏÑ±Ìôî Ìï®Ïàò
    function activateTab(tabName) {
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));

      const targetBtn = document.querySelector(`.tab-btn[data-tab="${tabName}"]`);
      const targetPanel = document.getElementById('tab-' + tabName);

      if (targetBtn && targetPanel) {
        targetBtn.classList.add('active');
        targetPanel.classList.add('active');

        // Î∂ÑÏÑùÎ¶¨Ìè¨Ìä∏ ÌÉ≠Ïù∏ Í≤ΩÏö∞ ÏÑúÎ≤ÑÏóêÏÑú ÏµúÏã† Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
        if (tabName === 'report') {
          refreshReportTab();
        }

        // Ïñ¥ÌúòÌïôÏäµ ÌÉ≠Ïù∏ Í≤ΩÏö∞ ÏßÄÎ¨∏ Î†åÎçîÎßÅ
        if (tabName === 'vocab') {
          const fn = window.renderVocabFromContent || window.renderVocabFill;
          if (typeof fn === 'function') {
            fn();
          }
        }
      }
    }

    // ÌÉ≠ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const target = btn.dataset.tab;

        activateTab(target);
        // ÌòÑÏû¨ ÌÉ≠ÏùÑ Îã®ÏõêÎ≥ÑÎ°ú localStorageÏóê Ï†ÄÏû•
        localStorage.setItem(`current-modern-tab:${window.CUR_UNIT}`, target);
      });
    });

    // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ìï≠ÏÉÅ Î≥∏Î¨∏ÌïôÏäµ ÌÉ≠ÏúºÎ°ú ÏãúÏûë
    window.addEventListener('DOMContentLoaded', () => {
      activateTab('reading');
    });

    /* ===== Îí§Î°ú Í∞ÄÍ∏∞ ÌôïÏù∏ ÌåùÏóÖ ===== */
    function showBackConfirm() {
      const overlay = document.getElementById('back-confirm-overlay');
      if (overlay) {
        overlay.classList.add('show');
      }
    }

    function hideBackConfirm() {
      const overlay = document.getElementById('back-confirm-overlay');
      if (overlay) {
        overlay.classList.remove('show');
      }
    }

    function goToMenu() {
      // iframe ÎÇ¥Î∂ÄÏóêÏÑú Ïã§Ìñâ Ï§ëÏù∏ÏßÄ ÌôïÏù∏
      if (window.parent && window.parent !== window) {
        // Î∂ÄÎ™® Ï∞Ω(menu.html)Ïùò Î™®Îã¨ Îã´Í∏∞ Ìï®Ïàò Ìò∏Ï∂ú
        try {
          if (window.parent.closeUnitModal) {
            window.parent.closeUnitModal();
          }
        } catch (e) {
          console.log('Î™®Îã¨ Îã´Í∏∞ Ïã§Ìå®, ÌéòÏù¥ÏßÄ Ïù¥Îèô:', e);
          window.location.href = '/menu.html';
        }
      } else {
        // ÏùºÎ∞ò Î∏åÎùºÏö∞Ï†ÄÏóêÏÑú ÏßÅÏ†ë Ïó¥ÏóàÏùÑ ÎïåÎäî Î©îÎâ¥Î°ú Ïù¥Îèô
        window.location.href = '/menu.html';
      }
    }

    // Î∏åÎùºÏö∞Ï†Ä Îí§Î°ú Í∞ÄÍ∏∞ Í∞êÏßÄ
    window.addEventListener('popstate', (e) => {
      e.preventDefault();
      showBackConfirm();
      // ÌûàÏä§ÌÜ†Î¶¨Î•º Îã§Ïãú ÏïûÏúºÎ°ú Î∞ÄÏñ¥ÏÑú Îí§Î°ú Í∞ÄÍ∏∞Î•º ÎßâÏùå
      history.pushState(null, '', location.href);
    });

    // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÌûàÏä§ÌÜ†Î¶¨ ÏÉÅÌÉú Ï∂îÍ∞Ä
    window.addEventListener('load', () => {
      history.pushState(null, '', location.href);
    });

    /* ===== ÏõêÌòï Ïä§ÌÉëÏõåÏπò ===== */
    let timer, seconds = 0, isRunning = false;
    const RADIUS = 45;
    const CIRCUMFERENCE = 2 * Math.PI * RADIUS;
    const TOTAL_SECONDS = 600; // 10Î∂Ñ
    function formatTime(sec){ const m=String(Math.floor(sec/60)).padStart(2,'0'); const s=String(sec%60).padStart(2,'0'); return `${m}:${s}`; }
    function updateDisplay(){ const t=document.getElementById("timer-text"); if (t) t.textContent = formatTime(seconds); updateRing(); }
    function updateRing(){ const c=document.querySelector(".timer-ring .progress"); if(!c) return; const r=(seconds%TOTAL_SECONDS)/TOTAL_SECONDS; c.style.strokeDashoffset = CIRCUMFERENCE - r*CIRCUMFERENCE; }
    function startTimer(){ if(!isRunning){ isRunning=true; const b=document.getElementById("timer-display"); b.classList.remove("paused","reset"); b.classList.add("active"); timer=setInterval(()=>{ seconds++; updateDisplay(); },1000);} }
    function pauseTimer(){ clearInterval(timer); isRunning=false; const b=document.getElementById("timer-display"); b.classList.remove("active"); b.classList.add("paused"); }
    function resetTimer(){ clearInterval(timer); isRunning=false; const m=document.getElementById("minute-input"), s=document.getElementById("second-input"); if(m) m.value=Math.floor(seconds/60); if(s) s.value=seconds%60; seconds=0; updateDisplay(); const b=document.getElementById("timer-display"); b.classList.remove("active","paused"); b.classList.add("reset"); }

    /* ===== Í≥µÌÜµ: ÌïôÏÉùÏ†ïÎ≥¥/ÌååÏùºÎ™Ö ===== */
    function getStudentInfo(){ const grade=document.getElementById('student-grade')?.value.trim()||''; const name=document.getElementById('student-name')?.value.trim()||''; return {grade,name}; }
    function ensureStudentInfo(){ const {grade,name}=getStudentInfo(); return grade!=='' && name!==''; }
    function buildFilename(base){ const {grade,name}=getStudentInfo(); let extra=''; if(grade) extra+='_'+grade; if(name) extra+='_'+name; extra=extra.replace(/[\/\\\s]+/g,'_'); return base.replace(/\.pdf$/,'')+extra+'.pdf'; }

    /* ===== Ï∫°Ï≤ò ‚Üí PDF ===== */
    async function captureElementToPDF(elementId, filenameBase, options = {}) { return; // PDF ÎπÑÌôúÏÑ±Ìôî
      try {
        // html2canvas Î°úÎî© Ï≤¥ÌÅ¨ Î∞è ÎèôÏ†Å Î°úÎî© (Ïó¨Îü¨ CDN ÏãúÎèÑ)
        if (typeof html2canvas === 'undefined') {
          console.log('[captureElementToPDF] html2canvas Î°úÎî© Ï§ë...');
          const html2canvasUrls = [
            'https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js',
            'https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js',
            'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js'
          ];
          let loaded = false;
          for (const url of html2canvasUrls) {
            if (loaded) break;
            try {
              await new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = url;
                script.onload = () => { loaded = true; resolve(); };
                script.onerror = reject;
                document.head.appendChild(script);
              });
            } catch (e) { console.log('CDN Ïã§Ìå®:', url); }
          }
          if (!loaded) { alert('PDF ÎùºÏù¥Î∏åÎü¨Î¶¨ Î°úÎî© Ïã§Ìå®. ÎÑ§Ìä∏ÏõåÌÅ¨Î•º ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.'); return; }
        }
        if (typeof window.jspdf === 'undefined') {
          console.log('[captureElementToPDF] jspdf Î°úÎî© Ï§ë...');
          const jspdfUrls = [
            'https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js',
            'https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js',
            'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js'
          ];
          let loaded = false;
          for (const url of jspdfUrls) {
            if (loaded) break;
            try {
              await new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = url;
                script.onload = () => { loaded = true; resolve(); };
                script.onerror = reject;
                document.head.appendChild(script);
              });
            } catch (e) { console.log('CDN Ïã§Ìå®:', url); }
          }
          if (!loaded) { alert('PDF ÎùºÏù¥Î∏åÎü¨Î¶¨ Î°úÎî© Ïã§Ìå®. ÎÑ§Ìä∏ÏõåÌÅ¨Î•º ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.'); return; }
        }

        window.scrollTo(0,0);
        const target = document.getElementById(elementId);
        if (!target) return;

        const finalFilename = buildFilename(filenameBase);

        const prevPosition = target.style.position;
        let tempInfo = null;
        if (options.withStudentInfo) {
          const { grade, name } = getStudentInfo();
          if (!target.style.position || target.style.position === '') target.style.position = 'relative';

          tempInfo = document.createElement('div');
          tempInfo.innerHTML = `<strong>ÌïôÎÖÑ:</strong> ${grade || '-'} &nbsp; | &nbsp; <strong>Ïù¥Î¶Ñ:</strong> ${name || '-'}`;
          tempInfo.style.position = 'absolute';
          tempInfo.style.top = '0'; tempInfo.style.left = '0'; tempInfo.style.right = '0';
          tempInfo.style.background = '#fff7ea'; tempInfo.style.borderBottom = '1px solid #f3d3b4';
          tempInfo.style.padding = '6px 12px'; tempInfo.style.fontSize = '13px'; tempInfo.style.color = '#5b4334';
          tempInfo.style.zIndex = '999'; tempInfo.style.pointerEvents = 'none';
          target.appendChild(tempInfo);
        }

        const canvas = await html2canvas(target, { scale: 2, useCORS: true });
        const imgData = canvas.toDataURL('image/png');

        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('p','mm','a4');
        const pdfW = pdf.internal.pageSize.getWidth();
        const pdfH = pdf.internal.pageSize.getHeight();

        const imgW = pdfW;
        const imgH = canvas.height * imgW / canvas.width;

        let heightLeft = imgH;
        let position = 0;

        pdf.addImage(imgData, 'PNG', 0, position, imgW, imgH);
        heightLeft -= pdfH;

        while (heightLeft > 0) {
          position = heightLeft - imgH;
          pdf.addPage();
          pdf.addImage(imgData, 'PNG', 0, position, imgW, imgH);
          heightLeft -= pdfH;
        }

        if (tempInfo) target.removeChild(tempInfo);
        target.style.position = prevPosition;

        pdf.save(finalFilename);
      } catch (e) {
        console.error(e);
        alert("PDF ÎßåÎìúÎäî Ï§ëÏóê Ïù¥ÎØ∏ÏßÄ ÎïåÎ¨∏Ïóê Ï∫°Ï≤òÍ∞Ä ÎßâÌòîÏñ¥. BRAINON.pngÎ•º ÎπºÍ±∞ÎÇò Í∞ôÏùÄ Í≤ΩÎ°úÎ°ú ÏòÆÍ≤®Ï§ò!");
      }
    }

    /* ===== Ïò§Î≤ÑÎ†àÏù¥ ===== */
    function showSubmitOverlay(message) {
      const overlay = document.getElementById("submit-overlay");
      const textBox = document.getElementById("submit-overlay-text");
      textBox.textContent = message;
      overlay.style.display = "flex";
      overlay.classList.add("show");
      setTimeout(() => { overlay.classList.remove("show"); overlay.style.display = "none"; }, 2600);
    }
    function showSubmitSuccess(kind) {
      const { grade, name } = getStudentInfo();
      const who = (grade || name) ? `${grade ? grade + ' ' : ''}${name ? name + ' ' : ''}`.trim() + ' ' : '';
      showSubmitOverlay(`${who}${kind} Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§ ‚úÖ`);
    }

    /* ===== Î≥∏Î¨∏ Ï±ÑÏ†ê ===== */
    let readingResultHTML = "";  // Î≥∏Î¨∏ÌïôÏäµÏö© (learning-common.jsÏùò readingResultHTMLÍ≥º Ï∂©Îèå Î∞©ÏßÄ)
    function gradeQuiz() {
      // content.jsÏóêÏÑú ÎèôÏ†ÅÏúºÎ°ú answerKey, explain, essayKeywords ÏùΩÏñ¥Ïò§Í∏∞
      const content = window.CONTENTS[window.CUR_UNIT];
      const answerKey = content.answerKey;
      const explain = content.explain;
      const detail = content.detail || {};

      // detail Ïö∞ÏÑ†, ÏóÜÏúºÎ©¥ explain fallback
      const q1Msg = detail.q1 || explain.q1 || '';
      const q2Msg = detail.q2 || explain.q2 || '';
      const q3Msg = detail.q3 || explain.q3 || '';
      const q4Msg = detail.q4 || explain.q4 || '';
      const q5Msg = explain.q5 || '';

      const quizBlocks = document.querySelectorAll('#tab-reading .quiz-block');
      const numLabels = ["01","02","03","04","05"];
      quizBlocks.forEach((block, idx) => {
        const numEl = block.querySelector('.quiz-num');
        const markEl = numEl.querySelector('.mark');
        numEl.textContent = numLabels[idx];
        numEl.appendChild(markEl);
        numEl.classList.remove('correct','wrong');
        markEl.textContent = "";
      });

      let score = 0;
      let totalAuto = 4;
      let shortMsgs = [];
      let fullMsgs = [];

      // 1Î≤à
      const q1 = document.querySelector('input[name="q1"]:checked');
      const q1Num = quizBlocks[0].querySelector('.quiz-num');
      const q1Mark = q1Num.querySelector('.mark');
      const q1ok = (q1 && q1.value === answerKey.q1);
      if (q1ok) { score++; q1Num.classList.add('correct'); q1Mark.textContent="‚≠ï"; shortMsgs.push("Ï†ïÎãµ ‚úÖ"); fullMsgs.push("Ï†ïÎãµ ‚úÖ " + q1Msg); }
      else { q1Num.classList.add('wrong'); q1Mark.textContent="‚úñ"; shortMsgs.push("Ïò§Îãµ ‚ùå"); fullMsgs.push("Ïò§Îãµ ‚ùå " + q1Msg); }

      // 2Î≤à
      const q2 = document.querySelector('input[name="q2"]:checked');
      const q2Num = quizBlocks[1].querySelector('.quiz-num');
      const q2Mark = q2Num.querySelector('.mark');
      const q2ok = (q2 && q2.value === answerKey.q2);
      if (q2ok) { score++; q2Num.classList.add('correct'); q2Mark.textContent="‚≠ï"; shortMsgs.push("Ï†ïÎãµ ‚úÖ"); fullMsgs.push("Ï†ïÎãµ ‚úÖ " + q2Msg); }
      else { q2Num.classList.add('wrong'); q2Mark.textContent="‚úñ"; shortMsgs.push("Ïò§Îãµ ‚ùå"); fullMsgs.push("Ïò§Îãµ ‚ùå " + q2Msg); }

      // 3Î≤à
      const q3_1 = document.getElementById("q3-1").value.trim();
      const q3_2 = document.getElementById("q3-2").value.trim();
      const q3Num = quizBlocks[2].querySelector('.quiz-num');
      const q3Mark = q3Num.querySelector('.mark');
      const ok3_1 = answerKey.q3_1.some(a => a.replace(/\s+/g,"").toLowerCase() === q3_1.replace(/\s+/g,"").toLowerCase());
      const ok3_2 = answerKey.q3_2.some(a => a.replace(/\s+/g,"").toLowerCase() === q3_2.replace(/\s+/g,"").toLowerCase());
      const q3ok = (ok3_1 && ok3_2);
      if (q3ok) { score++; q3Num.classList.add('correct'); q3Mark.textContent="‚≠ï"; shortMsgs.push("Ï†ïÎãµ ‚úÖ"); fullMsgs.push("Ï†ïÎãµ ‚úÖ " + q3Msg); }
      else { q3Num.classList.add('wrong'); q3Mark.textContent="‚úñ"; shortMsgs.push("Ïò§Îãµ ‚ùå"); fullMsgs.push("Ïò§Îãµ ‚ùå " + q3Msg); }

      // 4Î≤à
      const q4_1 = document.getElementById("q4-1").value.trim();
      const q4_2 = document.getElementById("q4-2").value.trim();
      const q4Num = quizBlocks[3].querySelector('.quiz-num');
      const q4Mark = q4Num.querySelector('.mark');
      const ok4_1 = answerKey.q4_1.some(a => a.replace(/\s+/g,"").toLowerCase() === q4_1.replace(/\s+/g,"").toLowerCase());
      const ok4_2 = answerKey.q4_2.some(a => a.replace(/\s+/g,"").toLowerCase() === q4_2.replace(/\s+/g,"").toLowerCase());
      const q4ok = (ok4_1 && ok4_2);
      if (q4ok) { score++; q4Num.classList.add('correct'); q4Mark.textContent="‚≠ï"; shortMsgs.push("Ï†ïÎãµ ‚úÖ"); fullMsgs.push("Ï†ïÎãµ ‚úÖ " + q4Msg); }
      else { q4Num.classList.add('wrong'); q4Mark.textContent="‚úñ"; shortMsgs.push("Ïò§Îãµ ‚ùå"); fullMsgs.push("Ïò§Îãµ ‚ùå " + q4Msg); }

      // 5Î≤à ÏÑúÏà†Ìòï
      const essay = document.getElementById("q5").value.trim().toLowerCase();
      const q5Num = quizBlocks[4].querySelector('.quiz-num');
      const q5Mark = q5Num.querySelector('.mark');
      const essayKeywords = content.essayKeywords;
      let hit = 0;
      essayKeywords.forEach(kw => { if (essay.includes(kw.replace(/\s+/g,""))) hit++; });
      let q5ok = false;

      if (essay.length === 0) {
        q5Num.classList.add('wrong'); q5Mark.textContent="‚úñ";
        shortMsgs.push("ÏÑúÏà†Ìòï: ÎØ∏ÏûëÏÑ± ‚ùå");
        fullMsgs.push("ÏÑúÏà†Ìòï: ÎØ∏ÏûëÏÑ± ‚ùå " + q5Msg);
      } else if (hit >= 1) {
        q5Num.classList.add('correct'); q5Mark.textContent="‚≠ï";
        shortMsgs.push("ÏÑúÏà†Ìòï: ÌïµÏã¨Ïñ¥ ÌëúÌòÑ Í∞êÏßÄ ‚úÖ");
        fullMsgs.push("ÏÑúÏà†Ìòï: ÌïµÏã¨Ïñ¥ ÌëúÌòÑ Í∞êÏßÄ ‚úÖ " + q5Msg);
        q5ok = true;
      } else {
        q5Num.classList.add('wrong'); q5Mark.textContent="‚úñ";
        shortMsgs.push("ÏÑúÏà†Ìòï: ÌïµÏã¨Ïñ¥ ÌëúÌòÑ Î∂ÄÏ°± ‚ùå");
        fullMsgs.push("ÏÑúÏà†Ìòï: ÌïµÏã¨Ïñ¥ ÌëúÌòÑ Î∂ÄÏ°± ‚ùå " + q5Msg);
      }

      const box = document.getElementById("grade-result");
      box.style.display = "block";
      box.innerHTML = `<p><strong>Ï†êÏàò: ${score} / ${totalAuto}</strong></p>` + shortMsgs.map(m => `<p>${m}</p>`).join("");
      readingResultHTML = `<p><strong>Ï†êÏàò: ${score} / ${totalAuto}</strong></p>` + fullMsgs.map(m => `<p>${m}</p>`).join("");

      // ‚òÖ Ï†ÑÏó≠ ÏÉÅÌÉúÏóê Ï†ÄÏû•
      reportState.q1ok = q1ok;
      reportState.q2ok = q2ok;
      reportState.q3ok = q3ok;
      reportState.q4ok = q4ok;
      reportState.q5ok = q5ok;
      reportState.radarScores = {
        literal:     q1ok ? 10 : 6,
        structural:  q2ok ? 10 : 6,
        lexical:     q3ok ? 10 : 6,
        inferential: q4ok ? 10 : 6,
        critical:    q5ok ? 10 : 6
      };

      // ‚òÖ window.reportStateÏóêÎèÑ Ï†ÄÏû• (sendLearningLogÏóêÏÑú ÏÇ¨Ïö©)
      window.reportState = window.reportState || {};
      window.reportState.q1ok = q1ok;
      window.reportState.q2ok = q2ok;
      window.reportState.q3ok = q3ok;
      window.reportState.q4ok = q4ok;
      window.reportState.q5ok = q5ok;
      window.reportState.radarScores = reportState.radarScores;

      // ‚òÖ Î∂ÑÏÑùÎ¶¨Ìè¨Ìä∏ ÌÖçÏä§Ìä∏/Î∞ïÏä§ ÎèôÍ∏∞Ìôî
      updateReportPanel({
        q1ok: reportState.q1ok,
        q2ok: reportState.q2ok,
        q3ok: reportState.q3ok,
        q4ok: reportState.q4ok,
        q5ok: reportState.q5ok,
        messages: (function(){
          const lexicalRatio = (typeof reportState.vocabScoreRatio === "number") ? reportState.vocabScoreRatio : 0;
          const lexicalOk = lexicalRatio >= 0.7;
          return [
            "ÌïµÏã¨ Ïù¥Ìï¥Î†•(Í∞ùÍ¥ÄÏãù): " + (reportState.q1ok ? "ÌïµÏã¨ Ïù¥Ìï¥Î†•Ïù¥ Ï¢ãÏïÑÏöî! ‚úÖ" : "Î≥¥ÏôÑ ÌïÑÏöîÌï¥Ïöî ‚ùó"),
            "Íµ¨Ï°∞ ÌååÏïÖÎ†•(Í∞ùÍ¥ÄÏãù): " + (reportState.q2ok ? "Íµ¨Ï°∞ ÌååÏïÖÎ†•Ïù¥ Ï¢ãÏïÑÏöî! ‚úÖ" : "Î≥¥ÏôÑ ÌïÑÏöîÌï¥Ïöî ‚ùó"),
            "Ïñ¥Ìúò Îß•ÎùΩÎ†•(ÎπàÏπ∏): " + (lexicalOk ? "Ïñ¥Ìúò Îß•ÎùΩÎ†•Ïù¥ Ï¢ãÏïÑÏöî! ‚úÖ" : "Ïñ¥Ìúò Î≥µÏäµÏù¥ ÌïÑÏöîÌï¥Ïöî ‚ùó"),
            "Ï∂îÎ°†¬∑ÌÜµÌï©Î†•(ÎπàÏπ∏): " + (reportState.q4ok ? "Ï∂îÎ°†¬∑ÌÜµÌï©Î†•Ïù¥ Ï¢ãÏïÑÏöî! ‚úÖ" : "Î≥¥ÏôÑ ÌïÑÏöîÌï¥Ïöî ‚ùó"),
            "ÎπÑÌåê¬∑Ï†ÅÏö©Î†•(ÏÑúÏà†Ìòï): " + (reportState.q5ok ? "ÎπÑÌåê¬∑Ï†ÅÏö©Î†•Ïù¥ Ï¢ãÏïÑÏöî! ‚úÖ" : "Î≥¥ÏôÑ ÌïÑÏöîÌï¥Ïöî ‚ùó")
          ];
        })()
      });

      // Î†àÏù¥Îçî Ï∞®Ìä∏
      drawRadarChart({
        literal:     reportState.q1ok ? 10 : 6,
        structural:  reportState.q2ok ? 10 : 6,
        lexical:     reportState.q3ok ? 10 : 6,
        inferential: reportState.q4ok ? 10 : 6,
        critical:    reportState.q5ok ? 10 : 6
      });

      // Ïñ¥Ìúò ÌîºÎìúÎ∞± Î∞òÏòÅ
      const lexicalRatio = (typeof reportState.vocabScoreRatio === "number") ? reportState.vocabScoreRatio : 0;
      const lexicalFromRatio = Math.round(lexicalRatio * 10);
      renderFeedback({
        literal:    reportState.q1ok ? 10 : 6,
        structural: reportState.q2ok ? 10 : 6,
        lexical:    lexicalFromRatio,
        inferential:reportState.q4ok ? 10 : 6,
        critical:   reportState.q5ok ? 10 : 6
      });

      // ‚òÖ localStorageÏóê Î∂ÑÏÑùÎ¶¨Ìè¨Ìä∏ ÏÉÅÌÉú Ï†ÄÏû• (Î∂ÑÏÑùÎ¶¨Ìè¨Ìä∏ ÌÉ≠ Ï¶âÏãú Î∞òÏòÅÏö©)
      localStorage.setItem(`dan-modern-report-state:${window.CUR_UNIT || 'on_modern_32'}`, JSON.stringify({
        q1ok: reportState.q1ok,
        q2ok: reportState.q2ok,
        q3ok: reportState.q3ok,
        q4ok: reportState.q4ok,
        q5ok: reportState.q5ok,
        vocabScoreRatio: reportState.vocabScoreRatio,
        literal: reportState.q1ok ? 10 : 6,
        structural: reportState.q2ok ? 10 : 6,
        lexical: reportState.q3ok ? 10 : 6,
        inferential: reportState.q4ok ? 10 : 6,
        critical: reportState.q5ok ? 10 : 6
      }));

      // ‚òÖ Î∂ÑÏÑùÎ¶¨Ìè¨Ìä∏ ÌÉ≠ Ï¶âÏãú ÏóÖÎç∞Ïù¥Ìä∏
      refreshReportTab();

      // ‚òÖ ÏÑúÎ≤ÑÏóê Î≥∏Î¨∏ÌïôÏäµ Ï±ÑÏ†ê Í≤∞Í≥º Ï†ÄÏû•
      console.log('[gradeQuiz] saveUnitProgressToServer ÌÉÄÏûÖ:', typeof saveUnitProgressToServer);
      console.log('[gradeQuiz] window.saveUnitProgressToServer ÌÉÄÏûÖ:', typeof window.saveUnitProgressToServer);

      const saveFn = typeof saveUnitProgressToServer === 'function' ? saveUnitProgressToServer : window.saveUnitProgressToServer;

      if (typeof saveFn === 'function') {
        // ÌòÑÏû¨ ÏûÖÎ†•Í∞í ÏàòÏßë
        const q1Radio = document.querySelector('input[name="q1"]:checked');
        const q2Radio = document.querySelector('input[name="q2"]:checked');
        const currentInputs = {
          q1: q1Radio ? q1Radio.value : '',
          q2: q2Radio ? q2Radio.value : '',
          q3_1: document.getElementById("q3-1")?.value || '',
          q3_2: document.getElementById("q3-2")?.value || '',
          q4_1: document.getElementById("q4-1")?.value || '',
          q4_2: document.getElementById("q4-2")?.value || '',
          q5: document.getElementById("q5")?.value || ''
        };

        saveFn({
          reportState: {
            q1ok: reportState.q1ok,
            q2ok: reportState.q2ok,
            q3ok: reportState.q3ok,
            q4ok: reportState.q4ok,
            q5ok: reportState.q5ok,
            vocabScoreRatio: reportState.vocabScoreRatio || 0,
            literal: reportState.q1ok ? 10 : 6,
            structural: reportState.q2ok ? 10 : 6,
            lexical: reportState.q3ok ? 10 : 6,
            inferential: reportState.q4ok ? 10 : 6,
            critical: reportState.q5ok ? 10 : 6,
            inputs: currentInputs,
            resultHTML: readingResultHTML
          }
        });
        console.log('[gradeQuiz] ÏÑúÎ≤ÑÏóê Î≥∏Î¨∏ÌïôÏäµ Ï±ÑÏ†ê Í≤∞Í≥º Ï†ÄÏû• ÏöîÏ≤≠ ÏôÑÎ£å');
      } else {
        console.error('[gradeQuiz] saveUnitProgressToServer Ìï®ÏàòÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå!');
      }
    }

    function resetQuiz() {
      document.querySelectorAll('#tab-reading input[type="radio"]').forEach(r => r.checked = false);
      // ÎèôÏ†Å Î†åÎçîÎßÅ ÏöîÏÜåÎì§ null Ï≤¥ÌÅ¨
      const q31 = document.getElementById("q3-1");
      const q32 = document.getElementById("q3-2");
      const q41 = document.getElementById("q4-1");
      const q42 = document.getElementById("q4-2");
      const q5 = document.getElementById("q5");
      if (q31) q31.value = "";
      if (q32) q32.value = "";
      if (q41) q41.value = "";
      if (q42) q42.value = "";
      if (q5) q5.value = "";

      const quizBlocks = document.querySelectorAll('#tab-reading .quiz-block');
      const numLabels = ["01","02","03","04","05"];
      quizBlocks.forEach((block, idx) => {
        const numEl = block.querySelector('.quiz-num');
        const markEl = numEl.querySelector('.mark');
        numEl.textContent = numLabels[idx];
        numEl.appendChild(markEl);
        numEl.classList.remove('correct','wrong');
        markEl.textContent = "";
      });

      const resultBox = document.getElementById("grade-result");
      resultBox.style.display = "none";
      resultBox.innerHTML = "";
      readingResultHTML = "";

      // solutions-box Ï†úÍ±∞ (Ï†úÏ∂úÌïòÍ∏∞ÏóêÏÑú ÏÉùÏÑ±Îêú Ìï¥ÏÑ§ Î∞ïÏä§)
      const solutionsBox = document.getElementById("solutions-box");
      if (solutionsBox) {
        solutionsBox.remove();
      }

      document.getElementById("save-progress-btn").style.display = "inline-block";
      document.getElementById("reset-btn").style.display = "none";
      enableQuizInputs();

      reportState = { q1ok:false, q2ok:false, q3ok:false, q4ok:false, q5ok:false, vocabScoreRatio:0 };

      updateReportPanel({ q1ok:false, q2ok:false, q3ok:false, q4ok:false, q5ok:false, messages: ["Ï±ÑÏ†ê Í≤∞Í≥ºÍ∞Ä Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§. Îã§Ïãú ÌíÄÍ≥† Ï±ÑÏ†êÌï¥ Ï£ºÏÑ∏Ïöî."] });

      drawRadarChart({ literal:0, structural:0, lexical:0, inferential:0, critical:0 });

      // ‚òÖ ÌïòÏù¥ÎùºÏù¥Ìä∏ Ï†úÍ±∞
      clearEvidenceHighlights();
    }
    // Î≥∏Î¨∏ Ï†úÏ∂ú
    async function submitQuiz() {
      if (!ensureStudentInfo()) { showSubmitOverlay('ÌïôÎÖÑÍ≥º Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî'); return; }
      await captureElementToPDF('capture-reading', 'Îã®Îã®Íµ≠Ïñ¥_Î≥∏Î¨∏ÌïôÏäµ.pdf', { withStudentInfo: true });

    // ‚òÖ PDF Ï∫°Ï≤ò ÌõÑ ÌïòÏù¥ÎùºÏù¥Ìä∏ Ï†ÅÏö©
    highlightEvidence();
      showSubmitSuccess('Î≥∏Î¨∏ÌïôÏäµ');
      const resultBox = document.getElementById("grade-result");
      resultBox.style.display = "block";
      resultBox.innerHTML = readingResultHTML;
    }

    /* ===== Ïñ¥ÌúòÌïôÏäµ Í¥ÄÎ†® ÏΩîÎìúÎäî learning-common.jsÏóêÏÑú Ï≤òÎ¶¨ ===== */
    // saveVocabState, loadVocabState, vocabGradeBtn, vocabResetBtn, vocabSubmitBtn Îì±
    // Î™®Îëê learning-common.jsÏùò initVocabButtons()ÏóêÏÑú Ï¥àÍ∏∞ÌôîÎê®

    /* ===== Ï∞ΩÏùòÌôúÎèô Í¥ÄÎ†® ÏΩîÎìúÎäî learning-common.jsÏóêÏÑú Ï≤òÎ¶¨ ===== */
    // saveCreativeState, loadCreativeState, creativeBtn, creativeCheckBtn Îì±
    // Î™®Îëê learning-common.jsÏùò initCreativeButtons()ÏóêÏÑú Ï¥àÍ∏∞ÌôîÎê®
    // drawRadarChart, loadVocabState, loadCreativeStateÎèÑ learning-common.jsÏóêÏÑú Ìò∏Ï∂úÎê®

    /* ===== ‚úÖ ÏµúÏ¢ÖÎ≥∏ submitReport()Îßå ÎÇ®ÍπÄ (Ï§ëÎ≥µ/Ï†ÑÏó≠ Î≥ëÌï© Î∏îÎ°ù ÏÇ≠Ï†ú) ===== */
    async function submitReport() {
      // 0) Î°úÍ∑∏Ïù∏ Ï†ïÎ≥¥ ÌôïÏù∏
      const stu = getCurrentStudent();
      if (!stu) {
        alert('Î°úÍ∑∏Ïù∏Ìïú ÌïôÏÉù Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§. Î®ºÏ†Ä Î°úÍ∑∏Ïù∏ Ìï¥Ï£ºÏÑ∏Ïöî.');
        return;
      }

      // 1) Î¶¨Ìè¨Ìä∏ PDF Ï†ÄÏû•
      await captureElementToPDF('capture-report', 'Îã®Îã®Íµ≠Ïñ¥_Î∂ÑÏÑùÎ¶¨Ìè¨Ìä∏.pdf', { withStudentInfo: true });

      // 2) ÌïôÏÉù Í≥†Ïú†ÌÇ§
      const studentKey = buildStudentKey(stu); // Ïòà: "4ÌïôÎÖÑ_ÏÇ¨ÏÇ¨ÏÇ¨_01044444444"

      // 3) ÌòÑÏû¨ Îã®Ïõê Î≤àÌò∏ÏôÄ PAGE_KEY
      const cur = (window.CUR_UNIT || 'on_modern_32');                  // Ïòà: 'on_modern_32'
      const m = cur.match(/modern_(\d{1,2})/);
      const no = m ? m[1].padStart(2, '0') : '01';
      const pk = window.PAGE_KEY || `BRAINUP_korlit_on_modern_${no}`;   // Ïòà: 'BRAINUP_korlit_modern_02'

      // 4) Í≥ºÍ±∞/Î≥ÄÌòï ÌÇ§ÍπåÏßÄ Ìïú Î≤àÏóê Ìù°Ïàò
      const legacyPath = `./BRAINUP/science/on_modern_${no}.html`;
      const pageIds = [
        pk,
        legacyPath,
        `BRAINUP_on_modern_${no}`,
        `BRAINUP_korlit_modern${no}`
      ];
      console.log('[study page] PAGE_IDs =', pageIds);

      // 5) localStorage ÎÇ¥ dan-progress* Ï†ÑÎ∂Ä Î≥ëÌï© Ï†ÄÏû•
      const allKeys = Object.keys(localStorage);
      const progressKeys = new Set([
        `dan-progress:${studentKey}`,
        `dan-progress-${studentKey}`
      ]);
      allKeys.forEach(k => { if (k.startsWith('dan-progress')) progressKeys.add(k); });

      progressKeys.forEach(storeKey => {
        let saved;
        try {
          saved = JSON.parse(localStorage.getItem(storeKey) || '[]');
          // Î∞∞Ïó¥Ïù¥ ÏïÑÎãàÎ©¥ Îπà Î∞∞Ïó¥Î°ú Ï¥àÍ∏∞Ìôî
          if (!Array.isArray(saved)) saved = [];
        }
        catch(e) { saved = []; }
        pageIds.forEach(id => { if (!saved.includes(id)) saved.push(id); });
        localStorage.setItem(storeKey, JSON.stringify(saved));
        console.log('[study page] wrote to', storeKey, '=>', saved);
      });

      // 6) ÏÑúÎ≤ÑÏóê ÌïôÏäµ Î°úÍ∑∏ Ï†ÑÏÜ° (Î≥ÑÌëú ÌëúÏãúÏö©)
      if (typeof window.sendLearningLog === 'function') {
        try {
          await window.sendLearningLog();
          console.log('[submitReport] ÌïôÏäµ Î°úÍ∑∏ Ï†ÑÏÜ° ÏôÑÎ£å');
        } catch (e) {
          console.warn('[submitReport] sendLearningLog Ïã§Ìå®', e);
        }
      }

      // 7) ÏôÑÎ£å ÌëúÏãú
      showSubmitSuccess('Î∂ÑÏÑùÎ¶¨Ìè¨Ìä∏');
    }
  </script>

  <!-- Î≥¥ÏôÑÌïôÏäµ ÌëúÏãú ÏòÅÏó≠ -->
  <div id="remedial-panel" style="display:none; position:fixed; right:20px; bottom:20px; width:360px; max-height:70vh; background:#fffdf8; border:1px solid #e5d0ac; border-radius:12px; box-shadow:0 6px 20px rgba(0,0,0,0.15); z-index:99999; flex-direction:column;">
    <div style="display:flex; justify-content:space-between; align-items:center; padding:10px 14px 6px;">
      <strong style="color:#7b3d1a;">Î≥¥ÏôÑÌïôÏäµ Î¨∏Ï†ú</strong>
      <button onclick="document.getElementById('remedial-panel').style.display='none';" style="background:none; border:none; font-size:16px; cursor:pointer;">√ó</button>
    </div>
    <div id="remedial-panel-body" style="flex:1 1 auto; overflow:auto; padding:0 14px 6px; max-height: calc(70vh - 110px);"></div>
    <div style="display:flex; justify-content:flex-end; gap:8px; padding:8px 14px 12px; border-top:1px solid #f0dfc8; background:#fffaf3; border-bottom-left-radius:12px; border-bottom-right-radius:12px;">
      <button onclick="resetRemedial()" style="background:#f1e0c8; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; font-size:12px;">Îã§Ïãú ÌíÄÍ∏∞</button>
      <button onclick="gradeRemedial()" style="background:#8b2f2f; color:#fff; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; font-size:12px;">Ï±ÑÏ†êÌïòÍ∏∞</button>
    </div>
  </div>
<!-- ‚úÖ Ïñ¥Ìúò ÏûêÎèô Î†åÎçîÎßÅ / Ï±ÑÏ†ê / Ï†ÄÏû• JS -->
<script>
/* ================================================
   üß© Ïñ¥ÌúòÌïôÏäµ ÏûêÎèô Î†åÎçîÎßÅ (+ÌÉ≠ Ï†ÑÌôò ÏûêÎèô Î∞òÏòÅ)
   - CONTENTS[CUR_UNIT].vocabFill ÏÇ¨Ïö©
   - ÏûÖÎ†•Í∞í ÌïôÏÉù/Îã®ÏõêÎ≥Ñ ÏûêÎèô Ï†ÄÏû•/Î≥µÏõê
=================================================== */

// ‚úÖ ÌïôÏÉù ÌÇ§ (ÏûàÏùÑ Í≤ΩÏö∞ localStorage Ï†ÄÏû•Ïö©)
function _getStudentKey() {
  try {
    if (typeof getCurrentStudent === 'function' && typeof buildStudentKey === 'function') {
      const stu = getCurrentStudent();
      if (stu) return 'dan-vfill:' + buildStudentKey(stu);
    }
  } catch(e){}
  return 'dan-vfill:guest';
}
function _storeKey(unit){ return `${_getStudentKey()}::${unit||window.CUR_UNIT||'on_modern_32'}`; }

// ‚úÖ ÎπÑÍµêÏö© Ï†ïÍ∑úÌôî (ÎåÄÏÜåÎ¨∏/Í≥µÎ∞±/Í∏∞Ìò∏ Ï†úÍ±∞)
function _norm(s){
  return (s||'')
    .normalize('NFC')
    .toLowerCase()
    .replace(/\s+/g,'')
    .replace(/[~!@#$%^&*()\-\=_+[\]{};:'",.<>/?\\|¬∑`]/g,'');
}

// ‚úÖ ÏûÖÎ†•Í∞í Ï†ÄÏû•/Î≥µÏõê
function _saveVocabInputs(unit){
  const key = _storeKey(unit);
  const inputs = [...document.querySelectorAll('#vocab-fill .vocab-input')].map(inp => ({
    id: inp.id, v: inp.value
  }));
  localStorage.setItem(key, JSON.stringify(inputs));
}
function _loadVocabInputs(unit){
  const key = _storeKey(unit);
  try {
    const saved = JSON.parse(localStorage.getItem(key) || '[]');
    saved.forEach(({id,v})=>{
      const el = document.getElementById(id);
      if (el) el.value = v || '';
    });
  } catch(e){}
}

// ‚úÖ Ï¥àÏÑ± ÏûêÎèô ÏÉùÏÑ±
function _initialsFromKorean(word){
  const CHO = ['„Ñ±','„Ñ≤','„Ñ¥','„Ñ∑','„Ñ∏','„Ñπ','„ÖÅ','„ÖÇ','„ÖÉ','„ÖÖ','„ÖÜ','„Öá','„Öà','„Öâ','„Öä','„Öã','„Öå','„Öç','„Öé'];
  const base = 'Í∞Ä'.charCodeAt(0);
  const choUnit = 588;
  let out = '';
  for (const ch of (word||'')) {
    const code = ch.charCodeAt(0);
    if (code >= 0xAC00 && code <= 0xD7A3) {
      const idx = Math.floor((code - base) / choUnit);
      out += CHO[idx] || ch;
    } else if (/\s/.test(ch)) {
      out += ' ';
    } else {
      out += ch;
    }
  }
  return out.replace(/\s+/g,'');
}

/* =========================================================
   üìò Î†åÎçîÎßÅ
========================================================= */
function renderVocabFill() {
  const data = (window.CONTENTS && window.CONTENTS[window.CUR_UNIT] && window.CONTENTS[window.CUR_UNIT].vocabFill) || null;
  const container = document.getElementById('vocab-fill');
  if (!data || !container) return;

  container.innerHTML = '';

  const inst = document.createElement('p');
  inst.className = 'vocab-instruction';
  inst.textContent = data.instructions || 'ÎπàÏπ∏Ïóê ÏïåÎßûÏùÄ ÎÇ±ÎßêÏùÑ Ïì∞ÏÑ∏Ïöî.';
  container.appendChild(inst);

  (data.items || []).forEach((item) => {
    const row = document.createElement('div');
    row.className = 'vocab-item';
    const initials = item.initials || _initialsFromKorean(item.answer);

    const html = (item.text || '').replace(
      '(      )',
      `<input type="text" id="fill-${item.no}" data-ans="${item.answer}" data-alias='${JSON.stringify(item.aliases||[])}' placeholder="${initials}" class="vocab-input">`
    );

    row.innerHTML = `<span class="vocab-num">${item.no}.</span> ${html}`;
    container.appendChild(row);
  });

  const btnWrap = document.createElement('div');
  btnWrap.style.marginTop = '12px';

  const btnCheck = document.createElement('button');
  btnCheck.textContent = 'Ï±ÑÏ†êÌïòÍ∏∞';
  btnCheck.className = 'check-btn';
  btnCheck.onclick = checkVocabFill;
  btnWrap.appendChild(btnCheck);

  const btnReset = document.createElement('button');
  btnReset.textContent = 'Ï¥àÍ∏∞Ìôî';
  btnReset.className = 'check-btn';
  btnReset.style.marginLeft = '8px';
  btnReset.onclick = () => {
    [...container.querySelectorAll('.vocab-input')].forEach(inp => {
      inp.value = '';
      inp.style.background = '';
    });
    _saveVocabInputs(unit);
  };
  btnWrap.appendChild(btnReset);
  container.appendChild(btnWrap);

  _loadVocabInputs(unit);
  container.addEventListener('input', (e)=>{
    if (e.target && e.target.classList.contains('vocab-input')) {
      e.target.style.background = '';
      _saveVocabInputs(unit);
    }
  });

  container.addEventListener('keydown', (e)=>{
    if (e.key === 'Enter' && e.target.classList.contains('vocab-input')) {
      const inputs = [...container.querySelectorAll('.vocab-input')];
      const idx = inputs.indexOf(e.target);
      const next = inputs[idx+1];
      if (next) next.focus();
    }
  });
}

/* =========================================================
   üßÆ Ï±ÑÏ†ê
========================================================= */
function checkVocabFill() {
  const data = (window.CONTENTS && window.CONTENTS[window.CUR_UNIT] && window.CONTENTS[window.CUR_UNIT].vocabFill && window.CONTENTS[window.CUR_UNIT].vocabFill.items) || [];
  let score = 0;

  data.forEach((item) => {
    const input = document.getElementById(`fill-${item.no}`);
    if (!input) return;
    const user = _norm(input.value);
    const answers = [item.answer, ...(item.aliases||[])].map(_norm);
    const correct = answers.some(v => v === user);

    input.style.background = correct ? '#d9f7be' : '#ffd6d6';
    if (correct) score++;
  });

  alert(`Ï†ïÎãµ ${score}Í∞ú / Ï¥ù ${data.length}Í∞ú`);
}

/* =========================================================
   ÌÉ≠ Ï†ÑÌôò Ïãú ÏûêÎèô Î†åÎçîÎßÅ
========================================================= */
function _bindTabEvents() {
  document.addEventListener('click', function (e) {
    var btn = e.target.closest('[data-tab]');
    if (!btn) return;
    var tab = btn.getAttribute('data-tab');

    // data-tab Í∞íÏù¥ 'vocab'Ïùº ÎïåÎßå Î†åÎçî
    if (tab === 'vocab') {
      var fn = window.renderVocabFromContent || window.renderVocabFill;
      if (typeof fn === 'function') fn();
    }
  });
}

function disableQuizInputs() {
  document.querySelectorAll('#tab-reading input[type="radio"]').forEach(r => r.disabled = true);
  ['q3-1', 'q3-2', 'q4-1', 'q4-2', 'q5'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.disabled = true;
  });
}

function enableQuizInputs() {
  document.querySelectorAll('#tab-reading input[type="radio"]').forEach(r => r.disabled = false);
  ['q3-1', 'q3-2', 'q4-1', 'q4-2', 'q5'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.disabled = false;
  });
}

async function saveReadingProgress() {
  gradeQuiz();

  const stu = window.getStudentInfo ? window.getStudentInfo() : null;
  if (!stu || !stu.grade || !stu.name) {
    showSubmitOverlay('ÌïôÎÖÑÍ≥º Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî');
    return;
  }

  const q1 = document.querySelector('input[name="q1"]:checked');
  const q2 = document.querySelector('input[name="q2"]:checked');
  const inputs = {
    q1: q1 ? q1.value : '',
    q2: q2 ? q2.value : '',
    q3_1: document.getElementById('q3-1')?.value || '',
    q3_2: document.getElementById('q3-2')?.value || '',
    q4_1: document.getElementById('q4-1')?.value || '',
    q4_2: document.getElementById('q4-2')?.value || '',
    q5: document.getElementById('q5')?.value || ''
  };

  const quizBlocks = document.querySelectorAll('#tab-reading .quiz-block');
  const results = [];
  quizBlocks.forEach((block, idx) => {
    const numEl = block.querySelector('.quiz-num');
    results.push({
      index: idx + 1,
      isCorrect: numEl.classList.contains('correct'),
      isWrong: numEl.classList.contains('wrong')
    });
  });

  const gradeResultBox = document.getElementById('grade-result');
  const dataToSave = {
    readingState: {
      inputs: inputs,
      results: results,
      resultHTML: gradeResultBox ? gradeResultBox.innerHTML : '',
      isGraded: true
    }
  };

  try {
    if (typeof window.saveUnitProgressToServer === 'function') {
      await window.saveUnitProgressToServer(dataToSave);
    }
    disableQuizInputs();
    await captureElementToPDF('capture-reading', 'Îã®Îã®Íµ≠Ïñ¥_Î≥∏Î¨∏ÌïôÏäµ.pdf', { withStudentInfo: true });

    // ‚òÖ PDF Ï∫°Ï≤ò ÌõÑ ÌïòÏù¥ÎùºÏù¥Ìä∏ Ï†ÅÏö©
    highlightEvidence();

    if (typeof renderSolutions === 'function') {
      const content = window.CONTENTS[window.CUR_UNIT];
      if (content) renderSolutions(content);
    }
    // showSubmitSuccessÎäî Ï†úÍ±∞ - Ï±ÑÏ†ê Í≤∞Í≥º ÌåùÏóÖÏù¥ ÎåÄÏã† ÌëúÏãúÎê®
    document.getElementById('save-progress-btn').style.display = 'none';
    document.getElementById('reset-btn').style.display = 'inline-block';
  } catch (err) {
    console.error('[saveReadingProgress] Ïã§Ìå®:', err);
    alert('Ï†ÄÏû• Ïã§Ìå®: ' + err.message);
  }
}
</script>


<!-- ‚òÖ Ï†ïÎãµ Í∑ºÍ±∞ ÌïòÏù¥ÎùºÏù¥Ìä∏ Ìï®Ïàò -->
<script>
// ÌïòÏù¥ÎùºÏù¥Ìä∏ Ï†úÍ±∞
function clearEvidenceHighlights() {
  const passage = document.querySelector('.passage-text');
  if (!passage) return;

  // evidence-highlight Ïä§Ìå¨ÏùÑ ÏõêÎûò ÌÖçÏä§Ìä∏Î°ú Î≥µÏõê
  passage.querySelectorAll('.evidence-highlight').forEach(el => {
    const text = el.textContent.replace(/\dÎ≤à$/, ''); // ÌÉúÍ∑∏ ÌÖçÏä§Ìä∏ Ï†úÍ±∞
    el.replaceWith(document.createTextNode(text));
  });

  // ÎÖ∏Îìú Ï†ïÍ∑úÌôî (Ïù∏Ï†ë ÌÖçÏä§Ìä∏ ÎÖ∏Îìú Î≥ëÌï©)
  passage.normalize();
}

// Ï†ïÎãµ Í∑ºÍ±∞ ÌïòÏù¥ÎùºÏù¥Ìä∏ Ï†ÅÏö©
function highlightEvidence() {
  const pack = window.CONTENTS?.[window.CUR_UNIT];
  if (!pack || !pack.explain) return;

  const passage = document.querySelector('.passage-text');
  if (!passage) return;

  // Î®ºÏ†Ä Í∏∞Ï°¥ ÌïòÏù¥ÎùºÏù¥Ìä∏ Ï†úÍ±∞
  clearEvidenceHighlights();

  const qLabels = ['1Î≤à', '2Î≤à', '3Î≤à', '4Î≤à', '5Î≤à'];
  const explains = [
    pack.explain.q1,
    pack.explain.q2,
    pack.explain.q3,
    pack.explain.q4,
    pack.explain.q5
  ].filter(Boolean);

  explains.forEach((text, idx) => {
    if (!text || text.length < 2) return;

    const qClass = `evidence-q${idx + 1}`;
    const label = qLabels[idx];

    // HTML ÌÉúÍ∑∏Î•º Î¨¥ÏãúÌïòÍ≥† ÌÖçÏä§Ìä∏Îßå Îß§Ïπ≠ÌïòÎäî Ï†ïÍ∑úÏãù ÏÉùÏÑ±
    const chars = Array.from(text);
    const escapedChars = chars.map(c => c.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'));
    const flexPattern = escapedChars.join('(?:<[^>]*>)*');

    let regex;
    try {
      regex = new RegExp(flexPattern, 'g');
    } catch (e) {
      console.warn('[highlightEvidence] regex error for q' + (idx+1) + ':', e.message);
      return;
    }

    const html = passage.innerHTML;
    const newHtml = html.replace(regex, (match) => {
      return `<span class="evidence-highlight ${qClass}">${match}<span class="evidence-tag">${label}</span></span>`;
    });

    if (newHtml !== html) {
      passage.innerHTML = newHtml;
    }
  });
}

// Ï†ÑÏó≠ ÎÖ∏Ï∂ú
window.highlightEvidence = highlightEvidence;
window.clearEvidenceHighlights = clearEvidenceHighlights;
</script>

<!-- ÏõπÌà∞ÌûåÌä∏ ÎìúÎ°≠Îã§Ïö¥ Ïä§ÌÅ¨Î¶ΩÌä∏ -->
<script>
let webtoonImagesLoaded = false;

function loadWebtoonImages() {
  if (webtoonImagesLoaded) return;
  const images = document.querySelectorAll('#webtoonBody img[data-src]');
  images.forEach(img => {
    img.src = img.dataset.src;
    img.removeAttribute('data-src');
  });
  webtoonImagesLoaded = true;
}

function toggleWebtoonDropdown() {
  const btn = document.getElementById('webtoonHintBtn');
  const dropdown = document.getElementById('webtoonDropdown');
  const isOpening = !dropdown.classList.contains('active');

  btn.classList.toggle('active');
  dropdown.classList.toggle('active');

  if (isOpening) {
    loadWebtoonImages();
  }
}
function closeWebtoonDropdown() {
  const btn = document.getElementById('webtoonHintBtn');
  const dropdown = document.getElementById('webtoonDropdown');
  btn.classList.remove('active');
  dropdown.classList.remove('active');
}
document.addEventListener('click', function(e) {
  const container = document.querySelector('.webtoon-hint-container');
  if (container && !container.contains(e.target)) {
    closeWebtoonDropdown();
  }
});
</script>

<!-- Ïô∏Î∂Ä JS: Îã®Ïõê ÏΩòÌÖêÏ∏† Î°úÎìú (geo_02.htmlÍ≥º Í∞ôÏùÄ Ìè¥Îçî) -->
<script src="./on_modern_content.js?v=20251113" defer></script>

<!-- Îã¨Î†• ÌåùÏóÖ -->
<div class="calendar-overlay" id="calendar-overlay"></div>
<div class="calendar-popup" id="calendar-popup">
  <div class="calendar-header">
    <span class="calendar-nav" onclick="changeMonth(-1)">‚óÄ</span>
    <span id="calendar-title">2024ÎÖÑ 11Ïõî</span>
    <span class="calendar-nav" onclick="changeMonth(1)">‚ñ∂</span>
  </div>
  <div class="calendar-grid" id="calendar-grid">
    <!-- ÏöîÏùº Ìó§Îçî -->
    <div class="calendar-day-header">Ïùº</div>
    <div class="calendar-day-header">Ïõî</div>
    <div class="calendar-day-header">Ìôî</div>
    <div class="calendar-day-header">Ïàò</div>
    <div class="calendar-day-header">Î™©</div>
    <div class="calendar-day-header">Í∏à</div>
    <div class="calendar-day-header">ÌÜ†</div>
    <!-- ÎÇ†ÏßúÎì§ÏùÄ JavaScriptÎ°ú ÎèôÏ†Å ÏÉùÏÑ± -->
  </div>
</div>

</body>
</html>