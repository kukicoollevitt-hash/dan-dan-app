<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í•™ìŠµê³¼ì œ ë¶€ì—¬ - ë‹¨ë‹¨êµì‹¤</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    }

    h1 {
      font-size: 32px;
      color: #333;
      margin-bottom: 10px;
      text-align: center;
    }

    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 40px;
      font-size: 14px;
    }

    .mode-selector {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-bottom: 40px;
    }

    .mode-btn {
      padding: 12px 32px;
      border: 2px solid #667eea;
      background: white;
      color: #667eea;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .mode-btn:hover {
      background: #f0f0f0;
    }

    .mode-btn.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: #764ba2;
    }

    .form-section {
      display: none;
    }

    .form-section.active {
      display: block;
    }

    .form-group {
      margin-bottom: 24px;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
      font-size: 15px;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 15px;
      transition: all 0.3s ease;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .student-select {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 10px;
      max-height: 300px;
      overflow-y: auto;
      padding: 16px;
      background: #f9f9f9;
      border-radius: 10px;
    }

    .student-checkbox {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: white;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .student-checkbox:hover {
      background: #e8edff;
    }

    .student-checkbox input[type="checkbox"] {
      width: auto;
      cursor: pointer;
    }

    .week-schedule {
      background: #f9f9f9;
      border-radius: 10px;
      padding: 20px;
    }

    .week-day {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
      padding: 12px;
      background: white;
      border-radius: 8px;
    }

    .week-day-label {
      min-width: 50px;
      font-weight: 600;
      color: #667eea;
    }

    .week-day-units {
      flex: 1;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .unit-checkbox {
      padding: 6px 12px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 14px;
    }

    .unit-checkbox:hover {
      border-color: #667eea;
      background: #f0f0ff;
    }

    .unit-checkbox input[type="checkbox"] {
      margin-right: 4px;
    }

    .submit-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 30px;
    }

    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .submit-btn:active {
      transform: translateY(0);
    }

    .back-btn {
      display: inline-block;
      padding: 10px 20px;
      background: #f0f0f0;
      color: #333;
      text-decoration: none;
      border-radius: 8px;
      font-size: 14px;
      margin-bottom: 20px;
      transition: all 0.2s ease;
    }

    .back-btn:hover {
      background: #e0e0e0;
    }

    .success-message {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 40px 50px;
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      text-align: center;
      z-index: 1000;
    }

    .success-message.show {
      display: block;
      animation: popIn 0.3s ease;
    }

    @keyframes popIn {
      from {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.8);
      }
      to {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
    }

    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
    }

    .overlay.show {
      display: block;
    }

    .repeat-weeks {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .repeat-weeks select {
      width: auto;
      flex: 1;
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="/admin-assign-menu" class="back-btn">â† ì‹œë¦¬ì¦ˆ ì„ íƒìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>

    <h1 id="pageTitle">ğŸ“š í•™ìŠµê³¼ì œ ë¶€ì—¬</h1>
    <p class="subtitle" id="pageSubtitle">í•™ìƒë“¤ì—ê²Œ ì£¼ë‹¨ìœ„ë¡œ í•™ìŠµê³¼ì œë¥¼ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>

    <div class="mode-selector">
      <button class="mode-btn active" data-mode="auto">ìë™ ë¶€ì—¬ (ì£¼ë‹¨ìœ„)</button>
      <button class="mode-btn" data-mode="manual">ìˆ˜ë™ ë¶€ì—¬</button>
    </div>

    <!-- ìë™ ë¶€ì—¬ (ì£¼ë‹¨ìœ„) -->
    <form id="autoForm" class="form-section active">
      <div class="form-group">
        <label>ì£¼ ì‹œì‘ì¼ (ì›”ìš”ì¼) ì„ íƒ</label>
        <input type="date" id="weekStart" required>
      </div>

      <div class="form-group">
        <label>í•™ìƒ ì„ íƒ (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)</label>
        <div class="student-select" id="studentListAuto">
          <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
        </div>
      </div>

      <div class="form-group" id="seriesGroupAuto" style="display: none;">
        <label>ì‹œë¦¬ì¦ˆ ì„ íƒ</label>
        <select id="seriesAuto" required>
          <option value="">ì‹œë¦¬ì¦ˆ ì„ íƒ</option>
          <option value="BRAINUP">BRAINì—…</option>
          <option value="BRAINON">BRAINì˜¨</option>
        </select>
      </div>

      <div class="form-group">
        <label>ë¶„ì•¼ ì„ íƒ</label>
        <select id="categoryAuto" required disabled>
          <option value="">ë¶„ì•¼ ì„ íƒ</option>
        </select>
      </div>

      <div class="form-group">
        <label>ê³¼ëª© ì„ íƒ</label>
        <select id="subjectAuto" required disabled>
          <option value="">ê³¼ëª© ì„ íƒ</option>
        </select>
      </div>

      <div class="form-group">
        <label>ì£¼ê°„ ìŠ¤ì¼€ì¤„ ì„¤ì •</label>
        <div class="week-schedule" id="weekSchedule">
          <!-- ì›”~ê¸ˆ ë‹¨ì› ì„ íƒ -->
        </div>
      </div>

      <div class="form-group">
        <label>ë°˜ë³µ ì£¼ìˆ˜</label>
        <div class="repeat-weeks">
          <select id="repeatWeeks">
            <option value="1">1ì£¼</option>
            <option value="2">2ì£¼</option>
            <option value="3">3ì£¼</option>
            <option value="4">4ì£¼</option>
            <option value="6">6ì£¼</option>
            <option value="8">8ì£¼</option>
          </select>
          <span>ì—°ì† ë¶€ì—¬</span>
        </div>
      </div>

      <button type="submit" class="submit-btn">ê³¼ì œ ë¶€ì—¬í•˜ê¸°</button>
    </form>

    <!-- ìˆ˜ë™ ë¶€ì—¬ -->
    <form id="manualForm" class="form-section">
      <div class="form-group">
        <label>ê³¼ì œ ë‚ ì§œ ì„ íƒ</label>
        <input type="date" id="dueDateManual" required>
      </div>

      <div class="form-group">
        <label>í•™ìƒ ì„ íƒ (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)</label>
        <div class="student-select" id="studentListManual">
          <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
        </div>
      </div>

      <div class="form-group">
        <label>ì‹œë¦¬ì¦ˆ ì„ íƒ</label>
        <select id="seriesManual" required>
          <option value="">ì‹œë¦¬ì¦ˆ ì„ íƒ</option>
          <option value="BRAINUP">BRAINì—…</option>
          <option value="BRAINON">BRAINì˜¨</option>
        </select>
      </div>

      <div class="form-group">
        <label>ë¶„ì•¼ ì„ íƒ</label>
        <select id="categoryManual" required disabled>
          <option value="">ë¶„ì•¼ ì„ íƒ</option>
        </select>
      </div>

      <div class="form-group">
        <select id="subjectManual" required disabled>
          <option value="">ê³¼ëª© ì„ íƒ</option>
        </select>
      </div>

      <div class="form-group">
        <label>ë‹¨ì› ì„ íƒ (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)</label>
        <div id="unitsManual" class="week-day-units">
          <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
        </div>
      </div>

      <button type="submit" class="submit-btn">ê³¼ì œ ë¶€ì—¬í•˜ê¸°</button>
    </form>
  </div>

  <div class="overlay" id="overlay"></div>
  <div class="success-message" id="successMessage">
    <h2 style="color: #667eea; margin-bottom: 16px;">âœ… ê³¼ì œ ë¶€ì—¬ ì™„ë£Œ!</h2>
    <p style="color: #666;">í•™ìƒë“¤ì—ê²Œ ê³¼ì œê°€ ì„±ê³µì ìœ¼ë¡œ ë¶€ì—¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
  </div>

  <script>
    // ì‹œë¦¬ì¦ˆë³„ ë¶„ì•¼/ê³¼ëª© ë°ì´í„°
    const contentData = {
      BRAINUP: {
        science: {
          name: "ê³¼í•™ë¬¸í•´",
          subjects: {
            bio: { name: "ìƒë¬¼", units: 4 },
            chem: { name: "í™”í•™", units: 4 },
            physics: { name: "ë¬¼ë¦¬", units: 4 },
            earth: { name: "ì§€êµ¬ê³¼í•™", units: 4 }
          }
        },
        social: {
          name: "ì‚¬íšŒíƒêµ¬",
          subjects: {
            geo: { name: "ì§€ë¦¬", units: 4 },
            law: { name: "ë²•", units: 4 },
            pol: { name: "ì •ì¹˜", units: 4 },
            soc: { name: "ì‚¬íšŒë¬¸í™”", units: 4 }
          }
        },
        korlit: {
          name: "í•œêµ­ë¬¸í•™",
          subjects: {
            classic: { name: "ê³ ì „ë¬¸í•™", units: 2 },
            modern: { name: "í˜„ëŒ€ë¬¸í•™", units: 2 }
          }
        },
        worldlit: {
          name: "ì„¸ê³„ë¬¸í•™",
          subjects: {
            world: { name: "ì„¸ê³„ë¬¸í•™", units: 4 }
          }
        },
        person: {
          name: "ì¸ë¬¼ë¬¸í•´",
          subjects: {
            people: { name: "ì¸ë¬¼", units: 4 }
          }
        }
      },
      BRAINON: {
        science: {
          name: "ê³¼í•™ë¬¸í•´",
          subjects: {
            bio: { name: "ìƒë¬¼", units: 4 },
            chem: { name: "í™”í•™", units: 4 },
            physics: { name: "ë¬¼ë¦¬", units: 4 },
            earth: { name: "ì§€êµ¬ê³¼í•™", units: 4 }
          }
        },
        social: {
          name: "ì‚¬íšŒíƒêµ¬",
          subjects: {
            geo: { name: "ì§€ë¦¬", units: 4 },
            law: { name: "ë²•", units: 4 },
            pol: { name: "ì •ì¹˜", units: 4 },
            soc: { name: "ì‚¬íšŒë¬¸í™”", units: 4 }
          }
        },
        korlit: {
          name: "í•œêµ­ë¬¸í•™",
          subjects: {
            classic: { name: "ê³ ì „ë¬¸í•™", units: 2 },
            modern: { name: "í˜„ëŒ€ë¬¸í•™", units: 2 }
          }
        },
        worldlit: {
          name: "ì„¸ê³„ë¬¸í•™",
          subjects: {
            world: { name: "ì„¸ê³„ë¬¸í•™", units: 4 }
          }
        },
        person: {
          name: "ì¸ë¬¼ë¬¸í•´",
          subjects: {
            people: { name: "ì¸ë¬¼", units: 4 }
          }
        }
      }
    };

    // ì‹œë¦¬ì¦ˆëª… ë§¤í•‘
    const seriesNameMap = {
      'BRAINON': 'BRAINì˜¨',
      'BRAINUP': 'BRAINì—…',
      'BRAINFIT': 'BRAINí•',
      'BRAINDIP': 'BRAINë”¥',
      'BRAINJUNIOR': 'BRAINì¤‘ë“±',
      'BRAINHIGH': 'BRAINê³ ë“±'
    };

    // URL íŒŒë¼ë¯¸í„°ì—ì„œ ì‹œë¦¬ì¦ˆ ê°€ì ¸ì˜¤ê¸°
    const urlParams = new URLSearchParams(window.location.search);
    const selectedSeries = urlParams.get('series');

    if (selectedSeries) {
      console.log('ì„ íƒëœ ì‹œë¦¬ì¦ˆ:', selectedSeries);

      // í˜ì´ì§€ íƒ€ì´í‹€ ì—…ë°ì´íŠ¸
      const seriesDisplayName = seriesNameMap[selectedSeries] || selectedSeries;
      document.getElementById('pageTitle').textContent = `ğŸ“š ${seriesDisplayName} í•™ìŠµê³¼ì œ ë¶€ì—¬`;
      document.getElementById('pageSubtitle').textContent = `${seriesDisplayName} ì‹œë¦¬ì¦ˆì˜ í•™ìŠµê³¼ì œë¥¼ í•™ìƒë“¤ì—ê²Œ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤`;

      // ì‹œë¦¬ì¦ˆ ì„ íƒ ë“œë¡­ë‹¤ìš´ì— ìë™ ì„¤ì • (ìë™ ë¶€ì—¬)
      const seriesAutoSelect = document.getElementById('seriesAuto');
      if (seriesAutoSelect && contentData[selectedSeries]) {
        seriesAutoSelect.value = selectedSeries;
        // ì¹´í…Œê³ ë¦¬ ë“œë¡­ë‹¤ìš´ í™œì„±í™” ë° ì±„ìš°ê¸°
        const categoryAutoSelect = document.getElementById('categoryAuto');
        categoryAutoSelect.disabled = false;
        categoryAutoSelect.innerHTML = '<option value="">ë¶„ì•¼ ì„ íƒ</option>';
        Object.keys(contentData[selectedSeries]).forEach(catKey => {
          const option = document.createElement('option');
          option.value = catKey;
          option.textContent = contentData[selectedSeries][catKey].name;
          categoryAutoSelect.appendChild(option);
        });
      }

      // ì‹œë¦¬ì¦ˆ ì„ íƒ ë“œë¡­ë‹¤ìš´ì— ìë™ ì„¤ì • (ìˆ˜ë™ ë¶€ì—¬)
      const seriesManualSelect = document.getElementById('seriesManual');
      if (seriesManualSelect && contentData[selectedSeries]) {
        seriesManualSelect.value = selectedSeries;
        // ì¹´í…Œê³ ë¦¬ ë“œë¡­ë‹¤ìš´ í™œì„±í™” ë° ì±„ìš°ê¸°
        const categoryManualSelect = document.getElementById('categoryManual');
        categoryManualSelect.disabled = false;
        categoryManualSelect.innerHTML = '<option value="">ë¶„ì•¼ ì„ íƒ</option>';
        Object.keys(contentData[selectedSeries]).forEach(catKey => {
          const option = document.createElement('option');
          option.value = catKey;
          option.textContent = contentData[selectedSeries][catKey].name;
          categoryManualSelect.appendChild(option);
        });
      }
    }

    // ëª¨ë“œ ì „í™˜
    document.querySelectorAll('.mode-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        const mode = btn.dataset.mode;
        document.querySelectorAll('.form-section').forEach(section => section.classList.remove('active'));
        document.getElementById(mode === 'auto' ? 'autoForm' : 'manualForm').classList.add('active');
      });
    });

    // í•™ìƒ ëª©ë¡ ë¡œë“œ
    async function loadStudents() {
      try {
        console.log('ğŸ” í•™ìƒ ëª©ë¡ ë¡œë“œ ì‹œì‘...');

        // URL íŒŒë¼ë¯¸í„°ì—ì„œ ì‹œë¦¬ì¦ˆ ê°€ì ¸ì˜¤ê¸°
        const urlParams = new URLSearchParams(window.location.search);
        const series = urlParams.get('series');

        // ì‹œë¦¬ì¦ˆ íŒŒë¼ë¯¸í„°ê°€ ìˆìœ¼ë©´ ì¿¼ë¦¬ ìŠ¤íŠ¸ë§ì— ì¶”ê°€
        const apiUrl = series ? `/api/students?series=${series}` : '/api/students';
        console.log('   - API í˜¸ì¶œ:', apiUrl);

        const response = await fetch(apiUrl);
        console.log('   - ì‘ë‹µ ìƒíƒœ:', response.status);

        const students = await response.json();
        console.log('   - ë¡œë“œëœ í•™ìƒ ìˆ˜:', students.length);
        console.log('   - í•™ìƒ ëª©ë¡:', students.map(s => `${s.grade} ${s.name} (${s.school}) [${s.assignedSeries?.join(', ') || 'ì‹œë¦¬ì¦ˆ ì—†ìŒ'}]`));

        const autoList = document.getElementById('studentListAuto');
        const manualList = document.getElementById('studentListManual');

        if (students.length === 0) {
          const noStudentMsg = `<div style="padding:20px; text-align:center; color:#999;">
            ${series ? `${seriesNameMap[series] || series} ì‹œë¦¬ì¦ˆê°€ ë¶€ì—¬ëœ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.` : 'í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.'}
          </div>`;
          autoList.innerHTML = noStudentMsg;
          manualList.innerHTML = noStudentMsg;
          return;
        }

        students.forEach(student => {
          const studentId = `${student.grade} ${student.name}`;

          // ìë™ ë¶€ì—¬ìš©
          const autoCheckbox = document.createElement('label');
          autoCheckbox.className = 'student-checkbox';
          autoCheckbox.innerHTML = `
            <input type="checkbox" name="students" value="${studentId}">
            <span>${studentId}</span>
          `;
          autoList.appendChild(autoCheckbox);

          // ìˆ˜ë™ ë¶€ì—¬ìš©
          const manualCheckbox = document.createElement('label');
          manualCheckbox.className = 'student-checkbox';
          manualCheckbox.innerHTML = `
            <input type="checkbox" name="students" value="${studentId}">
            <span>${studentId}</span>
          `;
          manualList.appendChild(manualCheckbox);
        });

        console.log('âœ… í•™ìƒ ëª©ë¡ í‘œì‹œ ì™„ë£Œ');
      } catch (error) {
        console.error('âŒ í•™ìƒ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
      }
    }

    // ì‹œë¦¬ì¦ˆ ë³€ê²½ ì‹œ ì¹´í…Œê³ ë¦¬ ì—…ë°ì´íŠ¸
    function setupSeriesChange(seriesId, categoryId, subjectId, mode) {
      const seriesSelect = document.getElementById(seriesId);
      const categorySelect = document.getElementById(categoryId);
      const subjectSelect = document.getElementById(subjectId);

      seriesSelect.addEventListener('change', () => {
        const series = seriesSelect.value;
        categorySelect.innerHTML = '<option value="">ë¶„ì•¼ ì„ íƒ</option>';
        subjectSelect.innerHTML = '<option value="">ê³¼ëª© ì„ íƒ</option>';
        categorySelect.disabled = true;
        subjectSelect.disabled = true;

        if (series && contentData[series]) {
          Object.keys(contentData[series]).forEach(catKey => {
            const cat = contentData[series][catKey];
            const option = document.createElement('option');
            option.value = catKey;
            option.textContent = cat.name;
            categorySelect.appendChild(option);
          });
          categorySelect.disabled = false;
        }
      });

      categorySelect.addEventListener('change', () => {
        const series = seriesSelect.value;
        const category = categorySelect.value;
        subjectSelect.innerHTML = '<option value="">ê³¼ëª© ì„ íƒ</option>';
        subjectSelect.disabled = true;

        if (series && category && contentData[series][category]) {
          Object.keys(contentData[series][category].subjects).forEach(subKey => {
            const sub = contentData[series][category].subjects[subKey];
            const option = document.createElement('option');
            option.value = subKey;
            option.textContent = sub.name;
            subjectSelect.appendChild(option);
          });
          subjectSelect.disabled = false;
        }

        if (mode === 'auto') {
          updateWeekSchedule();
        }
      });

      if (mode === 'manual') {
        subjectSelect.addEventListener('change', updateManualUnits);
      } else {
        subjectSelect.addEventListener('change', updateWeekSchedule);
      }
    }

    // ì£¼ê°„ ìŠ¤ì¼€ì¤„ ì—…ë°ì´íŠ¸
    function updateWeekSchedule() {
      const series = document.getElementById('seriesAuto').value;
      const category = document.getElementById('categoryAuto').value;
      const subject = document.getElementById('subjectAuto').value;
      const scheduleDiv = document.getElementById('weekSchedule');

      if (!series || !category || !subject) {
        scheduleDiv.innerHTML = '';
        return;
      }

      const unitCount = contentData[series][category].subjects[subject].units;
      const weekDays = ['ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼'];

      scheduleDiv.innerHTML = '';
      weekDays.forEach(day => {
        const dayDiv = document.createElement('div');
        dayDiv.className = 'week-day';
        dayDiv.innerHTML = `
          <div class="week-day-label">${day}</div>
          <div class="week-day-units" data-day="${day}">
            ${Array.from({length: unitCount}, (_, i) => `
              <label class="unit-checkbox">
                <input type="checkbox" name="units-${day}" value="${i + 1}">
                ${i + 1}ë‹¨ì›
              </label>
            `).join('')}
          </div>
        `;
        scheduleDiv.appendChild(dayDiv);
      });
    }

    // ìˆ˜ë™ ë¶€ì—¬ ë‹¨ì› ì—…ë°ì´íŠ¸
    function updateManualUnits() {
      const series = document.getElementById('seriesManual').value;
      const category = document.getElementById('categoryManual').value;
      const subject = document.getElementById('subjectManual').value;
      const unitsDiv = document.getElementById('unitsManual');

      if (!series || !category || !subject) {
        unitsDiv.innerHTML = '';
        return;
      }

      const unitCount = contentData[series][category].subjects[subject].units;
      unitsDiv.innerHTML = Array.from({length: unitCount}, (_, i) => `
        <label class="unit-checkbox">
          <input type="checkbox" name="units" value="${i + 1}">
          ${i + 1}ë‹¨ì›
        </label>
      `).join('');
    }

    // ìë™ ë¶€ì—¬ í¼ ì œì¶œ
    document.getElementById('autoForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const weekStart = new Date(document.getElementById('weekStart').value);
      const students = Array.from(document.querySelectorAll('#studentListAuto input:checked')).map(el => el.value);
      const series = document.getElementById('seriesAuto').value;
      const category = document.getElementById('categoryAuto').value;
      const subject = document.getElementById('subjectAuto').value;
      const repeatWeeks = parseInt(document.getElementById('repeatWeeks').value);

      if (students.length === 0) {
        alert('í•™ìƒì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }

      // ì£¼ê°„ ìŠ¤ì¼€ì¤„ ìˆ˜ì§‘
      const weekDays = ['ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼'];
      const schedule = [];

      weekDays.forEach((day, idx) => {
        const units = Array.from(document.querySelectorAll(`input[name="units-${day}"]:checked`)).map(el => parseInt(el.value));
        if (units.length > 0) {
          schedule.push({
            dayOfWeek: day.replace('ìš”ì¼', ''),
            dayOffset: idx,
            units: units
          });
        }
      });

      if (schedule.length === 0) {
        alert('ìµœì†Œ í•˜ë‚˜ ì´ìƒì˜ ê³¼ì œë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.');
        return;
      }

      try {
        const response = await fetch('/api/assignments/auto', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            weekStartDate: weekStart,
            students,
            series,
            category,
            subject,
            schedule,
            repeatWeeks
          })
        });

        if (response.ok) {
          showSuccess();
        } else {
          alert('ê³¼ì œ ë¶€ì—¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    });

    // ìˆ˜ë™ ë¶€ì—¬ í¼ ì œì¶œ
    document.getElementById('manualForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const dueDate = new Date(document.getElementById('dueDateManual').value);
      const students = Array.from(document.querySelectorAll('#studentListManual input:checked')).map(el => el.value);
      const series = document.getElementById('seriesManual').value;
      const category = document.getElementById('categoryManual').value;
      const subject = document.getElementById('subjectManual').value;
      const units = Array.from(document.querySelectorAll('#unitsManual input:checked')).map(el => parseInt(el.value));

      if (students.length === 0) {
        alert('í•™ìƒì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }

      if (units.length === 0) {
        alert('ë‹¨ì›ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }

      try {
        const response = await fetch('/api/assignments', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            dueDate,
            students,
            series,
            category,
            subject,
            units
          })
        });

        if (response.ok) {
          showSuccess();
        } else {
          alert('ê³¼ì œ ë¶€ì—¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    });

    function showSuccess() {
      document.getElementById('overlay').classList.add('show');
      document.getElementById('successMessage').classList.add('show');

      setTimeout(() => {
        document.getElementById('overlay').classList.remove('show');
        document.getElementById('successMessage').classList.remove('show');
        window.location.reload();
      }, 2000);
    }

    // ì´ˆê¸°í™”
    loadStudents();
    setupSeriesChange('seriesAuto', 'categoryAuto', 'subjectAuto', 'auto');
    setupSeriesChange('seriesManual', 'categoryManual', 'subjectManual', 'manual');

    // ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì´ˆê¸°í™”
    const today = new Date();
    const monday = new Date(today);
    monday.setDate(today.getDate() - today.getDay() + 1);
    document.getElementById('weekStart').valueAsDate = monday;
    document.getElementById('dueDateManual').valueAsDate = today;
  </script>
</body>
</html>
