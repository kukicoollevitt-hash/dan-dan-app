<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ”ï¸ ì‚°ì€ ì†Ÿì•„ì˜¤ë¥´ê³  ë°”ë‹¤ëŠ” ê°ˆë¼ì§„ë‹¤ - ê´€ë¬¸í‰ê°€</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: "Gmarket Sans", "Noto Sans KR", sans-serif;
      background: linear-gradient(135deg, #5D4E37 0%, #3E2723 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .quiz-container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 24px;
      padding: 40px;
      max-width: 700px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }
    .quiz-header { text-align: center; margin-bottom: 30px; }
    .quiz-header h1 { font-size: 28px; color: #5D4E37; margin-bottom: 10px; }
    .quiz-header p { color: #666; font-size: 14px; }
    .progress-bar { width: 100%; height: 8px; background: #e0e0e0; border-radius: 4px; margin-bottom: 30px; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, #5D4E37, #3E2723); border-radius: 4px; transition: width 0.3s ease; }
    .question-number { display: inline-block; padding: 6px 16px; background: linear-gradient(135deg, #5D4E37 0%, #3E2723 100%); color: white; border-radius: 20px; font-size: 13px; font-weight: 600; margin-bottom: 15px; }
    .category-tag { display: inline-block; padding: 4px 12px; background: rgba(93, 78, 55, 0.1); color: #5D4E37; border-radius: 12px; font-size: 12px; margin-left: 10px; }
    .question-text { font-size: 18px; font-weight: 600; color: #333; margin-bottom: 25px; line-height: 1.6; }
    .options { display: flex; flex-direction: column; gap: 12px; }
    .option { padding: 16px 20px; background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 12px; cursor: pointer; transition: all 0.2s ease; font-size: 15px; color: #444; }
    .option:hover { border-color: #5D4E37; background: rgba(93, 78, 55, 0.05); }
    .option.selected { border-color: #5D4E37; background: rgba(93, 78, 55, 0.1); color: #3E2723; font-weight: 600; }
    .option.correct { border-color: #27ae60; background: rgba(39, 174, 96, 0.15); color: #1e8449; }
    .option.wrong { border-color: #e74c3c; background: rgba(231, 76, 60, 0.15); color: #c0392b; }
    .nav-buttons { display: flex; justify-content: space-between; margin-top: 30px; gap: 15px; }
    .nav-btn { flex: 1; padding: 14px 24px; border: none; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
    .nav-btn.prev { background: #e9ecef; color: #666; }
    .nav-btn.next { background: linear-gradient(135deg, #5D4E37 0%, #3E2723 100%); color: white; }
    .nav-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); }
    .nav-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    .result-container { display: none; text-align: center; }
    .result-container.show { display: block; }
    .result-title { font-size: 32px; color: #5D4E37; margin-bottom: 10px; }
    .result-score { font-size: 64px; font-weight: 700; color: #3E2723; margin: 20px 0; }
    .result-message { font-size: 18px; color: #666; margin-bottom: 30px; }
    .radar-container { width: 300px; height: 300px; margin: 0 auto 30px; }
    .category-scores { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 30px; }
    .category-score { padding: 8px 16px; background: rgba(93, 78, 55, 0.1); border-radius: 20px; font-size: 13px; color: #3E2723; }
    .restart-btn { padding: 16px 40px; background: linear-gradient(135deg, #5D4E37 0%, #3E2723 100%); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
    .restart-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); }
    .close-btn { position: fixed; top: 20px; right: 20px; width: 44px; height: 44px; background: rgba(255, 255, 255, 0.9); border: none; border-radius: 50%; font-size: 24px; cursor: pointer; z-index: 100; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); }
    @media (max-width: 768px) {
      .quiz-container { padding: 25px; margin: 10px; }
      .quiz-header h1 { font-size: 22px; }
      .question-text { font-size: 16px; }
      .option { padding: 14px 16px; font-size: 14px; }
      .result-score { font-size: 48px; }
      .radar-container { width: 250px; height: 250px; }
    }
  </style>
</head>
<body>
  <button class="close-btn" onclick="closeQuiz()">Ã—</button>
  <div class="quiz-container">
    <div id="quiz-screen">
      <div class="quiz-header">
        <h1>ğŸ”ï¸ ì‚°ì€ ì†Ÿì•„ì˜¤ë¥´ê³  ë°”ë‹¤ëŠ” ê°ˆë¼ì§„ë‹¤</h1>
        <p>ê´€ë¬¸í‰ê°€ - ì´ì•¼ê¸°ë¥¼ ì˜ ì´í•´í–ˆëŠ”ì§€ í™•ì¸í•´ ë³´ì„¸ìš”!</p>
      </div>
      <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
      <div id="question-container">
        <span class="question-number" id="question-number">1/10</span>
        <span class="category-tag" id="category-tag">ì¸ë¬¼íŒŒì•…</span>
        <p class="question-text" id="question-text"></p>
        <div class="options" id="options"></div>
      </div>
      <div class="nav-buttons">
        <button class="nav-btn prev" id="prev-btn" onclick="prevQuestion()">ì´ì „</button>
        <button class="nav-btn next" id="next-btn" onclick="nextQuestion()">ë‹¤ìŒ</button>
      </div>
    </div>
    <div class="result-container" id="result-screen">
      <h2 class="result-title">ğŸ‰ í‰ê°€ ì™„ë£Œ!</h2>
      <div class="result-score" id="result-score">0ì </div>
      <p class="result-message" id="result-message"></p>
      <div class="radar-container"><canvas id="radar-chart" width="300" height="300"></canvas></div>
      <div class="category-scores" id="category-scores"></div>
      <button class="restart-btn" onclick="closeQuiz()">ëŒì•„ê°€ê¸°</button>
    </div>
  </div>

  <script>
    const quizData = [
      // ì¸ë¬¼íŒŒì•… (2ë¬¸ì œ)
      { category: "ì¸ë¬¼íŒŒì•…", question: "ì§€êµ¬ì—ì„œ ê°€ì¥ í° íŒìœ¼ë¡œ, íƒœí‰ì–‘ ë°”ë‹¥ ì•„ë˜ ëˆ„ì›Œ ìˆëŠ” ì¡´ì¬ëŠ”?", options: ["ìœ ë¼ì‹œì•„íŒ ìœ ë¼", "íƒœí‰ì–‘íŒ íƒœí‰", "ì•„í”„ë¦¬ì¹´íŒ", "ë‚¨ê·¹íŒ"], answer: 1 },
      { category: "ì¸ë¬¼íŒŒì•…", question: "ì§€ê° ì•„ë˜ ë§¨í‹€ì—ì„œ ëŠë¦¿ëŠë¦¿ ëŒ€ë¥˜í•˜ë©° íŒë“¤ì„ ì›€ì§ì´ê²Œ í•˜ëŠ” ë³´ì´ì§€ ì•ŠëŠ” ì¡°ì¢…ìëŠ”?", options: ["íˆë§ë¼ì•¼ íˆë§", "ëŒ€ì„œì–‘ í•´ë ¹ ë¦¬í”„íŠ¸", "ë§¨í‹€ ëŒ€ë¥˜ ì¥ì¸ ë§ˆê·¸ë§ˆ", "ë§ˆë¦¬ì•„ë‚˜ í•´êµ¬ íŠ¸ë Œì¹˜"], answer: 2 },
      // ë‚´ìš©ì¼ì¹˜ (2ë¬¸ì œ)
      { category: "ë‚´ìš©ì¼ì¹˜", question: "ì•½ 3ì–µ ë…„ ì „ ëª¨ë“  ëŒ€ë¥™ì´ í•˜ë‚˜ë¡œ ë¶™ì–´ ìˆë˜ ì´ˆëŒ€ë¥™ì˜ ì´ë¦„ì€?", options: ["ë¡œë””ë‹ˆì•„", "íŒê²Œì•„", "ì•„ë§ˆì‹œì•„", "ê³¤ë“œì™€ë‚˜"], answer: 1 },
      { category: "ë‚´ìš©ì¼ì¹˜", question: "ì¸ë„íŒê³¼ ìœ ë¼ì‹œì•„íŒì´ ì¶©ëŒí•´ì„œ ë§Œë“¤ì–´ì§„ ì‚°ë§¥ì€?", options: ["ì•Œí”„ìŠ¤ì‚°ë§¥", "ì•ˆë°ìŠ¤ì‚°ë§¥", "íˆë§ë¼ì•¼ì‚°ë§¥", "ë¡œí‚¤ì‚°ë§¥"], answer: 2 },
      // ë‚´ìš©êµ¬ì¡° (2ë¬¸ì œ)
      { category: "ë‚´ìš©êµ¬ì¡°", question: "ì§€êµ¬ì˜ í‘œë©´ì ì€ ëŠ˜ì–´ë‚˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ìƒˆë¡œìš´ ë•…ì´ ë§Œë“¤ì–´ì§€ë©´ ë‹¤ë¥¸ ê³³ì—ì„œëŠ” ì–´ë–¤ ì¼ì´ ì¼ì–´ë‚˜ë‚˜ìš”?", options: ["ë•…ì´ ì‚¬ë¼ì§„ë‹¤(ì„­ì…)", "ë•…ì´ ë‘ ë°°ë¡œ ëŠ˜ì–´ë‚œë‹¤", "ë•…ì´ í•˜ëŠ˜ë¡œ ì˜¬ë¼ê°„ë‹¤", "ì•„ë¬´ ë³€í™”ê°€ ì—†ë‹¤"], answer: 0 },
      { category: "ë‚´ìš©êµ¬ì¡°", question: "íŒì˜ ê²½ê³„ì—ì„œ ë²Œì–´ì§€ëŠ” ì„¸ ê°€ì§€ ì›€ì§ì„ì´ ì•„ë‹Œ ê²ƒì€?", options: ["ì¶©ëŒ", "ë²Œì–´ì§", "ì—‡ê°ˆë¦¼", "ìœµí•©"], answer: 3 },
      // ë‚´ìš©ì–´íœ˜ (2ë¬¸ì œ)
      { category: "ë‚´ìš©ì–´íœ˜", question: "'ì„­ì…'ì´ë€ ë¬´ì—‡ì¸ê°€ìš”?", options: ["ë‘ íŒì´ ì„œë¡œ ë°€ì–´ë‚´ëŠ” ê²ƒ", "ë¬´ê±°ìš´ í•´ì–‘íŒì´ ëŒ€ë¥™íŒ ì•„ë˜ë¡œ íŒŒê³ ë“¤ì–´ ì§€êµ¬ ë‚´ë¶€ë¡œ ë˜ëŒì•„ê°€ëŠ” ê²ƒ", "íŒì´ ìœ„ë¡œ ì†Ÿì•„ì˜¤ë¥´ëŠ” ê²ƒ", "íŒì´ ì˜†ìœ¼ë¡œ ì´ë™í•˜ëŠ” ê²ƒ"], answer: 1 },
      { category: "ë‚´ìš©ì–´íœ˜", question: "'í•´ë ¹'ì´ë€ ë¬´ì—‡ì¸ê°€ìš”?", options: ["ë°”ë‹¤ ë°‘ì˜ ê¹Šì€ ê³¨ì§œê¸°", "ë°”ë‹¤ ë°‘ì—ì„œ ë§ˆê·¸ë§ˆê°€ ì†Ÿì•„ì˜¬ë¼ ìƒˆë¡œìš´ ë°”ë‹¥ì„ ë§Œë“œëŠ” í•´ì € ì‚°ë§¥", "í•´ì•ˆê°€ì˜ ì ˆë²½", "ë°”ë‹¤ ìœ„ì˜ ì„¬"], answer: 1 },
      // ë‚´ìš©ì¶”ë¡  (2ë¬¸ì œ)
      { category: "ë‚´ìš©ì¶”ë¡ ", question: "í™˜íƒœí‰ì–‘ í™”ì‚°ëŒ€(ë¶ˆì˜ ê³ ë¦¬)ì—ì„œ í™”ì‚°ê³¼ ì§€ì§„ì´ ì§‘ì¤‘ë˜ëŠ” ì´ìœ ëŠ”?", options: ["ë°”ë‹¤ê°€ ê¹Šì–´ì„œ", "íƒœí‰ì–‘íŒì´ ì£¼ë³€ íŒë“¤ ì•„ë˜ë¡œ ì„­ì…ë˜ê¸° ë•Œë¬¸ì—", "ê¸°ì˜¨ì´ ë†’ì•„ì„œ", "ì¸êµ¬ê°€ ë§ì•„ì„œ"], answer: 1 },
      { category: "ë‚´ìš©ì¶”ë¡ ", question: "íŒë“¤ì˜ ì›€ì§ì„ì´ ë©ˆì¶”ë©´ ì§€êµ¬ì— ì–´ë–¤ ì¼ì´ ë°œìƒí• ê¹Œìš”?", options: ["ë‚ ì”¨ê°€ ì¢‹ì•„ì§„ë‹¤", "ì§€êµ¬ê°€ ì£½ì€ í–‰ì„±ì´ ëœë‹¤", "ë°”ë‹¤ê°€ ë„“ì–´ì§„ë‹¤", "ì‚°ì´ ë” ë†’ì•„ì§„ë‹¤"], answer: 1 }
    ];

    let currentQuestion = 0;
    let userAnswers = new Array(quizData.length).fill(null);
    let answered = new Array(quizData.length).fill(false);
    const categoryScores = { "ì¸ë¬¼íŒŒì•…": { correct: 0, total: 2 }, "ë‚´ìš©ì¼ì¹˜": { correct: 0, total: 2 }, "ë‚´ìš©êµ¬ì¡°": { correct: 0, total: 2 }, "ë‚´ìš©ì–´íœ˜": { correct: 0, total: 2 }, "ë‚´ìš©ì¶”ë¡ ": { correct: 0, total: 2 } };

    function renderQuestion() {
      const q = quizData[currentQuestion];
      document.getElementById('question-number').textContent = `${currentQuestion + 1}/${quizData.length}`;
      document.getElementById('category-tag').textContent = q.category;
      document.getElementById('question-text').textContent = q.question;
      document.getElementById('progress-fill').style.width = `${((currentQuestion + 1) / quizData.length) * 100}%`;
      const optionsContainer = document.getElementById('options');
      optionsContainer.innerHTML = '';
      q.options.forEach((opt, idx) => {
        const optDiv = document.createElement('div');
        optDiv.className = 'option';
        if (userAnswers[currentQuestion] === idx) optDiv.classList.add('selected');
        if (answered[currentQuestion]) {
          if (idx === q.answer) optDiv.classList.add('correct');
          else if (userAnswers[currentQuestion] === idx) optDiv.classList.add('wrong');
        }
        optDiv.textContent = opt;
        optDiv.onclick = () => selectOption(idx);
        optionsContainer.appendChild(optDiv);
      });
      document.getElementById('prev-btn').disabled = currentQuestion === 0;
      document.getElementById('next-btn').textContent = currentQuestion === quizData.length - 1 ? 'ê²°ê³¼ ë³´ê¸°' : 'ë‹¤ìŒ';
    }

    function selectOption(idx) {
      if (answered[currentQuestion]) return;
      userAnswers[currentQuestion] = idx;
      answered[currentQuestion] = true;
      const q = quizData[currentQuestion];
      if (idx === q.answer) categoryScores[q.category].correct++;
      renderQuestion();
    }

    function nextQuestion() {
      if (userAnswers[currentQuestion] === null) { alert('ë‹µì„ ì„ íƒí•´ì£¼ì„¸ìš”!'); return; }
      if (currentQuestion < quizData.length - 1) { currentQuestion++; renderQuestion(); }
      else showResult();
    }

    function prevQuestion() {
      if (currentQuestion > 0) { currentQuestion--; renderQuestion(); }
    }

    function showResult() {
      document.getElementById('quiz-screen').style.display = 'none';
      document.getElementById('result-screen').classList.add('show');
      let totalScore = 0;
      const scores = [];
      for (const cat in categoryScores) {
        const s = categoryScores[cat];
        let score = s.correct === 2 ? 10 : s.correct === 1 ? 5 : 1;
        scores.push(score);
        totalScore += score;
      }
      document.getElementById('result-score').textContent = totalScore + 'ì ';
      let msg = totalScore >= 40 ? 'í›Œë¥­í•´ìš”! íŒ êµ¬ì¡°ë¡  ë°•ì‚¬!' : totalScore >= 25 ? 'ì˜í–ˆì–´ìš”! ì¡°ê¸ˆë§Œ ë” ë…¸ë ¥í•˜ë©´ ì™„ë²½!' : 'ë‹¤ì‹œ í•œë²ˆ ì´ì•¼ê¸°ë¥¼ ì½ì–´ë³¼ê¹Œìš”?';
      document.getElementById('result-message').textContent = msg;
      const scoresDiv = document.getElementById('category-scores');
      scoresDiv.innerHTML = '';
      const categories = Object.keys(categoryScores);
      categories.forEach((cat, i) => {
        const span = document.createElement('span');
        span.className = 'category-score';
        span.textContent = `${cat}: ${scores[i]}ì `;
        scoresDiv.appendChild(span);
      });
      drawRadar(scores);
      saveResult(totalScore, scores);
    }

    function drawRadar(scores) {
      const canvas = document.getElementById('radar-chart');
      const ctx = canvas.getContext('2d');
      const cx = 150, cy = 150, r = 100;
      ctx.clearRect(0, 0, 300, 300);
      const labels = ['ì¸ë¬¼íŒŒì•…', 'ë‚´ìš©ì¼ì¹˜', 'ë‚´ìš©êµ¬ì¡°', 'ë‚´ìš©ì–´íœ˜', 'ë‚´ìš©ì¶”ë¡ '];
      ctx.strokeStyle = '#ddd';
      ctx.lineWidth = 1;
      for (let level = 1; level <= 5; level++) {
        ctx.beginPath();
        for (let i = 0; i <= 5; i++) {
          const angle = (Math.PI * 2 * i / 5) - Math.PI / 2;
          const x = cx + Math.cos(angle) * (r * level / 5);
          const y = cy + Math.sin(angle) * (r * level / 5);
          if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
        }
        ctx.closePath();
        ctx.stroke();
      }
      for (let i = 0; i < 5; i++) {
        const angle = (Math.PI * 2 * i / 5) - Math.PI / 2;
        ctx.beginPath();
        ctx.moveTo(cx, cy);
        ctx.lineTo(cx + Math.cos(angle) * r, cy + Math.sin(angle) * r);
        ctx.stroke();
        const labelX = cx + Math.cos(angle) * (r + 25);
        const labelY = cy + Math.sin(angle) * (r + 25);
        ctx.fillStyle = '#333';
        ctx.font = '12px sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(labels[i], labelX, labelY);
      }
      ctx.beginPath();
      ctx.fillStyle = 'rgba(93, 78, 55, 0.3)';
      ctx.strokeStyle = '#5D4E37';
      ctx.lineWidth = 2;
      for (let i = 0; i <= 5; i++) {
        const angle = (Math.PI * 2 * (i % 5) / 5) - Math.PI / 2;
        const val = scores[i % 5] / 10;
        const x = cx + Math.cos(angle) * r * val;
        const y = cy + Math.sin(angle) * r * val;
        if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
      }
      ctx.closePath();
      ctx.fill();
      ctx.stroke();
    }

    async function saveResult(totalScore, scores) {
      const urlParams = new URLSearchParams(window.location.search);
      const season = urlParams.get('season') || 'season1';
      const grade = localStorage.getItem('selectedGrade') || '';
      const name = localStorage.getItem('selectedStudent') || '';
      try {
        await fetch('/api/creative-quiz/save', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ grade, name, storyId: 'earth07', season, scores: { ì¸ë¬¼íŒŒì•…: scores[0], ë‚´ìš©ì¼ì¹˜: scores[1], ë‚´ìš©êµ¬ì¡°: scores[2], ë‚´ìš©ì–´íœ˜: scores[3], ë‚´ìš©ì¶”ë¡ : scores[4] }, totalScore })
        });
      } catch (e) { console.error('ì €ì¥ ì‹¤íŒ¨:', e); }
    }

    function closeQuiz() {
      if (window.opener) window.close();
      else if (window.parent !== window) window.parent.postMessage({ action: 'closeQuiz' }, '*');
      else window.location.href = 'earth07_season1.html';
    }

    renderQuestion();
  </script>
</body>
</html>
