<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë‹¨ë‹¨êµ­ì–´ ë¬¸í•´ë ¥ ì‹œë¦¬ì¦ˆ | ëª©ì°¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <!-- ðŸŽ‰ Confetti ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    /* ðŸ”„ ë¡œë”© ìŠ¤í”¼ë„ˆ - ì¸ë¼ì¸ í¬ë¦¬í‹°ì»¬ CSS (ì¦‰ì‹œ ë¡œë“œ) */
    #loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(242, 237, 229, 0.95);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 99999;
      transition: opacity 0.5s ease;
    }

    #loading-overlay.fade-out {
      opacity: 0;
      pointer-events: none;
    }

    .spinner-container {
      text-align: center;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(139, 47, 47, 0.2);
      border-top: 4px solid #8b2f2f;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    .loading-text {
      color: #8b2f2f;
      font-size: 16px;
      font-weight: 600;
      font-family: "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    :root {
      --bg: #f2ede5;
      --panel: #fffaf3;
      --accent: #8b2f2f;
      --line: #e5d4c1;
      --text: #3b2a1a;
    }
    * { box-sizing: border-box; }

    /* ðŸ”¥ ì•„ì´íŒ¨ë“œ í„°ì¹˜ ë”œë ˆì´ ì œê±° */
    button, a, [onclick], .clickable, .tab, .menu-item, .study-room-item {
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }

body {
  margin: 0;
  min-height: 100vh;
  font-family: "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
  background: #f2ede5;   /* ê¸°ë³¸ ë°°ê²½ìƒ‰ë§Œ ë‚¨ê¸°ê¸° (ë¹„ë””ì˜¤ ë¡œë”© ì‹¤íŒ¨ ì‹œìš©) */
  background-size: cover;
  background-position: center center;
  background-repeat: no-repeat;
  background-attachment: fixed;
  position: relative;
  overflow-x: hidden;
  opacity: 1;
  transition: opacity 0.5s ease, background-image 0.8s ease;
}


/* ðŸ”¥ ë©”ë‰´ ì „ì²´ì— ê¹ŒëŠ” MP4 ë°°ê²½ ì˜ìƒ */
.menu-bg-video {
  position: fixed;
  inset: 0;              /* top:0; right:0; bottom:0; left:0; ì™€ ê°™ìŒ */
  width: 100%;
  height: 100%;
  object-fit: cover;     /* í™”ë©´ ê°€ë“ ì±„ìš°ê¸° */
  z-index: -1;           /* ëª¨ë“  ë‚´ìš© ë’¤ë¡œ ë³´ë‚´ê¸° */
  pointer-events: auto;  /* í´ë¦­ ê°€ëŠ¥í•˜ê²Œ ë³€ê²½ */
  cursor: pointer;       /* ë§ˆìš°ìŠ¤ ì»¤ì„œë¥¼ í¬ì¸í„°ë¡œ ë³€ê²½ */
}

    header {
      background: #f7f1e5;
      border-bottom: 3px solid #c58a45;
      padding: 8px 20px 10px;
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: flex-start;
      position: relative;
      z-index: 1;
    }
    .brand-title { font-size: 22px; font-weight: 700; color: #7f2b2b; }
    .brand-sub { font-size: 12px; color: #a57145; }

    /* ðŸ”¹ í—¤ë” ì˜¤ë¥¸ìª½(ìœ ì €ì •ë³´ + ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼) */
    .header-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .layout {
      display: grid;
  grid-template-columns: 220px 210px 220px 1fr;  /* ðŸ”¥ ì²« ì»¬ëŸ¼ í­ë§Œ 220pxë¡œ í™•ëŒ€ */
      min-height: calc(100vh - 65px);
      position: relative;
      z-index: 1;
    }
.col {
  border-right: 1px solid #e1d3c0;
  background: rgba(255, 250, 240, 0.85);
  overflow-y: auto;
}
    .col-title {
      padding: 12px 14px 6px;
      font-weight: 700;
      font-size: 13px;
      color: #5b3a22;
    }
    .series-list, .domain-list, .subject-list, .unit-list {
      list-style: none;
      margin: 0;
      padding: 4px 8px 16px;
    }
    .series-item,
    .domain-item,
    .subject-item,
    .unit-item {
      padding: 14px 18px;
      margin-bottom: 6px;
  background: rgba(248, 238, 214, 0.9);  /* âœ… ì—¬ê¸°ë§Œ êµì²´ */
      border: 1px solid transparent;
      border-radius: 10px;
      font-size: 15px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      transition: all 0.2s ease;
    }
    .series-item:hover,
    .domain-item:hover,
    .subject-item:hover,
    .unit-item:hover {
      border-color: rgba(139,47,47,0.5);
      background: rgba(255,248,240,0.8);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(139,47,47,0.15);
    }
    .series-item.active,
    .domain-item.active,
    .subject-item.active,
    .unit-item.active {
      background: #af4604;
      color: #fff;
      border-color: #8b2f2f;
    }
    /* ë¹„í™œì„±í™”ëœ ì‹œë¦¬ì¦ˆ */
    .series-item.disabled {
      opacity: 0.4;
      filter: grayscale(1);
      cursor: not-allowed;
      pointer-events: none;
    }
    .meta { font-size: 11px; opacity: 0.6; }
    .detail-panel {
      padding: 14px 18px 40px;
      background: #fffdf8;
      overflow-y: auto;
    }
    .detail-title { font-weight: 700; margin-bottom: 2px; }
    .detail-desc { font-size: 12px; color: #9b7a54; margin-bottom: 10px; }
    

    /* ë‹¨ì› ì˜¤ë¥¸ìª½ ë¬¶ìŒ(ë²ˆí˜¸ + ìƒíƒœ) */
    .unit-right {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .unit-list .unit-item { border-radius: 7px; font-size: 14px; }

    .badge {
      background: rgba(255,255,255,0.2);
      border: 1px solid rgba(255,255,255,0.4);
      border-radius: 999px;
      padding: 1px 8px 2px;
      font-size: 10px;
    }

    /* âœ… ìƒíƒœ ë±ƒì§€ */
    .status-badge {
      display: inline-block;
      border-radius: 8px;
      padding: 3px 8px 4px;
      font-size: 11px;
      font-weight: 500;
      white-space: nowrap;
    }
    /* ì¼ë°˜ ê³¼ì œ - âœï¸ ë¯¸ì™„ë£Œ */
    .status-default {
      background: #f8d4d4;
      color: #7f2525;
    }
    /* ì¼ë°˜ ê³¼ì œ - ðŸ† í•™ìŠµì™„ë£Œ */
    .status-done {
      background: #aef3ae;
      color: #18622e;
    }
    /* AI ê³¼ì œ - ðŸ”„ í•™ìŠµí•„ìš” */
    .status-ai-pending {
      background: #e9d5ff;
      color: #6b21a8;
    }
    /* ë³„ì  í‘œì‹œ */
    .unit-stars {
      display: inline-block;
      margin-right: 8px;
      font-size: 14px;
      color: #fbbf24;
      text-shadow: 0 0 2px rgba(251, 191, 36, 0.3);
    }

    /* AI ê³¼ì œ - ðŸ† í•™ìŠµì™„ë£Œ */
    .status-ai-done {
      background: #d1fae5;
      color: #065f46;
    }

    /* ëª¨ë‹¬ (ì¤€ë¹„ì¤‘) */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.35);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
      backdrop-filter: blur(2px);
    }
    .overlay.show { display: flex; }
    .modal-box {
      background: #fffaf3;
      border: 1px solid rgba(139,47,47,0.08);
      border-radius: 18px;
      padding: 22px 24px 20px;
      width: 330px;
      text-align: center;
      box-shadow: 0 15px 45px rgba(0,0,0,0.12);
      animation: pop 0.25s ease;
    }
    @keyframes pop {
      from { transform: translateY(10px) scale(0.97); opacity: 0; }
      to { transform: translateY(0) scale(1); opacity: 1; }
    }
    .modal-emoji { font-size: 34px; margin-bottom: 6px; }
    .modal-title { font-weight: 700; margin-bottom: 6px; color: #6f2e2e; }
    .modal-msg { font-size: 12.5px; color: #8d6f51; line-height: 1.5; margin-bottom: 14px; }
    .modal-btn { background: #8b2f2f; color: #fff; border: none; border-radius: 999px; padding: 7px 16px 8px; font-size: 12.5px; cursor: pointer; }
    .modal-btn:hover { opacity: 0.9; }
    .modal-btn-danger {
      background: #b02a2a;
      border: 1px solid rgba(176,42,42,0.3);
    }
    .modal-btn-danger:hover {
      opacity: 0.95;
      box-shadow: 0 3px 8px rgba(0,0,0,0.15);
    }

    /* ìƒë‹¨ ì‚¬ìš©ìž í‘œì‹œ */
    #user-info {
      font-size: 12px;
      color: #8d6f51;
      background: rgba(255,255,255,0.3);
      padding: 6px 12px 7px;
      border-radius: 999px;
      border: 1px solid rgba(197,138,69,0.15);
      white-space: nowrap;
    }

    /* ðŸ”´ ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ */
    .logout-btn {
      padding: 6px 14px 7px;
      border-radius: 999px;
      border: 1px solid rgba(139,47,47,0.25);
      background: #8b2f2f;
      color: #fff;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.08);
      transition: transform 0.05s ease, box-shadow 0.05s ease, opacity 0.15s;
    }
    .logout-btn:hover {
      opacity: 0.95;
      box-shadow: 0 3px 8px rgba(0,0,0,0.12);
      transform: translateY(-1px);
    }
    .logout-btn:active {
      transform: translateY(0);
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .logout-btn:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
    }

    /* ðŸ¤– AI í•™ìŠµ ì¸ì‹ ì˜¤ë²„ë ˆì´ */
    .ai-loading-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      backdrop-filter: blur(6px);
    }
    .ai-loading-overlay.show {
      display: flex;
    }
    .ai-loading-box {
      background: rgba(255, 250, 243, 0.75);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(139,117,87,0.15);
      border-radius: 20px;
      width: 280px;
      text-align: center;
      padding: 28px 30px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.15);
    }
    .ai-loading-spinner {
      width: 44px;
      height: 44px;
      border: 4px solid rgba(139,117,87,0.2);
      border-top-color: #8b7557;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }
    .ai-loading-title {
      font-weight: 700;
      font-size: 17px;
      margin-bottom: 6px;
      color: #5a4a3a;
    }
    .ai-loading-msg {
      font-size: 13px;
      color: #8d7a65;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ðŸ”‹ ë¡œë”© ì˜¤ë²„ë ˆì´ */
    .overlay-loading {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      backdrop-filter: blur(4px);
    }
    .overlay-loading.show {
      display: flex;
    }
    .loading-box {
      background: #fffaf3;
      border: 1px solid rgba(139,47,47,0.12);
      border-radius: 18px;
      width: 320px;
      text-align: center;
      padding: 28px 30px 26px;
      box-shadow: 0 15px 45px rgba(0,0,0,0.12);
    }
    .loading-emoji {
      font-size: 56px;
      margin-bottom: 8px;
    }
    .loading-title {
      font-weight: 700;
      margin-bottom: 6px;
      color: #6f2e2e;
    }
    .loading-msg {
      font-size: 13px;
      color: #8d6f51;
      margin-bottom: 14px;
    }
    .loading-progress {
      width: 100%;
      height: 10px;
      background: #e0d2c1;
      border-radius: 999px;
      position: relative;
      overflow: hidden;
    }
    .loading-bar {
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 0;
      background: #8b2f2f;
      border-radius: 999px;
      transition: width 0.25s ease;
    }
    .loading-percent {
      margin-top: 8px;
      font-size: 12px;
      font-weight: 600;
      color: #8b2f2f;
    }

    .brand-sub-wrap {
      position: relative;      /* ë£¨ëŒí”„ì˜ ê¸°ì¤€ì  */
      display: inline-block;
    }

    .brand-sub {
      white-space: nowrap;     /* ì¤„ë°”ê¿ˆ ë°©ì§€ */
      line-height: 1.2;        /* í˜„ìž¬ ì¤„ ë†’ì´ ìœ ì§€ */
    }

    .brand-rudolph {
      position: absolute;
      right: -60px;
      top: -35px;
      transform: translateY(-50%);
      height: 50px;
      width: auto;
      display: block;
      pointer-events: none;
    }
    .bottom-snow {
      position: fixed;
      bottom: -100px;
      left: 0;
      width: 100%;
      pointer-events: none;
      z-index: 1;
    }
    /* === ë©”ë‰´ ì»¬ëŸ¼ê³¼ ìƒì„¸ íŒ¨ë„ì„ íˆ¬ëª…í•˜ê²Œ === */
.col {
  background: transparent !important;
}

.detail-panel {
  background: transparent !important;
}
/* ë¸Œëžœë“œ ì„œë¸Œ + ë£¨ëŒí”„ë¥¼ í•œ ì¤„ ì •ë ¬ */
.brand-sub-wrap {
  display: flex;
  align-items: center;
  justify-content: space-between;  /* ì™¼ìª½ í…ìŠ¤íŠ¸, ì˜¤ë¥¸ìª½ ë£¨ëŒí”„ */
}

/* ë£¨ëŒí”„ ì˜ìƒ ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
.brand-rudolph {
  width: 100px;          /* ì›í•˜ëŠ” í¬ê¸° */
  height: 100px;
  object-fit: contain;  /* ë¹„ìœ¨ ìœ ì§€ */
  display: block;
  margin-left: auto;    /* ì˜¤ë¥¸ìª½ìœ¼ë¡œ ë°€ê¸° */
  margin-right: -60px;  /* ë” ì˜¤ë¥¸ìª½ìœ¼ë¡œ */
  pointer-events: auto; /* í´ë¦­ ê°€ëŠ¥í•˜ë„ë¡ ë³€ê²½ */
  border: none;
  background: none;
  animation: float-whale 3s ease-in-out infinite;
  cursor: pointer;      /* ë§ˆìš°ìŠ¤ ì»¤ì„œ ë³€ê²½ */
}

/* ê³ ëž˜ ë‘¥ë‘¥ ë– ë‹¤ë‹ˆëŠ” ì• ë‹ˆë©”ì´ì…˜ */
@keyframes float-whale {
  0%, 100% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-10px);
  }
}

/* ìŠ¤í† ë¦¬ ë ˆì´ë¸” ì´ë¯¸ì§€ */
.story-label {
  width: 90px;
  height: auto;
  object-fit: contain;
  display: block;
  margin-left: -30px;
  pointer-events: none;
  animation: float-label 2.5s ease-in-out infinite;
  animation-delay: 0.3s;
}

/* ìŠ¤í† ë¦¬ ë ˆì´ë¸” ë‘¥ë‘¥ ì• ë‹ˆë©”ì´ì…˜ (ê³ ëž˜ì™€ ì•½ê°„ ë‹¤ë¥¸ íƒ€ì´ë°) */
@keyframes float-label {
  0%, 100% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-8px);
  }
}

/* ë ˆì´ë” ì°¨íŠ¸ ì•„ì´ì½˜ */
.radar-chart-icon {
  position: fixed;
  bottom: 30px;
  left: 30px;
  width: 120px;
  height: 120px;
  cursor: pointer;
  z-index: 1000;
  filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.2));
  animation: float-icon 3s ease-in-out infinite;
}

.radar-chart-icon:hover {
  animation-play-state: paused;
  transform: scale(1.1) translateY(-5px);
  filter: drop-shadow(0 8px 20px rgba(139, 47, 47, 0.4));
}

.radar-chart-icon img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

/* ë…¸íŠ¸ ì•„ì´ì½˜ */
.note-icon {
  position: fixed;
  bottom: 30px;
  left: 140px;
  width: 120px;
  height: 130px;
  cursor: pointer;
  z-index: 1000;
  filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.2));
  user-select: none;
  animation: float-icon-delay 3s ease-in-out infinite;
}

.note-icon:hover {
  animation-play-state: paused;
  transform: scale(1.1);
  filter: drop-shadow(0 8px 20px rgba(139, 47, 47, 0.4));
}

.note-icon img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

/* ë ˆì´ë” ë“±ê¸‰ ë±ƒì§€ */
/* íŽ€í•‘ ì• ë‹ˆë©”ì´ì…˜ */
@keyframes badgePump {
  0%, 100% {
    transform: translateX(-50%) scale(1);
  }
  50% {
    transform: translateX(-50%) scale(1.1);
  }
}

.radar-grade-badge {
  position: absolute;
  top: -15px;
  left: 50%;
  transform: translateX(-50%);
  background: #ff8c42;
  color: white;
  border-radius: 999px;
  padding: 8px 15px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  font-weight: 700;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  border: 3px solid white;
  z-index: 10;
  min-width: 70px;
  white-space: nowrap;
  animation: badgePump 2s ease-in-out infinite;
}

.radar-grade-badge.excellent {
  background: #5dade2;
  color: white;
}

.radar-grade-badge.good {
  background: #f1c40f;
  color: #333;
}

.radar-grade-badge.average {
  background: #ff8c42;
  color: white;
}

.radar-grade-badge.encourage {
  background: #e74c3c;
  color: white;
}

/* ì–´íœ˜í€´ì¦ˆ í‰ê· ì ìˆ˜ ë±ƒì§€ */
.vocab-avg-badge {
  position: absolute;
  top: -5px;
  left: 25px;
  background: linear-gradient(135deg, #ff1493 0%, #ff69b4 100%);
  color: white;
  border-radius: 999px;
  min-width: 35px;
  height: 35px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  font-weight: 700;
  box-shadow: 0 3px 8px rgba(255, 20, 147, 0.5);
  border: 2px solid white;
  animation: badge-pulse 2s ease-in-out infinite;
  padding: 0 6px;
}

/* í•™ìŠµì‹¤ ì•„ì´ì½˜ */
.study-room-icon {
  position: fixed;
  bottom: 30px;
  left: 250px;
  width: 130px;
  height: 130px;
  cursor: pointer;
  z-index: 1000;
  filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.2));
  user-select: none;
  animation: float-icon 3s ease-in-out infinite;
  animation-delay: 0.5s;
}

.study-room-icon:hover {
  animation-play-state: paused;
  transform: scale(1.1);
  filter: drop-shadow(0 8px 20px rgba(139, 47, 47, 0.4));
}

.study-room-icon img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

/* í•™ìŠµì‹¤ ê³¼ì œ ê°œìˆ˜ ë±ƒì§€ */
.study-room-badge {
  position: absolute;
  top: -5px;
  left: 25px;
  background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
  color: white;
  border-radius: 999px;
  min-width: 35px;
  height: 35px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  font-weight: 700;
  box-shadow: 0 3px 8px rgba(238, 90, 82, 0.5);
  border: 2px solid white;
  animation: badge-pulse 2s ease-in-out infinite;
  padding: 0 6px;
}

@keyframes badge-pulse {
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.1);
  }
}

/* ì•„ì´ì½˜ ë‘¥ë‘¥ ë– ë‹¤ë‹ˆëŠ” ì• ë‹ˆë©”ì´ì…˜ */
@keyframes float-icon {
  0%, 100% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-12px);
  }
}

/* ë…¸íŠ¸ ì•„ì´ì½˜ì€ ì•½ê°„ ì‹œì°¨ë¥¼ ë‘  */
@keyframes float-icon-delay {
  0%, 100% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-10px);
  }
}

/* í•™ìŠµ ë¶„ì„ ëª¨ë‹¬ */
.learning-modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  backdrop-filter: blur(3px);
}

.learning-modal.show {
  display: flex;
}

.learning-modal-content {
  background: #fff;
  width: 90vw;
  height: 90vh;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  display: flex;
  flex-direction: column;
  animation: modalSlideIn 0.3s ease;
}

@keyframes modalSlideIn {
  from {
    transform: translateY(30px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.learning-modal-header {
  position: absolute;
  top: 16px;
  right: 16px;
  z-index: 10;
}

.learning-modal-title {
  display: none;
}

.learning-modal-footer {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 12px;
  padding: 20px;
  background: rgba(255, 255, 255, 0.95);
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.05);
}

.learning-action-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 12px 24px;
  border: none;
  border-radius: 10px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  white-space: nowrap;
}

.learning-action-btn svg {
  flex-shrink: 0;
}

.send-btn {
  background: linear-gradient(135deg, #4A90E2 0%, #5CB3FF 100%);
  color: white;
}

.send-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 16px rgba(74, 144, 226, 0.4);
}

.download-btn {
  background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
  color: white;
}

.download-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 16px rgba(86, 171, 47, 0.4);
}

.learning-modal-close {
  background: rgba(0, 0, 0, 0.5);
  border: none;
  color: #fff;
  font-size: 28px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.learning-modal-close:hover {
  background: rgba(0, 0, 0, 0.7);
  transform: scale(1.1);
}

.learning-modal-iframe {
  flex: 1;
  border: none;
  width: 100%;
  height: 100%;
}

/* ë‹¨ì› í•™ìŠµ ëª¨ë‹¬ */
.unit-modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 10001;
  backdrop-filter: blur(3px);
}

.unit-modal.show {
  display: flex;
}

.unit-modal-content {
  background: #fff;
  width: 90vw;
  height: 90vh;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  display: flex;
  flex-direction: column;
  animation: modalSlideIn 0.3s ease;
}

.unit-modal-header {
  position: absolute;
  top: 16px;
  right: 16px;
  z-index: 10;
}

.unit-modal-close {
  background: rgba(0, 0, 0, 0.5);
  border: none;
  color: #fff;
  font-size: 28px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.unit-modal-close:hover {
  background: rgba(0, 0, 0, 0.7);
  transform: scale(1.1);
}

.unit-modal-iframe {
  flex: 1;
  border: none;
  width: 100%;
  height: 100%;
}

/* AI ì±—ë´‡ í”Œë¡œíŒ… ë²„íŠ¼ */
.ai-chatbot-floating-btn {
  position: fixed;
  bottom: 30px;
  right: 30px;
  width: 120px;
  height: 120px;
  cursor: pointer;
  z-index: 10002;
  transition: transform 0.3s ease;
  animation: floatingBounce 3s ease-in-out infinite;
}

.ai-chatbot-floating-btn:hover {
  animation: floatingHover 1s ease-in-out infinite;
}

.ai-chatbot-floating-btn img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.2));
}

@keyframes floatingBounce {
  0%, 100% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-15px);
  }
}

@keyframes floatingHover {
  0%, 100% {
    transform: translateY(-5px) scale(1.05);
  }
  50% {
    transform: translateY(-20px) scale(1.1);
  }
}

/* AI ì±—ë´‡ ëª¨ë‹¬ - í•¸ë“œí° í˜•íƒœ */
.ai-chatbot-modal {
  position: fixed;
  bottom: 160px;
  right: 30px;
  display: none;
  z-index: 10003;
}

.ai-chatbot-modal.show {
  display: block;
  animation: chatbotSlideUp 0.3s ease;
}

.ai-chatbot-modal-content {
  background: transparent;
  width: 400px;
  height: 650px;
  border-radius: 24px;
  overflow: visible;
  box-shadow: none;
  display: flex;
  flex-direction: column;
  position: relative;
  pointer-events: auto;
}

.ai-chatbot-modal-header {
  position: absolute;
  top: 12px;
  right: 12px;
  z-index: 10;
  cursor: move;
}

.ai-chatbot-modal-close {
  background: rgba(0, 0, 0, 0.5);
  border: none;
  color: #fff;
  font-size: 24px;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.ai-chatbot-modal-close:hover {
  background: rgba(0, 0, 0, 0.7);
  transform: scale(1.1);
}

.ai-chatbot-modal-iframe {
  flex: 1;
  border: none;
  width: 100%;
  height: 100%;
  border-radius: 24px;
}

@keyframes chatbotSlideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ì•„ì´íŒ¨ë“œìš© ê³ ì • ë°°ê²½ ë ˆì´ì–´ */
#tablet-fixed-bg {
  display: none;
}

/* ë°˜ì‘í˜•: íƒœë¸”ë¦¿ (ì•„ì´íŒ¨ë“œ ì„¸ë¡œ/ê°€ë¡œ) */
@media (max-width: 1400px) and (min-width: 769px) {
  #tablet-fixed-bg {
    display: block;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-size: 150%;
    background-position: center 15%;
    background-repeat: no-repeat;
    background-color: #f5efe6;
    z-index: -1;
  }

  body {
    background: transparent !important;
  }

  .ai-chatbot-modal-content {
    width: 280px;
    height: 400px;
  }

  .ai-chatbot-modal {
    right: 20px;
    bottom: 80px;
  }
}

/* ë°˜ì‘í˜•: ìž‘ì€ í™”ë©´ì—ì„œëŠ” í¬ê¸° ì¡°ì • */
@media (max-width: 768px) {
  .ai-chatbot-modal-content {
    width: calc(100vw - 40px);
    height: calc(100vh - 200px);
    max-width: 400px;
  }

  .ai-chatbot-modal {
    right: 20px;
    bottom: 140px;
  }
}

/* ì–´íœ˜ë ¥ í€´ì¦ˆì‡¼ ëª¨ë‹¬ - ì¤‘ì•™ íŒì—… */
.vocab-quiz-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 10005;
}

.vocab-quiz-modal.show {
  display: flex;
  animation: fadeIn 0.3s ease;
}

.vocab-quiz-modal-content {
  background: #fff;
  width: 1000px;
  height: 750px;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 12px 48px rgba(0, 0, 0, 0.3);
  display: flex;
  flex-direction: column;
  position: relative;
}

.vocab-quiz-modal-header {
  position: absolute;
  top: 12px;
  right: 12px;
  z-index: 10;
}

.vocab-quiz-modal-close {
  background: rgba(0, 0, 0, 0.5);
  border: none;
  color: #fff;
  font-size: 28px;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.vocab-quiz-modal-close:hover {
  background: rgba(0, 0, 0, 0.7);
  transform: scale(1.1);
}

.vocab-quiz-modal-iframe {
  flex: 1;
  border: none;
  width: 100%;
  height: 100%;
  border-radius: 16px;
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* í•™ìŠµì‹¤ ëª¨ë‹¬ */
.study-room-modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 10002;
  backdrop-filter: blur(3px);
}

.study-room-modal.show {
  display: flex;
}

.study-room-modal-content {
  background: linear-gradient(135deg, #fffaf3 0%, #fff5e6 100%);
  width: 700px;
  max-height: 85vh;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  display: flex;
  flex-direction: column;
  animation: modalSlideIn 0.3s ease;
}

.study-room-modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 24px;
  background: linear-gradient(135deg, #c94b4b 0%, #8b2f2f 50%, #5a1f1f 100%);
  background-size: 200% 200%;
  animation: gradientShift 8s ease infinite;
  color: white;
  border-bottom: 2px solid rgba(139, 47, 47, 0.3);
  box-shadow: 0 4px 15px rgba(139, 47, 47, 0.3);
  position: relative;
  overflow: hidden;
}

.study-room-modal-header::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
  animation: shimmer 3s infinite;
}

@keyframes gradientShift {
  0%, 100% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
}

@keyframes shimmer {
  0% {
    left: -100%;
  }
  100% {
    left: 100%;
  }
}

.study-room-modal-header h2 {
  margin: 0;
  font-size: 20px;
  font-weight: 700;
  position: relative;
  z-index: 1;
}

.study-room-modal-close {
  background: rgba(255, 255, 255, 0.2);
  border: none;
  color: #fff;
  font-size: 28px;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  position: relative;
  z-index: 1;
}

.study-room-modal-close:hover {
  background: rgba(255, 255, 255, 0.3);
  transform: scale(1.1);
}

.study-room-modal-body {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
}

.study-room-list {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.study-room-item {
  background: white;
  border: 2px solid #e0d2c1;
  border-radius: 12px;
  padding: 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: all 0.2s ease;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.study-room-item:not(.empty):hover {
  border-color: #8b2f2f;
  box-shadow: 0 4px 12px rgba(139, 47, 47, 0.15);
  transform: translateY(-2px);
}

.study-room-item.empty {
  background: repeating-linear-gradient(
    45deg,
    #fafafa,
    #fafafa 10px,
    #f0f0f0 10px,
    #f0f0f0 20px
  );
  border-style: dashed;
  border-color: #d0d0d0;
  justify-content: center;
}

.study-room-item.empty .empty-text {
  color: #999;
  font-size: 14px;
  font-weight: 500;
}

.study-room-item-left {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.study-room-item-title {
  font-size: 16px;
  font-weight: 700;
  color: #2c2c2c;
}

.study-room-item-meta {
  font-size: 13px;
  color: #888;
}

.study-room-item-right {
  display: flex;
  align-items: center;
  gap: 10px;
}

.trash-btn {
  background: transparent;
  border: none;
  padding: 8px 12px;
  cursor: pointer;
  font-size: 18px;
  transition: all 0.2s ease;
}

.trash-btn:hover {
  transform: scale(1.2);
}

/* ì˜¤ë²„ë ˆì´ ëª¨ë‹¬ ê³µí†µ ìŠ¤íƒ€ì¼ */
.overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 10003;
  backdrop-filter: blur(3px);
}

.overlay.show {
  display: flex;
}

/* ê´€ë¦¬ìž ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬ */
.password-modal,
.assign-modal {
  background: white;
  border-radius: 16px;
  padding: 24px;
  width: 400px;
  max-width: 90%;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  animation: modalSlideIn 0.3s ease;
}

.password-modal-header h3,
.assign-modal-header h3 {
  margin: 0 0 16px 0;
  font-size: 18px;
  font-weight: 700;
  color: #2c2c2c;
}

.password-modal-body,
.assign-modal-body {
  margin-bottom: 20px;
}

.password-modal-body p,
.assign-modal-body p {
  margin: 0 0 16px 0;
  font-size: 14px;
  color: #666;
}

.password-modal-body input {
  width: 100%;
  padding: 12px;
  border: 2px solid #e0d2c1;
  border-radius: 8px;
  font-size: 16px;
  box-sizing: border-box;
  transition: border-color 0.2s ease;
}

.password-modal-body input:focus {
  outline: none;
  border-color: #8b2f2f;
}

.password-modal-footer,
.assign-modal-footer {
  display: flex;
  gap: 12px;
  justify-content: flex-end;
}

.btn-cancel,
.btn-confirm {
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
}

.btn-cancel {
  background: #f0f0f0;
  color: #666;
}

.btn-cancel:hover {
  background: #e0e0e0;
}

.btn-confirm {
  background: linear-gradient(135deg, #8b2f2f 0%, #6f2e2e 100%);
  color: white;
}

.btn-confirm:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(139, 47, 47, 0.3);
}

/* ë“œëž˜ê·¸ ì¤‘ ì‹œê° íš¨ê³¼ */
.dragging {
  opacity: 0.5;
  transform: scale(0.98);
}

.drag-over {
  border-color: #4A90E2 !important;
  background: rgba(74, 144, 226, 0.05);
  transform: scale(1.02);
}

/* ë°˜ì‘í˜•: íƒœë¸”ë¦¿ (ì•„ì´íŒ¨ë“œ) */
@media (max-width: 1024px) and (min-width: 901px) {
  .vocab-quiz-modal-content {
    width: 70%;
    height: 65%;
    max-width: 650px;
    max-height: 550px;
  }
}

/* ë°˜ì‘í˜•: ìž‘ì€ íƒœë¸”ë¦¿ ë° ëª¨ë°”ì¼ */
@media (max-width: 900px) {
  .vocab-quiz-modal-content {
    width: 90%;
    height: 80%;
  }
}

/* ì•„ì´íŒ¨ë“œ ì „ìš© - ë©”ì¸ ë©”ë‰´ í™”ë©´ ì¶•ì†Œ (1024px ì´í•˜) */
@media (max-width: 1024px) and (min-width: 901px) {
  body {
    transform: scale(0.75);
    transform-origin: top center;
    min-height: 100vh;
  }

  header {
    padding: 10px 18px 8px;
  }

  .brand-title {
    font-size: 20px;
  }

  .brand-sub {
    font-size: 11px;
  }

  .layout {
    grid-template-columns: 200px 190px 200px 1fr;
  }

  .col-title {
    font-size: 12px;
    padding: 10px 12px 5px;
  }

  .series-item,
  .domain-item,
  .subject-item,
  .unit-item {
    font-size: 14px;
    padding: 12px 16px;
  }
}

/* ê³ ëž˜ì„¬ ì´ì•¼ê¸° íŒì—… ëª¨ë‹¬ */
.whale-story-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(10px);
  z-index: 9999;
  align-items: center;
  justify-content: center;
  animation: fadeIn 0.3s ease;
}

.whale-story-modal.show {
  display: flex;
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

.whale-story-modal-content {
  background: transparent;
  border-radius: 30px;
  padding: 50px;
  max-width: 800px;
  width: 90%;
  box-shadow: 0 30px 80px rgba(0, 0, 0, 0.5);
  animation: scaleIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  position: relative;
  overflow: hidden;
}

/* Carousel wrapper */
.story-carousel-wrapper {
  position: relative;
  overflow: hidden;
  width: 100%;
}

.story-carousel-container {
  display: flex;
  transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

.story-slide {
  min-width: 100%;
  width: 100%;
  flex-shrink: 0;
  border-radius: 30px;
  padding: 50px;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  position: relative;
}

/* Whale story background image */
.story-slide.whale-story {
  background-image: url(https://cdn.jsdelivr.net/gh/kukicoollevitt-hash/dan-dan-app@main/public/images/whale-story/main.jpg);
}

/* Semi-transparent overlay for readability */
.story-slide::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.3);
  border-radius: 30px;
  z-index: 0;
}

.story-slide > * {
  position: relative;
  z-index: 1;
}

/* Carousel navigation arrows */
.carousel-nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(255, 255, 255, 0.9);
  border: 3px solid rgba(255, 255, 255, 1);
  width: 60px;
  height: 60px;
  border-radius: 50%;
  font-size: 36px;
  font-weight: bold;
  color: #333;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
  backdrop-filter: blur(10px);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

.carousel-nav:hover {
  background: white;
  transform: translateY(-50%) scale(1.15);
  box-shadow: 0 6px 30px rgba(0, 0, 0, 0.4);
}

.carousel-nav.prev {
  left: 10px;
}

.carousel-nav.next {
  right: 10px;
}

.carousel-nav:disabled {
  opacity: 0;
  cursor: default;
  pointer-events: none;
}

/* Jungle story background image */
.story-slide.jungle-story {
  background-image: url(https://cdn.jsdelivr.net/gh/kukicoollevitt-hash/dan-dan-app@main/public/images/jungle-story/jungle_s1_main.jpg);
}

.story-slide.library-story {
  background-image: url(https://cdn.jsdelivr.net/gh/kukicoollevitt-hash/dan-dan-app@main/public/images/library-story/library_part1_main.jpg);
}

/* Time Library story background image */
.story-slide.time-library-story {
  background-image: url(https://cdn.jsdelivr.net/gh/kukicoollevitt-hash/dan-dan-app@main/public/images/time-library-story/time_part1_main.jpg);
}

/* Cat Island story background image */
.story-slide.cat-island-story {
  background-image: url(https://cdn.jsdelivr.net/gh/kukicoollevitt-hash/dan-dan-app@main/public/images/cat-island-story/cat_part1_main.jpg);
}

/* Cat Transform story background image */
.story-slide.cat-transform-story {
  background-image: url(https://cdn.jsdelivr.net/gh/kukicoollevitt-hash/dan-dan-app@main/public/images/cat-transform-story/transform_part1-main.jpg);
}

@keyframes scaleIn {
  0% {
    transform: scale(0.5) rotate(-5deg);
    opacity: 0;
  }
  50% {
    transform: scale(1.05) rotate(2deg);
  }
  100% {
    transform: scale(1) rotate(0deg);
    opacity: 1;
  }
}

.whale-story-modal-close {
  position: absolute;
  top: 20px;
  right: 20px;
  background: rgba(255, 255, 255, 0.2);
  border: none;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  font-size: 24px;
  color: white;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.whale-story-modal-close:hover {
  background: rgba(255, 255, 255, 0.3);
  transform: rotate(90deg);
}

.whale-story-header {
  text-align: center;
  margin-bottom: 40px;
}

.whale-story-header h2 {
  font-size: 42px;
  color: white;
  margin-bottom: 10px;
  text-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
}

.whale-story-header p {
  font-size: 18px;
  color: rgba(255, 255, 255, 0.9);
  text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}

.whale-story-seasons {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
  margin-top: 30px;
}

.season-card {
  background: transparent;
  border-radius: 20px;
  padding: 30px 20px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
  border: 3px solid transparent;
  position: relative;
  overflow: hidden;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
}

/* Remove card backgrounds - using slide background instead */
.season-card {
  background: transparent !important;
  background-image: none !important;
}

.season-card::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
  transform: rotate(45deg);
  transition: all 0.6s ease;
  z-index: 1;
}

.season-card:hover::before {
  left: 100%;
}

.season-card:hover {
  transform: translateY(-10px) scale(1.05);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
  border-color: #ffd700;
}

.season-card.locked {
  opacity: 0.6;
  cursor: not-allowed;
  filter: grayscale(0.5);
}

.season-card.locked:hover {
  transform: none;
  box-shadow: none;
  border-color: transparent;
}

.season-number {
  font-size: 48px;
  margin-bottom: 15px;
  animation: float 3s ease-in-out infinite;
  position: relative;
  z-index: 2;
}

@keyframes float {
  0%, 100% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-10px);
  }
}

.season-card:nth-child(2) .season-number {
  animation-delay: 0.3s;
}

.season-card:nth-child(3) .season-number {
  animation-delay: 0.6s;
}

.season-title {
  font-size: 20px;
  font-weight: 700;
  color: #ffffff;
  margin-bottom: 8px;
  position: relative;
  z-index: 2;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
}

.season-subtitle {
  font-size: 14px;
  color: #ffffff;
  font-weight: 600;
  margin-bottom: 15px;
  position: relative;
  z-index: 2;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
}

/* Jungle story subtitle color */
.jungle-story .season-subtitle {
  color: #ffffff;
}

.season-desc {
  font-size: 13px;
  color: #ffffff;
  line-height: 1.6;
  position: relative;
  z-index: 2;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
}

.season-lock-icon {
  font-size: 32px;
  margin-top: 10px;
  opacity: 0.5;
}

@media (max-width: 768px) {
  .whale-story-seasons {
    grid-template-columns: 1fr;
    gap: 15px;
  }

  .whale-story-modal-content {
    padding: 30px 20px;
  }

  .whale-story-header h2 {
    font-size: 32px;
  }

  .carousel-nav {
    width: 50px;
    height: 50px;
    font-size: 30px;
  }

  .carousel-nav.prev {
    left: 5px;
  }

  .carousel-nav.next {
    right: 5px;
  }
}

/* ìŠ¤í† ë¦¬ ì½˜í…ì¸  íŒì—… ëª¨ë‹¬ */
.story-content-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.95);
  z-index: 10000;
  align-items: center;
  justify-content: center;
  animation: fadeIn 0.3s ease;
}

.story-content-modal.show {
  display: flex;
}

.story-content-modal-inner {
  width: 95%;
  height: 95%;
  background: white;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 30px 80px rgba(0, 0, 0, 0.8);
  animation: zoomIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  position: relative;
}

@keyframes zoomIn {
  0% {
    transform: scale(0.3);
    opacity: 0;
  }
  50% {
    transform: scale(1.03);
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

.story-content-close {
  position: fixed;
  top: 2.5%;
  right: 2.5%;
  background: rgba(255, 0, 0, 0.9);
  border: 3px solid white;
  width: 60px;
  height: 60px;
  border-radius: 50%;
  font-size: 32px;
  font-weight: bold;
  color: white;
  cursor: pointer;
  transition: all 0.3s ease;
  z-index: 10001;
  display: flex;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(10px);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
  pointer-events: auto;
}

.story-content-close:hover {
  background: rgba(255, 50, 50, 1);
  transform: rotate(90deg) scale(1.2);
  box-shadow: 0 6px 30px rgba(255, 0, 0, 0.6);
}

.story-content-iframe {
  width: 100%;
  height: 100%;
  border: none;
  border-radius: 20px;
}

/* ========== ë…ì„œ ê°ìƒë¬¸ íŒì—… ìŠ¤íƒ€ì¼ ========== */
.reading-report-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 10004;
}

.reading-report-modal.show {
  display: flex;
}

.reading-report-container {
  position: relative;
  width: 1000px;
  max-width: 90%;
  height: 700px;
  max-height: 90%;
  background: #fff;
  border-radius: 20px;
  display: flex;
  overflow: hidden;
  box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
}

.reading-report-close {
  position: absolute;
  top: 15px;
  right: 15px;
  width: 40px;
  height: 40px;
  background: rgba(255, 50, 50, 0.8);
  color: white;
  border: none;
  border-radius: 50%;
  font-size: 24px;
  cursor: pointer;
  z-index: 10;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.reading-report-close:hover {
  background: rgba(255, 50, 50, 1);
  transform: rotate(90deg) scale(1.2);
}

/* ì™¼ìª½ ížˆìŠ¤í† ë¦¬ ì‚¬ì´ë“œë°” */
.reading-history-sidebar {
  width: 33.33%;
  background: #f8f9fa;
  border-right: 2px solid #e9ecef;
  overflow-y: auto;
  padding: 20px;
}

.history-header {
  font-size: 18px;
  font-weight: 700;
  color: #2c3e50;
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.history-list {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.history-item {
  background: white;
  border: 2px solid #e9ecef;
  border-radius: 12px;
  padding: 15px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.history-item:hover {
  border-color: #667eea;
  box-shadow: 0 2px 10px rgba(102, 126, 234, 0.2);
}

.history-item-title {
  font-size: 14px;
  font-weight: 600;
  color: #2c3e50;
  margin-bottom: 6px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.history-item-date {
  font-size: 12px;
  color: #6b7280;
}

.history-item-month {
  font-size: 11px;
  color: #9ca3af;
  margin-top: 4px;
}

.history-item-story {
  font-size: 11px;
  color: #667eea;
  font-weight: 600;
  margin-top: 6px;
  padding: 4px 8px;
  background: rgba(102, 126, 234, 0.1);
  border-radius: 6px;
  display: inline-block;
}

.history-load-more {
  width: 100%;
  padding: 12px;
  background: #667eea;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  margin-top: 12px;
  transition: all 0.3s ease;
}

.history-load-more:hover {
  background: #5568d3;
}

/* ì˜¤ë¥¸ìª½ ë©”ì¸ ìž‘ì„± ì˜ì—­ */
.reading-report-main {
  flex: 1;
  padding: 40px;
  overflow-y: auto;
  position: relative;
  background-image: url('https://cdn.jsdelivr.net/gh/kukicoollevitt-hash/dan-dan-app@main/public/images/rudolph.png');
  background-position: center center;
  background-repeat: no-repeat;
  background-size: 400px;
  background-attachment: local;
}

.reading-report-main::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(255, 255, 255, 0.92);
  pointer-events: none;
  z-index: 0;
}

.reading-report-main > * {
  position: relative;
  z-index: 1;
}

.report-form-header {
  text-align: center;
  margin-bottom: 30px;
}

.report-form-header h2 {
  font-size: 28px;
  font-weight: 700;
  color: #2c3e50;
  margin-bottom: 10px;
}

.report-form-header p {
  font-size: 14px;
  color: #6b7280;
}

.report-form {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.form-row {
  display: flex;
  gap: 15px;
}

.form-group {
  flex: 1;
}

.form-group label {
  display: block;
  font-size: 14px;
  font-weight: 600;
  color: #2c3e50;
  margin-bottom: 8px;
}

.form-group input,
.form-group textarea,
.form-group select {
  width: 100%;
  padding: 12px 15px;
  border: 2px solid #e9ecef;
  border-radius: 10px;
  font-size: 14px;
  font-family: inherit;
  transition: all 0.3s ease;
}

.form-group select {
  cursor: pointer;
  background-color: white;
  background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
  background-repeat: no-repeat;
  background-position: right 12px center;
  background-size: 20px;
  padding-right: 40px;
  appearance: none;
}

.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.form-group input:disabled {
  background: #f8f9fa;
  color: #6b7280;
  cursor: not-allowed;
}

.form-group textarea {
  min-height: 250px;
  resize: vertical;
  line-height: 1.6;
}

.form-actions {
  display: flex;
  gap: 12px;
  justify-content: center;
  margin-top: 10px;
}

.btn-submit {
  padding: 14px 30px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.btn-submit:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
}

.btn-submit:active {
  transform: translateY(0);
}

.btn-kakao {
  padding: 14px 30px;
  background: linear-gradient(135deg, #FEE500 0%, #FFCD00 100%);
  color: #3C1E1E;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(255, 205, 0, 0.3);
}

.btn-kakao:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(255, 205, 0, 0.5);
  background: linear-gradient(135deg, #FFED4E 0%, #FFD700 100%);
}

.btn-kakao:active {
  transform: translateY(0);
}

.btn-new {
  padding: 14px 30px;
  background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
}

.btn-new:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(16, 185, 129, 0.5);
  background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
}

.btn-new:active {
  transform: translateY(0);
}

.auto-save-indicator {
  text-align: center;
  font-size: 12px;
  color: #10b981;
  margin-top: 10px;
}

/* ë§žì¶¤ë²• ê²€ì‚¬ ê²°ê³¼ ëª¨ë‹¬ */
.spell-check-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  z-index: 10005;
  align-items: center;
  justify-content: center;
}

.spell-check-modal.show {
  display: flex;
}

.spell-check-modal-content {
  background: white;
  border-radius: 20px;
  width: 90%;
  max-width: 700px;
  max-height: 80vh;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  box-shadow: 0 10px 50px rgba(0, 0, 0, 0.3);
}

.spell-check-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 30px;
  border-bottom: 2px solid #e9ecef;
}

.spell-check-header h3 {
  margin: 0;
  font-size: 24px;
  color: #2c3e50;
}

.spell-check-close {
  background: none;
  border: none;
  font-size: 32px;
  color: #6b7280;
  cursor: pointer;
  transition: color 0.3s;
}

.spell-check-close:hover {
  color: #ef4444;
}

.spell-check-body {
  padding: 30px;
  overflow-y: auto;
  flex: 1;
}

.error-section {
  background: #fef2f2;
  border: 2px solid #fecaca;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 20px;
}

.error-section h4 {
  color: #dc2626;
  margin: 0 0 15px 0;
  font-size: 18px;
}

.error-item {
  margin-bottom: 12px;
  font-size: 15px;
  line-height: 1.6;
}

.error-item .wrong-text {
  color: #dc2626;
  text-decoration: underline wavy #dc2626;
  font-weight: 600;
}

.correct-section {
  background: #f0fdf4;
  border: 2px solid #bbf7d0;
  border-radius: 12px;
  padding: 20px;
}

.correct-section h4 {
  color: #16a34a;
  margin: 0 0 15px 0;
  font-size: 18px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.correct-text {
  font-size: 15px;
  line-height: 1.8;
  color: #2c3e50;
  white-space: pre-wrap;
}

.correct-text .highlight-correct {
  background: #bbf7d0;
  padding: 2px 6px;
  border-radius: 4px;
  font-weight: 600;
  color: #16a34a;
}

.spell-check-footer {
  display: flex;
  gap: 15px;
  padding: 20px 30px;
  border-top: 2px solid #e9ecef;
  justify-content: center;
}

.btn-recheck {
  padding: 14px 30px;
  background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
}

.btn-recheck:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(16, 185, 129, 0.5);
}

.btn-submit-final {
  padding: 14px 30px;
  background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
}

.btn-submit-final:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(239, 68, 68, 0.5);
}

.no-error-message {
  text-align: center;
  padding: 40px 20px;
  color: #16a34a;
  font-size: 18px;
}

/* ë§žì¶¤ë²• ê²€ì‚¬ ë¡œë”© */
.spell-check-loading {
  margin-top: 20px;
  text-align: center;
  padding: 20px;
  animation: fadeIn 0.3s ease;
}

.loading-spinner {
  width: 40px;
  height: 40px;
  margin: 0 auto 10px;
  border: 4px solid #f3f4f6;
  border-top: 4px solid #3b82f6;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.spell-check-loading p {
  color: #6b7280;
  font-size: 14px;
  margin: 0;
}

/* ë§žì¶¤ë²• ê²€ì‚¬ ì¸ë¼ì¸ í‘œì‹œ (ë°•ìŠ¤ ì—†ì´) */
.spell-check-inline {
  margin-top: 20px;
  animation: slideDown 0.3s ease;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* í­ì£½ íš¨ê³¼ê°€ ëª¨ë“  ìš”ì†Œ ìœ„ì— í‘œì‹œë˜ë„ë¡ z-index ì„¤ì • */
canvas[id^="confetti-canvas"] {
  z-index: 99999 !important;
  pointer-events: none;
}

    /* ðŸŽ† í­ì£½ ì• ë‹ˆë©”ì´ì…˜ */
    .fireworks-container {
      position: fixed;
      top: 20px;
      left: 20px;
      width: 80px;
      height: 80px;
      pointer-events: none;
      z-index: 9999;
    }

    .firework {
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      animation: firework-animation 2s ease-out infinite;
    }

    .firework:nth-child(1) {
      background: linear-gradient(45deg, #ff6b6b, #feca57);
      animation-delay: 0s;
      left: 40%;
      top: 40%;
    }

    .firework:nth-child(2) {
      background: linear-gradient(45deg, #5f27cd, #00d2d3);
      animation-delay: 0.5s;
      left: 60%;
      top: 30%;
    }

    .firework:nth-child(3) {
      background: linear-gradient(45deg, #ff9ff3, #feca57);
      animation-delay: 1s;
      left: 30%;
      top: 50%;
    }

    .firework:nth-child(4) {
      background: linear-gradient(45deg, #48dbfb, #0abde3);
      animation-delay: 1.5s;
      left: 50%;
      top: 35%;
    }

    @keyframes firework-animation {
      0% {
        transform: translate(0, 0) scale(1);
        opacity: 1;
      }
      25% {
        transform: translate(var(--tx), var(--ty)) scale(1.5);
        opacity: 0.8;
      }
      50% {
        transform: translate(calc(var(--tx) * 1.5), calc(var(--ty) * 1.5)) scale(2);
        opacity: 0.6;
        box-shadow: 0 0 20px currentColor;
      }
      75% {
        transform: translate(calc(var(--tx) * 2), calc(var(--ty) * 2)) scale(1.2);
        opacity: 0.3;
      }
      100% {
        transform: translate(calc(var(--tx) * 2.5), calc(var(--ty) * 2.5)) scale(0);
        opacity: 0;
      }
    }

    /* ê° í­ì£½ë§ˆë‹¤ ë‹¤ë¥¸ ë°©í–¥ìœ¼ë¡œ í„°ì§€ë„ë¡ */
    .firework:nth-child(1) { --tx: -15px; --ty: -20px; }
    .firework:nth-child(2) { --tx: 18px; --ty: -15px; }
    .firework:nth-child(3) { --tx: -20px; --ty: 10px; }
    .firework:nth-child(4) { --tx: 15px; --ty: 12px; }

    /* ë°˜ì§ì´ëŠ” ë³„ íš¨ê³¼ ì¶”ê°€ */
    .sparkle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: #ffd700;
      border-radius: 50%;
      animation: sparkle-animation 1.5s ease-in-out infinite;
    }

    .sparkle:nth-child(5) {
      left: 20%;
      top: 20%;
      animation-delay: 0.2s;
    }

    .sparkle:nth-child(6) {
      left: 70%;
      top: 60%;
      animation-delay: 0.8s;
    }

    @keyframes sparkle-animation {
      0%, 100% {
        transform: scale(0);
        opacity: 0;
      }
      50% {
        transform: scale(1.5);
        opacity: 1;
        box-shadow: 0 0 10px #ffd700;
      }
    }

  </style>

  <!-- html2canvas and jsPDF for PDF generation with Korean support -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- JS Confetti for celebration effects -->
  <script src="https://cdn.jsdelivr.net/npm/js-confetti@latest/dist/js-confetti.browser.js"></script>
</head>
<body>
  <!-- ðŸ“± ì•„ì´íŒ¨ë“œìš© ê³ ì • ë°°ê²½ ë ˆì´ì–´ -->
  <div id="tablet-fixed-bg"></div>

  <!-- ðŸ”„ ë¡œë”© ì˜¤ë²„ë ˆì´ -->
  <div id="loading-overlay">
    <div class="spinner-container">
      <div class="spinner"></div>
      <div class="loading-text">AI í•™ìŠµ ì¸ì‹ ì¤‘...</div>
    </div>
  </div>

  <!-- ðŸ”¥ MP4 ë©”ë‰´ ë°°ê²½ ì˜ìƒ -->
  <video class="menu-bg-video" autoplay muted loop playsinline>
    <source src="https://cdn.jsdelivr.net/gh/kukicoollevitt-hash/dan-dan-app@main/public/images/brain-menu-bg-a.mp4" type="video/mp4" />
  </video>

  <!-- ðŸŽ† í­ì£½ ì• ë‹ˆë©”ì´ì…˜ -->
  <div class="fireworks-container">
    <div class="firework"></div>
    <div class="firework"></div>
    <div class="firework"></div>
    <div class="firework"></div>
    <div class="sparkle"></div>
    <div class="sparkle"></div>
  </div>

  <header id="menuHeader">
    <div>
      <div class="brand-title">ë‹¨ë‹¨êµ­ì–´ BRAIN ë¬¸í•´ë ¥ ì‹œë¦¬ì¦ˆ</div>

      <div class="brand-sub-wrap">
        <div class="brand-sub">
          BRAINì˜¨ â†’ BRAINì—… â†’ BRAINí• â†’ BRAINë”¥ â†’ BRAINì¤‘ë“± â†’ BRAINê³ ë“± â†’ ë¶„ì•¼ â†’ ì„¸ë¶€ ê³¼ëª© â†’ ë‹¨ì›
        </div>

        <img src="https://cdn.jsdelivr.net/gh/kukicoollevitt-hash/dan-dan-app@main/public/images/rudolph.png" class="brand-rudolph" alt="ë£¨ëŒí”„" onclick="goToWhaleStory()" style="cursor: pointer;" title="í‘¸ë¥¸ ê³ ëž˜ì„¬ ì´ì•¼ê¸° ì‹œìž‘í•˜ê¸°">
      </div>
    </div>

    <!-- ðŸ”¹ ì˜¤ë¥¸ìª½: ì‚¬ìš©ìž ì •ë³´ + ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
    <div class="header-right">
      <div id="user-info">ì„±ì¸ ì•ˆìœ ë¹ˆë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!</div>
      <button id="logoutBtn" class="logout-btn" type="button">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </header>

  <div class="layout">
    <!-- â‘  ì‹œë¦¬ì¦ˆ -->
    <div class="col" id="colSeries">
      <div class="col-title">â‘  ì‹œë¦¬ì¦ˆ ì„ íƒ</div>
      <ul class="series-list" id="seriesList">
        <li class="series-item active" data-series="BRAINON"><span>ðŸ’¡ BRAINì˜¨</span><span class="meta">ê°œë…ì´í•´</span></li>
        <li class="series-item" data-series="BRAINUP"><span>ðŸš€ BRAINì—…</span><span class="meta">ì‘ìš©ì ìš©</span></li>
        <li class="series-item" data-series="BRAINFIT"><span>ðŸ”— BRAINí•</span><span class="meta">ë…¼ë¦¬ì—°ê²°</span></li>
        <li class="series-item" data-series="BRAINDEEP"><span>ðŸ”Ž BRAINë”¥</span><span class="meta">ì‹¬í™”ì¶”ë¡ </span></li>
        <li class="series-item" data-series="BRAINM"><span>ðŸ“˜ BRAINì¤‘ë“±</span><span class="meta">ì¤‘ë“±êµê³¼</span></li>
        <li class="series-item" data-series="BRAINH"><span>ðŸ“• BRAINê³ ë“±</span><span class="meta">ê³ ë“±êµê³¼</span></li>
      </ul>
    </div>

    <!-- â‘¡ ë¶„ì•¼ -->
    <div class="col" id="colDomain">
      <div class="col-title">â‘¡ ë¶„ì•¼ ì„ íƒ</div>
      <ul class="domain-list" id="domainList"></ul>
    </div>

    <!-- â‘¢ ì„¸ë¶€ ê³¼ëª© -->
    <div class="col" id="colSubject">
      <div class="col-title">â‘¢ ì„¸ë¶€ ê³¼ëª©</div>
      <ul class="subject-list" id="subjectList"></ul>
    </div>

    <!-- â‘£ ë‹¨ì› + ê²€ìƒ‰ -->
    <div class="detail-panel" id="detailPanel">
      <div style="display:flex; justify-content:space-between; gap:12px; align-items:center;">
        <div>
          <div class="detail-title" id="unitTitle">ë‹¨ì› ì„ íƒ</div>
          <div class="detail-desc" id="unitDesc">[ë³¸ë¬¸í•™ìŠµ] â†’ [ì–´íœ˜í•™ìŠµ] â†’ [ì°½ì˜í™œë™]ì„ ì™„ë£Œ í›„ ì œì¶œí•´ì£¼ì„¸ìš”!</div>
        </div>
        <input
          type="text"
          id="unitSearch"
          placeholder="ë‹¨ì› ê²€ìƒ‰"
          style="padding:5px 8px; border:1px solid #e2d5c3; border-radius:6px; font-size:12px; min-width:140px; background:#ffffff;">
      </div>
      <ul class="unit-list" id="unitList"></ul>
    </div>
  </div>

  <!-- ì¤€ë¹„ì¤‘ ëª¨ë‹¬ -->
  <div class="overlay" id="pendingModal">
    <div class="modal-box">
      <div class="modal-emoji">ðŸ“šâœ¨</div>
      <div class="modal-title">ì•„ì§ ì¤€ë¹„ ì¤‘ìž…ë‹ˆë‹¤.</div>
      <div class="modal-msg">ê³§ ì§€ë¬¸ì´ ì˜¤í”ˆë©ë‹ˆë‹¤. ê¸°ëŒ€í•´ì£¼ì„¸ìš”!</div>
      <button class="modal-btn" id="closeModalBtn">í™•ì¸</button>
    </div>
  </div>

  <!-- âš ï¸ ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ì™€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆëŠ” ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ ë¸”ë¡ì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤ (ë¼ì¸ 3250+ ì°¸ê³ ) -->

  <!-- ðŸ”¥ ì„¸ì…˜ ì •ë³´ë¥¼ sessionStorageì— ì €ìž¥ -->
  <script>
    (async function() {
      try {
        const response = await fetch('/api/session');
        const data = await response.json();

        if (data.ok && data.user) {
          // ì„œë²„ ì„¸ì…˜ ì •ë³´ë¥¼ sessionStorageì— ì €ìž¥
          sessionStorage.setItem('user', JSON.stringify(data.user));
          console.log('âœ… Session data saved to sessionStorage:', data.user);

          // âœ… í˜„ìž¬ í•™ìƒì´ ì•„ë‹Œ localStorage ë°ì´í„° ì‚­ì œ (ì´ì „ í•™ìƒ ì–´íœ˜í€´ì¦ˆ ë±ƒì§€ ë“±)
          const currentStudent = JSON.parse(localStorage.getItem('currentStudent') || '{}');
          const currentGrade = currentStudent.grade || data.user.grade;
          const currentName = currentStudent.name || data.user.name;

          // localStorageì˜ ëª¨ë“  í‚¤ë¥¼ í™•ì¸í•˜ì—¬ ë‹¤ë¥¸ í•™ìƒ ë°ì´í„° ì‚­ì œ
          const keysToRemove = [];
          for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);

            // vocabAvgScore_, studyRoomBadge_ ë“± í•™ìƒë³„ ë°ì´í„° í‚¤ íŒ¨í„´
            if (key && (key.startsWith('vocabAvgScore_') || key.startsWith('studyRoomBadge_') || key.startsWith('í•™ìƒ_'))) {
              // í˜„ìž¬ í•™ìƒì˜ í‚¤ê°€ ì•„ë‹ˆë©´ ì‚­ì œ ëŒ€ìƒ
              if (!key.includes(`${currentGrade}_${currentName}`)) {
                keysToRemove.push(key);
              }
            }
          }

          // ì‚­ì œ ì‹¤í–‰
          keysToRemove.forEach(key => {
            console.log('ðŸ—‘ï¸ ì´ì „ í•™ìƒ ë°ì´í„° ì‚­ì œ:', key);
            localStorage.removeItem(key);
          });

        } else {
          console.log('âŒ No session data available');
        }
      } catch (error) {
        console.error('âŒ Error fetching session:', error);
      }
    })();
  </script>

  <!-- ë¡œê·¸ì•„ì›ƒ í™•ì¸ ëª¨ë‹¬ -->
  <div class="overlay" id="logoutConfirm">
    <div class="modal-box">
      <div class="modal-emoji">ðŸšª</div>
      <div class="modal-title">ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ì–´ìš”?</div>
      <div class="modal-msg">
        ë¡œê·¸ì•„ì›ƒí•˜ë©´ ì´ í•™ìŠµ ë©”ë‰´ë¥¼ ë‹¤ì‹œ ë³´ë ¤ë©´<br>
        ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì•¼ í•´ìš”.
      </div>
      <div style="display:flex; gap:8px; justify-content:center;">
        <button type="button" class="modal-btn" id="logoutCancelBtn">ì·¨ì†Œ</button>
        <button type="button" class="modal-btn modal-btn-danger" id="logoutOkBtn">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
    </div>
  </div>

    <!-- ðŸšª ë¡œê·¸ì•„ì›ƒ í™•ì¸ ëª¨ë‹¬ -->
  <div class="overlay" id="logoutModal">
    <div class="modal-box">
      <div style="font-size:32px; margin-bottom:8px;">ðŸšª</div>
      <div class="modal-title">ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ì–´ìš”?</div>
      <div class="modal-msg">
        ë¡œê·¸ì•„ì›ƒí•˜ë©´ ì´ í•™ìŠµ ë©”ë‰´ë¥¼ ë‹¤ì‹œ ë³´ë ¤ë©´<br>
        ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì•¼ í•´ìš”.
      </div>
      <div style="display:flex; justify-content:center; gap:10px; margin-top:8px;">
        <button
          type="button"
          class="modal-btn"
          id="logoutCancelBtn"
          style="background:#b9a090;"
        >
          ì·¨ì†Œ
        </button>
        <button
          type="button"
          class="modal-btn"
          id="logoutConfirmBtn"
        >
          ë¡œê·¸ì•„ì›ƒ
        </button>
      </div>
    </div>
  </div>



  <!-- ðŸ¤– AI í•™ìŠµ ì¸ì‹ ì˜¤ë²„ë ˆì´ -->
  <div class="ai-loading-overlay" id="aiLoadingOverlay">
    <div class="ai-loading-box">
      <div class="ai-loading-spinner"></div>
      <div class="ai-loading-title">AI í•™ìŠµ ì¸ì‹ ì¤‘...</div>
      <div class="ai-loading-msg">í•™ìŠµ í™˜ê²½ì„ ì¤€ë¹„í•˜ê³  ìžˆì–´ìš”</div>
    </div>
  </div>

  <!-- ðŸ”‹ ë¡œë”© ì˜¤ë²„ë ˆì´ -->
  <div class="overlay-loading" id="loadingOverlay">
    <div class="loading-box">
      <div class="loading-emoji">ðŸ‹</div>
      <div class="loading-title">ë¡œë”© ì¤‘...</div>
      <div class="loading-msg">í•™ìŠµ ìžë£Œë¥¼ ì¤€ë¹„í•˜ê³  ìžˆì–´ìš”.</div>
      <div class="loading-progress">
        <div class="loading-bar" id="loadingBar"></div>
      </div>
      <div class="loading-percent" id="loadingPercent">0%</div>
    </div>
  </div>

  <!-- ì¹´ì¹´ì˜¤ SDK -->
  <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.2/kakao.min.js"></script>
  <script>
    // ì¹´ì¹´ì˜¤ SDK ì´ˆê¸°í™” (SDK ë¡œë“œ ì§í›„ ë°”ë¡œ ì‹¤í–‰)
    if (!Kakao.isInitialized()) {
      Kakao.init('6ad10cc6680c7a5829a4fd7a3cbb4a7e');
      console.log('âœ… Kakao SDK ì´ˆê¸°í™” ì™„ë£Œ:', Kakao.isInitialized());
    }
  </script>

  <script>

    /* 0. ì‹œë¦¬ì¦ˆ ì •ë³´ */
    const seriesInfo = {
      BRAINON: { name: "BRAINì˜¨", desc: "ê°œë… ì´í•´" },
      BRAINUP: { name: "BRAINì—…", desc: "ì‘ìš© ì ìš©" },
      BRAINFIT: { name: "BRAINí•", desc: "ë…¼ë¦¬ ì—°ê²°" },
      BRAINDEEP: { name: "BRAINë”¥", desc: "ì‹¬í™” ì¶”ë¡ " },
      BRAINM: { name: "BRAINì¤‘ë“±", desc: "ì¤‘ë“± êµê³¼" },
      BRAINH: { name: "BRAINê³ ë“±", desc: "ê³ ë“± êµê³¼" }
    };

    /* 1. ì‹œë¦¬ì¦ˆë³„ ë¶„ì•¼/ê³¼ëª© */
    const domainsBySeries = {
      BRAINON: [
        {
          id: "science",
          label: "ê³¼í•™ë¶„ì•¼",
          subs: [
            { id: "bio", label: "ìƒë¬¼", count: 20 },
            { id: "earth", label: "ì§€êµ¬ê³¼í•™", count: 20 },
            { id: "physics", label: "ë¬¼ë¦¬", count: 20 },
            { id: "chem", label: "í™”í•™", count: 20 }
          ]
        },
        {
          id: "social",
          label: "ì‚¬íšŒë¶„ì•¼",
          subs: [
            { id: "society", label: "ì‚¬íšŒë¬¸í™”", count: 20 },
            { id: "geo", label: "ì§€ë¦¬", count: 20 },
            { id: "law", label: "ë²•", count: 20 },
            { id: "pol", label: "ì •ì¹˜ê²½ì œ", count: 20 }
          ]
        },
        {
          id: "korlit",
          label: "í•œêµ­ë¬¸í•™ë¶„ì•¼",
          subs: [
            { id: "modern", label: "í˜„ëŒ€ë¬¸í•™", count: 40 },
            { id: "classic", label: "ê³ ì „ë¬¸í•™", count: 40 }
          ]
        },
        {
          id: "worldlit",
          label: "ì„¸ê³„ë¬¸í•™ë¶„ì•¼",
          subs: [
            { id: "world", label: "ì„¸ê³„ë¬¸í•™(1)", count: 40 },
            { id: "world", label: "ì„¸ê³„ë¬¸í•™(2)", count: 40, offset: 40 }
          ]
        },
        {
          id: "person",
          label: "ì¸ë¬¼ë¶„ì•¼",
          subs: [
            { id: "people", label: "ì¸ë¬¼(1)", count: 40 },
            { id: "people", label: "ì¸ë¬¼(2)", count: 40, offset: 40 }
          ]
        }
      ],
      // ë‚˜ë¨¸ì§€ëŠ” ì„¸ì¢… êµ¬ì¡° ìž¬ì‚¬ìš©
      BRAINUP: null,
      BRAINFIT: null,
      BRAINDEEP: null,
      // ì„±ê· ê´€
      BRAINM: [
        {
          id: "nonfiction",
          label: "ë¹„ë¬¸í•™ë¶„ì•¼",
          subs: [
            { id: "naesin", label: "ë‚´ì‹ êµê³¼", count: 20 },
            { id: "suneung", label: "ìˆ˜ëŠ¥ëª¨ê³ ", count: 20 }
          ]
        },
        {
          id: "modernlit",
          label: "í˜„ëŒ€ë¬¸í•™ë¶„ì•¼",
          subs: [
            { id: "poem", label: "í˜„ëŒ€ì‹œ", count: 20 },
            { id: "novel", label: "í˜„ëŒ€ì†Œì„¤", count: 20 },
            { id: "etc", label: "ê·¹Â·ìˆ˜í•„Â·í¬ê³¡", count: 20 }
          ]
        },
        {
          id: "classiclit",
          label: "ê³ ì „ë¬¸í•™ë¶„ì•¼",
          subs: [
            { id: "gosi", label: "ê³ ì „ì‹œê°€", count: 20 },
            { id: "gonovel", label: "ê³ ì „ì†Œì„¤", count: 20 },
            { id: "goessay", label: "ê³ ì „ìˆ˜í•„", count: 20 }
          ]
        },
        {
          id: "grammar",
          label: "ë¬¸ë²•ë¶„ì•¼",
          subs: [
            { id: "modern", label: "í˜„ëŒ€", count: 12 },
            { id: "middle", label: "ì¤‘ì„¸", count: 12 }
          ]
        }
      ],
      // êµ­ìžê°
      BRAINH: [
        {
          id: "nonfiction",
          label: "ë¹„ë¬¸í•™ë¶„ì•¼",
          subs: [
            { id: "naesin", label: "ë‚´ì‹ êµê³¼", count: 24 },
            { id: "suneung", label: "ìˆ˜ëŠ¥ëª¨ê³ ", count: 24 }
          ]
        },
        {
          id: "modernlit",
          label: "í˜„ëŒ€ë¬¸í•™ë¶„ì•¼",
          subs: [
            { id: "poem", label: "í˜„ëŒ€ì‹œ", count: 20 },
            { id: "novel", label: "í˜„ëŒ€ì†Œì„¤", count: 20 },
            { id: "etc", label: "ê·¹Â·ìˆ˜í•„Â·í¬ê³¡", count: 15 }
          ]
        },
        {
          id: "classiclit",
          label: "ê³ ì „ë¬¸í•™ë¶„ì•¼",
          subs: [
            { id: "gosi", label: "ê³ ì „ì‹œê°€", count: 20 },
            { id: "gonovel", label: "ê³ ì „ì†Œì„¤", count: 20 },
            { id: "goessay", label: "ê³ ì „ìˆ˜í•„", count: 15 }
          ]
        },
        {
          id: "grammar",
          label: "ë¬¸ë²•ë¶„ì•¼",
          subs: [
            { id: "modern", label: "í˜„ëŒ€", count: 12 },
            { id: "middle", label: "ì¤‘ì„¸", count: 12 }
          ]
        }
      ]
    };

    /* 1.5 ê³¼ëª©ë³„ ë°°ê²½ ì´ë¯¸ì§€ ë§¤í•‘ (PCìš©) */
    const subjectBackgrounds = {
      'bio': './images/ìƒë¬¼ë°°ê²½.jpg',
      'earth': './images/ì§€êµ¬ê³¼í•™ë°°ê²½.jpg',
      'physics': './images/ë¬¼ë¦¬ë°°ê²½.jpg',
      'chem': './images/ê³¼í•™ì‹¤ ë°°ê²½.jpg',
      'society': './images/ì‚¬íšŒë¬¸í™”ë°°ê²½.jpg',
      'geo': './images/ì§€ë¦¬ë°°ê²½.jpg',
      'law': './images/ë²•ë°°ê²½.jpg',
      'pol': './images/ì •ì¹˜ê²½ì œë°°ê²½.jpg',
      'modern': './images/í˜„ëŒ€ë¬¸í•™ë°°ê²½.jpg',
      'classic': './images/ê³ ì „ë¬¸í•™ë°°ê²½.jpg',
      'world': './images/ì„¸ê³„ë¬¸í•™1ë°°ê²½.jpg',
      'people': './images/ì¸ë¬¼1ë°°ê²½.jpg'
    };

    /* ê³¼ëª©ë³„ ë°°ê²½ ì´ë¯¸ì§€ ë§¤í•‘ (íƒœë¸”ë¦¿ìš©) */
    const subjectBackgroundsTablet = {
      'bio': './images/ìƒë¬¼ë°°ê²½_tablet.jpg',
      'earth': './images/ì§€êµ¬ê³¼í•™ë°°ê²½_tablet.jpg',
      'physics': './images/ë¬¼ë¦¬ë°°ê²½_tablet.jpg',
      'chem': './images/ê³¼í•™ì‹¤ ë°°ê²½_tablet.jpg',
      'society': './images/ì‚¬íšŒë¬¸í™”ë°°ê²½_tablet.jpg',
      'geo': './images/ì§€ë¦¬ë°°ê²½_tablet.jpg',
      'law': './images/ë²•ë°°ê²½_tablet.jpg',
      'pol': './images/ì •ì¹˜ê²½ì œë°°ê²½_tablet.jpg',
      'modern': './images/í˜„ëŒ€ë¬¸í•™ë°°ê²½_tablet.jpg',
      'classic': './images/ê³ ì „ë¬¸í•™ë°°ê²½_tablet.jpg',
      'world': './images/ì„¸ê³„ë¬¸í•™1ë°°ê²½_tablet.jpg',
      'people': './images/ì¸ë¬¼1ë°°ê²½_tablet.jpg'
    };

    /* ë°°ê²½ ì´ë¯¸ì§€ ë³€ê²½ í•¨ìˆ˜ */
    function changeBackgroundImage(subjectObj) {
      console.log('ðŸŽ¨ ë°°ê²½ ë³€ê²½ ìš”ì²­:', subjectObj);

      // íƒœë¸”ë¦¿(ì•„ì´íŒ¨ë“œ) ê°ì§€
      const isTablet = window.innerWidth >= 769 && window.innerWidth <= 1400;

      // AI ë¡œë”© ì˜¤ë²„ë ˆì´ í‘œì‹œ
      const aiOverlay = document.getElementById('aiLoadingOverlay');
      if (aiOverlay) {
        aiOverlay.classList.add('show');
      }

      // offsetì´ ìžˆìœ¼ë©´ (2)ë²ˆ ì´ë¯¸ì§€ ì‚¬ìš©
      let subjectId = subjectObj.id;
      if (subjectObj.offset && subjectObj.offset > 0) {
        // world + offset â†’ world2, people + offset â†’ people2
        if (subjectId === 'world') {
          subjectId = 'world2';
        } else if (subjectId === 'people') {
          subjectId = 'people2';
        }
      }

      // PCì™€ íƒœë¸”ë¦¿ì— ë”°ë¼ ë‹¤ë¥¸ ì´ë¯¸ì§€ ì‚¬ìš©
      let imageUrl;
      if (isTablet) {
        imageUrl = subjectBackgroundsTablet[subjectId];
        // world2, people2 íƒœë¸”ë¦¿ ë§¤í•‘
        if (!imageUrl) {
          if (subjectId === 'world2') {
            imageUrl = './images/ì„¸ê³„ë¬¸í•™2ë°°ê²½_tablet.jpg';
          } else if (subjectId === 'people2') {
            imageUrl = './images/ì¸ë¬¼2ë°°ê²½_tablet.jpg';
          }
        }
      } else {
        imageUrl = subjectBackgrounds[subjectId];
        // world2, people2 PC ë§¤í•‘
        if (!imageUrl) {
          if (subjectId === 'world2') {
            imageUrl = './images/ì„¸ê³„ë¬¸í•™2ë°°ê²½.jpg';
          } else if (subjectId === 'people2') {
            imageUrl = './images/ì¸ë¬¼2ë°°ê²½.jpg';
          }
        }
      }

      console.log('ðŸ–¼ï¸ ì´ë¯¸ì§€ URL:', imageUrl);
      if (imageUrl) {
        // ì´ë¯¸ì§€ í”„ë¦¬ë¡œë“œ
        const img = new Image();
        img.onload = function() {
          // íƒœë¸”ë¦¿ì—ì„œëŠ” ê³ ì • ë°°ê²½ divì— ì´ë¯¸ì§€ ì„¤ì •
          if (isTablet) {
            const tabletBg = document.getElementById('tablet-fixed-bg');
            if (tabletBg) {
              tabletBg.style.backgroundImage = `url('${imageUrl}')`;
            }
            // body ë°°ê²½ì€ íˆ¬ëª…í•˜ê²Œ (CSSì—ì„œ ì²˜ë¦¬)
          } else {
            // PCì—ì„œëŠ” bodyì— ë°°ê²½ ì„¤ì •
            document.body.style.backgroundImage = `url('${imageUrl}')`;
            document.body.style.backgroundSize = '';
            document.body.style.backgroundPosition = '';
            document.body.style.backgroundAttachment = '';
          }

          // ë°°ê²½ ë™ì˜ìƒ ìˆ¨ê¸°ê¸°
          const bgVideo = document.querySelector('.menu-bg-video');
          if (bgVideo) {
            bgVideo.style.display = 'none';
          }
          console.log('âœ… ë°°ê²½ ë³€ê²½ ì™„ë£Œ:', document.body.style.backgroundImage);

          // ì•½ê°„ì˜ ë”œë ˆì´ í›„ ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê¸° (ìžì—°ìŠ¤ëŸ¬ìš´ ì „í™˜)
          setTimeout(() => {
            if (aiOverlay) {
              aiOverlay.classList.remove('show');
            }
          }, 800);
        };
        img.onerror = function() {
          console.warn('âŒ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:', imageUrl);
          if (aiOverlay) {
            aiOverlay.classList.remove('show');
          }
        };
        img.src = imageUrl;
      } else {
        console.warn('âŒ í•´ë‹¹ ê³¼ëª©ì˜ ë°°ê²½ ì´ë¯¸ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', subjectId);
        if (aiOverlay) {
          aiOverlay.classList.remove('show');
        }
      }
    }

    // ê¸€ë¡œë²Œ ìŠ¤ì½”í”„ì— í•¨ìˆ˜ì™€ ê°ì²´ ë…¸ì¶œ (ë””ë²„ê¹… ë° ì™¸ë¶€ ì ‘ê·¼ìš©)
    window.changeBackgroundImage = changeBackgroundImage;
    window.subjectBackgrounds = subjectBackgrounds;

    /* 2. ê³¼ëª©ë³„ í…Œë§ˆ */
    const titleThemes = {
      bio: [
        "ìƒëª…ì˜ ê¸°ë³¸ ì›ë¦¬ë¥¼ ì´í•´í•˜ê¸°",
        "ì„¸í¬ì—ì„œë¶€í„° ì‹œìž‘ë˜ëŠ” ìƒëª…",
        "ë‹¤ì–‘í•œ ìƒë¬¼ì˜ êµ¬ì¡°ì™€ ê¸°ëŠ¥",
        "ìœ ì „ê³¼ ë²ˆì‹ì˜ ë¹„ë°€",
        "í™˜ê²½ê³¼ ìƒë¬¼ì˜ ìƒí˜¸ìž‘ìš©",
        "ì ì‘ê³¼ ì§„í™”ì˜ ê³¼ì •",
        "ìƒíƒœê³„ì˜ êµ¬ì„±ê³¼ ìˆœí™˜",
        "ì¸ê°„ê³¼ ìƒíƒœê³„ì˜ ì¡°í™”",
        "ì§ˆë³‘ê³¼ ë©´ì—­ì˜ ì´í•´",
        "ìƒëª…ê³µí•™ì˜ ê¸°ì´ˆ ì‚´íŽ´ë³´ê¸°"
      ],
      earth: [
        "ì§€êµ¬ì˜ êµ¬ì„±ê³¼ ë³€í™”",
        "ëŒ€ê¸°ì™€ ë‚ ì”¨ë¥¼ ì½ë‹¤",
        "ì§€ì§ˆ êµ¬ì¡°ì˜ ì›ë¦¬",
        "í•´ì–‘ì˜ íë¦„ê³¼ ìƒíƒœ",
        "ê¸°ìƒ ìž¬í•´ì™€ ëŒ€ë¹„",
        "ê¸°í›„ ë³€í™”ì˜ ì´í•´",
        "ë³„ê³¼ ìš°ì£¼ì˜ ê´€ì°°",
        "ì§€êµ¬ ë‚´ë¶€ì˜ ë¹„ë°€",
        "ìžì—°ìžì›ì˜ í˜•ì„±ê³¼ ì´ìš©",
        "ì§€êµ¬ í™˜ê²½ì˜ ë³´ì „"
      ],
      physics: [
        "íž˜ê³¼ ìš´ë™ì˜ ê¸°ë³¸ ê°œë…",
        "ì—ë„ˆì§€ì˜ í˜•íƒœì™€ ì „í™˜",
        "íŒŒë™ê³¼ ì†Œë¦¬ì˜ ì„¸ê³„",
        "ë¹›ê³¼ ì „ìžê¸° í˜„ìƒ",
        "ì—´ê³¼ ì˜¨ë„ì˜ ì›ë¦¬",
        "ì¼ê³¼ ëŠ¥ë¥ ì„ ê³„ì‚°í•˜ë‹¤",
        "ì „ê¸°íšŒë¡œì˜ ê¸°ì´ˆ",
        "ê³¼í•™ì  ì‚¬ê³ ë¡œ ë¬¸ì œ í•´ê²°",
        "ë¬¼ë¦¬ ë²•ì¹™ì˜ ì‹¤ì œ ì ìš©",
        "í˜„ëŒ€ ë¬¼ë¦¬ì˜ ê°„ë‹¨í•œ ì´í•´"
      ],
      chem: [
        "ë¬¼ì§ˆì˜ ì„±ì§ˆê³¼ ìƒíƒœ",
        "ì›ìžì™€ ë¶„ìžì˜ êµ¬ì¡°",
        "í™”í•™ ë°˜ì‘ì˜ ê¸°ë³¸",
        "ìš©ì•¡ê³¼ ë†ë„ ê³„ì‚°",
        "ì‚°ê³¼ ì—¼ê¸°ì˜ ì„±ì§ˆ",
        "ì£¼ê¸°ìœ¨í‘œë¡œ ë³´ëŠ” ê·œì¹™ì„±",
        "ì—ë„ˆì§€ì™€ í™”í•™ ë³€í™”",
        "ìƒí™œ ì† í™”í•™ ì•Œì•„ë³´ê¸°",
        "í™˜ê²½ê³¼ í™”í•™ ë¬¼ì§ˆ",
        "ì‹¤í—˜ìœ¼ë¡œ í™•ì¸í•˜ëŠ” í™”í•™"
      ],
      society: [
        "ì‚¬íšŒë¬¸í™”ë¥¼ ë°”ë¼ë³´ëŠ” ì‹œê°",
        "ì‚¬íšŒì˜ êµ¬ì¡°ì™€ ì§‘ë‹¨",
        "ë¬¸í™”ì˜ ë‹¤ì–‘ì„±ê³¼ ì´í•´",
        "ì‚¬íšŒ ë³€ë™ê³¼ í˜„ëŒ€ì‚¬íšŒ",
        "ë¯¸ë””ì–´ì™€ ëŒ€ì¤‘ë¬¸í™” ì½ê¸°",
        "ê°€ì¹˜ê´€ê³¼ ê·œë²”ì˜ í˜•ì„±",
        "ì²­ì†Œë…„ê³¼ ì‚¬íšŒ ì°¸ì—¬",
        "ì¸ê¶Œê³¼ í‰ë“±ì˜ í™•ìž¥",
        "ê°ˆë“±ê³¼ í•´ê²°ì˜ ë°©ë²•",
        "ì„¸ê³„í™” ì‹œëŒ€ì˜ ì‚¬íšŒë¬¸í™”"
      ],
      geo: [
        "ì§€ë„ë¥¼ í†µí•´ ì„¸ìƒì„ ì´í•´í•˜ë‹¤",
        "ì§€ë„ì— ë‹´ê¸´ ì•½ì†ê³¼ í‘œí˜„",
        "ìš°ë¦¬ ê³ ìž¥ì˜ ìƒì§•ê³¼ ìœ ëž˜",
        "ê¸°í›„ì— ë”°ë¼ ë‹¬ë¼ì§€ëŠ” ìƒí™œ ëª¨ìŠµ",
        "ìžì—°ê³¼ ì¸ê°„ì˜ ì¡°í™”ë¡œìš´ ê´€ê³„",
        "ì§€ë„ë¥¼ ë³´ê³  ê¸¸ì„ ì°¾ì•„ê°€ë‹¤",
        "ì„¸ê³„ ì—¬ëŸ¬ ë‚˜ë¼ì˜ ìœ„ì¹˜ì™€ íŠ¹ì§•",
        "ìš°ë¦¬ë‚˜ë¼ì˜ ì§€ë¦¬ì  íŠ¹ì„± ì´í•´í•˜ê¸°",
        "ìžì—°ìž¬í•´ì™€ ì¸ê°„ì˜ ëŒ€ì‘",
        "í™˜ê²½ ë¬¸ì œì™€ ì§€ì† ê°€ëŠ¥í•œ ë°œì „",
        "ë„ì‹œì™€ ë†ì´Œì˜ ì°¨ì´",
        "êµí†µê³¼ í†µì‹ ì˜ ë°œë‹¬",
        "ì„¸ê³„í™”ì™€ ì§€ì—­í™”ì˜ ê´€ê³„",
        "ì¸êµ¬ ë¶„í¬ì™€ ì´ë™",
        "ë¬¸í™”ê¶Œì˜ ë‹¤ì–‘ì„± ì´í•´í•˜ê¸°",
        "ì§€ë¦¬ ì •ë³´ ê¸°ìˆ ì˜ í™œìš©",
        "ì„¸ê³„ì˜ ì£¼ìš” ì‚°ì—…",
        "ì—ë„ˆì§€ ìžì›ì˜ ì´ìš©",
        "ì§€êµ¬ì´Œì˜ í™˜ê²½ ë¬¸ì œ",
        "ë¯¸ëž˜ì˜ ì§€êµ¬ë¥¼ ê·¸ë¦¬ë‹¤"
      ],
      law: [
        "ë²•ì´ í•„ìš”í•œ ì´ìœ ",
        "í—Œë²•ê³¼ ê¸°ë³¸ê¶Œ ì´í•´",
        "ë¯¼ë²•ìœ¼ë¡œ ë³´ëŠ” ê¶Œë¦¬ ê´€ê³„",
        "í˜•ë²•ê³¼ ë²”ì£„ì˜ êµ¬ì„±",
        "ë…¸ë™ê³¼ ì‚¬íšŒ ë³´ìž¥ ì œë„",
        "ìƒí™œ ì† ê³„ì•½ê³¼ ë¶„ìŸ",
        "êµ­ê°€ì™€ ì‹œë¯¼ì˜ ì±…ìž„",
        "ë²•ì  ì ˆì°¨ì™€ ìž¬íŒ",
        "êµ­ì œ ì‚¬íšŒì™€ ë²•",
        "ê³µì •í•œ ì‚¬íšŒë¥¼ ìœ„í•œ ê·œë²”"
      ],
      econ: [
        "ê²½ì œ í™œë™ì˜ ê¸°ë³¸ ì›ë¦¬",
        "ì‹œìž¥ê³¼ ìˆ˜ìš”Â·ê³µê¸‰",
        "ê°€ê²©ì´ ê²°ì •ë˜ëŠ” ê³¼ì •",
        "ê¸ˆìœµê³¼ í™”íì˜ ì—­í• ",
        "êµ­ê°€ ê²½ì œì˜ ìˆœí™˜",
        "ë¬´ì—­ê³¼ ì„¸ê³„ ê²½ì œ",
        "ì†Œë¹„ìžì™€ í•©ë¦¬ì  ì„ íƒ",
        "ê¸°ì—…ì˜ ì—­í• ê³¼ ê²½ì˜",
        "ê²½ì œ ë¬¸ì œì™€ ì •ì±…",
        "ë¯¸ëž˜ ì‚°ì—…ê³¼ ê²½ì œ ë³€í™”"
      ],
      modern: [
        "í˜„ëŒ€ë¬¸í•™ì˜ íë¦„ ì½ê¸°",
        "ì‹œëŒ€ë¥¼ ë‹´ì€ í˜„ëŒ€ì‹œ",
        "í˜„ëŒ€ì†Œì„¤ì˜ ì¸ë¬¼ê³¼ ê°ˆë“±",
        "ì„œì •ê³¼ ì„œì‚¬ êµ¬ë¶„í•˜ê¸°",
        "í˜„ëŒ€ë¬¸í•™ì˜ ì£¼ì œ ì˜ì‹",
        "ìž‘ê°€ì˜ ì‹œì„ ê³¼ í‘œí˜„ ê¸°ë²•",
        "ì‹œì–´ì™€ ì´ë¯¸ì§€ í•´ì„",
        "ì‹œëŒ€ ë°°ê²½ê³¼ ìž‘í’ˆ ì´í•´",
        "í˜„ëŒ€ ìˆ˜í•„ì˜ ë§›",
        "ê°ìƒë¬¸ ì“°ê¸° ì‹¤ìŠµ"
      ],
      classic: [
        "ê³ ì „ë¬¸í•™ì˜ ìž¥ë¥´ ì´í•´",
        "ê³ ì „ì‹œê°€ì˜ ì •ì„œ ì½ê¸°",
        "ê³ ì „ì†Œì„¤ì˜ êµ¬ì¡°ì™€ ì¸ë¬¼",
        "ì‹œëŒ€ìƒì„ ë°˜ì˜í•œ ì´ì•¼ê¸°",
        "ì „ê¸°ë¬¸ê³¼ ì„¤í™”ì˜ íŠ¹ì§•",
        "ìš°ë¦¬ë§ì˜ ì˜› í‘œí˜„ ìµížˆê¸°",
        "ì£¼ì œì™€ êµí›ˆ íŒŒì•…í•˜ê¸°",
        "êµ¬ë¹„ë¬¸í•™ê³¼ ê¸°ë¡ë¬¸í•™",
        "ê³ ì „ê³¼ í˜„ëŒ€ì˜ ì—°ê²°",
        "ê³ ì „ ê°ìƒë²• ì •ë¦¬"
      ],
      world: [
        "ì„¸ê³„ ì—¬ëŸ¬ ì§€ì—­ì˜ ë¬¸í•™",
        "ì„œì–‘ ê³ ì „ì˜ ì „ê°œ",
        "ë™ì–‘ ë¬¸í•™ì˜ ì •ì„œ",
        "ë¯¼ì¡±ë¬¸í•™ê³¼ ì •ì²´ì„±",
        "ì‹ í™”ì™€ ì „ì„¤ì˜ ë³€ì£¼",
        "í˜„ëŒ€ ì„¸ê³„ë¬¸í•™ì˜ íë¦„",
        "ì „ìŸê³¼ í‰í™”ë¥¼ ë…¸ëž˜í•˜ë‹¤",
        "ì‚¬ëž‘ê³¼ ì¸ê°„ ë‚´ë©´ì˜ í‘œí˜„",
        "ì‚¬íšŒ ë¹„íŒì  ì‹œê°ì˜ ë¬¸í•™",
        "ì—¬ì„±ê³¼ ë¬¸í•™ì˜ ëª©ì†Œë¦¬"
      ],
      people: [
        "ì—­ì‚¬ë¥¼ ë°”ê¾¼ ì¸ë¬¼ë“¤",
        "ì‚¬ìƒê°€ë“¤ì˜ ìƒê° ë”°ë¼ê°€ê¸°",
        "ê³¼í•™ ë°œì „ì— ê¸°ì—¬í•œ ì‚¬ëžŒë“¤",
        "ë¬¸í™”ì˜ˆìˆ ì„ ë¹›ë‚¸ ì¸ë¬¼",
        "ë…ë¦½ê³¼ í‰í™”ë¥¼ ìœ„í•œ ì§€ë„ìž",
        "êµìœ¡ê³¼ ë³µì§€ë¥¼ ì´ëˆ ì´ë“¤",
        "ì„¸ê³„ ë¬´ëŒ€ì˜ ë¦¬ë”ì‹­",
        "ë„ì „ê³¼ í˜ì‹ ì˜ ì‚¬ë¡€",
        "ì¸ë¬¼ë¹„êµë¡œ ë³´ëŠ” ì‹œëŒ€",
        "ì¸ë¬¼ ì´ì•¼ê¸°ë¡œ ì½ëŠ” ì—­ì‚¬"
      ],
      naesin: [
        "êµê³¼ ê°œë…ì„ ì •ë¦¬í•˜ë‹¤",
        "ì§€ë¬¸ êµ¬ì¡°ë¥¼ íŒŒì•…í•˜ë‹¤",
        "ë¬¸ë‹¨ ì „ê°œë¥¼ ì´í•´í•˜ë‹¤",
        "ì¤‘ìš” ì–´íœ˜ë¥¼ ìµížˆë‹¤",
        "ìžë£Œì™€ í‘œë¥¼ í•´ì„í•˜ë‹¤",
        "ì¶œì œ í¬ì¸íŠ¸ë¥¼ ì •ë¦¬í•˜ë‹¤",
        "ì„œìˆ í˜• ë‹µì•ˆì„ ì—°ìŠµí•˜ë‹¤",
        "ë¹„íŒì  ì½ê¸°ë¡œ í™•ìž¥í•˜ë‹¤",
        "ìœ í˜•ë³„ ë¬¸ì œì— ì ì‘í•˜ë‹¤",
        "í•™ìŠµí•œ ë‚´ìš©ì„ ë§ˆë¬´ë¦¬í•˜ë‹¤"
      ],
      suneung: [
        "ìˆ˜ëŠ¥ ì§€ë¬¸ì˜ ì „ê°œ ë°©ì‹",
        "ì‚¬ì„¤Â·í‰ë¡  ì§€ë¬¸ ë…í•´",
        "ì •ë³´ í™•ì¸ ë¬¸ì œ ê³µëžµ",
        "ì¶”ë¡ í˜• ë¬¸ì œ ì ‘ê·¼ë²•",
        "ê°„ì ‘ ì—°ê³„ ì§€ë¬¸ ì—°ìŠµ",
        "ì‹œê°„ ê´€ë¦¬ ì „ëžµ ì„¸ìš°ê¸°",
        "ë³´ê¸° ìžë£Œì™€ í•¨ê»˜ ì½ê¸°",
        "ì˜¤ë‹µ ìœ í˜• ë¶„ì„í•˜ê¸°",
        "ìˆ˜ëŠ¥ ì–´íœ˜ ë³´ì¶©í•˜ê¸°",
        "ì‹¤ì „ì²˜ëŸ¼ í’€ì–´ë³´ê¸°"
      ],
      poem: [
        "ì‹œì  í™”ìžì™€ ì •ì„œ íŒŒì•…",
        "ì´ë¯¸ì§€ì™€ ìƒì§• ì½ê¸°",
        "ë¦¬ë“¬ê³¼ ìš´ìœ¨ ëŠë¼ê¸°",
        "ë¹„ìœ ë²•ì˜ íš¨ê³¼ ì´í•´",
        "í˜„ëŒ€ì‹œì˜ ì£¼ì œ ì •ë¦¬",
        "í™”ìžì˜ íƒœë„ ë³€í™” ë³´ê¸°",
        "ëŒ€ìƒê³¼ ì‹œì„ ì˜ ê±°ë¦¬",
        "ì œëª©ê³¼ ë‚´ìš©ì˜ ê´€ê³„",
        "ìœ í˜•ë³„ ë¬¸ì œ ì ‘ê·¼",
        "ê°ìƒë¬¸ìœ¼ë¡œ ì˜®ê²¨ë³´ê¸°"
      ],
      novel: [
        "ì¸ë¬¼ê³¼ ê°ˆë“± êµ¬ì¡°",
        "ì‹œì ê³¼ ì„œìˆ  ë°©ì‹",
        "ë°°ê²½ê³¼ ì£¼ì œì˜ ì—°ê²°",
        "ëŒ€í™”ì™€ í–‰ë™ì˜ ì˜ë¯¸",
        "í˜„ëŒ€ì†Œì„¤ì˜ í‘œí˜„ ê¸°ë²•",
        "ê²°ë§ì„ í†µí•œ ì£¼ì œ í™•ì¸",
        "ë°˜ì „ê³¼ ë³µì„  íŒŒì•…",
        "ì¸ë¬¼ì˜ ì‹¬ë¦¬ ì½ê¸°",
        "ìƒì§•ì  ìž¥ë©´ í•´ì„",
        "ì„œì‚¬ êµ¬ì¡° ì •ë¦¬í•˜ê¸°"
      ],
      etc: [
        "ê·¹ì˜ êµ¬ì¡° ì´í•´í•˜ê¸°",
        "í¬ê³¡ ì¸ë¬¼ì˜ ëŒ€ì‚¬ ë¶„ì„",
        "ìˆ˜í•„ì˜ í™”ìžì™€ íƒœë„",
        "í¬ê³¡ ë¬´ëŒ€ì§€ì‹œ ì½ê¸°",
        "ìˆ˜í•„ì˜ ì¤‘ì‹¬ ìƒê° ì°¾ê¸°",
        "ê·¹ì˜ ê°ˆë“±ê³¼ í•´ê²°",
        "í¬ê³¡ ìž¥ë¥´ì˜ íŠ¹ì§•",
        "ì‚¶ì„ ë‹´ì€ ìˆ˜í•„ ì½ê¸°",
        "í‘œí˜„ìƒì˜ íŠ¹ì§• ì •ë¦¬",
        "ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ì“°ê¸°"
      ],
      gosi: [
        "ì‹œì¡°ì˜ í˜•ì‹ê³¼ ì •ì„œ",
        "í–¥ê°€ì™€ ê³ ë ¤ê°€ìš”ì˜ ë¯¸",
        "ê³ ì „ì‹œê°€ì˜ í™”ìž ì´í•´",
        "í‘œí˜„ë²•ê³¼ ë¶€ì‚¬ì–´ í•´ì„",
        "ì‹œëŒ€ë³„ ì‹œê°€ì˜ íŠ¹ì§•",
        "ìžì—°ê³¼ ì¸ê°„ì˜ êµê°",
        "ì—°êµ°Â·ì—°êµ°ê°€ì˜ ì˜ë¯¸",
        "ì—¬ì„± í™”ìžì˜ ëª©ì†Œë¦¬",
        "ìš´ìœ¨ê³¼ ì–´ì¡° íŒŒì•…",
        "í˜„ëŒ€ì–´ í’€ì´ ì—°ìŠµ"
      ],
      gonovel: [
        "ê³ ì „ì†Œì„¤ì˜ êµ¬ì¡°",
        "ì˜ì›…ì†Œì„¤ì˜ ì „ê°œ",
        "ì• ì •ì†Œì„¤ì˜ ê°ˆë“±",
        "ê°€ì •ì†Œì„¤ê³¼ êµí›ˆ",
        "ìš°í™”ì  í‘œí˜„ ì½ê¸°",
        "ì—¬ì„± ì¸ë¬¼ì˜ í˜•ìƒí™”",
        "ê¶Œì„ ì§•ì•… êµ¬ì¡° ì´í•´",
        "ì„œì‚¬ ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ê¸°",
        "ê³ ì „ì†Œì„¤ì˜ ë°°ê²½",
        "í˜„ëŒ€ì  ì˜ë¯¸ë¡œ í™•ìž¥"
      ],
      goessay: [
        "ê³ ì „ ìˆ˜í•„ì˜ ì–´ì¡°",
        "ìžì—°ê³¼ ì€ì¼ì˜ ì •ì„œ",
        "ì¸ë¬¼ í‰ê°€ì™€ êµí›ˆ",
        "ì—­ì‚¬ì  ì¼í™” ì½ê¸°",
        "ìžê¸° ì„±ì°°ì˜ ê¸€",
        "ê°„ê²°í•œ í‘œí˜„ì˜ ë¯¸",
        "ë¹„ìœ ì™€ í•œìžì–´ í•´ì„",
        "ê¸€ì“´ì´ì˜ ì‚¶ê³¼ íƒœë„",
        "ë¬¸ìž¥ ê³ ì³ ì“°ê¸°",
        "ê°ìƒ ì •ë¦¬í•˜ê¸°"
      ],
      modernGrammar: [
        "í˜„ëŒ€ êµ­ì–´ì˜ ìŒìš´",
        "í’ˆì‚¬ì™€ í˜•íƒœì†Œ ë¶„ì„",
        "ë‹¨ì–´ì˜ í˜•ì„± ë°©ì‹",
        "ë¬¸ìž¥ì˜ ì„±ë¶„ ì´í•´",
        "ë¬¸ìž¥ í˜¸ì‘ê³¼ ì–´ìˆœ",
        "ë†’ìž„ë²•ê³¼ ê³µì† í‘œí˜„",
        "ì–´íœ˜ì˜ ì˜ë¯¸ ê´€ê³„",
        "í‘œì¤€ì–´ì™€ ë§žì¶¤ë²•",
        "ë„ì–´ì“°ê¸° ê·œì¹™",
        "ë‹´í™”ì™€ ë‹´í™” í‘œì§€"
      ],
      middleGrammar: [
        "ì¤‘ì„¸êµ­ì–´ì˜ ë¬¸ìžì™€ ì†Œë¦¬",
        "í›ˆë¯¼ì •ìŒ ì°½ì œ ë°°ê²½",
        "ì¤‘ì„¸êµ­ì–´ì˜ ë¬¸ë²• ìš”ì†Œ",
        "ì˜›ë§ ì–´ë¯¸ì™€ ì„ ì–´ë§ì–´ë¯¸",
        "ì¤‘ì„¸êµ­ì–´ ì–´íœ˜ ì‚´íŽ´ë³´ê¸°",
        "ì‹œëŒ€ë³„ ë¬¸í—Œ ì½ê¸°",
        "ì¤‘ì„¸êµ­ì–´ ë¬¸ìž¥ ë¶„ì„",
        "í˜„ëŒ€êµ­ì–´ì™€ì˜ ì°¨ì´",
        "ì˜ë¯¸ ë³€ì²œ ì´í•´",
        "ê³ ì–´ í•´ì„ ì—°ìŠµ"
      ]
    };

    /* 3. ì „ì²´ ê³¼ëª© ìž„ì‹œ ì œëª© ìžë™ ìƒì„± */
    function buildUnitTitleOverrides() {
      const overrides = {};

      for (const [seriesKey, domains] of Object.entries(domainsBySeries)) {
        const realDomains = domains || domainsBySeries["BRAINON"];

        realDomains.forEach(domainObj => {
          domainObj.subs.forEach(subObj => {
            const key = `${seriesKey}.${domainObj.id}.${subObj.id}`;
            const count = subObj.count;

            const theme =
              titleThemes[subObj.id] ||
              titleThemes[subObj.label] ||
              ["ë‚´ìš©ì„ ì´í•´í•˜ê³  ì •ë¦¬í•˜ê¸°", "í•µì‹¬ì–´ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì½ê¸°", "ë¬¸ë‹¨ ì „ê°œ íŒŒì•…í•˜ê¸°", "ìžë£Œì™€ í•¨ê»˜ ìƒê°í•˜ê¸°"];

            const arr = [];
            for (let i = 1; i <= count; i++) {
              const picked = theme[(i - 1) % theme.length];
              arr.push(`${picked}`);
            }
            overrides[key] = arr;
          });
        });
      }

      // ì‹¤ì œ ì•Œê³  ìžˆëŠ” ì œëª© ë®ì–´ì“°ê¸° (ì •ì¡°/ì‚¬íšŒ/ì§€ë¦¬)
      overrides["BRAINUP.social.geo"] = [
        "ì§€ë„ë¥¼ í†µí•´ ì„¸ìƒì„ ì´í•´í•˜ë‹¤",
        "ì§€ë„ì— ë‹´ê¸´ ì•½ì†ê³¼ í‘œí˜„",
        "ìš°ë¦¬ ê³ ìž¥ì˜ ìƒì§•ê³¼ ìœ ëž˜",
        "ê¸°í›„ì— ë”°ë¼ ë‹¬ë¼ì§€ëŠ” ìƒí™œ ëª¨ìŠµ",
        "ìžì—°ê³¼ ì¸ê°„ì˜ ì¡°í™”ë¡œìš´ ê´€ê³„",
        "ì§€ë„ë¥¼ ë³´ê³  ê¸¸ì„ ì°¾ì•„ê°€ë‹¤",
        "ì„¸ê³„ ì—¬ëŸ¬ ë‚˜ë¼ì˜ ìœ„ì¹˜ì™€ íŠ¹ì§•",
        "ìš°ë¦¬ë‚˜ë¼ì˜ ì§€ë¦¬ì  íŠ¹ì„± ì´í•´í•˜ê¸°",
        "ìžì—°ìž¬í•´ì™€ ì¸ê°„ì˜ ëŒ€ì‘",
        "í™˜ê²½ ë¬¸ì œì™€ ì§€ì† ê°€ëŠ¥í•œ ë°œì „",
        "ë„ì‹œì™€ ë†ì´Œì˜ ì°¨ì´",
        "êµí†µê³¼ í†µì‹ ì˜ ë°œë‹¬",
        "ì„¸ê³„í™”ì™€ ì§€ì—­í™”ì˜ ê´€ê³„",
        "ì¸êµ¬ ë¶„í¬ì™€ ì´ë™",
        "ë¬¸í™”ê¶Œì˜ ë‹¤ì–‘ì„± ì´í•´í•˜ê¸°",
        "ì§€ë¦¬ ì •ë³´ ê¸°ìˆ ì˜ í™œìš©",
        "ì„¸ê³„ì˜ ì£¼ìš” ì‚°ì—…",
        "ì—ë„ˆì§€ ìžì›ì˜ ì´ìš©",
        "ì§€êµ¬ì´Œì˜ í™˜ê²½ ë¬¸ì œ",
        "ë¯¸ëž˜ì˜ ì§€êµ¬ë¥¼ ê·¸ë¦¬ë‹¤"
      ];

      return overrides;
    }

    const unitTitleOverrides = buildUnitTitleOverrides();

    // ë‹¨ì›ë³„ ë“±ê¸‰ ë°ì´í„° ì €ìž¥ ê°ì²´
    let unitGradesData = {};

    /* 4. DOM ìºì‹± */
    const domainList = document.getElementById("domainList");
    const subjectList = document.getElementById("subjectList");
    const unitList = document.getElementById("unitList");
    const modal = document.getElementById("pendingModal");
    const closeModalBtn = document.getElementById("closeModalBtn");
    const unitSearch = document.getElementById("unitSearch");
    let currentUnits = [];

    // í˜„ìž¬ ì„ íƒëœ ì‹œë¦¬ì¦ˆ/ë„ë©”ì¸/ê³¼ëª© ì¶”ì 
    let currentSelectedSeries = null;
    let currentSelectedDomain = null;
    let currentSelectedSubject = null;



    // ðŸšª ë¡œê·¸ì•„ì›ƒ ëª¨ë‹¬ ê´€ë ¨
const logoutModal = document.getElementById("logoutModal");
const logoutCancelBtn = document.getElementById("logoutCancelBtn");
const logoutConfirmBtn = document.getElementById("logoutConfirmBtn");
let logoutCallback = null;


    function showPendingModal() {
      modal.classList.add("show");
    }

    function hidePendingModal() {
      modal.classList.remove("show");
    }

    // X ë²„íŠ¼ í´ë¦­ ì‹œ: íŒì—… ë‹«ê³  1.5ì´ˆ í›„ íŽ˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
    closeModalBtn.addEventListener("click", () => {
      hidePendingModal();
      setTimeout(() => {
        location.reload();
      }, 1500);
    });

    modal.addEventListener("click", e => {
      if (e.target === modal) hidePendingModal();
    });

/* ðŸšª ë¡œê·¸ì•„ì›ƒ ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸° */
function showLogoutModal(cb) {
  logoutCallback = cb || null;
  if (logoutModal) logoutModal.classList.add("show");
}
function hideLogoutModal() {
  if (logoutModal) logoutModal.classList.remove("show");
}

if (logoutCancelBtn) {
  logoutCancelBtn.addEventListener("click", () => {
    hideLogoutModal();
    if (logoutCallback) logoutCallback(false);  // ì·¨ì†Œ
  });
}

if (logoutConfirmBtn) {
  logoutConfirmBtn.addEventListener("click", () => {
    hideLogoutModal();
    if (logoutCallback) logoutCallback(true);   // í™•ì¸
  });
}


    

    /* 5. ì‹œë¦¬ì¦ˆ í´ë¦­ */
    document.querySelectorAll("#seriesList .series-item").forEach(li => {
      li.addEventListener("click", () => {
        document.querySelectorAll("#seriesList .series-item").forEach(x => x.classList.remove("active"));
        li.classList.add("active");
        const series = li.dataset.series;
        currentSelectedSeries = series;
        currentSelectedDomain = null;
        currentSelectedSubject = null;
        renderDomains(series);
        subjectList.innerHTML = "";
        unitList.innerHTML = "";
        document.getElementById("unitTitle").textContent = "ë‹¨ì› ì„ íƒ";
        document.getElementById("unitDesc").textContent =
          seriesInfo[series].desc + " Â· ë¶„ì•¼ì™€ ê³¼ëª©ì„ ì„ íƒí•˜ì„¸ìš”.";
        unitSearch.value = "";
      });
    });

    /* 6. ë¶„ì•¼ í‘œì‹œ */
    function renderDomains(seriesKey) {
      domainList.innerHTML = "";
      const domainData = domainsBySeries[seriesKey] || domainsBySeries["BRAINON"];

      domainData.forEach(dom => {
        const li = document.createElement("li");
        li.className = "domain-item";
        li.dataset.domain = dom.id;
        li.innerHTML = `<span>${dom.label}</span><span class="meta">${dom.subs.length}ê³¼ëª©</span>`;
        li.addEventListener("click", () => {
          document.querySelectorAll(".domain-item").forEach(x => x.classList.remove("active"));
          li.classList.add("active");
          currentSelectedDomain = dom;
          currentSelectedSubject = null;
          renderSubjects(seriesKey, dom);
          unitList.innerHTML = "";
          document.getElementById("unitTitle").textContent = dom.label;
          document.getElementById("unitDesc").textContent = "ì„¸ë¶€ ê³¼ëª©ì„ ì„ íƒí•˜ë©´ 01~ë²ˆí˜¸ê°€ í‘œì‹œë©ë‹ˆë‹¤.";
          unitSearch.value = "";
        });
        domainList.appendChild(li);
      });
    }

    /* 7. ì„¸ë¶€ ê³¼ëª© í‘œì‹œ */
    function renderSubjects(seriesKey, domainObj) {
      subjectList.innerHTML = "";
      domainObj.subs.forEach(sub => {
        const li = document.createElement("li");
        li.className = "subject-item";
        li.dataset.sub = sub.id;
        li.innerHTML = `<span>${sub.label}</span><span class="meta">${sub.count}ê°œ</span>`;
        li.addEventListener("click", () => {
          document.querySelectorAll(".subject-item").forEach(x => x.classList.remove("active"));
          li.classList.add("active");
          currentSelectedSubject = sub;
          changeBackgroundImage(sub);  // ë°°ê²½ ì´ë¯¸ì§€ ë³€ê²½ (sub ì „ì²´ ì „ë‹¬)
          renderUnits(seriesKey, domainObj, sub);
        });
        subjectList.appendChild(li);
      });
    }

    /* 8. ë‹¨ì› í‘œì‹œ */
    function renderUnits(seriesKey, domainObj, subObj) {
      unitList.innerHTML = "";
      document.getElementById("unitTitle").textContent =
        `${seriesInfo[seriesKey].name} / ${domainObj.label} / ${subObj.label}`;
      document.getElementById("unitDesc").textContent =
        `${subObj.label} ${subObj.count}ê°œ ë‹¨ì›ìž…ë‹ˆë‹¤.`;

      unitSearch.value = "";
      currentUnits = [];

      const key = `${seriesKey}.${domainObj.id}.${subObj.id}`;
      const titles = unitTitleOverrides[key] || [];
      const startNum = (subObj.offset || 0) + 1; // offsetì´ ìžˆìœ¼ë©´ ì‹œìž‘ ë²ˆí˜¸ ì¡°ì •

      for (let i = 1; i <= subObj.count; i++) {
        const actualNum = startNum + i - 1; // ì‹¤ì œ íŒŒì¼ ë²ˆí˜¸
        const num = String(actualNum).padStart(2, "0");
        const title = titles[actualNum - 1] || `${subObj.label} ${num} í•™ìŠµí•˜ê¸°`;

        // íŒŒì¼ëª… ë³€í™˜: societyâ†’soc_, geoâ†’geo_, lawâ†’law_, polâ†’pol_, bioâ†’bio_, earthâ†’earth_, physicsâ†’physics_, chemâ†’chem_, modernâ†’modern_, classicâ†’classic_, worldâ†’world_, peopleâ†’people_
        let filename = `${subObj.id}_${num}.html`;
        if (subObj.id === 'society') {
          filename = `soc_${num}.html`;
        } else if (subObj.id === 'geo') {
          filename = `geo_${num}.html`;
        } else if (subObj.id === 'law') {
          filename = `law_${num}.html`;
        } else if (subObj.id === 'pol') {
          filename = `pol_${num}.html`;
        } else if (subObj.id === 'bio') {
          filename = `bio_${num}.html`;
        } else if (subObj.id === 'earth') {
          filename = `earth_${num}.html`;
        } else if (subObj.id === 'physics') {
          filename = `physics_${num}.html`;
        } else if (subObj.id === 'chem') {
          filename = `chem_${num}.html`;
        } else if (subObj.id === 'modern') {
          filename = `modern_${num}.html`;
        } else if (subObj.id === 'classic') {
          filename = `classic_${num}.html`;
        } else if (subObj.id === 'world') {
          filename = `world_${num}.html`;
        } else if (subObj.id === 'people') {
          filename = `people_${num}.html`;
        }

        currentUnits.push({
          label: `${subObj.label} ${num} ${title}`.trim(),
          num,
          path: `./${seriesKey}/${domainObj.id}/${filename}`
        });
      }

      renderUnitList(currentUnits);
    }

    /* 9. ë‹¨ì› ë¦¬ìŠ¤íŠ¸ ì¶œë ¥ */
    async function renderUnitList(units) {
      // ë‹¨ì› ë“±ê¸‰ ë°ì´í„° ë¡œë“œ
      unitGradesData = await fetchUnitGrades();
      unitList.innerHTML = "";
      units.forEach(u => {
        const li = document.createElement("li");
        li.className = "unit-item";
        li.dataset.page = u.path;

        // ê³¼ì œ ë°ì´í„° ì €ìž¥ (ë“œëž˜ê·¸/ëª¨ë°”ì¼ ì¶”ê°€ìš©)
        li.dataset.taskData = JSON.stringify({
          unitId: u.path,
          title: u.label,
          series: currentSelectedSeries ? seriesInfo[currentSelectedSeries].name : '',
          domain: currentSelectedDomain ? currentSelectedDomain.label : '',
          subject: currentSelectedSubject ? currentSelectedSubject.label : ''
        });

        // ë‹¨ì› ID ì¶”ì¶œ (ì˜ˆ: "BRAINUP/social/geo_01.html" â†’ "geo_01")
        const unitId = u.path.split('/').pop().replace('.html', '');

        // í•´ë‹¹ ë‹¨ì›ì˜ ë“±ê¸‰ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const gradeInfo = unitGradesData[unitId];
        const stars = gradeInfo ? getStarsForGrade(gradeInfo.grade) : '';

        li.innerHTML = `
          <span>${u.label}</span>
          <span class="unit-right">
            ${stars ? `<span class="unit-stars">${stars}</span>` : ''}
            <span class="status-badge status-default" draggable="true">âœï¸ ë¯¸ì™„ë£Œ</span>
          </span>
        `;

        // ë‹¨ì› í´ë¦­ ì´ë²¤íŠ¸
        li.addEventListener("click", (e) => {
          // ìƒíƒœ ë±ƒì§€ í´ë¦­ ì‹œì—ëŠ” ë‹¨ì› ì—´ê¸° ë°©ì§€
          if (e.target.classList.contains('status-badge')) {
            return;
          }

          // ë‹¨ì› íŒŒì¼ ì¡´ìž¬ ì—¬ë¶€ í™•ì¸
          fetch(u.path, { method: "HEAD" })
            .then(res => {
              if (res.ok) {
                openUnitModal(u.path);
              } else {
                showPendingModal();
              }
            })
            .catch(() => showPendingModal());
        });

        // ìƒíƒœ ë±ƒì§€ ë“œëž˜ê·¸ ì´ë²¤íŠ¸
        const statusBadge = li.querySelector('.status-badge');

        // PC: ë“œëž˜ê·¸ ì•¤ ë“œë¡­
        statusBadge.addEventListener('dragstart', (e) => {
          e.stopPropagation();
          li.classList.add('dragging');
          e.dataTransfer.effectAllowed = 'copy';
          e.dataTransfer.setData('text/plain', li.dataset.taskData);
        });

        statusBadge.addEventListener('dragend', (e) => {
          li.classList.remove('dragging');
        });

        // ëª¨ë°”ì¼: í´ë¦­ìœ¼ë¡œ ê³¼ì œë¶€ì—¬ íŒì—…
        statusBadge.addEventListener('click', (e) => {
          e.stopPropagation();
          showAssignTaskModal(li.dataset.taskData);
        });

        unitList.appendChild(li);
      });

      // ëª©ë¡ ê·¸ë¦´ ë•Œë§ˆë‹¤ ì €ìž¥ëœ ì™„ë£Œ ìƒíƒœ ë‹¤ì‹œ ë°˜ì˜
      restoreProgressOnRenderedList();
    }

    /* 10. ê²€ìƒ‰ */
    unitSearch.addEventListener("input", (e) => {
      const q = e.target.value.trim();
      if (!q) {
        renderUnitList(currentUnits);
        return;
      }
      const filtered = currentUnits.filter(u =>
        u.label.includes(q) || u.num.includes(q)
      );
      renderUnitList(filtered);
    });

    // âœ… ìƒíƒœë¥¼ ë°”ê¾¸ëŠ” ê³µìš© í•¨ìˆ˜
    function updateLessonStatus(pageKey, status) {
      const li = document.querySelector(`.unit-item[data-page="${pageKey}"]`);
      if (!li) return;
      const badge = li.querySelector('.status-badge');
      if (!badge) return;

      badge.classList.remove('status-default', 'status-done');

      if (status === 'done') {
        badge.classList.add('status-done');
        badge.textContent = 'ðŸ† í•™ìŠµì™„ë£Œ';
      } else {
        badge.classList.add('status-default');
        badge.textContent = 'âœï¸ ë¯¸ì™„ë£Œ';
      }
    }

    /* ðŸ” í•™ìƒ ì •ë³´ ê°€ì ¸ì˜¤ê¸° */
    function getCurrentStudent() {
      const saved = localStorage.getItem('currentStudent');
      if (!saved) return null;
      try { return JSON.parse(saved); }
      catch(e) { return null; }
    }

    /* ðŸ” í•™ìƒí‚¤ ë§Œë“¤ê¸° (ë¡œê·¸ì¸ íŽ˜ì´ì§€ëž‘ ê°™ì€ ê·œì¹™) */
    function buildStudentKey(stu) {
      const cleanPhone = (stu.phone || '').replace(/\D/g, '');
      const cleanName = (stu.name || '').trim();
      const cleanGrade = (stu.grade || '').trim();
      return `${cleanGrade}_${cleanName}_${cleanPhone}`;
    }

    /* â­ ë‹¨ì›ë³„ ë“±ê¸‰ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° */
    async function fetchUnitGrades() {
      try {
        const stu = getCurrentStudent();
        if (!stu) {
          console.log('â­ ë¡œê·¸ì¸ëœ í•™ìƒ ì •ë³´ ì—†ìŒ');
          return {};
        }

        const params = new URLSearchParams({
          grade: stu.grade || '',
          name: stu.name || ''
        });

        const response = await fetch(`/api/unit-grades?${params}`);
        if (!response.ok) {
          console.error('â­ ë‹¨ì› ë“±ê¸‰ ì¡°íšŒ ì‹¤íŒ¨:', response.status);
          return {};
        }

        const data = await response.json();
        console.log('â­ ë‹¨ì› ë“±ê¸‰ ë°ì´í„° ë¡œë“œ:', Object.keys(data).length, 'ê°œ');
        return data;
      } catch (error) {
        console.error('â­ ë‹¨ì› ë“±ê¸‰ ì¡°íšŒ ì˜¤ë¥˜:', error);
        return {};
      }
    }

    /* â­ ë“±ê¸‰ë³„ ë³„ ê°œìˆ˜ ë°˜í™˜ */
    function getStarsForGrade(grade) {
      const starsMap = {
        'ìš°ìˆ˜': 'â­â­â­â­â­',
        'ì–‘í˜¸': 'â­â­â­â­',
        'ë³´í†µ': 'â­â­â­',
        'ê²©ë ¤': 'â­â­'
      };
      return starsMap[grade] || '';
    }

    /* âœ… í˜„ìž¬ ë¡œê·¸ì¸í•œ í•™ìƒì˜ ì™„ë£Œ ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° */
    function getStudentProgressList() {
      const stu = getCurrentStudent();
      if (!stu) return [];  // ë¡œê·¸ì¸ ì•ˆ ë˜ì–´ ìžˆìœ¼ë©´ ë¹ˆë°°ì—´
      const stuKey = buildStudentKey(stu);
      const progressKey = `dan-progress:${stuKey}`;
      return JSON.parse(localStorage.getItem(progressKey) || '[]');
    }

    // ðŸ”„ ì„œë²„ì—ì„œ ìµœì‹  ì™„ë£Œ ìƒíƒœ ê°€ì ¸ì™€ì„œ localStorageì— ì €ìž¥
    async function syncCompletionStatusFromServer() {
      try {
        const stu = getCurrentStudent();
        if (!stu) return;

        const params = new URLSearchParams({
          grade: stu.grade || '',
          name: stu.name || '',
          series: 'BRAINì—…'
        });

        const res = await fetch(`/api/completion-status?${params}`, {
          method: 'GET',
          headers: { 'Content-Type': 'application/json' }
        });

        if (!res.ok) {
          console.warn('[syncCompletionStatus] ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜:', res.status);
          return;
        }

        const data = await res.json();
        console.log('[syncCompletionStatus] ì„œë²„ ì‘ë‹µ:', data);

        if (data.ok && Array.isArray(data.completedUnits)) {
          const stuKey = buildStudentKey(stu);
          const keyPrefix = `dan-progress:${stuKey}:`;

          data.completedUnits.forEach(unit => {
            const key = keyPrefix + unit;
            // ë°°ì—´ í˜•ì‹ìœ¼ë¡œ ì €ìž¥ (í•™ìŠµ íŽ˜ì´ì§€ì™€ ë™ì¼í•œ ë°©ì‹)
            let saved = [];
            try {
              const existing = localStorage.getItem(key);
              if (existing) {
                saved = JSON.parse(existing);
                if (!Array.isArray(saved)) saved = [];
              }
            } catch(e) {
              saved = [];
            }

            // ê¸°ë³¸ íŽ˜ì´ì§€ ID ì¶”ê°€ (ë¹„ì–´ìžˆìœ¼ë©´)
            if (saved.length === 0) {
              saved.push(`BRAINUP_social_${unit}`);
            }

            localStorage.setItem(key, JSON.stringify(saved));
            console.log('[syncCompletionStatus] ì €ìž¥:', key);
          });

          console.log('[syncCompletionStatus] ì™„ë£Œ ìƒíƒœ ë™ê¸°í™” ì™„ë£Œ:', data.completedUnits);
        }
      } catch (e) {
        console.warn('[syncCompletionStatus] ì˜¤ë¥˜', e);
      }
    }

    // âœ… localStorageì— ì €ìž¥í•´ë‘” ì™„ë£Œëœ ë‹¨ì›ë“¤ì„ ë©”ë‰´ì— ë°˜ì˜ (í•™ìƒë³„)
    function restoreProgressOnRenderedList() {
      const stu = getCurrentStudent();
      if (!stu) return;

      // 1ï¸âƒ£ ê¸°ì¡´ ë°©ì‹: ë°°ì—´ë¡œ ì €ìž¥ëœ ì™„ë£Œ ëª©ë¡ (í•˜ìœ„ í˜¸í™˜)
      const saved = getStudentProgressList(); // ["./BRAINUP/social/geo_01.html", ...]
      saved.forEach(pageKey => {
        updateLessonStatus(pageKey, 'done');
      });

      // 2ï¸âƒ£ ìƒˆ ë°©ì‹: ê°œë³„ í‚¤ë¡œ ì €ìž¥ëœ ì™„ë£Œ ìƒíƒœ (í•™ìŠµ íŽ˜ì´ì§€ì™€ ë™ì¼í•œ ë°©ì‹)
      const stuKey = buildStudentKey(stu);
      const keyPrefix = `dan-progress:${stuKey}:`;

      // í˜„ìž¬ í™”ë©´ì— í‘œì‹œëœ ëª¨ë“  ë‹¨ì› li ìˆœíšŒ
      document.querySelectorAll('.unit-item').forEach(li => {
        const pageKey = li.dataset.page; // "./BRAINUP/social/geo_01.html"
        if (!pageKey) return;

        // ê²½ë¡œì—ì„œ ë‹¨ì› ì½”ë“œ ì¶”ì¶œ (geo_01, geo_02 ë“±)
        const match = pageKey.match(/\/([^\/]+)\.html$/);
        if (!match) return;
        const unitCode = match[1]; // "geo_01"

        // localStorageì—ì„œ ì™„ë£Œ ìƒíƒœ í™•ì¸ (ë°°ì—´ ë°©ì‹)
        const storageKey = keyPrefix + unitCode;
        let saved = [];
        try {
          const data = localStorage.getItem(storageKey);
          if (data) {
            saved = JSON.parse(data);
            if (!Array.isArray(saved)) saved = [];
          }
        } catch(e) {
          saved = [];
        }

        // ë°°ì—´ì— ë°ì´í„°ê°€ ìžˆìœ¼ë©´ ì™„ë£Œ
        if (saved.length > 0) {
          updateLessonStatus(pageKey, 'done');
        }
      });
    }

    /* ðŸ”‹ ë¡œë”© ì˜¤ë²„ë ˆì´ ì œì–´ (ë‹¨ì› ì´ë™ìš©) */
    function hideLoadingScreen() {
      const loadingOverlay = document.getElementById('loadingOverlay');
      loadingOverlay.classList.remove('show');
    }

    function showLoadingScreen(targetUrl) {
      const overlay = document.getElementById('loadingOverlay');
      const bar = document.getElementById('loadingBar');
      const percent = document.getElementById('loadingPercent');
      const emoji = document.querySelector('.loading-emoji');
      const title = document.querySelector('.loading-title');
      const msg = document.querySelector('.loading-msg');

      if (!overlay || !bar || !percent) {
        window.location.href = targetUrl;
        return;
      }

      overlay.classList.add('show');
      // ê¸°ë³¸ ëª¨ë“œëŠ” í•™ìŠµ ë¡œë”© ìŠ¤íƒ€ì¼ ìœ ì§€
      if (emoji) emoji.textContent = 'ðŸ‹';
      if (title) title.textContent = 'ë¡œë”© ì¤‘...';
      if (msg) msg.textContent = 'í•™ìŠµ ìžë£Œë¥¼ ì¤€ë¹„í•˜ê³  ìžˆì–´ìš”.';

      bar.style.width = '0%';
      percent.textContent = '0%';

      let p = 0;
      const timer = setInterval(() => {
        p += 5;
        if (p > 100) p = 100;
        bar.style.width = p + '%';
        percent.textContent = p + '%';

        if (p === 100) {
          clearInterval(timer);
          setTimeout(() => {
            window.location.href = targetUrl;
          }, 500);
        }
      }, 80);
    }

    window.onbeforeunload = () => {
      hideLoadingScreen();
    };

    // ðŸ”» ìƒë‹¨ ì‚¬ìš©ìž í‘œì‹œ: localStorageê°€ ìš°ì„ , ì—†ìœ¼ë©´ URL íŒŒë¼ë¯¸í„°
    function showUserInfo() {
      const infoTarget = document.getElementById("user-info");
      if (!infoTarget) return;

      const stu = getCurrentStudent();
      if (stu) {
        infoTarget.textContent = `${stu.grade || ''} ${stu.name || ''}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`.trim();
      } else {
        infoTarget.textContent = "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.";
      }
    }

        // ì‹¤ì œë¡œ ë¡œê·¸ì•„ì›ƒ ì‹¤í–‰í•˜ëŠ” í•¨ìˆ˜ (ë²„íŠ¼/ë’¤ë¡œê°€ê¸°ì—ì„œ ê³µìš©ìœ¼ë¡œ ì‚¬ìš©)
    async function performLogout() {
      const btn = document.getElementById('logoutBtn');
      const overlay = document.getElementById('loadingOverlay');
      const bar = document.getElementById('loadingBar');
      const percent = document.getElementById('loadingPercent');
      const emoji = document.querySelector('.loading-emoji');
      const title = document.querySelector('.loading-title');
      const msg = document.querySelector('.loading-msg');

      // ðŸ”„ ë¡œë”© ì˜¤ë²„ë ˆì´ë¥¼ "ë¡œê·¸ì•„ì›ƒ ëª¨ë“œ"ë¡œ ì‚¬ìš©
      if (overlay && bar && percent) {
        overlay.classList.add('show');
        if (emoji) emoji.textContent = 'ðŸšª';
        if (title) title.textContent = 'ë¡œê·¸ì•„ì›ƒ ì¤‘...';
        if (msg) msg.textContent = 'ìž ì‹œ í›„ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.';

        bar.style.width = '0%';
        percent.textContent = '0%';
      }

      if (btn) btn.disabled = true;

      let progressTimer = null;
      if (bar && percent) {
        progressTimer = setInterval(() => {
          let current = parseInt(percent.textContent) || 0;
          if (current < 95) {
            current += 5;
            bar.style.width = current + '%';
            percent.textContent = current + '%';
          }
        }, 80);
      }

      try {
        // í˜„ìž¬ í•™ìƒ ì •ë³´ ì œê±°
        localStorage.removeItem('currentStudent');

        await fetch("/logout", {
          method: "POST",
          headers: { "Content-Type": "application/json" }
        });
      } catch (e) {
        console.error("logout error", e);
      } finally {
        if (bar && percent) {
          bar.style.width = '100%';
          percent.textContent = '100%';
        }
        if (progressTimer) clearInterval(progressTimer);

        setTimeout(() => {
          window.location.href = "/";
        }, 400);
      }
    }


    // âœ… íŽ˜ì´ì§€ ë¡œë“œ ì‹œ: ìœ ì €ì •ë³´ ë°˜ì˜ + ë’¤ë¡œê°€ê¸°ìš© ížˆìŠ¤í† ë¦¬ 1ë‹¨ê³„ ìŒ“ê¸°
    document.addEventListener('DOMContentLoaded', () => {
      // âœ… URL íŒŒë¼ë¯¸í„°ì—ì„œ gradeì™€ nameì„ ì½ì–´ì„œ localStorageì— ì €ìž¥ (ê´€ë¦¬ìž íŽ˜ì´ì§€ì—ì„œ ì´ë™ ì‹œ)
      const urlParams = new URLSearchParams(window.location.search);
      const gradeFromUrl = urlParams.get('grade');
      const nameFromUrl = urlParams.get('name');

      if (gradeFromUrl && nameFromUrl) {
        console.log('ðŸ“¥ URLì—ì„œ í•™ìƒ ì •ë³´ ê°ì§€:', gradeFromUrl, nameFromUrl);
        const studentData = {
          grade: gradeFromUrl,
          name: nameFromUrl
        };
        localStorage.setItem('currentStudent', JSON.stringify(studentData));
        console.log('âœ… currentStudent ì €ìž¥ ì™„ë£Œ');
      } else {
        console.log('â„¹ï¸ URL íŒŒë¼ë¯¸í„° ì—†ìŒ - ê¸°ì¡´ localStorage ì‚¬ìš©');
      }

      showUserInfo();

      // í˜„ìž¬ ë©”ë‰´ íŽ˜ì´ì§€ë¥¼ í•œ ë²ˆ ë” pushí•´ì„œ,
      // ì²« ë²ˆì§¸ ë’¤ë¡œê°€ê¸°ëŠ” popstateë§Œ ë°œìƒí•˜ê³  í™”ë©´ì€ ê·¸ëŒ€ë¡œ ìžˆê²Œ ë§Œë“¤ê¸°
      if (window.history && window.history.pushState) {
        history.pushState({ page: 'menu' }, '', location.href);
      }

      // âœ… AI ê³¼ì œ ì•Œë¦¼ ì²´í¬ (ë‹¹ì¼ ì²« ë¡œê·¸ì¸ë§Œ)
      checkAITaskNotification();

      // âœ… ê´€ë¦¬ìž ë¶€ì—¬ ê³¼ì œ í™•ì¸ íŒì—…
      checkAssignedTasks();

      // ðŸŽ‰ ë°°ê²½ ë¹ˆ ê³µê°„ í´ë¦­ ì‹œ í­ì£½ íš¨ê³¼ + í•™ìŠµ ì§„ë„ ê°±ì‹ 
      document.body.addEventListener('click', function(e) {
        // í´ë¦­í•œ ìš”ì†Œê°€ ë²„íŠ¼, ë§í¬, ìž…ë ¥ í•„ë“œ ë“±ì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ í­ì£½ ì‹¤í–‰
        const clickedElement = e.target;
        const isInteractiveElement = clickedElement.closest('button, a, input, select, textarea, .series-item, .domain-item, .subject-item, .unit-item');

        if (!isInteractiveElement) {
          // í´ë¦­ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í­ì£½ í„°ëœ¨ë¦¬ê¸°
          const x = e.clientX / window.innerWidth;
          const y = e.clientY / window.innerHeight;

          confetti({
            particleCount: 150,
            spread: 80,
            origin: { x: x, y: y },
            colors: ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#ffd700', '#ff6b6b']
          });

          // ðŸ”„ í­ì£½ íš¨ê³¼ í›„ í•™ìŠµ ì™„ë£Œ ìƒíƒœ ê°±ì‹  (íŽ˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì—†ì´)
          setTimeout(async () => {
            console.log('ðŸ”„ ì„œë²„ì—ì„œ ìµœì‹  ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” ì¤‘...');
            await syncCompletionStatusFromServer(); // ì„œë²„ì—ì„œ ìµœì‹  ì™„ë£Œ ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
            console.log('ðŸ”„ UI ì—…ë°ì´íŠ¸ ì¤‘...');
            restoreProgressOnRenderedList(); // UIì— ë°˜ì˜
            console.log('âœ… í•™ìŠµ ì§„ë„ ê°±ì‹  ì™„ë£Œ!');
          }, 800); // í­ì£½ íš¨ê³¼ ê°ìƒ í›„ ì—…ë°ì´íŠ¸
        }
      });
    });

    // === AI ê³¼ì œ ì•Œë¦¼ ì²´í¬ (ë‹¹ì¼ ì²« ë¡œê·¸ì¸ë§Œ) ===
    async function checkAITaskNotification() {
      try {
        const user = JSON.parse(localStorage.getItem('currentStudent') || '{}');
        if (!user.grade || !user.name) return;

        const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
        const lastNotificationDate = localStorage.getItem('lastAINotificationDate');

        // ì˜¤ëŠ˜ ì´ë¯¸ ì•Œë¦¼ì„ ë°›ì•˜ìœ¼ë©´ í‘œì‹œ ì•ˆ í•¨
        if (lastNotificationDate === today) {
          console.log('ðŸ”” AI ê³¼ì œ ì•Œë¦¼: ì´ë¯¸ ì˜¤ëŠ˜ í™•ì¸í•¨');
          return;
        }

        // ë§ˆì§€ë§‰ AI ë¶€ì—¬ ì‹œê°„ ì¡°íšŒ
        const response = await fetch(`/api/ai-task/last-assigned?grade=${encodeURIComponent(user.grade)}&name=${encodeURIComponent(user.name)}`);
        const data = await response.json();

        if (data.ok && data.lastAIAssignedAt) {
          const lastAssigned = new Date(data.lastAIAssignedAt).toISOString().split('T')[0];

          // ì˜¤ëŠ˜ AIê°€ ê³¼ì œë¥¼ ë¶€ì—¬í–ˆìœ¼ë©´ ì•Œë¦¼ í‘œì‹œ
          if (lastAssigned === today) {
            showMessage(
              'ðŸ¤–',
              'AIê³ ëž˜ìŒ¤ì´ ìƒˆ ê³¼ì œë¥¼ ì¶”ì²œí–ˆì–´ìš”!',
              'í•™ìŠµì‹¤ì„ í™•ì¸í•´ë³´ì„¸ìš”. ë§žì¶¤í˜• ë³µìŠµ ê³¼ì œê°€ ì¤€ë¹„ë˜ì–´ ìžˆìŠµë‹ˆë‹¤.'
            );

            // ì˜¤ëŠ˜ ì•Œë¦¼ í‘œì‹œí–ˆìŒì„ ê¸°ë¡
            localStorage.setItem('lastAINotificationDate', today);
            console.log('ðŸ”” AI ê³¼ì œ ì•Œë¦¼: ìƒˆ ê³¼ì œ ì•Œë¦¼ í‘œì‹œ');
          }
        }
      } catch (error) {
        console.error('âŒ AI ê³¼ì œ ì•Œë¦¼ ì²´í¬ ì˜¤ë¥˜:', error);
      }
    }

    // === ê´€ë¦¬ìž ë¶€ì—¬ ê³¼ì œ í™•ì¸ íŒì—… ===
    async function checkAssignedTasks() {
      try {
        const user = JSON.parse(localStorage.getItem('currentStudent') || '{}');
        if (!user.grade || !user.name) return;

        const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
        const taskPopupHideDate = localStorage.getItem('taskPopupHideDate');

        // "ì˜¤ëŠ˜ í•˜ë£¨ ë³´ì§€ ì•Šê¸°"ë¥¼ ì„ íƒí–ˆìœ¼ë©´ í‘œì‹œ ì•ˆ í•¨
        if (taskPopupHideDate === today) {
          console.log('ðŸ“‹ ê³¼ì œ íŒì—…: ì˜¤ëŠ˜ í•˜ë£¨ ë³´ì§€ ì•Šê¸° ì„¤ì •ë¨');
          return;
        }

        // ê³¼ì œ ëª©ë¡ ì¡°íšŒ
        const response = await fetch(`/api/user-progress/study-room?grade=${encodeURIComponent(user.grade)}&name=${encodeURIComponent(user.name)}`);
        const data = await response.json();

        if (data.ok && data.assignedTasks && data.assignedTasks.length > 0) {
          const pendingTasks = data.assignedTasks.filter(t => t.status === 'pending');

          if (pendingTasks.length > 0) {
            showAssignedTasksPopup(pendingTasks);
          }
        }
      } catch (error) {
        console.error('âŒ ê³¼ì œ í™•ì¸ ì˜¤ë¥˜:', error);
      }
    }

    // ê³¼ì œ íŒì—… í‘œì‹œ í•¨ìˆ˜
    function showAssignedTasksPopup(tasks) {
      const overlay = document.createElement('div');
      overlay.className = 'overlay';
      overlay.id = 'assignedTasksOverlay';
      overlay.style.display = 'flex';
      overlay.style.zIndex = '10000';

      const taskList = tasks.slice(0, 5).map(task =>
        `<li>ðŸ“š ${task.field} > ${task.subject} > ${task.title || task.unitId}</li>`
      ).join('');

      const moreText = tasks.length > 5 ? `<p style="color: #6b7280; font-size: 14px; margin-top: 8px;">ì™¸ ${tasks.length - 5}ê°œ ë” ìžˆìŠµë‹ˆë‹¤</p>` : '';

      overlay.innerHTML = `
        <div class="assign-modal">
          <div class="assign-modal-header">
            <h3>ðŸ“š ìƒˆë¡œìš´ ê³¼ì œê°€ ìžˆìŠµë‹ˆë‹¤!</h3>
          </div>
          <div class="assign-modal-body">
            <p style="margin-bottom: 12px;">ì´ <strong>${tasks.length}ê°œ</strong>ì˜ ê³¼ì œê°€ ë¶€ì—¬ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            <ul style="text-align: left; padding-left: 20px; margin: 12px 0;">
              ${taskList}
            </ul>
            ${moreText}
            <p style="margin-top: 16px;">ì¢Œì¸¡ ìƒë‹¨ì˜ <strong>í•™ìŠµì‹¤</strong>ì—ì„œ í™•ì¸í•˜ì„¸ìš”!</p>
          </div>
          <div class="assign-modal-footer">
            <button class="btn-cancel" id="hideTodayBtn">ì˜¤ëŠ˜ í•˜ë£¨ ë³´ì§€ ì•Šê¸°</button>
            <button class="btn-confirm" id="confirmTaskBtn">í™•ì¸</button>
          </div>
        </div>
      `;

      document.body.appendChild(overlay);

      // í™•ì¸ ë²„íŠ¼
      document.getElementById('confirmTaskBtn').addEventListener('click', () => {
        document.body.removeChild(overlay);
      });

      // ì˜¤ëŠ˜ í•˜ë£¨ ë³´ì§€ ì•Šê¸° ë²„íŠ¼
      document.getElementById('hideTodayBtn').addEventListener('click', () => {
        const today = new Date().toISOString().split('T')[0];
        localStorage.setItem('taskPopupHideDate', today);
        document.body.removeChild(overlay);
        console.log('ðŸ“‹ ê³¼ì œ íŒì—…: ì˜¤ëŠ˜ í•˜ë£¨ ë³´ì§€ ì•Šê¸° ì„¤ì •');
      });

      // ì˜¤ë²„ë ˆì´ í´ë¦­ ì‹œ ë‹«ê¸°
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
          document.body.removeChild(overlay);
        }
      });
    }

    // âœ… ì‹¤ì œ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ê³µìš© í•¨ìˆ˜ (í—¤ë” ë²„íŠ¼/ë’¤ë¡œê°€ê¸° ê³µìš© ì‚¬ìš©)
    async function doLogoutWithAnimation() {
      const overlay = document.getElementById('loadingOverlay');
      const bar = document.getElementById('loadingBar');
      const percent = document.getElementById('loadingPercent');
      const emoji = document.querySelector('.loading-emoji');
      const title = document.querySelector('.loading-title');
      const msg = document.querySelector('.loading-msg');

      // ðŸ”„ ë¡œë”© ì˜¤ë²„ë ˆì´ë¥¼ "ë¡œê·¸ì•„ì›ƒ ëª¨ë“œ"ë¡œ ì‚¬ìš©
      if (overlay && bar && percent) {
        overlay.classList.add('show');
        if (emoji) emoji.textContent = 'ðŸšª';
        if (title) title.textContent = 'ë¡œê·¸ì•„ì›ƒ ì¤‘...';
        if (msg) msg.textContent = 'ìž ì‹œ í›„ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.';

        bar.style.width = '0%';
        percent.textContent = '0%';
      }

      let progressTimer = null;
      if (bar && percent) {
        progressTimer = setInterval(() => {
          let current = parseInt(percent.textContent) || 0;
          if (current < 95) {
            current += 5;
            bar.style.width = current + '%';
            percent.textContent = current + '%';
          }
        }, 80);
      }

      try {
        // í˜„ìž¬ í•™ìƒ ì •ë³´ ì œê±°
        localStorage.removeItem('currentStudent');

        await fetch("/logout", {
          method: "POST",
          headers: { "Content-Type": "application/json" }
        });
      } catch (e) {
        console.error("logout error", e);
      } finally {
        if (bar && percent) {
          bar.style.width = '100%';
          percent.textContent = '100%';
        }
        if (progressTimer) clearInterval(progressTimer);

        setTimeout(() => {
          window.location.href = "/";
        }, 400);
      }
    }

async function performLogout() {
  const btn = document.getElementById('logoutBtn');
  const overlay = document.getElementById('loadingOverlay');
  const bar = document.getElementById('loadingBar');
  const percent = document.getElementById('loadingPercent');
  const emoji = document.querySelector('.loading-emoji');
  const title = document.querySelector('.loading-title');
  const msg = document.querySelector('.loading-msg');

  if (overlay && bar && percent) {
    overlay.classList.add('show');
    if (emoji) emoji.textContent = 'ðŸšª';
    if (title) title.textContent = 'ë¡œê·¸ì•„ì›ƒ ì¤‘...';
    if (msg) msg.textContent = 'ìž ì‹œ í›„ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.';

    bar.style.width = '0%';
    percent.textContent = '0%';
  }

  if (btn) btn.disabled = true;

  let progressTimer = null;
  if (bar && percent) {
    progressTimer = setInterval(() => {
      let current = parseInt(percent.textContent) || 0;
      if (current < 95) {
        current += 5;
        bar.style.width = current + '%';
        percent.textContent = current + '%';
      }
    }, 80);
  }

  try {
    localStorage.removeItem('currentStudent');

    await fetch("/logout", {
      method: "POST",
      headers: { "Content-Type": "application/json" }
    });
  } catch (e) {
    console.error("logout error", e);
  } finally {
    if (bar && percent) {
      bar.style.width = '100%';
      percent.textContent = '100%';
    }
    if (progressTimer) clearInterval(progressTimer);

    setTimeout(() => {
      window.location.href = "/";
    }, 400);
  }
}


    // âœ… ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ë™ìž‘ (ì»¤ìŠ¤í…€ ëª¨ë‹¬ ì‚¬ìš©)
    (function setupLogout() {
      const btn = document.getElementById('logoutBtn');
      const modal = document.getElementById('logoutConfirm');
      const cancelBtn = document.getElementById('logoutCancelBtn');
      const okBtn = document.getElementById('logoutOkBtn');

      if (!btn || !modal || !cancelBtn || !okBtn) return;

      // 1) ë©”ë‰´ ìƒë‹¨ ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ í´ë¦­ â†’ ëª¨ë‹¬ ì—´ê¸°
      btn.addEventListener('click', () => {
        modal.classList.add('show');
      });

      // 2) ì·¨ì†Œ ë²„íŠ¼ â†’ ëª¨ë‹¬ ë‹«ê¸°
      cancelBtn.addEventListener('click', () => {
        modal.classList.remove('show');
      });

      // 3) ë°”ê¹¥ ê²€ì€ ì˜ì—­ í´ë¦­ â†’ ëª¨ë‹¬ ë‹«ê¸°
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.classList.remove('show');
        }
      });

      // 4) í™•ì¸(ë¡œê·¸ì•„ì›ƒ) ë²„íŠ¼ â†’ ì‹¤ì œ ë¡œê·¸ì•„ì›ƒ ì‹¤í–‰
      okBtn.addEventListener('click', async () => {
        modal.classList.remove('show');
        btn.disabled = true;     // ì¤‘ë³µ í´ë¦­ ë°©ì§€
        await doLogoutWithAnimation();
      });
    })();

    // ðŸ”™ ë¸Œë¼ìš°ì € ë’¤ë¡œê°€ê¸° ì¸í„°ì…‰íŠ¸
    window.addEventListener('popstate', (event) => {
      // menu.html ì—ì„œë§Œ ë™ìž‘ (í˜¹ì‹œ ë‹¤ë¥¸ íŽ˜ì´ì§€ì—ì„œ ì„žì´ì§€ ì•Šê²Œ)
      if (!location.pathname.includes('menu')) return;

      const ok = confirm('ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');

      if (ok) {
        // ë’¤ë¡œê°€ê¸°ì—ì„œ í™•ì¸ ëˆ„ë¥´ë©´ ë°”ë¡œ ë¡œê·¸ì•„ì›ƒ ì‹¤í–‰
        doLogoutWithAnimation();
      } else {
        // ì·¨ì†Œí•˜ë©´ ë‹¤ì‹œ ížˆìŠ¤í† ë¦¬ ìŒ“ì•„ì„œ í™”ë©´ ìœ ì§€
        if (window.history && window.history.pushState) {
          history.pushState({ page: 'menu' }, '', location.href);
        }
      }
    });

    // ì‹œìž‘ì€ ì„¸ì¢… ì‹œë¦¬ì¦ˆ
    renderDomains("BRAINON");

    // === í—¤ë” í´ë¦­ ì‹œ í­ì£½ íš¨ê³¼ ===
    let jsConfetti = null;

    // JS Confetti ì¸ìŠ¤í„´ìŠ¤ ì´ˆê¸°í™”
    if (typeof JSConfetti !== 'undefined') {
      jsConfetti = new JSConfetti();
    }

    // í—¤ë” ì˜ì—­ì—ë§Œ ì´ë²¤íŠ¸ ì¶”ê°€
    const menuHeader = document.getElementById('menuHeader');
    if (menuHeader) {
      menuHeader.addEventListener('click', function(e) {
        // ë²„íŠ¼, ë§í¬ ë“± ìƒí˜¸ìž‘ìš© ìš”ì†Œë¥¼ í´ë¦­í•œ ê²½ìš°ëŠ” ì œì™¸
        const clickedElement = e.target;
        const isInteractiveElement =
          clickedElement.tagName === 'BUTTON' ||
          clickedElement.tagName === 'A' ||
          clickedElement.tagName === 'INPUT' ||
          clickedElement.closest('button') ||
          clickedElement.closest('a');

        if (!isInteractiveElement) {
          console.log('ðŸŽ‰ í—¤ë” í´ë¦­ - í­ì£½ íš¨ê³¼!');

          if (jsConfetti) {
            jsConfetti.addConfetti({
              emojis: ['ðŸ“š', 'ðŸ‹', 'âœ¨', 'ðŸŽ‰', 'ðŸŽŠ', 'â­'],
              emojiSize: 30,
              confettiNumber: 30,
            });
          }
        }
      });
    }

    // === ê³ ëž˜ Coin ì‹œìŠ¤í…œ ===
    // ë‹¨ì› ì™„ë£Œ ë©”ì‹œì§€ë¥¼ ë°›ì•„ì„œ ì½”ì¸ ì¦ê°€ ì²˜ë¦¬ + ì™„ë£Œ ìƒíƒœ ì €ìž¥
    window.addEventListener('message', function(event) {
      // ë³´ì•ˆ: ê°™ì€ originì—ì„œ ì˜¨ ë©”ì‹œì§€ë§Œ ì²˜ë¦¬
      if (event.origin !== window.location.origin) return;

      // ì–´íœ˜í€´ì¦ˆ ì™„ë£Œ ë©”ì‹œì§€ ì²˜ë¦¬
      if (event.data && event.data.type === 'vocabularyQuizCompleted') {
        console.log('âœ… ì–´íœ˜í€´ì¦ˆ ì™„ë£Œ ë©”ì‹œì§€ ìˆ˜ì‹ ');

        // ì–´íœ˜í€´ì¦ˆ íŒì—… ë‹«ê¸°
        closeVocabularyQuiz();

        // í•™ìŠµì‹¤ ëª¨ë‹¬ì´ ì—´ë ¤ìžˆë‹¤ë©´ ë¦¬ìŠ¤íŠ¸ ë‹¤ì‹œ ë Œë”ë§
        const studyRoomModal = document.getElementById('studyRoomModal');
        if (studyRoomModal && studyRoomModal.classList.contains('show')) {
          renderStudyRoomList();
          console.log('ðŸ”„ ì–´íœ˜í€´ì¦ˆ ì™„ë£Œ - í•™ìŠµì‹¤ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸');
        }

        return;
      }

      if (event.data && event.data.type === 'UNIT_COMPLETED') {
        // í˜„ìž¬ ì—´ë ¤ìžˆëŠ” ë‹¨ì› ê²½ë¡œ ê°€ì ¸ì˜¤ê¸°
        const currentUnitPath = sessionStorage.getItem('currentOpenUnit');
        if (!currentUnitPath) {
          console.log('âš ï¸ currentOpenUnit not found in sessionStorage');
          return;
        }

        // ê²½ë¡œì—ì„œ ë‹¨ì› ì½”ë“œ ì¶”ì¶œ (geo_01, geo_02 ë“±)
        const match = currentUnitPath.match(/\/([^\/]+)\.html$/);
        if (!match) {
          console.log('âš ï¸ Cannot extract unit code from path:', currentUnitPath);
          return;
        }
        const unitCode = match[1];

        // í•™ìƒ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const stu = getCurrentStudent();
        if (!stu) {
          console.log('âš ï¸ No student info found');
          return;
        }
        const stuKey = buildStudentKey(stu);

        // ì™„ë£Œ ì—¬ë¶€ í™•ì¸ - í•™ìŠµ íŽ˜ì´ì§€ì™€ ë™ì¼í•œ ë°©ì‹ ì‚¬ìš©
        const storageKey = `dan-progress:${stuKey}:${unitCode}`;
        let saved = [];
        try {
          const data = localStorage.getItem(storageKey);
          if (data) {
            saved = JSON.parse(data);
            if (!Array.isArray(saved)) saved = [];
          }
        } catch(e) {
          saved = [];
        }

        // ì´ë¯¸ ì™„ë£Œë˜ì—ˆëŠ”ì§€ ì²´í¬ (ë°°ì—´ì— ë°ì´í„°ê°€ ìžˆìœ¼ë©´ ì™„ë£Œ)
        const alreadyCompleted = saved.length > 0;

        if (!alreadyCompleted) {
          console.log(`âœ… ìƒˆë¡œìš´ ë‹¨ì› ì™„ë£Œ: ${unitCode}`);
        } else {
          console.log(`â„¹ï¸ ì´ë¯¸ ì™„ë£Œëœ ë‹¨ì›: ${unitCode}`);
        }

        // UI ì—…ë°ì´íŠ¸ (í•™ìŠµì™„ë£Œ ë°°ì§€ í‘œì‹œ)
        updateLessonStatus(currentUnitPath, 'done');

        // í•™ìŠµì‹¤ ëª¨ë‹¬ì´ ì—´ë ¤ìžˆë‹¤ë©´ ë¦¬ìŠ¤íŠ¸ ë‹¤ì‹œ ë Œë”ë§
        const studyRoomModal = document.getElementById('studyRoomModal');
        if (studyRoomModal && studyRoomModal.classList.contains('show')) {
          renderStudyRoomList();
          console.log('ðŸ”„ í•™ìŠµì‹¤ ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸');
        }
      }
    });

    // ===== ì‹œë¦¬ì¦ˆ í™œì„±í™”/ë¹„í™œì„±í™” ì²˜ë¦¬ =====
    function applySeriesRestrictions() {
      try {
        const user = JSON.parse(sessionStorage.getItem('user') || '{}');
        const assignedSeries = user.assignedSeries || [];

        console.log('ðŸ”’ Applying series restrictions:', assignedSeries);

        // ì‹œë¦¬ì¦ˆ ì´ë¦„ ë§¤í•‘ (ëª¨ë‹¬ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì´ë¦„ -> HTML data-series ê°’)
        const seriesMapping = {
          'BRAINì€': 'BRAINON',
          'BRAINì•”': 'BRAINUP',
          'BRAINë¹›': 'BRAINFIT',
          'BRAINë‹µ': 'BRAINDEEP',
          'BRAINì¤‘ë“±': 'BRAINM',
          'BRAINê³ ë“±': 'BRAINH',
          // ì—­ë°©í–¥ ë§¤í•‘ë„ ì¶”ê°€ (ì´ë¯¸ ì˜ë¬¸ IDì¸ ê²½ìš° ëŒ€ì‘)
          'BRAINON': 'BRAINON',
          'BRAINUP': 'BRAINUP',
          'BRAINFIT': 'BRAINFIT',
          'BRAINDEEP': 'BRAINDEEP',
          'BRAINM': 'BRAINM',
          'BRAINH': 'BRAINH'
        };

        // assignedSeriesë¥¼ data-series í˜•ì‹ìœ¼ë¡œ ë³€í™˜
        const allowedSeriesIds = assignedSeries.map(name => seriesMapping[name]).filter(Boolean);

        console.log('âœ… Allowed series IDs:', allowedSeriesIds);

        // ëª¨ë“  ì‹œë¦¬ì¦ˆ ì•„ì´í…œ í™•ì¸
        document.querySelectorAll("#seriesList .series-item").forEach(li => {
          const seriesId = li.dataset.series;

          if (allowedSeriesIds.includes(seriesId)) {
            // í™œì„±í™”
            li.classList.remove("disabled");
          } else {
            // ë¹„í™œì„±í™”
            li.classList.add("disabled");
          }
        });
      } catch (err) {
        console.error('âŒ Error applying series restrictions:', err);
      }
    }

    // ì‹œë¦¬ì¦ˆ ì œí•œ ì ìš©
    applySeriesRestrictions();

    // íŽ˜ì´ì§€ ì²˜ìŒ ì—´ë¦´ ë•Œë„ ì´ë¯¸ ì €ìž¥ë¼ ìžˆë˜ ì™„ë£Œ ë‚´ì—­ ìžˆìœ¼ë©´ ë°˜ì˜
    restoreProgressOnRenderedList();

    window.addEventListener("pageshow", async function (event) {
      // ë’¤ë¡œê°€ê¸° ìºì‹œì—ì„œ ëŒì•„ì˜¬ ë•Œ ë¡œë”© ê°€ë¦¬ê¸°
      document.getElementById("loadingOverlay")?.classList.remove("show");

      const stu = getCurrentStudent();

      // ðŸ” ë¡œê·¸ì•„ì›ƒ í›„ ë’¤ë¡œê°€ê¸° í•˜ë©´ ë¬´ì¡°ê±´ ë¡œê·¸ì¸ íŽ˜ì´ì§€ë¡œ ëŒë ¤ë³´ë‚´ê¸°
      if (!stu) {
        window.location.href = "/";
        return;
      }

      // ðŸ”„ ì„œë²„ì—ì„œ ìµœì‹  ì‚¬ìš©ìž ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ì‹œë¦¬ì¦ˆ ë¶€ì—¬ ì—…ë°ì´íŠ¸ ë°˜ì˜)
      if (stu && stu.grade && stu.name) {
        try {
          const res = await fetch(`/api/user-info?grade=${encodeURIComponent(stu.grade)}&name=${encodeURIComponent(stu.name)}`);
          if (res.ok) {
            const userData = await res.json();
            if (userData) {
              // sessionStorage ì—…ë°ì´íŠ¸
              sessionStorage.setItem('user', JSON.stringify(userData));
              console.log('âœ… User info updated from server:', userData);

              // ì‹œë¦¬ì¦ˆ ì œí•œ ë‹¤ì‹œ ì ìš©
              applySeriesRestrictions();
            }
          }
        } catch (err) {
          console.error('Failed to fetch updated user info:', err);
        }
      }

      // í•™ìƒ ì •ë³´ê°€ ìžˆìœ¼ë©´ í—¤ë” ë¬¸êµ¬ ë‹¤ì‹œ ê°±ì‹ 
      showUserInfo();

      // ðŸ”„ ì„œë²„ì—ì„œ ìµœì‹  ì™„ë£Œ ìƒíƒœ ë‹¤ì‹œ ê°€ì ¸ì˜¤ê¸° (ìƒˆë¡œ ì™„ë£Œëœ ë‹¨ì› ë°˜ì˜)
      await syncCompletionStatusFromServer();
      restoreProgressOnRenderedList();
    });

    // === ì¤€ë¹„ëœ ë‹¨ì› ëª©ë¡ (íŒŒì¼ ì¡´ìž¬ ì—¬ë¶€ í™•ì¸ìš©) ===
    const availableUnits = {
      './BRAINON/korlit/classic_01.html': true,
      './BRAINON/korlit/classic_02.html': true,
      './BRAINON/korlit/classic_03.html': true,
      './BRAINON/korlit/classic_04.html': true,
      './BRAINON/korlit/classic_05.html': true,
      './BRAINON/korlit/classic_06.html': true,
      './BRAINON/korlit/classic_07.html': true,
      './BRAINON/korlit/classic_08.html': true,
      './BRAINON/korlit/classic_09.html': true,
      './BRAINON/korlit/classic_10.html': true,
      './BRAINON/korlit/classic_11.html': true,
      './BRAINON/korlit/classic_12.html': true,
      './BRAINON/korlit/classic_13.html': true,
      './BRAINON/korlit/classic_14.html': true,
      './BRAINON/korlit/classic_15.html': true,
      './BRAINON/korlit/classic_16.html': true,
      './BRAINON/korlit/classic_17.html': true,
      './BRAINON/korlit/classic_18.html': true,
      './BRAINON/korlit/classic_19.html': true,
      './BRAINON/korlit/classic_20.html': true,
      './BRAINON/korlit/classic_21.html': true,
      './BRAINON/korlit/classic_22.html': true,
      './BRAINON/korlit/classic_23.html': true,
      './BRAINON/korlit/classic_24.html': true,
      './BRAINON/korlit/classic_25.html': true,
      './BRAINON/korlit/classic_26.html': true,
      './BRAINON/korlit/classic_27.html': true,
      './BRAINON/korlit/classic_28.html': true,
      './BRAINON/korlit/classic_29.html': true,
      './BRAINON/korlit/classic_30.html': true,
      './BRAINON/korlit/classic_31.html': true,
      './BRAINON/korlit/classic_32.html': true,
      './BRAINON/korlit/classic_33.html': true,
      './BRAINON/korlit/classic_34.html': true,
      './BRAINON/korlit/classic_35.html': true,
      './BRAINON/korlit/classic_36.html': true,
      './BRAINON/korlit/classic_37.html': true,
      './BRAINON/korlit/classic_38.html': true,
      './BRAINON/korlit/classic_39.html': true,
      './BRAINON/korlit/classic_40.html': true,
      './BRAINON/korlit/modern_01.html': true,
      './BRAINON/korlit/modern_02.html': true,
      './BRAINON/korlit/modern_03.html': true,
      './BRAINON/korlit/modern_04.html': true,
      './BRAINON/korlit/modern_05.html': true,
      './BRAINON/korlit/modern_06.html': true,
      './BRAINON/korlit/modern_07.html': true,
      './BRAINON/korlit/modern_08.html': true,
      './BRAINON/korlit/modern_09.html': true,
      './BRAINON/korlit/modern_10.html': true,
      './BRAINON/korlit/modern_11.html': true,
      './BRAINON/korlit/modern_12.html': true,
      './BRAINON/korlit/modern_13.html': true,
      './BRAINON/korlit/modern_14.html': true,
      './BRAINON/korlit/modern_15.html': true,
      './BRAINON/korlit/modern_16.html': true,
      './BRAINON/korlit/modern_17.html': true,
      './BRAINON/korlit/modern_18.html': true,
      './BRAINON/korlit/modern_19.html': true,
      './BRAINON/korlit/modern_20.html': true,
      './BRAINON/korlit/modern_21.html': true,
      './BRAINON/korlit/modern_22.html': true,
      './BRAINON/korlit/modern_23.html': true,
      './BRAINON/korlit/modern_24.html': true,
      './BRAINON/korlit/modern_25.html': true,
      './BRAINON/korlit/modern_26.html': true,
      './BRAINON/korlit/modern_27.html': true,
      './BRAINON/korlit/modern_28.html': true,
      './BRAINON/korlit/modern_29.html': true,
      './BRAINON/korlit/modern_30.html': true,
      './BRAINON/korlit/modern_31.html': true,
      './BRAINON/korlit/modern_32.html': true,
      './BRAINON/korlit/modern_33.html': true,
      './BRAINON/korlit/modern_34.html': true,
      './BRAINON/korlit/modern_35.html': true,
      './BRAINON/korlit/modern_36.html': true,
      './BRAINON/korlit/modern_37.html': true,
      './BRAINON/korlit/modern_38.html': true,
      './BRAINON/korlit/modern_39.html': true,
      './BRAINON/korlit/modern_40.html': true,
      './BRAINON/person/people_01.html': true,
      './BRAINON/person/people_02.html': true,
      './BRAINON/person/people_03.html': true,
      './BRAINON/person/people_04.html': true,
      './BRAINON/person/people_05.html': true,
      './BRAINON/person/people_06.html': true,
      './BRAINON/person/people_07.html': true,
      './BRAINON/person/people_08.html': true,
      './BRAINON/person/people_09.html': true,
      './BRAINON/person/people_10.html': true,
      './BRAINON/person/people_11.html': true,
      './BRAINON/person/people_12.html': true,
      './BRAINON/person/people_13.html': true,
      './BRAINON/person/people_14.html': true,
      './BRAINON/person/people_15.html': true,
      './BRAINON/person/people_16.html': true,
      './BRAINON/person/people_17.html': true,
      './BRAINON/person/people_18.html': true,
      './BRAINON/person/people_19.html': true,
      './BRAINON/person/people_20.html': true,
      './BRAINON/person/people_21.html': true,
      './BRAINON/person/people_22.html': true,
      './BRAINON/person/people_23.html': true,
      './BRAINON/person/people_24.html': true,
      './BRAINON/person/people_25.html': true,
      './BRAINON/person/people_26.html': true,
      './BRAINON/person/people_27.html': true,
      './BRAINON/person/people_28.html': true,
      './BRAINON/person/people_29.html': true,
      './BRAINON/person/people_30.html': true,
      './BRAINON/person/people_31.html': true,
      './BRAINON/person/people_32.html': true,
      './BRAINON/person/people_33.html': true,
      './BRAINON/person/people_34.html': true,
      './BRAINON/person/people_35.html': true,
      './BRAINON/person/people_36.html': true,
      './BRAINON/person/people_37.html': true,
      './BRAINON/person/people_38.html': true,
      './BRAINON/person/people_39.html': true,
      './BRAINON/person/people_40.html': true,
      './BRAINON/person/people_41.html': true,
      './BRAINON/person/people_42.html': true,
      './BRAINON/person/people_43.html': true,
      './BRAINON/person/people_44.html': true,
      './BRAINON/person/people_45.html': true,
      './BRAINON/person/people_46.html': true,
      './BRAINON/person/people_47.html': true,
      './BRAINON/person/people_48.html': true,
      './BRAINON/person/people_49.html': true,
      './BRAINON/person/people_50.html': true,
      './BRAINON/person/people_51.html': true,
      './BRAINON/person/people_52.html': true,
      './BRAINON/person/people_53.html': true,
      './BRAINON/person/people_54.html': true,
      './BRAINON/person/people_55.html': true,
      './BRAINON/person/people_56.html': true,
      './BRAINON/person/people_57.html': true,
      './BRAINON/person/people_58.html': true,
      './BRAINON/person/people_59.html': true,
      './BRAINON/person/people_60.html': true,
      './BRAINON/person/people_61.html': true,
      './BRAINON/person/people_62.html': true,
      './BRAINON/person/people_63.html': true,
      './BRAINON/person/people_64.html': true,
      './BRAINON/person/people_65.html': true,
      './BRAINON/person/people_66.html': true,
      './BRAINON/person/people_67.html': true,
      './BRAINON/person/people_68.html': true,
      './BRAINON/person/people_69.html': true,
      './BRAINON/person/people_70.html': true,
      './BRAINON/person/people_71.html': true,
      './BRAINON/person/people_72.html': true,
      './BRAINON/person/people_73.html': true,
      './BRAINON/person/people_74.html': true,
      './BRAINON/person/people_75.html': true,
      './BRAINON/person/people_76.html': true,
      './BRAINON/person/people_77.html': true,
      './BRAINON/person/people_78.html': true,
      './BRAINON/person/people_79.html': true,
      './BRAINON/person/people_80.html': true,
      './BRAINON/science/bio_01.html': true,
      './BRAINON/science/bio_02.html': true,
      './BRAINON/science/bio_03.html': true,
      './BRAINON/science/bio_04.html': true,
      './BRAINON/science/bio_05.html': true,
      './BRAINON/science/bio_06.html': true,
      './BRAINON/science/bio_07.html': true,
      './BRAINON/science/bio_08.html': true,
      './BRAINON/science/bio_09.html': true,
      './BRAINON/science/bio_10.html': true,
      './BRAINON/science/bio_11.html': true,
      './BRAINON/science/bio_12.html': true,
      './BRAINON/science/bio_13.html': true,
      './BRAINON/science/bio_14.html': true,
      './BRAINON/science/bio_15.html': true,
      './BRAINON/science/bio_16.html': true,
      './BRAINON/science/bio_17.html': true,
      './BRAINON/science/bio_18.html': true,
      './BRAINON/science/bio_19.html': true,
      './BRAINON/science/bio_20.html': true,
      './BRAINON/science/chem_01.html': true,
      './BRAINON/science/chem_02.html': true,
      './BRAINON/science/chem_03.html': true,
      './BRAINON/science/chem_04.html': true,
      './BRAINON/science/chem_05.html': true,
      './BRAINON/science/chem_06.html': true,
      './BRAINON/science/chem_07.html': true,
      './BRAINON/science/chem_08.html': true,
      './BRAINON/science/chem_09.html': true,
      './BRAINON/science/chem_10.html': true,
      './BRAINON/science/chem_11.html': true,
      './BRAINON/science/chem_12.html': true,
      './BRAINON/science/chem_13.html': true,
      './BRAINON/science/chem_14.html': true,
      './BRAINON/science/chem_15.html': true,
      './BRAINON/science/chem_16.html': true,
      './BRAINON/science/chem_17.html': true,
      './BRAINON/science/chem_18.html': true,
      './BRAINON/science/chem_19.html': true,
      './BRAINON/science/chem_20.html': true,
      './BRAINON/science/earth_01.html': true,
      './BRAINON/science/earth_02.html': true,
      './BRAINON/science/earth_03.html': true,
      './BRAINON/science/earth_04.html': true,
      './BRAINON/science/earth_05.html': true,
      './BRAINON/science/earth_06.html': true,
      './BRAINON/science/earth_07.html': true,
      './BRAINON/science/earth_08.html': true,
      './BRAINON/science/earth_09.html': true,
      './BRAINON/science/earth_10.html': true,
      './BRAINON/science/earth_11.html': true,
      './BRAINON/science/earth_12.html': true,
      './BRAINON/science/earth_13.html': true,
      './BRAINON/science/earth_14.html': true,
      './BRAINON/science/earth_15.html': true,
      './BRAINON/science/earth_16.html': true,
      './BRAINON/science/earth_17.html': true,
      './BRAINON/science/earth_18.html': true,
      './BRAINON/science/earth_19.html': true,
      './BRAINON/science/earth_20.html': true,
      './BRAINON/science/physics_01.html': true,
      './BRAINON/science/physics_02.html': true,
      './BRAINON/science/physics_03.html': true,
      './BRAINON/science/physics_04.html': true,
      './BRAINON/science/physics_05.html': true,
      './BRAINON/science/physics_06.html': true,
      './BRAINON/science/physics_07.html': true,
      './BRAINON/science/physics_08.html': true,
      './BRAINON/science/physics_09.html': true,
      './BRAINON/science/physics_10.html': true,
      './BRAINON/science/physics_11.html': true,
      './BRAINON/science/physics_12.html': true,
      './BRAINON/science/physics_13.html': true,
      './BRAINON/science/physics_14.html': true,
      './BRAINON/science/physics_15.html': true,
      './BRAINON/science/physics_16.html': true,
      './BRAINON/science/physics_17.html': true,
      './BRAINON/science/physics_18.html': true,
      './BRAINON/science/physics_19.html': true,
      './BRAINON/science/physics_20.html': true,
      './BRAINON/social/geo_01.html': true,
      './BRAINON/social/geo_02.html': true,
      './BRAINON/social/geo_03.html': true,
      './BRAINON/social/geo_04.html': true,
      './BRAINON/social/geo_05.html': true,
      './BRAINON/social/geo_06.html': true,
      './BRAINON/social/geo_07.html': true,
      './BRAINON/social/geo_08.html': true,
      './BRAINON/social/geo_09.html': true,
      './BRAINON/social/geo_10.html': true,
      './BRAINON/social/geo_11.html': true,
      './BRAINON/social/geo_12.html': true,
      './BRAINON/social/geo_13.html': true,
      './BRAINON/social/geo_14.html': true,
      './BRAINON/social/geo_15.html': true,
      './BRAINON/social/geo_16.html': true,
      './BRAINON/social/geo_17.html': true,
      './BRAINON/social/geo_18.html': true,
      './BRAINON/social/geo_19.html': true,
      './BRAINON/social/geo_20.html': true,
      './BRAINON/social/law_01.html': true,
      './BRAINON/social/law_02.html': true,
      './BRAINON/social/law_03.html': true,
      './BRAINON/social/law_04.html': true,
      './BRAINON/social/law_05.html': true,
      './BRAINON/social/law_06.html': true,
      './BRAINON/social/law_07.html': true,
      './BRAINON/social/law_08.html': true,
      './BRAINON/social/law_09.html': true,
      './BRAINON/social/law_10.html': true,
      './BRAINON/social/law_11.html': true,
      './BRAINON/social/law_12.html': true,
      './BRAINON/social/law_13.html': true,
      './BRAINON/social/law_14.html': true,
      './BRAINON/social/law_15.html': true,
      './BRAINON/social/law_16.html': true,
      './BRAINON/social/law_17.html': true,
      './BRAINON/social/law_18.html': true,
      './BRAINON/social/law_19.html': true,
      './BRAINON/social/law_20.html': true,
      './BRAINON/social/pol_01.html': true,
      './BRAINON/social/pol_02.html': true,
      './BRAINON/social/pol_03.html': true,
      './BRAINON/social/pol_04.html': true,
      './BRAINON/social/pol_05.html': true,
      './BRAINON/social/pol_06.html': true,
      './BRAINON/social/pol_07.html': true,
      './BRAINON/social/pol_08.html': true,
      './BRAINON/social/pol_09.html': true,
      './BRAINON/social/pol_10.html': true,
      './BRAINON/social/pol_11.html': true,
      './BRAINON/social/pol_12.html': true,
      './BRAINON/social/pol_13.html': true,
      './BRAINON/social/pol_14.html': true,
      './BRAINON/social/pol_15.html': true,
      './BRAINON/social/pol_16.html': true,
      './BRAINON/social/pol_17.html': true,
      './BRAINON/social/pol_18.html': true,
      './BRAINON/social/pol_19.html': true,
      './BRAINON/social/pol_20.html': true,
      './BRAINON/social/soc_01.html': true,
      './BRAINON/social/soc_02.html': true,
      './BRAINON/social/soc_03.html': true,
      './BRAINON/social/soc_04.html': true,
      './BRAINON/social/soc_05.html': true,
      './BRAINON/social/soc_06.html': true,
      './BRAINON/social/soc_07.html': true,
      './BRAINON/social/soc_08.html': true,
      './BRAINON/social/soc_09.html': true,
      './BRAINON/social/soc_10.html': true,
      './BRAINON/social/soc_11.html': true,
      './BRAINON/social/soc_12.html': true,
      './BRAINON/social/soc_13.html': true,
      './BRAINON/social/soc_14.html': true,
      './BRAINON/social/soc_15.html': true,
      './BRAINON/social/soc_16.html': true,
      './BRAINON/social/soc_17.html': true,
      './BRAINON/social/soc_18.html': true,
      './BRAINON/social/soc_19.html': true,
      './BRAINON/social/soc_20.html': true,
      './BRAINON/worldlit/world_01.html': true,
      './BRAINON/worldlit/world_02.html': true,
      './BRAINON/worldlit/world_03.html': true,
      './BRAINON/worldlit/world_04.html': true,
      './BRAINON/worldlit/world_05.html': true,
      './BRAINON/worldlit/world_06.html': true,
      './BRAINON/worldlit/world_07.html': true,
      './BRAINON/worldlit/world_08.html': true,
      './BRAINON/worldlit/world_09.html': true,
      './BRAINON/worldlit/world_10.html': true,
      './BRAINON/worldlit/world_11.html': true,
      './BRAINON/worldlit/world_12.html': true,
      './BRAINON/worldlit/world_13.html': true,
      './BRAINON/worldlit/world_14.html': true,
      './BRAINON/worldlit/world_15.html': true,
      './BRAINON/worldlit/world_16.html': true,
      './BRAINON/worldlit/world_17.html': true,
      './BRAINON/worldlit/world_18.html': true,
      './BRAINON/worldlit/world_19.html': true,
      './BRAINON/worldlit/world_20.html': true,
      './BRAINON/worldlit/world_21.html': true,
      './BRAINON/worldlit/world_22.html': true,
      './BRAINON/worldlit/world_23.html': true,
      './BRAINON/worldlit/world_24.html': true,
      './BRAINON/worldlit/world_25.html': true,
      './BRAINON/worldlit/world_26.html': true,
      './BRAINON/worldlit/world_27.html': true,
      './BRAINON/worldlit/world_28.html': true,
      './BRAINON/worldlit/world_29.html': true,
      './BRAINON/worldlit/world_30.html': true,
      './BRAINON/worldlit/world_31.html': true,
      './BRAINON/worldlit/world_32.html': true,
      './BRAINON/worldlit/world_33.html': true,
      './BRAINON/worldlit/world_34.html': true,
      './BRAINON/worldlit/world_35.html': true,
      './BRAINON/worldlit/world_36.html': true,
      './BRAINON/worldlit/world_37.html': true,
      './BRAINON/worldlit/world_38.html': true,
      './BRAINON/worldlit/world_39.html': true,
      './BRAINON/worldlit/world_40.html': true,
      './BRAINON/worldlit/world_41.html': true,
      './BRAINON/worldlit/world_42.html': true,
      './BRAINON/worldlit/world_43.html': true,
      './BRAINON/worldlit/world_44.html': true,
      './BRAINON/worldlit/world_45.html': true,
      './BRAINON/worldlit/world_46.html': true,
      './BRAINON/worldlit/world_47.html': true,
      './BRAINON/worldlit/world_48.html': true,
      './BRAINON/worldlit/world_49.html': true,
      './BRAINON/worldlit/world_50.html': true,
      './BRAINON/worldlit/world_51.html': true,
      './BRAINON/worldlit/world_52.html': true,
      './BRAINON/worldlit/world_53.html': true,
      './BRAINON/worldlit/world_54.html': true,
      './BRAINON/worldlit/world_55.html': true,
      './BRAINON/worldlit/world_56.html': true,
      './BRAINON/worldlit/world_57.html': true,
      './BRAINON/worldlit/world_58.html': true,
      './BRAINON/worldlit/world_59.html': true,
      './BRAINON/worldlit/world_60.html': true,
      './BRAINON/worldlit/world_61.html': true,
      './BRAINON/worldlit/world_62.html': true,
      './BRAINON/worldlit/world_63.html': true,
      './BRAINON/worldlit/world_64.html': true,
      './BRAINON/worldlit/world_65.html': true,
      './BRAINON/worldlit/world_66.html': true,
      './BRAINON/worldlit/world_67.html': true,
      './BRAINON/worldlit/world_68.html': true,
      './BRAINON/worldlit/world_69.html': true,
      './BRAINON/worldlit/world_70.html': true,
      './BRAINON/worldlit/world_71.html': true,
      './BRAINON/worldlit/world_72.html': true,
      './BRAINON/worldlit/world_73.html': true,
      './BRAINON/worldlit/world_74.html': true,
      './BRAINON/worldlit/world_75.html': true,
      './BRAINON/worldlit/world_76.html': true,
      './BRAINON/worldlit/world_77.html': true,
      './BRAINON/worldlit/world_78.html': true,
      './BRAINON/worldlit/world_79.html': true,
      './BRAINON/worldlit/world_80.html': true,
      './BRAINUP/korlit/classic_01.html': true,
      './BRAINUP/korlit/classic_02.html': true,
      './BRAINUP/korlit/classic_03.html': true,
      './BRAINUP/korlit/classic_04.html': true,
      './BRAINUP/korlit/classic_05.html': true,
      './BRAINUP/korlit/classic_06.html': true,
      './BRAINUP/korlit/classic_07.html': true,
      './BRAINUP/korlit/classic_08.html': true,
      './BRAINUP/korlit/classic_09.html': true,
      './BRAINUP/korlit/classic_10.html': true,
      './BRAINUP/korlit/classic_11.html': true,
      './BRAINUP/korlit/classic_12.html': true,
      './BRAINUP/korlit/classic_13.html': true,
      './BRAINUP/korlit/classic_14.html': true,
      './BRAINUP/korlit/classic_15.html': true,
      './BRAINUP/korlit/classic_16.html': true,
      './BRAINUP/korlit/classic_17.html': true,
      './BRAINUP/korlit/classic_18.html': true,
      './BRAINUP/korlit/classic_19.html': true,
      './BRAINUP/korlit/classic_20.html': true,
      './BRAINUP/korlit/classic_21.html': true,
      './BRAINUP/korlit/classic_22.html': true,
      './BRAINUP/korlit/classic_23.html': true,
      './BRAINUP/korlit/classic_24.html': true,
      './BRAINUP/korlit/classic_25.html': true,
      './BRAINUP/korlit/classic_26.html': true,
      './BRAINUP/korlit/classic_27.html': true,
      './BRAINUP/korlit/classic_28.html': true,
      './BRAINUP/korlit/classic_29.html': true,
      './BRAINUP/korlit/classic_30.html': true,
      './BRAINUP/korlit/classic_31.html': true,
      './BRAINUP/korlit/classic_32.html': true,
      './BRAINUP/korlit/classic_33.html': true,
      './BRAINUP/korlit/classic_34.html': true,
      './BRAINUP/korlit/classic_35.html': true,
      './BRAINUP/korlit/classic_36.html': true,
      './BRAINUP/korlit/classic_37.html': true,
      './BRAINUP/korlit/classic_38.html': true,
      './BRAINUP/korlit/classic_39.html': true,
      './BRAINUP/korlit/classic_40.html': true,
      './BRAINUP/korlit/modern_01.html': true,
      './BRAINUP/korlit/modern_02.html': true,
      './BRAINUP/korlit/modern_03.html': true,
      './BRAINUP/korlit/modern_04.html': true,
      './BRAINUP/korlit/modern_05.html': true,
      './BRAINUP/korlit/modern_06.html': true,
      './BRAINUP/korlit/modern_07.html': true,
      './BRAINUP/korlit/modern_08.html': true,
      './BRAINUP/korlit/modern_09.html': true,
      './BRAINUP/korlit/modern_10.html': true,
      './BRAINUP/korlit/modern_11.html': true,
      './BRAINUP/korlit/modern_12.html': true,
      './BRAINUP/korlit/modern_13.html': true,
      './BRAINUP/korlit/modern_14.html': true,
      './BRAINUP/korlit/modern_15.html': true,
      './BRAINUP/korlit/modern_16.html': true,
      './BRAINUP/korlit/modern_17.html': true,
      './BRAINUP/korlit/modern_18.html': true,
      './BRAINUP/korlit/modern_19.html': true,
      './BRAINUP/korlit/modern_20.html': true,
      './BRAINUP/korlit/modern_21.html': true,
      './BRAINUP/korlit/modern_22.html': true,
      './BRAINUP/korlit/modern_23.html': true,
      './BRAINUP/korlit/modern_24.html': true,
      './BRAINUP/korlit/modern_25.html': true,
      './BRAINUP/korlit/modern_26.html': true,
      './BRAINUP/korlit/modern_27.html': true,
      './BRAINUP/korlit/modern_28.html': true,
      './BRAINUP/korlit/modern_29.html': true,
      './BRAINUP/korlit/modern_30.html': true,
      './BRAINUP/korlit/modern_31.html': true,
      './BRAINUP/korlit/modern_32.html': true,
      './BRAINUP/korlit/modern_33.html': true,
      './BRAINUP/korlit/modern_34.html': true,
      './BRAINUP/korlit/modern_35.html': true,
      './BRAINUP/korlit/modern_36.html': true,
      './BRAINUP/korlit/modern_37.html': true,
      './BRAINUP/korlit/modern_38.html': true,
      './BRAINUP/korlit/modern_39.html': true,
      './BRAINUP/korlit/modern_40.html': true,
      './BRAINUP/person/people_01.html': true,
      './BRAINUP/person/people_02.html': true,
      './BRAINUP/person/people_03.html': true,
      './BRAINUP/person/people_04.html': true,
      './BRAINUP/person/people_05.html': true,
      './BRAINUP/person/people_06.html': true,
      './BRAINUP/person/people_07.html': true,
      './BRAINUP/person/people_08.html': true,
      './BRAINUP/person/people_09.html': true,
      './BRAINUP/person/people_10.html': true,
      './BRAINUP/person/people_11.html': true,
      './BRAINUP/person/people_12.html': true,
      './BRAINUP/person/people_13.html': true,
      './BRAINUP/person/people_14.html': true,
      './BRAINUP/person/people_15.html': true,
      './BRAINUP/person/people_16.html': true,
      './BRAINUP/person/people_17.html': true,
      './BRAINUP/person/people_18.html': true,
      './BRAINUP/person/people_19.html': true,
      './BRAINUP/person/people_20.html': true,
      './BRAINUP/person/people_21.html': true,
      './BRAINUP/person/people_22.html': true,
      './BRAINUP/person/people_23.html': true,
      './BRAINUP/person/people_24.html': true,
      './BRAINUP/person/people_25.html': true,
      './BRAINUP/person/people_26.html': true,
      './BRAINUP/person/people_27.html': true,
      './BRAINUP/person/people_28.html': true,
      './BRAINUP/person/people_29.html': true,
      './BRAINUP/person/people_30.html': true,
      './BRAINUP/person/people_31.html': true,
      './BRAINUP/person/people_32.html': true,
      './BRAINUP/person/people_33.html': true,
      './BRAINUP/person/people_34.html': true,
      './BRAINUP/person/people_35.html': true,
      './BRAINUP/person/people_36.html': true,
      './BRAINUP/person/people_37.html': true,
      './BRAINUP/person/people_38.html': true,
      './BRAINUP/person/people_39.html': true,
      './BRAINUP/person/people_40.html': true,
      './BRAINUP/person/people_41.html': true,
      './BRAINUP/person/people_42.html': true,
      './BRAINUP/person/people_43.html': true,
      './BRAINUP/person/people_44.html': true,
      './BRAINUP/person/people_45.html': true,
      './BRAINUP/person/people_46.html': true,
      './BRAINUP/person/people_47.html': true,
      './BRAINUP/person/people_48.html': true,
      './BRAINUP/person/people_49.html': true,
      './BRAINUP/person/people_50.html': true,
      './BRAINUP/person/people_51.html': true,
      './BRAINUP/person/people_52.html': true,
      './BRAINUP/person/people_53.html': true,
      './BRAINUP/person/people_54.html': true,
      './BRAINUP/person/people_55.html': true,
      './BRAINUP/person/people_56.html': true,
      './BRAINUP/person/people_57.html': true,
      './BRAINUP/person/people_58.html': true,
      './BRAINUP/person/people_59.html': true,
      './BRAINUP/person/people_60.html': true,
      './BRAINUP/person/people_61.html': true,
      './BRAINUP/person/people_62.html': true,
      './BRAINUP/person/people_63.html': true,
      './BRAINUP/person/people_64.html': true,
      './BRAINUP/person/people_65.html': true,
      './BRAINUP/person/people_66.html': true,
      './BRAINUP/person/people_67.html': true,
      './BRAINUP/person/people_68.html': true,
      './BRAINUP/person/people_69.html': true,
      './BRAINUP/person/people_70.html': true,
      './BRAINUP/person/people_71.html': true,
      './BRAINUP/person/people_72.html': true,
      './BRAINUP/person/people_73.html': true,
      './BRAINUP/person/people_74.html': true,
      './BRAINUP/person/people_75.html': true,
      './BRAINUP/person/people_76.html': true,
      './BRAINUP/person/people_77.html': true,
      './BRAINUP/person/people_78.html': true,
      './BRAINUP/person/people_79.html': true,
      './BRAINUP/person/people_80.html': true,
      './BRAINUP/science/bio_01.html': true,
      './BRAINUP/science/bio_02.html': true,
      './BRAINUP/science/bio_03.html': true,
      './BRAINUP/science/bio_04.html': true,
      './BRAINUP/science/bio_05.html': true,
      './BRAINUP/science/bio_06.html': true,
      './BRAINUP/science/bio_07.html': true,
      './BRAINUP/science/bio_08.html': true,
      './BRAINUP/science/bio_09.html': true,
      './BRAINUP/science/bio_10.html': true,
      './BRAINUP/science/bio_11.html': true,
      './BRAINUP/science/bio_12.html': true,
      './BRAINUP/science/bio_13.html': true,
      './BRAINUP/science/bio_14.html': true,
      './BRAINUP/science/bio_15.html': true,
      './BRAINUP/science/bio_16.html': true,
      './BRAINUP/science/bio_17.html': true,
      './BRAINUP/science/bio_18.html': true,
      './BRAINUP/science/bio_19.html': true,
      './BRAINUP/science/bio_20.html': true,
      './BRAINUP/science/chem_01.html': true,
      './BRAINUP/science/chem_02.html': true,
      './BRAINUP/science/chem_03.html': true,
      './BRAINUP/science/chem_04.html': true,
      './BRAINUP/science/chem_05.html': true,
      './BRAINUP/science/chem_06.html': true,
      './BRAINUP/science/chem_07.html': true,
      './BRAINUP/science/chem_08.html': true,
      './BRAINUP/science/chem_09.html': true,
      './BRAINUP/science/chem_10.html': true,
      './BRAINUP/science/chem_11.html': true,
      './BRAINUP/science/chem_12.html': true,
      './BRAINUP/science/chem_13.html': true,
      './BRAINUP/science/chem_14.html': true,
      './BRAINUP/science/chem_15.html': true,
      './BRAINUP/science/chem_16.html': true,
      './BRAINUP/science/chem_17.html': true,
      './BRAINUP/science/chem_18.html': true,
      './BRAINUP/science/chem_19.html': true,
      './BRAINUP/science/chem_20.html': true,
      './BRAINUP/science/earth_01.html': true,
      './BRAINUP/science/earth_02.html': true,
      './BRAINUP/science/earth_03.html': true,
      './BRAINUP/science/earth_04.html': true,
      './BRAINUP/science/earth_05.html': true,
      './BRAINUP/science/earth_06.html': true,
      './BRAINUP/science/earth_07.html': true,
      './BRAINUP/science/earth_08.html': true,
      './BRAINUP/science/earth_09.html': true,
      './BRAINUP/science/earth_10.html': true,
      './BRAINUP/science/earth_11.html': true,
      './BRAINUP/science/earth_12.html': true,
      './BRAINUP/science/earth_13.html': true,
      './BRAINUP/science/earth_14.html': true,
      './BRAINUP/science/earth_15.html': true,
      './BRAINUP/science/earth_16.html': true,
      './BRAINUP/science/earth_17.html': true,
      './BRAINUP/science/earth_18.html': true,
      './BRAINUP/science/earth_19.html': true,
      './BRAINUP/science/earth_20.html': true,
      './BRAINUP/science/physics_01.html': true,
      './BRAINUP/science/physics_02.html': true,
      './BRAINUP/science/physics_03.html': true,
      './BRAINUP/science/physics_04.html': true,
      './BRAINUP/science/physics_05.html': true,
      './BRAINUP/science/physics_06.html': true,
      './BRAINUP/science/physics_07.html': true,
      './BRAINUP/science/physics_08.html': true,
      './BRAINUP/science/physics_09.html': true,
      './BRAINUP/science/physics_10.html': true,
      './BRAINUP/science/physics_11.html': true,
      './BRAINUP/science/physics_12.html': true,
      './BRAINUP/science/physics_13.html': true,
      './BRAINUP/science/physics_14.html': true,
      './BRAINUP/science/physics_15.html': true,
      './BRAINUP/science/physics_16.html': true,
      './BRAINUP/science/physics_17.html': true,
      './BRAINUP/science/physics_18.html': true,
      './BRAINUP/science/physics_19.html': true,
      './BRAINUP/science/physics_20.html': true,
      './BRAINUP/social/geo_01.html': true,
      './BRAINUP/social/geo_02.html': true,
      './BRAINUP/social/geo_03.html': true,
      './BRAINUP/social/geo_04.html': true,
      './BRAINUP/social/geo_05.html': true,
      './BRAINUP/social/geo_06.html': true,
      './BRAINUP/social/geo_07.html': true,
      './BRAINUP/social/geo_08.html': true,
      './BRAINUP/social/geo_09.html': true,
      './BRAINUP/social/geo_10.html': true,
      './BRAINUP/social/geo_11.html': true,
      './BRAINUP/social/geo_12.html': true,
      './BRAINUP/social/geo_13.html': true,
      './BRAINUP/social/geo_14.html': true,
      './BRAINUP/social/geo_15.html': true,
      './BRAINUP/social/geo_16.html': true,
      './BRAINUP/social/geo_17.html': true,
      './BRAINUP/social/geo_18.html': true,
      './BRAINUP/social/geo_19.html': true,
      './BRAINUP/social/geo_20.html': true,
      './BRAINUP/social/law_01.html': true,
      './BRAINUP/social/law_02.html': true,
      './BRAINUP/social/law_03.html': true,
      './BRAINUP/social/law_04.html': true,
      './BRAINUP/social/law_05.html': true,
      './BRAINUP/social/law_06.html': true,
      './BRAINUP/social/law_07.html': true,
      './BRAINUP/social/law_08.html': true,
      './BRAINUP/social/law_09.html': true,
      './BRAINUP/social/law_10.html': true,
      './BRAINUP/social/law_11.html': true,
      './BRAINUP/social/law_12.html': true,
      './BRAINUP/social/law_13.html': true,
      './BRAINUP/social/law_14.html': true,
      './BRAINUP/social/law_15.html': true,
      './BRAINUP/social/law_16.html': true,
      './BRAINUP/social/law_17.html': true,
      './BRAINUP/social/law_18.html': true,
      './BRAINUP/social/law_19.html': true,
      './BRAINUP/social/law_20.html': true,
      './BRAINUP/social/pol_01.html': true,
      './BRAINUP/social/pol_02.html': true,
      './BRAINUP/social/pol_03.html': true,
      './BRAINUP/social/pol_04.html': true,
      './BRAINUP/social/pol_05.html': true,
      './BRAINUP/social/pol_06.html': true,
      './BRAINUP/social/pol_07.html': true,
      './BRAINUP/social/pol_08.html': true,
      './BRAINUP/social/pol_09.html': true,
      './BRAINUP/social/pol_10.html': true,
      './BRAINUP/social/pol_11.html': true,
      './BRAINUP/social/pol_12.html': true,
      './BRAINUP/social/pol_13.html': true,
      './BRAINUP/social/pol_14.html': true,
      './BRAINUP/social/pol_15.html': true,
      './BRAINUP/social/pol_16.html': true,
      './BRAINUP/social/pol_17.html': true,
      './BRAINUP/social/pol_18.html': true,
      './BRAINUP/social/pol_19.html': true,
      './BRAINUP/social/pol_20.html': true,
      './BRAINUP/social/soc_01.html': true,
      './BRAINUP/social/soc_02.html': true,
      './BRAINUP/social/soc_03.html': true,
      './BRAINUP/social/soc_04.html': true,
      './BRAINUP/social/soc_05.html': true,
      './BRAINUP/social/soc_06.html': true,
      './BRAINUP/social/soc_07.html': true,
      './BRAINUP/social/soc_08.html': true,
      './BRAINUP/social/soc_09.html': true,
      './BRAINUP/social/soc_10.html': true,
      './BRAINUP/social/soc_11.html': true,
      './BRAINUP/social/soc_12.html': true,
      './BRAINUP/social/soc_13.html': true,
      './BRAINUP/social/soc_14.html': true,
      './BRAINUP/social/soc_15.html': true,
      './BRAINUP/social/soc_16.html': true,
      './BRAINUP/social/soc_17.html': true,
      './BRAINUP/social/soc_18.html': true,
      './BRAINUP/social/soc_19.html': true,
      './BRAINUP/social/soc_20.html': true,
      './BRAINUP/worldlit/world_01.html': true,
      './BRAINUP/worldlit/world_02.html': true,
      './BRAINUP/worldlit/world_03.html': true,
      './BRAINUP/worldlit/world_04.html': true,
      './BRAINUP/worldlit/world_05.html': true,
      './BRAINUP/worldlit/world_06.html': true,
      './BRAINUP/worldlit/world_07.html': true,
      './BRAINUP/worldlit/world_08.html': true,
      './BRAINUP/worldlit/world_09.html': true,
      './BRAINUP/worldlit/world_10.html': true,
      './BRAINUP/worldlit/world_11.html': true,
      './BRAINUP/worldlit/world_12.html': true,
      './BRAINUP/worldlit/world_13.html': true,
      './BRAINUP/worldlit/world_14.html': true,
      './BRAINUP/worldlit/world_15.html': true,
      './BRAINUP/worldlit/world_16.html': true,
      './BRAINUP/worldlit/world_17.html': true,
      './BRAINUP/worldlit/world_18.html': true,
      './BRAINUP/worldlit/world_19.html': true,
      './BRAINUP/worldlit/world_20.html': true,
      './BRAINUP/worldlit/world_21.html': true,
      './BRAINUP/worldlit/world_22.html': true,
      './BRAINUP/worldlit/world_23.html': true,
      './BRAINUP/worldlit/world_24.html': true,
      './BRAINUP/worldlit/world_25.html': true,
      './BRAINUP/worldlit/world_26.html': true,
      './BRAINUP/worldlit/world_27.html': true,
      './BRAINUP/worldlit/world_28.html': true,
      './BRAINUP/worldlit/world_29.html': true,
      './BRAINUP/worldlit/world_30.html': true,
      './BRAINUP/worldlit/world_31.html': true,
      './BRAINUP/worldlit/world_32.html': true,
      './BRAINUP/worldlit/world_33.html': true,
      './BRAINUP/worldlit/world_34.html': true,
      './BRAINUP/worldlit/world_35.html': true,
      './BRAINUP/worldlit/world_36.html': true,
      './BRAINUP/worldlit/world_37.html': true,
      './BRAINUP/worldlit/world_38.html': true,
      './BRAINUP/worldlit/world_39.html': true,
      './BRAINUP/worldlit/world_40.html': true,
      './BRAINUP/worldlit/world_41.html': true,
      './BRAINUP/worldlit/world_42.html': true,
      './BRAINUP/worldlit/world_43.html': true,
      './BRAINUP/worldlit/world_44.html': true,
      './BRAINUP/worldlit/world_45.html': true,
      './BRAINUP/worldlit/world_46.html': true,
      './BRAINUP/worldlit/world_47.html': true,
      './BRAINUP/worldlit/world_48.html': true,
      './BRAINUP/worldlit/world_49.html': true,
      './BRAINUP/worldlit/world_50.html': true,
      './BRAINUP/worldlit/world_51.html': true,
      './BRAINUP/worldlit/world_52.html': true,
      './BRAINUP/worldlit/world_53.html': true,
      './BRAINUP/worldlit/world_54.html': true,
      './BRAINUP/worldlit/world_55.html': true,
      './BRAINUP/worldlit/world_56.html': true,
      './BRAINUP/worldlit/world_57.html': true,
      './BRAINUP/worldlit/world_58.html': true,
      './BRAINUP/worldlit/world_59.html': true,
      './BRAINUP/worldlit/world_60.html': true,
      './BRAINUP/worldlit/world_61.html': true,
      './BRAINUP/worldlit/world_62.html': true,
      './BRAINUP/worldlit/world_63.html': true,
      './BRAINUP/worldlit/world_64.html': true,
      './BRAINUP/worldlit/world_65.html': true,
      './BRAINUP/worldlit/world_66.html': true,
      './BRAINUP/worldlit/world_67.html': true,
      './BRAINUP/worldlit/world_68.html': true,
      './BRAINUP/worldlit/world_69.html': true,
      './BRAINUP/worldlit/world_70.html': true,
      './BRAINUP/worldlit/world_71.html': true,
      './BRAINUP/worldlit/world_72.html': true,
      './BRAINUP/worldlit/world_73.html': true,
      './BRAINUP/worldlit/world_74.html': true,
      './BRAINUP/worldlit/world_75.html': true,
      './BRAINUP/worldlit/world_76.html': true,
      './BRAINUP/worldlit/world_77.html': true,
      './BRAINUP/worldlit/world_78.html': true,
      './BRAINUP/worldlit/world_79.html': true,
      './BRAINUP/worldlit/world_80.html': true,
      './BRAINFIT/korlit/classic_01.html': true,
      './BRAINFIT/korlit/classic_02.html': true,
      './BRAINFIT/korlit/classic_03.html': true,
      './BRAINFIT/korlit/classic_04.html': true,
      './BRAINFIT/korlit/classic_05.html': true,
      './BRAINFIT/korlit/classic_06.html': true,
      './BRAINFIT/korlit/classic_07.html': true,
      './BRAINFIT/korlit/classic_08.html': true,
      './BRAINFIT/korlit/classic_09.html': true,
      './BRAINFIT/korlit/classic_10.html': true,
      './BRAINFIT/korlit/classic_11.html': true,
      './BRAINFIT/korlit/classic_12.html': true,
      './BRAINFIT/korlit/classic_13.html': true,
      './BRAINFIT/korlit/classic_14.html': true,
      './BRAINFIT/korlit/classic_15.html': true,
      './BRAINFIT/korlit/classic_16.html': true,
      './BRAINFIT/korlit/classic_17.html': true,
      './BRAINFIT/korlit/classic_18.html': true,
      './BRAINFIT/korlit/classic_19.html': true,
      './BRAINFIT/korlit/classic_20.html': true,
      './BRAINFIT/korlit/classic_21.html': true,
      './BRAINFIT/korlit/classic_22.html': true,
      './BRAINFIT/korlit/classic_23.html': true,
      './BRAINFIT/korlit/classic_24.html': true,
      './BRAINFIT/korlit/classic_25.html': true,
      './BRAINFIT/korlit/classic_26.html': true,
      './BRAINFIT/korlit/classic_27.html': true,
      './BRAINFIT/korlit/classic_28.html': true,
      './BRAINFIT/korlit/classic_29.html': true,
      './BRAINFIT/korlit/classic_30.html': true,
      './BRAINFIT/korlit/classic_31.html': true,
      './BRAINFIT/korlit/classic_32.html': true,
      './BRAINFIT/korlit/classic_33.html': true,
      './BRAINFIT/korlit/classic_34.html': true,
      './BRAINFIT/korlit/classic_35.html': true,
      './BRAINFIT/korlit/classic_36.html': true,
      './BRAINFIT/korlit/classic_37.html': true,
      './BRAINFIT/korlit/classic_38.html': true,
      './BRAINFIT/korlit/classic_39.html': true,
      './BRAINFIT/korlit/classic_40.html': true,
      './BRAINFIT/korlit/modern_01.html': true,
      './BRAINFIT/korlit/modern_02.html': true,
      './BRAINFIT/korlit/modern_03.html': true,
      './BRAINFIT/korlit/modern_04.html': true,
      './BRAINFIT/korlit/modern_05.html': true,
      './BRAINFIT/korlit/modern_06.html': true,
      './BRAINFIT/korlit/modern_07.html': true,
      './BRAINFIT/korlit/modern_08.html': true,
      './BRAINFIT/korlit/modern_09.html': true,
      './BRAINFIT/korlit/modern_10.html': true,
      './BRAINFIT/korlit/modern_11.html': true,
      './BRAINFIT/korlit/modern_12.html': true,
      './BRAINFIT/korlit/modern_13.html': true,
      './BRAINFIT/korlit/modern_14.html': true,
      './BRAINFIT/korlit/modern_15.html': true,
      './BRAINFIT/korlit/modern_16.html': true,
      './BRAINFIT/korlit/modern_17.html': true,
      './BRAINFIT/korlit/modern_18.html': true,
      './BRAINFIT/korlit/modern_19.html': true,
      './BRAINFIT/korlit/modern_20.html': true,
      './BRAINFIT/korlit/modern_21.html': true,
      './BRAINFIT/korlit/modern_22.html': true,
      './BRAINFIT/korlit/modern_23.html': true,
      './BRAINFIT/korlit/modern_24.html': true,
      './BRAINFIT/korlit/modern_25.html': true,
      './BRAINFIT/korlit/modern_26.html': true,
      './BRAINFIT/korlit/modern_27.html': true,
      './BRAINFIT/korlit/modern_28.html': true,
      './BRAINFIT/korlit/modern_29.html': true,
      './BRAINFIT/korlit/modern_30.html': true,
      './BRAINFIT/korlit/modern_31.html': true,
      './BRAINFIT/korlit/modern_32.html': true,
      './BRAINFIT/korlit/modern_33.html': true,
      './BRAINFIT/korlit/modern_34.html': true,
      './BRAINFIT/korlit/modern_35.html': true,
      './BRAINFIT/korlit/modern_36.html': true,
      './BRAINFIT/korlit/modern_37.html': true,
      './BRAINFIT/korlit/modern_38.html': true,
      './BRAINFIT/korlit/modern_39.html': true,
      './BRAINFIT/korlit/modern_40.html': true,
      './BRAINFIT/person/people_01.html': true,
      './BRAINFIT/person/people_02.html': true,
      './BRAINFIT/person/people_03.html': true,
      './BRAINFIT/person/people_04.html': true,
      './BRAINFIT/person/people_05.html': true,
      './BRAINFIT/person/people_06.html': true,
      './BRAINFIT/person/people_07.html': true,
      './BRAINFIT/person/people_08.html': true,
      './BRAINFIT/person/people_09.html': true,
      './BRAINFIT/person/people_10.html': true,
      './BRAINFIT/person/people_11.html': true,
      './BRAINFIT/person/people_12.html': true,
      './BRAINFIT/person/people_13.html': true,
      './BRAINFIT/person/people_14.html': true,
      './BRAINFIT/person/people_15.html': true,
      './BRAINFIT/person/people_16.html': true,
      './BRAINFIT/person/people_17.html': true,
      './BRAINFIT/person/people_18.html': true,
      './BRAINFIT/person/people_19.html': true,
      './BRAINFIT/person/people_20.html': true,
      './BRAINFIT/person/people_21.html': true,
      './BRAINFIT/person/people_22.html': true,
      './BRAINFIT/person/people_23.html': true,
      './BRAINFIT/person/people_24.html': true,
      './BRAINFIT/person/people_25.html': true,
      './BRAINFIT/person/people_26.html': true,
      './BRAINFIT/person/people_27.html': true,
      './BRAINFIT/person/people_28.html': true,
      './BRAINFIT/person/people_29.html': true,
      './BRAINFIT/person/people_30.html': true,
      './BRAINFIT/person/people_31.html': true,
      './BRAINFIT/person/people_32.html': true,
      './BRAINFIT/person/people_33.html': true,
      './BRAINFIT/person/people_34.html': true,
      './BRAINFIT/person/people_35.html': true,
      './BRAINFIT/person/people_36.html': true,
      './BRAINFIT/person/people_37.html': true,
      './BRAINFIT/person/people_38.html': true,
      './BRAINFIT/person/people_39.html': true,
      './BRAINFIT/person/people_40.html': true,
      './BRAINFIT/person/people_41.html': true,
      './BRAINFIT/person/people_42.html': true,
      './BRAINFIT/person/people_43.html': true,
      './BRAINFIT/person/people_44.html': true,
      './BRAINFIT/person/people_45.html': true,
      './BRAINFIT/person/people_46.html': true,
      './BRAINFIT/person/people_47.html': true,
      './BRAINFIT/person/people_48.html': true,
      './BRAINFIT/person/people_49.html': true,
      './BRAINFIT/person/people_50.html': true,
      './BRAINFIT/person/people_51.html': true,
      './BRAINFIT/person/people_52.html': true,
      './BRAINFIT/person/people_53.html': true,
      './BRAINFIT/person/people_54.html': true,
      './BRAINFIT/person/people_55.html': true,
      './BRAINFIT/person/people_56.html': true,
      './BRAINFIT/person/people_57.html': true,
      './BRAINFIT/person/people_58.html': true,
      './BRAINFIT/person/people_59.html': true,
      './BRAINFIT/person/people_60.html': true,
      './BRAINFIT/person/people_61.html': true,
      './BRAINFIT/person/people_62.html': true,
      './BRAINFIT/person/people_63.html': true,
      './BRAINFIT/person/people_64.html': true,
      './BRAINFIT/person/people_65.html': true,
      './BRAINFIT/person/people_66.html': true,
      './BRAINFIT/person/people_67.html': true,
      './BRAINFIT/person/people_68.html': true,
      './BRAINFIT/person/people_69.html': true,
      './BRAINFIT/person/people_70.html': true,
      './BRAINFIT/person/people_71.html': true,
      './BRAINFIT/person/people_72.html': true,
      './BRAINFIT/person/people_73.html': true,
      './BRAINFIT/person/people_74.html': true,
      './BRAINFIT/person/people_75.html': true,
      './BRAINFIT/person/people_76.html': true,
      './BRAINFIT/person/people_77.html': true,
      './BRAINFIT/person/people_78.html': true,
      './BRAINFIT/person/people_79.html': true,
      './BRAINFIT/person/people_80.html': true,
      './BRAINFIT/science/bio_01.html': true,
      './BRAINFIT/science/bio_02.html': true,
      './BRAINFIT/science/bio_03.html': true,
      './BRAINFIT/science/bio_04.html': true,
      './BRAINFIT/science/bio_05.html': true,
      './BRAINFIT/science/bio_06.html': true,
      './BRAINFIT/science/bio_07.html': true,
      './BRAINFIT/science/bio_08.html': true,
      './BRAINFIT/science/bio_09.html': true,
      './BRAINFIT/science/bio_10.html': true,
      './BRAINFIT/science/bio_11.html': true,
      './BRAINFIT/science/bio_12.html': true,
      './BRAINFIT/science/bio_13.html': true,
      './BRAINFIT/science/bio_14.html': true,
      './BRAINFIT/science/bio_15.html': true,
      './BRAINFIT/science/bio_16.html': true,
      './BRAINFIT/science/bio_17.html': true,
      './BRAINFIT/science/bio_18.html': true,
      './BRAINFIT/science/bio_19.html': true,
      './BRAINFIT/science/bio_20.html': true,
      './BRAINFIT/science/chem_01.html': true,
      './BRAINFIT/science/chem_02.html': true,
      './BRAINFIT/science/chem_03.html': true,
      './BRAINFIT/science/chem_04.html': true,
      './BRAINFIT/science/chem_05.html': true,
      './BRAINFIT/science/chem_06.html': true,
      './BRAINFIT/science/chem_07.html': true,
      './BRAINFIT/science/chem_08.html': true,
      './BRAINFIT/science/chem_09.html': true,
      './BRAINFIT/science/chem_10.html': true,
      './BRAINFIT/science/chem_11.html': true,
      './BRAINFIT/science/chem_12.html': true,
      './BRAINFIT/science/chem_13.html': true,
      './BRAINFIT/science/chem_14.html': true,
      './BRAINFIT/science/chem_15.html': true,
      './BRAINFIT/science/chem_16.html': true,
      './BRAINFIT/science/chem_17.html': true,
      './BRAINFIT/science/chem_18.html': true,
      './BRAINFIT/science/chem_19.html': true,
      './BRAINFIT/science/chem_20.html': true,
      './BRAINFIT/science/earth_01.html': true,
      './BRAINFIT/science/earth_02.html': true,
      './BRAINFIT/science/earth_03.html': true,
      './BRAINFIT/science/earth_04.html': true,
      './BRAINFIT/science/earth_05.html': true,
      './BRAINFIT/science/earth_06.html': true,
      './BRAINFIT/science/earth_07.html': true,
      './BRAINFIT/science/earth_08.html': true,
      './BRAINFIT/science/earth_09.html': true,
      './BRAINFIT/science/earth_10.html': true,
      './BRAINFIT/science/earth_11.html': true,
      './BRAINFIT/science/earth_12.html': true,
      './BRAINFIT/science/earth_13.html': true,
      './BRAINFIT/science/earth_14.html': true,
      './BRAINFIT/science/earth_15.html': true,
      './BRAINFIT/science/earth_16.html': true,
      './BRAINFIT/science/earth_17.html': true,
      './BRAINFIT/science/earth_18.html': true,
      './BRAINFIT/science/earth_19.html': true,
      './BRAINFIT/science/earth_20.html': true,
      './BRAINFIT/science/physics_01.html': true,
      './BRAINFIT/science/physics_02.html': true,
      './BRAINFIT/science/physics_03.html': true,
      './BRAINFIT/science/physics_04.html': true,
      './BRAINFIT/science/physics_05.html': true,
      './BRAINFIT/science/physics_06.html': true,
      './BRAINFIT/science/physics_07.html': true,
      './BRAINFIT/science/physics_08.html': true,
      './BRAINFIT/science/physics_09.html': true,
      './BRAINFIT/science/physics_10.html': true,
      './BRAINFIT/science/physics_11.html': true,
      './BRAINFIT/science/physics_12.html': true,
      './BRAINFIT/science/physics_13.html': true,
      './BRAINFIT/science/physics_14.html': true,
      './BRAINFIT/science/physics_15.html': true,
      './BRAINFIT/science/physics_16.html': true,
      './BRAINFIT/science/physics_17.html': true,
      './BRAINFIT/science/physics_18.html': true,
      './BRAINFIT/science/physics_19.html': true,
      './BRAINFIT/science/physics_20.html': true,
      './BRAINFIT/social/geo_01.html': true,
      './BRAINFIT/social/geo_02.html': true,
      './BRAINFIT/social/geo_03.html': true,
      './BRAINFIT/social/geo_04.html': true,
      './BRAINFIT/social/geo_05.html': true,
      './BRAINFIT/social/geo_06.html': true,
      './BRAINFIT/social/geo_07.html': true,
      './BRAINFIT/social/geo_08.html': true,
      './BRAINFIT/social/geo_09.html': true,
      './BRAINFIT/social/geo_10.html': true,
      './BRAINFIT/social/geo_11.html': true,
      './BRAINFIT/social/geo_12.html': true,
      './BRAINFIT/social/geo_13.html': true,
      './BRAINFIT/social/geo_14.html': true,
      './BRAINFIT/social/geo_15.html': true,
      './BRAINFIT/social/geo_16.html': true,
      './BRAINFIT/social/geo_17.html': true,
      './BRAINFIT/social/geo_18.html': true,
      './BRAINFIT/social/geo_19.html': true,
      './BRAINFIT/social/geo_20.html': true,
      './BRAINFIT/social/law_01.html': true,
      './BRAINFIT/social/law_02.html': true,
      './BRAINFIT/social/law_03.html': true,
      './BRAINFIT/social/law_04.html': true,
      './BRAINFIT/social/law_05.html': true,
      './BRAINFIT/social/law_06.html': true,
      './BRAINFIT/social/law_07.html': true,
      './BRAINFIT/social/law_08.html': true,
      './BRAINFIT/social/law_09.html': true,
      './BRAINFIT/social/law_10.html': true,
      './BRAINFIT/social/law_11.html': true,
      './BRAINFIT/social/law_12.html': true,
      './BRAINFIT/social/law_13.html': true,
      './BRAINFIT/social/law_14.html': true,
      './BRAINFIT/social/law_15.html': true,
      './BRAINFIT/social/law_16.html': true,
      './BRAINFIT/social/law_17.html': true,
      './BRAINFIT/social/law_18.html': true,
      './BRAINFIT/social/law_19.html': true,
      './BRAINFIT/social/law_20.html': true,
      './BRAINFIT/social/pol_01.html': true,
      './BRAINFIT/social/pol_02.html': true,
      './BRAINFIT/social/pol_03.html': true,
      './BRAINFIT/social/pol_04.html': true,
      './BRAINFIT/social/pol_05.html': true,
      './BRAINFIT/social/pol_06.html': true,
      './BRAINFIT/social/pol_07.html': true,
      './BRAINFIT/social/pol_08.html': true,
      './BRAINFIT/social/pol_09.html': true,
      './BRAINFIT/social/pol_10.html': true,
      './BRAINFIT/social/pol_11.html': true,
      './BRAINFIT/social/pol_12.html': true,
      './BRAINFIT/social/pol_13.html': true,
      './BRAINFIT/social/pol_14.html': true,
      './BRAINFIT/social/pol_15.html': true,
      './BRAINFIT/social/pol_16.html': true,
      './BRAINFIT/social/pol_17.html': true,
      './BRAINFIT/social/pol_18.html': true,
      './BRAINFIT/social/pol_19.html': true,
      './BRAINFIT/social/pol_20.html': true,
      './BRAINFIT/social/soc_01.html': true,
      './BRAINFIT/social/soc_02.html': true,
      './BRAINFIT/social/soc_03.html': true,
      './BRAINFIT/social/soc_04.html': true,
      './BRAINFIT/social/soc_05.html': true,
      './BRAINFIT/social/soc_06.html': true,
      './BRAINFIT/social/soc_07.html': true,
      './BRAINFIT/social/soc_08.html': true,
      './BRAINFIT/social/soc_09.html': true,
      './BRAINFIT/social/soc_10.html': true,
      './BRAINFIT/social/soc_11.html': true,
      './BRAINFIT/social/soc_12.html': true,
      './BRAINFIT/social/soc_13.html': true,
      './BRAINFIT/social/soc_14.html': true,
      './BRAINFIT/social/soc_15.html': true,
      './BRAINFIT/social/soc_16.html': true,
      './BRAINFIT/social/soc_17.html': true,
      './BRAINFIT/social/soc_18.html': true,
      './BRAINFIT/social/soc_19.html': true,
      './BRAINFIT/social/soc_20.html': true,
      './BRAINFIT/worldlit/world_01.html': true,
      './BRAINFIT/worldlit/world_02.html': true,
      './BRAINFIT/worldlit/world_03.html': true,
      './BRAINFIT/worldlit/world_04.html': true,
      './BRAINFIT/worldlit/world_05.html': true,
      './BRAINFIT/worldlit/world_06.html': true,
      './BRAINFIT/worldlit/world_07.html': true,
      './BRAINFIT/worldlit/world_08.html': true,
      './BRAINFIT/worldlit/world_09.html': true,
      './BRAINFIT/worldlit/world_10.html': true,
      './BRAINFIT/worldlit/world_11.html': true,
      './BRAINFIT/worldlit/world_12.html': true,
      './BRAINFIT/worldlit/world_13.html': true,
      './BRAINFIT/worldlit/world_14.html': true,
      './BRAINFIT/worldlit/world_15.html': true,
      './BRAINFIT/worldlit/world_16.html': true,
      './BRAINFIT/worldlit/world_17.html': true,
      './BRAINFIT/worldlit/world_18.html': true,
      './BRAINFIT/worldlit/world_19.html': true,
      './BRAINFIT/worldlit/world_20.html': true,
      './BRAINFIT/worldlit/world_21.html': true,
      './BRAINFIT/worldlit/world_22.html': true,
      './BRAINFIT/worldlit/world_23.html': true,
      './BRAINFIT/worldlit/world_24.html': true,
      './BRAINFIT/worldlit/world_25.html': true,
      './BRAINFIT/worldlit/world_26.html': true,
      './BRAINFIT/worldlit/world_27.html': true,
      './BRAINFIT/worldlit/world_28.html': true,
      './BRAINFIT/worldlit/world_29.html': true,
      './BRAINFIT/worldlit/world_30.html': true,
      './BRAINFIT/worldlit/world_31.html': true,
      './BRAINFIT/worldlit/world_32.html': true,
      './BRAINFIT/worldlit/world_33.html': true,
      './BRAINFIT/worldlit/world_34.html': true,
      './BRAINFIT/worldlit/world_35.html': true,
      './BRAINFIT/worldlit/world_36.html': true,
      './BRAINFIT/worldlit/world_37.html': true,
      './BRAINFIT/worldlit/world_38.html': true,
      './BRAINFIT/worldlit/world_39.html': true,
      './BRAINFIT/worldlit/world_40.html': true,
      './BRAINFIT/worldlit/world_41.html': true,
      './BRAINFIT/worldlit/world_42.html': true,
      './BRAINFIT/worldlit/world_43.html': true,
      './BRAINFIT/worldlit/world_44.html': true,
      './BRAINFIT/worldlit/world_45.html': true,
      './BRAINFIT/worldlit/world_46.html': true,
      './BRAINFIT/worldlit/world_47.html': true,
      './BRAINFIT/worldlit/world_48.html': true,
      './BRAINFIT/worldlit/world_49.html': true,
      './BRAINFIT/worldlit/world_50.html': true,
      './BRAINFIT/worldlit/world_51.html': true,
      './BRAINFIT/worldlit/world_52.html': true,
      './BRAINFIT/worldlit/world_53.html': true,
      './BRAINFIT/worldlit/world_54.html': true,
      './BRAINFIT/worldlit/world_55.html': true,
      './BRAINFIT/worldlit/world_56.html': true,
      './BRAINFIT/worldlit/world_57.html': true,
      './BRAINFIT/worldlit/world_58.html': true,
      './BRAINFIT/worldlit/world_59.html': true,
      './BRAINFIT/worldlit/world_60.html': true,
      './BRAINFIT/worldlit/world_61.html': true,
      './BRAINFIT/worldlit/world_62.html': true,
      './BRAINFIT/worldlit/world_63.html': true,
      './BRAINFIT/worldlit/world_64.html': true,
      './BRAINFIT/worldlit/world_65.html': true,
      './BRAINFIT/worldlit/world_66.html': true,
      './BRAINFIT/worldlit/world_67.html': true,
      './BRAINFIT/worldlit/world_68.html': true,
      './BRAINFIT/worldlit/world_69.html': true,
      './BRAINFIT/worldlit/world_70.html': true,
      './BRAINFIT/worldlit/world_71.html': true,
      './BRAINFIT/worldlit/world_72.html': true,
      './BRAINFIT/worldlit/world_73.html': true,
      './BRAINFIT/worldlit/world_74.html': true,
      './BRAINFIT/worldlit/world_75.html': true,
      './BRAINFIT/worldlit/world_76.html': true,
      './BRAINFIT/worldlit/world_77.html': true,
      './BRAINFIT/worldlit/world_78.html': true,
      './BRAINFIT/worldlit/world_79.html': true,
      './BRAINFIT/worldlit/world_80.html': true,
      './BRAINDEEP/korlit/classic_01.html': true,
      './BRAINDEEP/korlit/classic_02.html': true,
      './BRAINDEEP/korlit/classic_03.html': true,
      './BRAINDEEP/korlit/classic_04.html': true,
      './BRAINDEEP/korlit/classic_05.html': true,
      './BRAINDEEP/korlit/classic_06.html': true,
      './BRAINDEEP/korlit/classic_07.html': true,
      './BRAINDEEP/korlit/classic_08.html': true,
      './BRAINDEEP/korlit/classic_09.html': true,
      './BRAINDEEP/korlit/classic_10.html': true,
      './BRAINDEEP/korlit/classic_11.html': true,
      './BRAINDEEP/korlit/classic_12.html': true,
      './BRAINDEEP/korlit/classic_13.html': true,
      './BRAINDEEP/korlit/classic_14.html': true,
      './BRAINDEEP/korlit/classic_15.html': true,
      './BRAINDEEP/korlit/classic_16.html': true,
      './BRAINDEEP/korlit/classic_17.html': true,
      './BRAINDEEP/korlit/classic_18.html': true,
      './BRAINDEEP/korlit/classic_19.html': true,
      './BRAINDEEP/korlit/classic_20.html': true,
      './BRAINDEEP/korlit/classic_21.html': true,
      './BRAINDEEP/korlit/classic_22.html': true,
      './BRAINDEEP/korlit/classic_23.html': true,
      './BRAINDEEP/korlit/classic_24.html': true,
      './BRAINDEEP/korlit/classic_25.html': true,
      './BRAINDEEP/korlit/classic_26.html': true,
      './BRAINDEEP/korlit/classic_27.html': true,
      './BRAINDEEP/korlit/classic_28.html': true,
      './BRAINDEEP/korlit/classic_29.html': true,
      './BRAINDEEP/korlit/classic_30.html': true,
      './BRAINDEEP/korlit/classic_31.html': true,
      './BRAINDEEP/korlit/classic_32.html': true,
      './BRAINDEEP/korlit/classic_33.html': true,
      './BRAINDEEP/korlit/classic_34.html': true,
      './BRAINDEEP/korlit/classic_35.html': true,
      './BRAINDEEP/korlit/classic_36.html': true,
      './BRAINDEEP/korlit/classic_37.html': true,
      './BRAINDEEP/korlit/classic_38.html': true,
      './BRAINDEEP/korlit/classic_39.html': true,
      './BRAINDEEP/korlit/classic_40.html': true,
      './BRAINDEEP/korlit/modern_01.html': true,
      './BRAINDEEP/korlit/modern_02.html': true,
      './BRAINDEEP/korlit/modern_03.html': true,
      './BRAINDEEP/korlit/modern_04.html': true,
      './BRAINDEEP/korlit/modern_05.html': true,
      './BRAINDEEP/korlit/modern_06.html': true,
      './BRAINDEEP/korlit/modern_07.html': true,
      './BRAINDEEP/korlit/modern_08.html': true,
      './BRAINDEEP/korlit/modern_09.html': true,
      './BRAINDEEP/korlit/modern_10.html': true,
      './BRAINDEEP/korlit/modern_11.html': true,
      './BRAINDEEP/korlit/modern_12.html': true,
      './BRAINDEEP/korlit/modern_13.html': true,
      './BRAINDEEP/korlit/modern_14.html': true,
      './BRAINDEEP/korlit/modern_15.html': true,
      './BRAINDEEP/korlit/modern_16.html': true,
      './BRAINDEEP/korlit/modern_17.html': true,
      './BRAINDEEP/korlit/modern_18.html': true,
      './BRAINDEEP/korlit/modern_19.html': true,
      './BRAINDEEP/korlit/modern_20.html': true,
      './BRAINDEEP/korlit/modern_21.html': true,
      './BRAINDEEP/korlit/modern_22.html': true,
      './BRAINDEEP/korlit/modern_23.html': true,
      './BRAINDEEP/korlit/modern_24.html': true,
      './BRAINDEEP/korlit/modern_25.html': true,
      './BRAINDEEP/korlit/modern_26.html': true,
      './BRAINDEEP/korlit/modern_27.html': true,
      './BRAINDEEP/korlit/modern_28.html': true,
      './BRAINDEEP/korlit/modern_29.html': true,
      './BRAINDEEP/korlit/modern_30.html': true,
      './BRAINDEEP/korlit/modern_31.html': true,
      './BRAINDEEP/korlit/modern_32.html': true,
      './BRAINDEEP/korlit/modern_33.html': true,
      './BRAINDEEP/korlit/modern_34.html': true,
      './BRAINDEEP/korlit/modern_35.html': true,
      './BRAINDEEP/korlit/modern_36.html': true,
      './BRAINDEEP/korlit/modern_37.html': true,
      './BRAINDEEP/korlit/modern_38.html': true,
      './BRAINDEEP/korlit/modern_39.html': true,
      './BRAINDEEP/korlit/modern_40.html': true,
      './BRAINDEEP/person/people_01.html': true,
      './BRAINDEEP/person/people_02.html': true,
      './BRAINDEEP/person/people_03.html': true,
      './BRAINDEEP/person/people_04.html': true,
      './BRAINDEEP/person/people_05.html': true,
      './BRAINDEEP/person/people_06.html': true,
      './BRAINDEEP/person/people_07.html': true,
      './BRAINDEEP/person/people_08.html': true,
      './BRAINDEEP/person/people_09.html': true,
      './BRAINDEEP/person/people_10.html': true,
      './BRAINDEEP/person/people_11.html': true,
      './BRAINDEEP/person/people_12.html': true,
      './BRAINDEEP/person/people_13.html': true,
      './BRAINDEEP/person/people_14.html': true,
      './BRAINDEEP/person/people_15.html': true,
      './BRAINDEEP/person/people_16.html': true,
      './BRAINDEEP/person/people_17.html': true,
      './BRAINDEEP/person/people_18.html': true,
      './BRAINDEEP/person/people_19.html': true,
      './BRAINDEEP/person/people_20.html': true,
      './BRAINDEEP/person/people_21.html': true,
      './BRAINDEEP/person/people_22.html': true,
      './BRAINDEEP/person/people_23.html': true,
      './BRAINDEEP/person/people_24.html': true,
      './BRAINDEEP/person/people_25.html': true,
      './BRAINDEEP/person/people_26.html': true,
      './BRAINDEEP/person/people_27.html': true,
      './BRAINDEEP/person/people_28.html': true,
      './BRAINDEEP/person/people_29.html': true,
      './BRAINDEEP/person/people_30.html': true,
      './BRAINDEEP/person/people_31.html': true,
      './BRAINDEEP/person/people_32.html': true,
      './BRAINDEEP/person/people_33.html': true,
      './BRAINDEEP/person/people_34.html': true,
      './BRAINDEEP/person/people_35.html': true,
      './BRAINDEEP/person/people_36.html': true,
      './BRAINDEEP/person/people_37.html': true,
      './BRAINDEEP/person/people_38.html': true,
      './BRAINDEEP/person/people_39.html': true,
      './BRAINDEEP/person/people_40.html': true,
      './BRAINDEEP/person/people_41.html': true,
      './BRAINDEEP/person/people_42.html': true,
      './BRAINDEEP/person/people_43.html': true,
      './BRAINDEEP/person/people_44.html': true,
      './BRAINDEEP/person/people_45.html': true,
      './BRAINDEEP/person/people_46.html': true,
      './BRAINDEEP/person/people_47.html': true,
      './BRAINDEEP/person/people_48.html': true,
      './BRAINDEEP/person/people_49.html': true,
      './BRAINDEEP/person/people_50.html': true,
      './BRAINDEEP/person/people_51.html': true,
      './BRAINDEEP/person/people_52.html': true,
      './BRAINDEEP/person/people_53.html': true,
      './BRAINDEEP/person/people_54.html': true,
      './BRAINDEEP/person/people_55.html': true,
      './BRAINDEEP/person/people_56.html': true,
      './BRAINDEEP/person/people_57.html': true,
      './BRAINDEEP/person/people_58.html': true,
      './BRAINDEEP/person/people_59.html': true,
      './BRAINDEEP/person/people_60.html': true,
      './BRAINDEEP/person/people_61.html': true,
      './BRAINDEEP/person/people_62.html': true,
      './BRAINDEEP/person/people_63.html': true,
      './BRAINDEEP/person/people_64.html': true,
      './BRAINDEEP/person/people_65.html': true,
      './BRAINDEEP/person/people_66.html': true,
      './BRAINDEEP/person/people_67.html': true,
      './BRAINDEEP/person/people_68.html': true,
      './BRAINDEEP/person/people_69.html': true,
      './BRAINDEEP/person/people_70.html': true,
      './BRAINDEEP/person/people_71.html': true,
      './BRAINDEEP/person/people_72.html': true,
      './BRAINDEEP/person/people_73.html': true,
      './BRAINDEEP/person/people_74.html': true,
      './BRAINDEEP/person/people_75.html': true,
      './BRAINDEEP/person/people_76.html': true,
      './BRAINDEEP/person/people_77.html': true,
      './BRAINDEEP/person/people_78.html': true,
      './BRAINDEEP/person/people_79.html': true,
      './BRAINDEEP/person/people_80.html': true,
      './BRAINDEEP/science/bio_01.html': true,
      './BRAINDEEP/science/bio_02.html': true,
      './BRAINDEEP/science/bio_03.html': true,
      './BRAINDEEP/science/bio_04.html': true,
      './BRAINDEEP/science/bio_05.html': true,
      './BRAINDEEP/science/bio_06.html': true,
      './BRAINDEEP/science/bio_07.html': true,
      './BRAINDEEP/science/bio_08.html': true,
      './BRAINDEEP/science/bio_09.html': true,
      './BRAINDEEP/science/bio_10.html': true,
      './BRAINDEEP/science/bio_11.html': true,
      './BRAINDEEP/science/bio_12.html': true,
      './BRAINDEEP/science/bio_13.html': true,
      './BRAINDEEP/science/bio_14.html': true,
      './BRAINDEEP/science/bio_15.html': true,
      './BRAINDEEP/science/bio_16.html': true,
      './BRAINDEEP/science/bio_17.html': true,
      './BRAINDEEP/science/bio_18.html': true,
      './BRAINDEEP/science/bio_19.html': true,
      './BRAINDEEP/science/bio_20.html': true,
      './BRAINDEEP/science/chem_01.html': true,
      './BRAINDEEP/science/chem_02.html': true,
      './BRAINDEEP/science/chem_03.html': true,
      './BRAINDEEP/science/chem_04.html': true,
      './BRAINDEEP/science/chem_05.html': true,
      './BRAINDEEP/science/chem_06.html': true,
      './BRAINDEEP/science/chem_07.html': true,
      './BRAINDEEP/science/chem_08.html': true,
      './BRAINDEEP/science/chem_09.html': true,
      './BRAINDEEP/science/chem_10.html': true,
      './BRAINDEEP/science/chem_11.html': true,
      './BRAINDEEP/science/chem_12.html': true,
      './BRAINDEEP/science/chem_13.html': true,
      './BRAINDEEP/science/chem_14.html': true,
      './BRAINDEEP/science/chem_15.html': true,
      './BRAINDEEP/science/chem_16.html': true,
      './BRAINDEEP/science/chem_17.html': true,
      './BRAINDEEP/science/chem_18.html': true,
      './BRAINDEEP/science/chem_19.html': true,
      './BRAINDEEP/science/chem_20.html': true,
      './BRAINDEEP/science/earth_01.html': true,
      './BRAINDEEP/science/earth_02.html': true,
      './BRAINDEEP/science/earth_03.html': true,
      './BRAINDEEP/science/earth_04.html': true,
      './BRAINDEEP/science/earth_05.html': true,
      './BRAINDEEP/science/earth_06.html': true,
      './BRAINDEEP/science/earth_07.html': true,
      './BRAINDEEP/science/earth_08.html': true,
      './BRAINDEEP/science/earth_09.html': true,
      './BRAINDEEP/science/earth_10.html': true,
      './BRAINDEEP/science/earth_11.html': true,
      './BRAINDEEP/science/earth_12.html': true,
      './BRAINDEEP/science/earth_13.html': true,
      './BRAINDEEP/science/earth_14.html': true,
      './BRAINDEEP/science/earth_15.html': true,
      './BRAINDEEP/science/earth_16.html': true,
      './BRAINDEEP/science/earth_17.html': true,
      './BRAINDEEP/science/earth_18.html': true,
      './BRAINDEEP/science/earth_19.html': true,
      './BRAINDEEP/science/earth_20.html': true,
      './BRAINDEEP/science/physics_01.html': true,
      './BRAINDEEP/science/physics_02.html': true,
      './BRAINDEEP/science/physics_03.html': true,
      './BRAINDEEP/science/physics_04.html': true,
      './BRAINDEEP/science/physics_05.html': true,
      './BRAINDEEP/science/physics_06.html': true,
      './BRAINDEEP/science/physics_07.html': true,
      './BRAINDEEP/science/physics_08.html': true,
      './BRAINDEEP/science/physics_09.html': true,
      './BRAINDEEP/science/physics_10.html': true,
      './BRAINDEEP/science/physics_11.html': true,
      './BRAINDEEP/science/physics_12.html': true,
      './BRAINDEEP/science/physics_13.html': true,
      './BRAINDEEP/science/physics_14.html': true,
      './BRAINDEEP/science/physics_15.html': true,
      './BRAINDEEP/science/physics_16.html': true,
      './BRAINDEEP/science/physics_17.html': true,
      './BRAINDEEP/science/physics_18.html': true,
      './BRAINDEEP/science/physics_19.html': true,
      './BRAINDEEP/science/physics_20.html': true,
      './BRAINDEEP/social/geo_01.html': true,
      './BRAINDEEP/social/geo_02.html': true,
      './BRAINDEEP/social/geo_03.html': true,
      './BRAINDEEP/social/geo_04.html': true,
      './BRAINDEEP/social/geo_05.html': true,
      './BRAINDEEP/social/geo_06.html': true,
      './BRAINDEEP/social/geo_07.html': true,
      './BRAINDEEP/social/geo_08.html': true,
      './BRAINDEEP/social/geo_09.html': true,
      './BRAINDEEP/social/geo_10.html': true,
      './BRAINDEEP/social/geo_11.html': true,
      './BRAINDEEP/social/geo_12.html': true,
      './BRAINDEEP/social/geo_13.html': true,
      './BRAINDEEP/social/geo_14.html': true,
      './BRAINDEEP/social/geo_15.html': true,
      './BRAINDEEP/social/geo_16.html': true,
      './BRAINDEEP/social/geo_17.html': true,
      './BRAINDEEP/social/geo_18.html': true,
      './BRAINDEEP/social/geo_19.html': true,
      './BRAINDEEP/social/geo_20.html': true,
      './BRAINDEEP/social/law_01.html': true,
      './BRAINDEEP/social/law_02.html': true,
      './BRAINDEEP/social/law_03.html': true,
      './BRAINDEEP/social/law_04.html': true,
      './BRAINDEEP/social/law_05.html': true,
      './BRAINDEEP/social/law_06.html': true,
      './BRAINDEEP/social/law_07.html': true,
      './BRAINDEEP/social/law_08.html': true,
      './BRAINDEEP/social/law_09.html': true,
      './BRAINDEEP/social/law_10.html': true,
      './BRAINDEEP/social/law_11.html': true,
      './BRAINDEEP/social/law_12.html': true,
      './BRAINDEEP/social/law_13.html': true,
      './BRAINDEEP/social/law_14.html': true,
      './BRAINDEEP/social/law_15.html': true,
      './BRAINDEEP/social/law_16.html': true,
      './BRAINDEEP/social/law_17.html': true,
      './BRAINDEEP/social/law_18.html': true,
      './BRAINDEEP/social/law_19.html': true,
      './BRAINDEEP/social/law_20.html': true,
      './BRAINDEEP/social/pol_01.html': true,
      './BRAINDEEP/social/pol_02.html': true,
      './BRAINDEEP/social/pol_03.html': true,
      './BRAINDEEP/social/pol_04.html': true,
      './BRAINDEEP/social/pol_05.html': true,
      './BRAINDEEP/social/pol_06.html': true,
      './BRAINDEEP/social/pol_07.html': true,
      './BRAINDEEP/social/pol_08.html': true,
      './BRAINDEEP/social/pol_09.html': true,
      './BRAINDEEP/social/pol_10.html': true,
      './BRAINDEEP/social/pol_11.html': true,
      './BRAINDEEP/social/pol_12.html': true,
      './BRAINDEEP/social/pol_13.html': true,
      './BRAINDEEP/social/pol_14.html': true,
      './BRAINDEEP/social/pol_15.html': true,
      './BRAINDEEP/social/pol_16.html': true,
      './BRAINDEEP/social/pol_17.html': true,
      './BRAINDEEP/social/pol_18.html': true,
      './BRAINDEEP/social/pol_19.html': true,
      './BRAINDEEP/social/pol_20.html': true,
      './BRAINDEEP/social/soc_01.html': true,
      './BRAINDEEP/social/soc_02.html': true,
      './BRAINDEEP/social/soc_03.html': true,
      './BRAINDEEP/social/soc_04.html': true,
      './BRAINDEEP/social/soc_05.html': true,
      './BRAINDEEP/social/soc_06.html': true,
      './BRAINDEEP/social/soc_07.html': true,
      './BRAINDEEP/social/soc_08.html': true,
      './BRAINDEEP/social/soc_09.html': true,
      './BRAINDEEP/social/soc_10.html': true,
      './BRAINDEEP/social/soc_11.html': true,
      './BRAINDEEP/social/soc_12.html': true,
      './BRAINDEEP/social/soc_13.html': true,
      './BRAINDEEP/social/soc_14.html': true,
      './BRAINDEEP/social/soc_15.html': true,
      './BRAINDEEP/social/soc_16.html': true,
      './BRAINDEEP/social/soc_17.html': true,
      './BRAINDEEP/social/soc_18.html': true,
      './BRAINDEEP/social/soc_19.html': true,
      './BRAINDEEP/social/soc_20.html': true,
      './BRAINDEEP/worldlit/world_01.html': true,
      './BRAINDEEP/worldlit/world_02.html': true,
      './BRAINDEEP/worldlit/world_03.html': true,
      './BRAINDEEP/worldlit/world_04.html': true,
      './BRAINDEEP/worldlit/world_05.html': true,
      './BRAINDEEP/worldlit/world_06.html': true,
      './BRAINDEEP/worldlit/world_07.html': true,
      './BRAINDEEP/worldlit/world_08.html': true,
      './BRAINDEEP/worldlit/world_09.html': true,
      './BRAINDEEP/worldlit/world_10.html': true,
      './BRAINDEEP/worldlit/world_11.html': true,
      './BRAINDEEP/worldlit/world_12.html': true,
      './BRAINDEEP/worldlit/world_13.html': true,
      './BRAINDEEP/worldlit/world_14.html': true,
      './BRAINDEEP/worldlit/world_15.html': true,
      './BRAINDEEP/worldlit/world_16.html': true,
      './BRAINDEEP/worldlit/world_17.html': true,
      './BRAINDEEP/worldlit/world_18.html': true,
      './BRAINDEEP/worldlit/world_19.html': true,
      './BRAINDEEP/worldlit/world_20.html': true,
      './BRAINDEEP/worldlit/world_21.html': true,
      './BRAINDEEP/worldlit/world_22.html': true,
      './BRAINDEEP/worldlit/world_23.html': true,
      './BRAINDEEP/worldlit/world_24.html': true,
      './BRAINDEEP/worldlit/world_25.html': true,
      './BRAINDEEP/worldlit/world_26.html': true,
      './BRAINDEEP/worldlit/world_27.html': true,
      './BRAINDEEP/worldlit/world_28.html': true,
      './BRAINDEEP/worldlit/world_29.html': true,
      './BRAINDEEP/worldlit/world_30.html': true,
      './BRAINDEEP/worldlit/world_31.html': true,
      './BRAINDEEP/worldlit/world_32.html': true,
      './BRAINDEEP/worldlit/world_33.html': true,
      './BRAINDEEP/worldlit/world_34.html': true,
      './BRAINDEEP/worldlit/world_35.html': true,
      './BRAINDEEP/worldlit/world_36.html': true,
      './BRAINDEEP/worldlit/world_37.html': true,
      './BRAINDEEP/worldlit/world_38.html': true,
      './BRAINDEEP/worldlit/world_39.html': true,
      './BRAINDEEP/worldlit/world_40.html': true,
      './BRAINDEEP/worldlit/world_41.html': true,
      './BRAINDEEP/worldlit/world_42.html': true,
      './BRAINDEEP/worldlit/world_43.html': true,
      './BRAINDEEP/worldlit/world_44.html': true,
      './BRAINDEEP/worldlit/world_45.html': true,
      './BRAINDEEP/worldlit/world_46.html': true,
      './BRAINDEEP/worldlit/world_47.html': true,
      './BRAINDEEP/worldlit/world_48.html': true,
      './BRAINDEEP/worldlit/world_49.html': true,
      './BRAINDEEP/worldlit/world_50.html': true,
      './BRAINDEEP/worldlit/world_51.html': true,
      './BRAINDEEP/worldlit/world_52.html': true,
      './BRAINDEEP/worldlit/world_53.html': true,
      './BRAINDEEP/worldlit/world_54.html': true,
      './BRAINDEEP/worldlit/world_55.html': true,
      './BRAINDEEP/worldlit/world_56.html': true,
      './BRAINDEEP/worldlit/world_57.html': true,
      './BRAINDEEP/worldlit/world_58.html': true,
      './BRAINDEEP/worldlit/world_59.html': true,
      './BRAINDEEP/worldlit/world_60.html': true,
      './BRAINDEEP/worldlit/world_61.html': true,
      './BRAINDEEP/worldlit/world_62.html': true,
      './BRAINDEEP/worldlit/world_63.html': true,
      './BRAINDEEP/worldlit/world_64.html': true,
      './BRAINDEEP/worldlit/world_65.html': true,
      './BRAINDEEP/worldlit/world_66.html': true,
      './BRAINDEEP/worldlit/world_67.html': true,
      './BRAINDEEP/worldlit/world_68.html': true,
      './BRAINDEEP/worldlit/world_69.html': true,
      './BRAINDEEP/worldlit/world_70.html': true,
      './BRAINDEEP/worldlit/world_71.html': true,
      './BRAINDEEP/worldlit/world_72.html': true,
      './BRAINDEEP/worldlit/world_73.html': true,
      './BRAINDEEP/worldlit/world_74.html': true,
      './BRAINDEEP/worldlit/world_75.html': true,
      './BRAINDEEP/worldlit/world_76.html': true,
      './BRAINDEEP/worldlit/world_77.html': true,
      './BRAINDEEP/worldlit/world_78.html': true,
      './BRAINDEEP/worldlit/world_79.html': true,
      './BRAINDEEP/worldlit/world_80.html': true
};

    // === ì¤€ë¹„ ì¤‘ íŒì—… ì—´ê¸°/ë‹«ê¸° ===
    function showComingSoonPopup() {
      const overlay = document.getElementById('comingSoonOverlay');
      if (overlay) {
        overlay.classList.add('show');
      }
    }

    function closeComingSoonPopup() {
      const overlay = document.getElementById('comingSoonOverlay');
      if (overlay) {
        overlay.classList.remove('show');
      }
    }

    // === ë‹¨ì› IDë¥¼ íŒŒì¼ ê²½ë¡œë¡œ ë³€í™˜ ===
    function getUnitPath(unitId) {
      console.log('ðŸ” getUnitPath called with:', unitId);

      // unitIdê°€ ì´ë¯¸ ê²½ë¡œì¸ ê²½ìš° ê·¸ëŒ€ë¡œ ë°˜í™˜
      if (unitId && unitId.startsWith('./')) {
        console.log('âœ… unitId is already a path, returning:', unitId);
        return unitId;
      }

      // unitIdë¥¼ íŒŒì¼ ê²½ë¡œë¡œ ë³€í™˜ (ì˜ˆ: "geo_01" -> "./BRAINUP/social/geo_01.html")
      // TODO: ì‹œë¦¬ì¦ˆ/ë¶„ì•¼ë³„ë¡œ ê²½ë¡œ ë§¤í•‘ í•„ìš” (í˜„ìž¬ëŠ” BRAINUP/socialë§Œ ì§€ì›)
      if (unitId && unitId.match(/^[a-z]+_\d+$/)) {
        const path = `./BRAINUP/social/${unitId}.html`;
        console.log('âš ï¸ Converting unitId to BRAINUP/social path:', path);
        return path;
      }

      console.log('âŒ Could not convert unitId to path, returning null');
      return null;
    }

    // === ë‹¨ì› í•™ìŠµ ëª¨ë‹¬ ê´€ë ¨ ===
    function openUnitModal(unitIdOrPath) {
      // ë‹¨ì› IDë¥¼ íŒŒì¼ ê²½ë¡œë¡œ ë³€í™˜
      const unitPath = getUnitPath(unitIdOrPath);

      if (!unitPath) {
        console.log('âš ï¸ ìž˜ëª»ëœ ë‹¨ì› ID:', unitIdOrPath);
        showComingSoonPopup();
        return;
      }

      // íŒŒì¼ ì¡´ìž¬ ì—¬ë¶€ í™•ì¸
      if (!availableUnits[unitPath]) {
        console.log('âš ï¸ ì¤€ë¹„ë˜ì§€ ì•Šì€ ë‹¨ì›:', unitPath);
        showComingSoonPopup();
        return;
      }

      const unitModal = document.getElementById('unitModal');
      const unitIframe = document.getElementById('unitIframe');
      const loadingOverlay = document.getElementById('loading-overlay');

      if (unitModal && unitIframe) {
        // ë¡œë”© ì˜¤ë²„ë ˆì´ í‘œì‹œ
        if (loadingOverlay) {
          loadingOverlay.style.display = 'flex';
          loadingOverlay.classList.remove('fade-out');
        }

        // iframe ë¡œë“œ ì™„ë£Œ ì‹œ ë¡œë”© ì˜¤ë²„ë ˆì´ ìˆ¨ê¹€
        unitIframe.onload = function() {
          if (loadingOverlay) {
            loadingOverlay.classList.add('fade-out');
            setTimeout(() => {
              loadingOverlay.style.display = 'none';
            }, 500);
          }
        };

        unitIframe.src = unitPath;
        unitModal.classList.add('show');
        // sessionStorageì— í˜„ìž¬ ì—´ë¦° ë‹¨ì› ê²½ë¡œ ì €ìž¥
        sessionStorage.setItem('currentOpenUnit', unitPath);
      }
    }

    // iframe ë‚´ë¶€ì—ì„œ í˜¸ì¶œí•  ìˆ˜ ìžˆë„ë¡ window ê°ì²´ì— ë…¸ì¶œ
    window.closeUnitModal = function() {
      const unitModal = document.getElementById('unitModal');
      const unitIframe = document.getElementById('unitIframe');

      if (unitModal) {
        unitModal.classList.remove('show');
        if (unitIframe) {
          unitIframe.src = ''; // iframe ì´ˆê¸°í™”
        }
        // sessionStorageì—ì„œ í˜„ìž¬ ì—´ë¦° ë‹¨ì› ê²½ë¡œ ì œê±°
        sessionStorage.removeItem('currentOpenUnit');

        // ë©”ë‰´ íŽ˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (í•™ìŠµ ì™„ë£Œ ìƒíƒœ ë°˜ì˜)
        setTimeout(() => {
          location.reload();
        }, 300);
      }
    };

    // íŽ˜ì´ì§€ ë¡œë“œ ì‹œ ì´ì „ì— ì—´ë ¤ìžˆë˜ ëª¨ë‹¬ ë³µì›
    function restoreUnitModal() {
      const savedUnitPath = sessionStorage.getItem('currentOpenUnit');
      if (savedUnitPath) {
        openUnitModal(savedUnitPath);
      }
    }

    // ë‹¨ì› ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
    window.addEventListener('DOMContentLoaded', function() {
      const closeUnitBtn = document.getElementById('closeUnitModal');
      const unitModal = document.getElementById('unitModal');

      if (closeUnitBtn) {
        closeUnitBtn.addEventListener('click', window.closeUnitModal);
      }

      // ë°°ê²½ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
      if (unitModal) {
        unitModal.addEventListener('click', function(e) {
          if (e.target === unitModal) {
            window.closeUnitModal();
          }
        });
      }

      // íŽ˜ì´ì§€ ë¡œë“œ ì‹œ ì´ì „ì— ì—´ë ¤ìžˆë˜ ëª¨ë‹¬ ë³µì›
      restoreUnitModal();
    });

    // === AI ì±—ë´‡ í”Œë¡œíŒ… ë²„íŠ¼ ===
    window.addEventListener('DOMContentLoaded', function() {
      const aiChatbotBtn = document.getElementById('aiChatbotBtn');
      const aiChatbotModal = document.getElementById('aiChatbotModal');
      const aiChatbotIframe = document.getElementById('aiChatbotIframe');
      const closeAiChatbotBtn = document.getElementById('closeAiChatbotModal');

      if (aiChatbotBtn && aiChatbotModal && aiChatbotIframe) {
        // í”Œë¡œíŒ… ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸° í† ê¸€
        aiChatbotBtn.addEventListener('click', function() {
          if (aiChatbotModal.classList.contains('show')) {
            aiChatbotModal.classList.remove('show');
            aiChatbotIframe.src = ''; // iframe ì´ˆê¸°í™”
          } else {
            aiChatbotIframe.src = '/demo-ai-korean-chatbot.html';
            aiChatbotModal.classList.add('show');
          }
        });

        // ë‹«ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
        if (closeAiChatbotBtn) {
          closeAiChatbotBtn.addEventListener('click', function() {
            aiChatbotModal.classList.remove('show');
            aiChatbotIframe.src = ''; // iframe ì´ˆê¸°í™”
          });
        }

        // ë“œëž˜ê·¸ ê¸°ëŠ¥ êµ¬í˜„
        let isDragging = false;
        let currentX;
        let currentY;
        let initialX;
        let initialY;

        aiChatbotModal.addEventListener('mousedown', dragStart);
        document.addEventListener('mousemove', drag);
        document.addEventListener('mouseup', dragEnd);

        // í„°ì¹˜ ì´ë²¤íŠ¸ë„ ì§€ì›
        aiChatbotModal.addEventListener('touchstart', dragStart);
        document.addEventListener('touchmove', drag);
        document.addEventListener('touchend', dragEnd);

        function dragStart(e) {
          // ë‹«ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ ë“œëž˜ê·¸ ë°©ì§€
          if (e.target.closest('.ai-chatbot-modal-close')) {
            return;
          }

          // iframe ì˜ì—­ í´ë¦­ ì‹œ ë“œëž˜ê·¸ ë°©ì§€
          if (e.target.closest('.ai-chatbot-modal-iframe')) {
            return;
          }

          if (e.type === 'touchstart') {
            initialX = e.touches[0].clientX - (aiChatbotModal.offsetLeft || 0);
            initialY = e.touches[0].clientY - (aiChatbotModal.offsetTop || 0);
          } else {
            initialX = e.clientX - (aiChatbotModal.offsetLeft || 0);
            initialY = e.clientY - (aiChatbotModal.offsetTop || 0);
          }

          isDragging = true;
        }

        function drag(e) {
          if (isDragging) {
            e.preventDefault();

            if (e.type === 'touchmove') {
              currentX = e.touches[0].clientX - initialX;
              currentY = e.touches[0].clientY - initialY;
            } else {
              currentX = e.clientX - initialX;
              currentY = e.clientY - initialY;
            }

            // í™”ë©´ ê²½ê³„ ì²´í¬
            const maxX = window.innerWidth - aiChatbotModal.offsetWidth;
            const maxY = window.innerHeight - aiChatbotModal.offsetHeight;

            currentX = Math.max(0, Math.min(currentX, maxX));
            currentY = Math.max(0, Math.min(currentY, maxY));

            setPosition(currentX, currentY);
          }
        }

        function dragEnd(e) {
          isDragging = false;
        }

        function setPosition(xPos, yPos) {
          aiChatbotModal.style.left = xPos + 'px';
          aiChatbotModal.style.top = yPos + 'px';
          aiChatbotModal.style.right = 'auto';
          aiChatbotModal.style.bottom = 'auto';
        }
      }
    });

    // === AI ìžë™ ê³¼ì œ ìŠ¤ì¼€ì¤„ ìƒì„± í•¨ìˆ˜ ===
    async function createAISchedulesForLogs(logs, studentGrade, studentName) {
      try {
        console.log('ðŸ¤– AI ìŠ¤ì¼€ì¤„ ìƒì„± ì‹œìž‘ - í•™ìƒ:', studentName, 'ê¸°ë¡ ìˆ˜:', logs.length);

        // ê° ë‹¨ì›ë³„ë¡œ ìµœì‹  ê¸°ë¡ë§Œ ì²˜ë¦¬ (ì¤‘ë³µ ì œê±°)
        const latestLogs = {};
        logs.forEach(log => {
          const key = log.unit;
          if (!latestLogs[key] || new Date(log.timestamp) > new Date(latestLogs[key].timestamp)) {
            latestLogs[key] = log;
          }
        });

        // ê° ë‹¨ì›ë³„ë¡œ AI ìŠ¤ì¼€ì¤„ ìƒì„±
        for (const unitId in latestLogs) {
          const log = latestLogs[unitId];

          // radar ë°ì´í„°ê°€ ìžˆëŠ” ê²½ìš°ë§Œ ì²˜ë¦¬
          if (!log.radar) continue;

          // 5ê°œ ì˜ì—­ í‰ê·  ê³„ì‚°
          const scores = [
            log.radar.literal || 0,
            log.radar.structural || 0,
            log.radar.lexical || 0,
            log.radar.inferential || 0,
            log.radar.critical || 0
          ];
          const avgScore = parseFloat((scores.reduce((a, b) => a + b, 0) / 5).toFixed(1));

          // ë“±ê¸‰ íŒì •
          let grade = 'encourage';
          let gradeText = 'ê²©ë ¤';
          if (avgScore >= 9) {
            grade = 'excellent';
            gradeText = 'ìš°ìˆ˜';
          } else if (avgScore >= 8) {
            grade = 'good';
            gradeText = 'ì–‘í˜¸';
          } else if (avgScore >= 7) {
            grade = 'average';
            gradeText = 'ë³´í†µ';
          }

          // ìš°ìˆ˜ ë“±ê¸‰ì€ ìŠ¤ì¼€ì¤„ ìƒì„± ì•ˆ í•¨
          if (grade === 'excellent') continue;

          // ì‹œë¦¬ì¦ˆ, ë¶„ì•¼, ê³¼ëª© ì •ë³´ íŒŒì‹±
          const seriesName = log.series || 'BRAINì˜¨';
          const parts = (log.unit || '').split('_');
          let fieldName = 'ì‚¬íšŒë¶„ì•¼';
          let subjectName = 'ì§€ë¦¬';
          let unitTitle = log.unit;

          // ë‹¨ì› IDë¡œ ë¶„ì•¼/ê³¼ëª© íŒë³„ (ê°„ë‹¨í•œ ì˜ˆì‹œ)
          if (parts[0] === 'geo') {
            fieldName = 'ì‚¬íšŒë¶„ì•¼';
            subjectName = 'ì§€ë¦¬';
            unitTitle = `ì§€ë¦¬ ${parts[1]}ë‹¨ì›`;
          } else if (parts[0] === 'his') {
            fieldName = 'ì‚¬íšŒë¶„ì•¼';
            subjectName = 'ì—­ì‚¬';
            unitTitle = `ì—­ì‚¬ ${parts[1]}ë‹¨ì›`;
          } else if (parts[0] === 'phy') {
            fieldName = 'ê³¼í•™ë¶„ì•¼';
            subjectName = 'ë¬¼ë¦¬';
            unitTitle = `ë¬¼ë¦¬ ${parts[1]}ë‹¨ì›`;
          } else if (parts[0] === 'bio') {
            fieldName = 'ê³¼í•™ë¶„ì•¼';
            subjectName = 'ìƒë¬¼';
            unitTitle = `ìƒë¬¼ ${parts[1]}ë‹¨ì›`;
          }

          // AI ìŠ¤ì¼€ì¤„ ìƒì„± API í˜¸ì¶œ
          const response = await fetch('/api/ai-task/create-schedule', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              studentGrade,
              studentName,
              unitId: log.unit,
              unitTitle,
              seriesName,
              fieldName,
              subjectName,
              avgScore,
              completedAt: log.timestamp || new Date()
            })
          });

          const result = await response.json();
          if (result.ok && result.schedule) {
            console.log(`âœ… AI ìŠ¤ì¼€ì¤„ ìƒì„±: ${unitTitle} (${gradeText}, ${avgScore}ì )`);
          }
        }

        console.log('ðŸ¤– AI ìŠ¤ì¼€ì¤„ ìƒì„± ì™„ë£Œ');
      } catch (error) {
        console.error('âŒ AI ìŠ¤ì¼€ì¤„ ìƒì„± ì˜¤ë¥˜:', error);
      }
    }

    // === ë ˆì´ë” ë“±ê¸‰ ë±ƒì§€ ì—…ë°ì´íŠ¸ (ì‹¤ì‹œê°„ ê³„ì‚°) ===
    async function updateRadarGradeBadge() {
      // âœ… localStorageì˜ currentStudentë¥¼ ìš°ì„  ì‚¬ìš© (ê°€ìž¥ ìµœì‹  ë¡œê·¸ì¸ ì •ë³´)
      let user = JSON.parse(localStorage.getItem('currentStudent') || '{}');

      // localStorageì— ì—†ìœ¼ë©´ sessionStorage ì‚¬ìš©
      if (!user.grade || !user.name) {
        user = JSON.parse(sessionStorage.getItem('user') || '{}');
      }

      const grade = user.grade || '';
      const name = user.name || '';
      const phone = user.phone || '';

      console.log('ðŸ” ë±ƒì§€ ì—…ë°ì´íŠ¸ - ì‚¬ìš©ìž ì •ë³´:', { grade, name, phone });

      if (!grade || !name) {
        console.log('âš ï¸ ì‚¬ìš©ìž ì •ë³´ ì—†ìŒ');
        document.getElementById('radarGradeBadge').textContent = '-';
        return;
      }

      try {
        // âœ… í•™ìŠµ ê¸°ë¡ ì¡°íšŒ (phone ì œì™¸ - ê¸°ì¡´ ì €ìž¥ ë°ì´í„° í˜¸í™˜)
        const url = `/api/learning-logs?grade=${encodeURIComponent(grade)}&name=${encodeURIComponent(name)}`;

        console.log('ðŸ“¡ í•™ìŠµ ê¸°ë¡ API í˜¸ì¶œ:', url);
        const response = await fetch(url);
        const logs = await response.json();

        if (!logs || logs.length === 0) {
          console.log('âš ï¸ í•™ìŠµ ê¸°ë¡ ì—†ìŒ');
          document.getElementById('radarGradeBadge').textContent = '-';
          return;
        }

        console.log('ðŸ“š ì´ í•™ìŠµ ê¸°ë¡:', logs.length, 'ê°œ');

        // ì§„ë„ìœ¨ ê³„ì‚° (ì „ì²´ ì‹œë¦¬ì¦ˆ ê¸°ì¤€ 400ê°œ ë‹¨ì›)
        const completedUnits = new Set();
        logs.forEach(log => {
          if (log.unit) {
            completedUnits.add(log.unit);
          }
        });
        const progressPercent = Math.round((completedUnits.size / 400) * 100);

        // radar ë°ì´í„°ê°€ ìžˆëŠ” ë¡œê·¸ë§Œ í•„í„°ë§
        const validLogs = logs.filter(log => log.radar);
        console.log('ðŸ“Š radar ë°ì´í„°ê°€ ìžˆëŠ” ê¸°ë¡:', validLogs.length, 'ê°œ');

        let avgScore = 0;
        let gradeClass = 'encourage';

        if (validLogs.length > 0) {
          // ì‹œë¦¬ì¦ˆ ì¢…í•© ë ˆì´ë”ì™€ ë™ì¼í•œ í‰ê·  ê³„ì‚° (5ê°œ ì˜ì—­ í‰ê· )
          let totalLiteral = 0, totalStructural = 0, totalLexical = 0;
          let totalInferential = 0, totalCritical = 0;
          let count = 0;

          validLogs.forEach(log => {
            totalLiteral += log.radar.literal || 0;
            totalStructural += log.radar.structural || 0;
            totalLexical += log.radar.lexical || 0;
            totalInferential += log.radar.inferential || 0;
            totalCritical += log.radar.critical || 0;
            count++;
          });

          const avgLiteral = Math.round((totalLiteral / count) * 10) / 10;
          const avgStructural = Math.round((totalStructural / count) * 10) / 10;
          const avgLexical = Math.round((totalLexical / count) * 10) / 10;
          const avgInferential = Math.round((totalInferential / count) * 10) / 10;
          const avgCritical = Math.round((totalCritical / count) * 10) / 10;

          const scores = [avgLiteral, avgStructural, avgLexical, avgInferential, avgCritical];
          avgScore = parseFloat((scores.reduce((a, b) => a + b, 0) / 5).toFixed(1));

          // ë“±ê¸‰ ê³„ì‚° (ìƒ‰ìƒ ê²°ì •ìš©)
          if (avgScore >= 9) {
            gradeClass = 'excellent';
          } else if (avgScore >= 8) {
            gradeClass = 'good';
          } else if (avgScore >= 7) {
            gradeClass = 'average';
          } else {
            gradeClass = 'encourage';
          }

          // âœ… AI ìžë™ ê³¼ì œ ìŠ¤ì¼€ì¤„ ìƒì„± (ìš°ìˆ˜ ì œì™¸)
          await createAISchedulesForLogs(validLogs, grade, name);
        }

        // ë±ƒì§€ ì—…ë°ì´íŠ¸ (í‰ì  / ì§„ë„ìœ¨ í‘œì‹œ)
        const badge = document.getElementById('radarGradeBadge');
        if (validLogs.length > 0) {
          // radar ë°ì´í„°ê°€ ìžˆìœ¼ë©´: í‰ì  / ì§„ë„ìœ¨
          badge.textContent = avgScore + ' / ' + progressPercent;
        } else {
          // radar ë°ì´í„°ê°€ ì—†ìœ¼ë©´: ì§„ë„ìœ¨ë§Œ í‘œì‹œ
          badge.textContent = '- / ' + progressPercent;
        }
        badge.className = 'radar-grade-badge ' + gradeClass;

        console.log('âœ… ë ˆì´ë” ë±ƒì§€ ì—…ë°ì´íŠ¸:', avgScore || '-', 'ì  / ì§„ë„ìœ¨:', progressPercent, '%');
      } catch (error) {
        console.error('âŒ ë ˆì´ë” ë“±ê¸‰ ì¡°íšŒ ì‹¤íŒ¨:', error);
      }
    }

    // === ë ˆì´ë” ì°¨íŠ¸ ì•„ì´ì½˜ í´ë¦­ ì´ë²¤íŠ¸ (ëª¨ë‹¬ë¡œ í‘œì‹œ) ===
    window.addEventListener('DOMContentLoaded', function() {
      const radarIcon = document.getElementById('radarChartIcon');
      const learningModal = document.getElementById('learningModal');
      const learningIframe = document.getElementById('learningIframe');
      const closeModalBtn = document.getElementById('closeLearningModal');

      // ë ˆì´ë” ë“±ê¸‰ ë±ƒì§€ ì—…ë°ì´íŠ¸ (ì´ˆê¸° ë¡œë“œ)
      updateRadarGradeBadge();

      // íŽ˜ì´ì§€ê°€ ë³´ì¼ ë•Œë§ˆë‹¤ ë±ƒì§€ ì—…ë°ì´íŠ¸ (í•™ìŠµ ì™„ë£Œ í›„ ëŒì•„ì™”ì„ ë•Œ)
      document.addEventListener('visibilitychange', async function() {
        if (!document.hidden) {
          console.log('ðŸ”„ íŽ˜ì´ì§€ í™œì„±í™” - ë±ƒì§€ ë° í•™ìŠµ ì™„ë£Œ ìƒíƒœ ì—…ë°ì´íŠ¸');
          updateRadarGradeBadge();
          // ë©”ì¸ ë©”ë‰´ì˜ í•™ìŠµ ì™„ë£Œ ìƒíƒœ ë° ë³„ì  ì—…ë°ì´íŠ¸
          await updateAllLessonStatus();
        }
      });

      // ëª¨ë‹¬ ë‹«ì„ ë•Œë„ ë±ƒì§€ ì—…ë°ì´íŠ¸
      if (closeModalBtn) {
        closeModalBtn.addEventListener('click', function() {
          console.log('ðŸ”„ ëª¨ë‹¬ ë‹«ê¸° - ë±ƒì§€ ì—…ë°ì´íŠ¸');
          updateRadarGradeBadge();
        });
      }

      if (radarIcon && learningModal && learningIframe) {
        // ì•„ì´ì½˜ í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ê¸°
        radarIcon.addEventListener('click', function() {
          const user = JSON.parse(sessionStorage.getItem('user') || '{}');
          console.log('ðŸ” sessionStorage user:', user);
          const grade = user.grade || 'í•™ë…„ë¯¸ì§€ì •';
          const name = user.name || 'ì´ë¦„ë¯¸ì§€ì •';
          console.log('ðŸ“Š Opening learning page:', { grade, name });

          const url = `/my-learning?grade=${encodeURIComponent(grade)}&name=${encodeURIComponent(name)}`;
          console.log('ðŸ”— URL:', url);

          // iframeì— URL ì„¤ì •í•˜ê³  ëª¨ë‹¬ ì—´ê¸°
          learningIframe.src = url;
          learningModal.classList.add('show');
        });

        // ë‹«ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
        if (closeModalBtn) {
          closeModalBtn.addEventListener('click', function() {
            learningModal.classList.remove('show');
            learningIframe.src = ''; // iframe ì´ˆê¸°í™”
          });
        }

        // ë°°ê²½ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
        learningModal.addEventListener('click', function(e) {
          if (e.target === learningModal) {
            learningModal.classList.remove('show');
            learningIframe.src = ''; // iframe ì´ˆê¸°í™”
          }
        });

        // ì „ì†¡í•˜ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ ì´ë©”ì¼ ì—´ê¸°
        const sendBtn = document.getElementById('sendLearningBtn');
        if (sendBtn) {
          console.log('âœ… ì „ì†¡í•˜ê¸° ë²„íŠ¼ ì°¾ìŒ:', sendBtn);
          sendBtn.addEventListener('click', function() {
            console.log('ðŸ“§ ì „ì†¡í•˜ê¸° ë²„íŠ¼ í´ë¦­ë¨');

            // iframeì—ì„œ í•™ìƒ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const iframeSrc = learningIframe.src;
            const urlParams = new URLSearchParams(iframeSrc.split('?')[1]);
            const grade = urlParams.get('grade') || '';
            const name = urlParams.get('name') || '';

            // ì´ë©”ì¼ ì œëª©ê³¼ ë³¸ë¬¸ ì„¤ì •
            const subject = `[ë‹¨ë‹¨êµ­ì–´] ${grade} ${name} í•™ìƒ í•™ìŠµ ë¶„ì„ ë¦¬í¬íŠ¸`;
            const body = `ì•ˆë…•í•˜ì„¸ìš”,

${grade} ${name} í•™ìƒì˜ í•™ìŠµ ë¶„ì„ ë¦¬í¬íŠ¸ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.

ðŸ“Š í•™ìŠµ ë¶„ì„ ë‚´ìš©:
- í•™ìŠµ ê¸°ë¡ ë° ì ìˆ˜
- ë‹¨ì›ë³„ ë¬¸í•´ë ¥ ë ˆì´ë” ì°¨íŠ¸
- ì¢…í•© ë¶„ì„ ê²°ê³¼

ìžì„¸í•œ ë‚´ìš©ì€ ì²¨ë¶€ëœ PDF íŒŒì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.

â€» PDF íŒŒì¼ì€ 'ë‹¤ìš´ë¡œë“œ' ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë¨¼ì € ì €ìž¥í•œ í›„ ì´ë©”ì¼ì— ì²¨ë¶€í•´ì£¼ì„¸ìš”.

ê°ì‚¬í•©ë‹ˆë‹¤.`;

            // mailto ë§í¬ ìƒì„±
            const mailtoLink = 'mailto:?subject=' + encodeURIComponent(subject) + '&body=' + encodeURIComponent(body);

            console.log('ðŸ“§ ì´ë©”ì¼ ì•± ì—´ê¸°:', mailtoLink);
            window.location.href = mailtoLink;
          });
        } else {
          console.error('âŒ ì „ì†¡í•˜ê¸° ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        }

        // ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ë²„íŠ¼ í´ë¦­ ì‹œ
        const kakaoShareBtn = document.getElementById('kakaoShareBtn');
        if (kakaoShareBtn) {
          console.log('âœ… ì¹´ì¹´ì˜¤í†¡ ì „ì†¡ ë²„íŠ¼ ì°¾ìŒ:', kakaoShareBtn);
          kakaoShareBtn.addEventListener('click', function() {
            console.log('ðŸ’¬ ì¹´ì¹´ì˜¤í†¡ ì „ì†¡ ë²„íŠ¼ í´ë¦­ë¨');

            // iframeì—ì„œ í•™ìƒ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const iframeSrc = learningIframe.src;
            const urlParams = new URLSearchParams(iframeSrc.split('?')[1]);
            const grade = urlParams.get('grade') || '';
            const name = urlParams.get('name') || '';

            // ì¹´ì¹´ì˜¤í†¡ ê³µìœ í•˜ê¸°
            if (typeof Kakao !== 'undefined' && Kakao.isInitialized()) {
              try {
                // ë°°í¬ í™˜ê²½ì—ì„œëŠ” ì‹¤ì œ ë„ë©”ì¸ ì‚¬ìš©, ë¡œì»¬ì—ì„œëŠ” localhost ì‚¬ìš©
                const baseUrl = window.location.hostname === 'localhost'
                  ? window.location.origin
                  : 'https://project-2516060862411225169.web.app';

                const reportPath = iframeSrc.replace(window.location.origin, '');
                const fullUrl = baseUrl + reportPath;

                Kakao.Share.sendDefault({
                  objectType: 'feed',
                  content: {
                    title: `ðŸ“Š ${grade} ${name} í•™ìƒ í•™ìŠµ ë¶„ì„ ë¦¬í¬íŠ¸`,
                    description: 'ë‹¨ë‹¨êµ­ì–´ í•™ìŠµ ë¶„ì„ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”!\n\nðŸ“ˆ í•™ìŠµ ê¸°ë¡ ë° ì ìˆ˜\nðŸ“Š ë‹¨ì›ë³„ ë¬¸í•´ë ¥ ë ˆì´ë” ì°¨íŠ¸\nâœ¨ ì¢…í•© ë¶„ì„ ê²°ê³¼',
                    imageUrl: 'https://project-2516060862411225169.web.app/images/report-share-thumbnail.png',
                    link: {
                      mobileWebUrl: fullUrl,
                      webUrl: fullUrl
                    }
                  },
                  buttons: [
                    {
                      title: 'ë¦¬í¬íŠ¸ ë³´ê¸°',
                      link: {
                        mobileWebUrl: fullUrl,
                        webUrl: fullUrl
                      }
                    }
                  ]
                });
                console.log('âœ… ì¹´ì¹´ì˜¤í†¡ ê³µìœ í•˜ê¸° ì‹¤í–‰ë¨:', fullUrl);
              } catch (error) {
                console.error('âŒ ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ì˜¤ë¥˜:', error);
                alert('ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\nì¹´ì¹´ì˜¤í†¡ì´ ì„¤ì¹˜ë˜ì–´ ìžˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
              }
            } else {
              console.error('âŒ Kakao SDKê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
              alert('ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\níŽ˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
          });
        } else {
          console.error('âŒ ì¹´ì¹´ì˜¤í†¡ ì „ì†¡ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        }

        // ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ í´ë¦­ ì‹œ PDF ìƒì„±
        const downloadBtn = document.getElementById('downloadLearningBtn');
        if (downloadBtn) {
          console.log('âœ… ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ì°¾ìŒ:', downloadBtn);
          downloadBtn.addEventListener('click', function() {
            console.log('ðŸ“¥ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ í´ë¦­ë¨');
            console.log('iframe:', learningIframe);
            console.log('iframe.contentWindow:', learningIframe.contentWindow);
            if (learningIframe && learningIframe.contentWindow) {
              console.log('ðŸ’¬ iframeì— ë©”ì‹œì§€ ì „ì†¡ ì¤‘...');
              learningIframe.contentWindow.postMessage({ action: 'downloadPDF' }, '*');
            } else {
              console.error('âŒ iframe.contentWindowë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
              alert('íŽ˜ì´ì§€ë¥¼ ë¨¼ì € ë¡œë“œí•´ì£¼ì„¸ìš”.');
            }
          });
        } else {
          console.error('âŒ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        }
      }
    });

    // ë…¸íŠ¸ ì•„ì´ì½˜ í´ë¦­ ê¸°ëŠ¥ - ì–´íœ˜ë ¥ í€´ì¦ˆì‡¼ ëª¨ë‹¬
    document.addEventListener('DOMContentLoaded', () => {
      const noteIcon = document.getElementById('noteIcon');
      const vocabModal = document.getElementById('vocabQuizModal');
      const vocabIframe = document.getElementById('vocabQuizIframe');
      const closeVocabModal = document.getElementById('closeVocabModal');

      if (noteIcon) {
        noteIcon.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();

          // ëª¨ë‹¬ ì—´ê¸°
          vocabIframe.src = '/demo-vocabulary-quiz.html';
          vocabModal.classList.add('show');
        });
      }

      // ë‹«ê¸° ë²„íŠ¼
      if (closeVocabModal) {
        closeVocabModal.addEventListener('click', () => {
          vocabModal.classList.remove('show');
          vocabIframe.src = '';
        });
      }

      // ë°°ê²½ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
      if (vocabModal) {
        vocabModal.addEventListener('click', (e) => {
          if (e.target === vocabModal) {
            vocabModal.classList.remove('show');
            vocabIframe.src = '';
          }
        });
      }

      // iframeì—ì„œ í•™ìŠµì™„ë£Œ ë©”ì‹œì§€ë¥¼ ë°›ìœ¼ë©´ ëª¨ë‹¬ ë‹«ê¸° ë° í•™ìŠµì‹¤ ìƒˆë¡œê³ ì¹¨
      window.addEventListener('message', async (event) => {
        if (event.data && event.data.type === 'vocabularyQuizCompleted') {
          console.log('âœ… ì–´íœ˜ í€´ì¦ˆ ì™„ë£Œ - ëª¨ë‹¬ ë‹«ê¸° ë° í•™ìŠµì‹¤ ìƒˆë¡œê³ ì¹¨');
          vocabModal.classList.remove('show');
          vocabIframe.src = '';

          // ë‚˜ì˜ í•™ìŠµì‹¤ì´ ì—´ë ¤ìžˆìœ¼ë©´ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          const studyRoomPopup = document.getElementById('studyRoomPopup');
          if (studyRoomPopup && studyRoomPopup.classList.contains('show')) {
            await renderStudyRoomList();
            console.log('âœ… ë‚˜ì˜ í•™ìŠµì‹¤ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
          }
        }
      });
    });

    // ========================================
    // í•™ìŠµì‹¤ (Study Room) ê¸°ëŠ¥
    // ========================================

    // ê´€ë¦¬ìž ë¹„ë°€ë²ˆí˜¸ (í†µí•© ë¹„ë°€ë²ˆí˜¸)
    const ADMIN_PASSWORD = '1234';

    // í˜„ìž¬ ë¡œê·¸ì¸í•œ í•™ìƒ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    function getCurrentStudentKey() {
      return localStorage.getItem('currentStudentKey') || 'guest';
    }

    // í•™ìŠµì‹¤ ë°ì´í„° í‚¤ ìƒì„±
    function getStudyRoomKey() {
      return `studyRoom_${getCurrentStudentKey()}`;
    }

    // í•™ìŠµì‹¤ ê³¼ì œ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° (ì„œë²„ DBì—ì„œ)
    async function getStudyRoomTasks() {
      try {
        const user = JSON.parse(localStorage.getItem('currentStudent') || '{}');
        if (!user.grade || !user.name) {
          console.log('âš ï¸ ì‚¬ìš©ìž ì •ë³´ ì—†ìŒ - localStorage ì‚¬ìš©');
          const key = getStudyRoomKey();
          const data = localStorage.getItem(key);
          return data ? JSON.parse(data) : [];
        }

        // ì„œë²„ì—ì„œ í•™ìŠµì‹¤ ë°ì´í„° ì¡°íšŒ
        const response = await fetch(`/api/user-progress/study-room?grade=${encodeURIComponent(user.grade)}&name=${encodeURIComponent(user.name)}`);
        const result = await response.json();

        if (result.ok && result.data?.studyRoom?.assignedTasks) {
          console.log('âœ… ì„œë²„ì—ì„œ í•™ìŠµì‹¤ ë°ì´í„° ë¡œë“œ:', result.data.studyRoom.assignedTasks.length, 'ê°œ');
          return result.data.studyRoom.assignedTasks;
        }

        // ì„œë²„ì— ë°ì´í„° ì—†ìœ¼ë©´ localStorage fallback
        console.log('âš ï¸ ì„œë²„ ë°ì´í„° ì—†ìŒ - localStorage ì‚¬ìš©');
        const key = getStudyRoomKey();
        const data = localStorage.getItem(key);
        return data ? JSON.parse(data) : [];
      } catch (error) {
        console.error('âŒ í•™ìŠµì‹¤ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
        // ì˜¤ë¥˜ ì‹œ localStorage fallback
        const key = getStudyRoomKey();
        const data = localStorage.getItem(key);
        return data ? JSON.parse(data) : [];
      }
    }

    // í•™ìŠµì‹¤ ê³¼ì œ ëª©ë¡ ì €ìž¥í•˜ê¸° (ì„œë²„ DBì—)
    async function saveStudyRoomTasks(tasks) {
      try {
        const user = JSON.parse(localStorage.getItem('currentStudent') || '{}');
        if (!user.grade || !user.name) {
          console.log('âš ï¸ ì‚¬ìš©ìž ì •ë³´ ì—†ìŒ - localStorageì—ë§Œ ì €ìž¥');
          const key = getStudyRoomKey();
          localStorage.setItem(key, JSON.stringify(tasks));
          updateStudyRoomBadge();
          return;
        }

        // ì„œë²„ì— ì €ìž¥
        const response = await fetch('/api/user-progress/study-room', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            grade: user.grade,
            name: user.name,
            assignedTasks: tasks
          })
        });

        const result = await response.json();
        if (result.ok) {
          console.log('âœ… í•™ìŠµì‹¤ ë°ì´í„° ì„œë²„ ì €ìž¥ ì™„ë£Œ');
        } else {
          console.error('âŒ ì„œë²„ ì €ìž¥ ì‹¤íŒ¨:', result.message);
          // fallback to localStorage
          const key = getStudyRoomKey();
          localStorage.setItem(key, JSON.stringify(tasks));
        }
      } catch (error) {
        console.error('âŒ í•™ìŠµì‹¤ ë°ì´í„° ì €ìž¥ ì˜¤ë¥˜:', error);
        // fallback to localStorage
        const key = getStudyRoomKey();
        localStorage.setItem(key, JSON.stringify(tasks));
      }

      updateStudyRoomBadge();
    }

    // ë±ƒì§€ ì—…ë°ì´íŠ¸
    async function updateStudyRoomBadge() {
      const badge = document.getElementById('studyRoomBadge');
      if (badge) {
        const tasks = await getStudyRoomTasks();

        // ì™„ë£Œëœ ê³¼ì œ ê°œìˆ˜ ê³„ì‚° (í•™ìŠµì™„ë£Œ + ë³µìŠµì™„ë£Œ)
        // - AI ê³¼ì œ: task.status === 'completed' (ë³µìŠµì™„ë£Œ)
        // - ì¼ë°˜ ê³¼ì œ: isUnitCompleted()ë¡œ í•™ìŠµ ì™„ë£Œ í™•ì¸ (í•™ìŠµì™„ë£Œ)
        const completedCount = tasks.filter(task => {
          if (task.isAI) {
            // AI ê³¼ì œëŠ” statusê°€ 'completed'ì¸ ê²½ìš° (ë³µìŠµì™„ë£Œ)
            return task.status === 'completed';
          } else {
            // ì¼ë°˜ ê³¼ì œëŠ” LearningLogì— ê¸°ë¡ëœ ê²½ìš° (í•™ìŠµì™„ë£Œ)
            const unitId = task.id || task.unitId;
            return isUnitCompleted(unitId);
          }
        }).length;

        // ì–´íœ˜í€´ì¦ˆ ì™„ë£Œ ì—¬ë¶€ í™•ì¸
        const vocabCompleted = await checkVocabularyCompletedToday();

        // ì „ì²´ ê³¼ì œ ê°œìˆ˜ = ê¸°ì¡´ ê³¼ì œ + ì–´íœ˜í€´ì¦ˆ(1ê°œ)
        const totalCount = tasks.length + 1;

        // ì™„ë£Œ ê°œìˆ˜ = ê¸°ì¡´ ì™„ë£Œ + ì–´íœ˜í€´ì¦ˆ ì™„ë£Œ ì—¬ë¶€
        const totalCompletedCount = completedCount + (vocabCompleted ? 1 : 0);

        badge.textContent = `${totalCompletedCount}/${totalCount}`;
      }
    }

    // ì–´íœ˜í€´ì¦ˆ í‰ê· ì ìˆ˜ ë±ƒì§€ ì—…ë°ì´íŠ¸
    function updateVocabAvgBadge() {
      const badge = document.getElementById('vocabAvgBadge');
      console.log('ðŸŽ¯ updateVocabAvgBadge ì‹¤í–‰, badge ìš”ì†Œ:', badge);

      if (badge) {
        const userStr = sessionStorage.getItem('user');
        let storageKey = 'vocabAvgScore'; // fallback
        if (userStr) {
          try {
            const user = JSON.parse(userStr);
            // ì–´íœ˜í€´ì¦ˆì™€ ë™ì¼í•œ í˜•ì‹: baseKey_grade_name
            storageKey = `vocabAvgScore_${user.grade}_${user.name}`;
            console.log('ðŸ‘¤ ì‚¬ìš©ìž ì •ë³´:', user, 'í‚¤:', storageKey);
          } catch(e) {
            console.error('âŒ User parse error:', e);
          }
        }

        const avgScore = localStorage.getItem(storageKey);
        console.log('ðŸ“Š localStorage í‚¤:', storageKey, 'ê°’:', avgScore);

        badge.textContent = avgScore ? avgScore : '0';
        console.log('âœ… ë±ƒì§€ ì—…ë°ì´íŠ¸ ì™„ë£Œ:', badge.textContent);
      } else {
        console.error('âŒ vocabAvgBadge ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
      }
    }

    // í•™ìŠµì‹¤ ëª¨ë‹¬ ì—´ê¸°
    async function openStudyRoomModal() {
      const modal = document.getElementById('studyRoomModal');
      if (modal) {
        modal.classList.add('show');
        // ê³¼ì œ ëª©ë¡ ë Œë”ë§
        await renderStudyRoomList();
      }
    }

    // í•™ìŠµì‹¤ ëª¨ë‹¬ ë‹«ê¸°
    async function closeStudyRoomModal() {
      console.log('ðŸšª í•™ìŠµì‹¤ ëª¨ë‹¬ ë‹«ê¸° ì‹œìž‘');
      const modal = document.getElementById('studyRoomModal');
      if (modal) {
        modal.classList.remove('show');
        console.log('âœ… ëª¨ë‹¬ ìˆ¨ê¹€ ì™„ë£Œ, í•™ìŠµ ì™„ë£Œ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹œìž‘');
        // ë©”ì¸ ë©”ë‰´ì˜ í•™ìŠµ ì™„ë£Œ ìƒíƒœ ì—…ë°ì´íŠ¸
        await updateAllLessonStatus();
        console.log('âœ… í•™ìŠµì‹¤ ëª¨ë‹¬ ë‹«ê¸° ì™„ë£Œ');
      } else {
        console.error('âŒ studyRoomModal ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
      }
    }

    // ë©”ì¸ ë©”ë‰´ì˜ ëª¨ë“  ë‹¨ì› í•™ìŠµ ì™„ë£Œ ìƒíƒœ ë° ë³„ì  ì—…ë°ì´íŠ¸
    async function updateAllLessonStatus() {
      console.log('ðŸ”„ í•™ìŠµ ì™„ë£Œ ìƒíƒœ ë° ë³„ì  ì—…ë°ì´íŠ¸ ì‹œìž‘');

      // í˜„ìž¬ ë Œë”ë§ëœ ë‹¨ì› ëª©ë¡ì´ ìžˆìœ¼ë©´ ë‹¤ì‹œ ë Œë”ë§ (ë“±ê¸‰ ë°ì´í„° í¬í•¨)
      if (currentUnits && currentUnits.length > 0) {
        console.log('ðŸ“š í˜„ìž¬ ë‹¨ì› ëª©ë¡ ë‹¤ì‹œ ë Œë”ë§:', currentUnits.length, 'ê°œ');
        await renderUnitList(currentUnits);
        console.log('âœ… ë©”ì¸ ë©”ë‰´ í•™ìŠµ ì™„ë£Œ ìƒíƒœ ë° ë³„ì  ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        return; // ìž¬ë Œë”ë§ ì™„ë£Œ, í•¨ìˆ˜ ì¢…ë£Œ
      }

      console.log('âš ï¸ currentUnitsê°€ ë¹„ì–´ìžˆìŒ, DOM ìš”ì†Œ ì§ì ‘ ì—…ë°ì´íŠ¸');

      // ìµœì‹  ë“±ê¸‰ ë°ì´í„° ë¡œë“œ
      unitGradesData = await fetchUnitGrades();
      console.log('â­ fetchUnitGrades ì™„ë£Œ, unitGradesData:', Object.keys(unitGradesData).length, 'ê°œ');

      // DOMì—ì„œ í˜„ìž¬ ë³´ì´ëŠ” ë‹¨ì›ë“¤ì„ ì°¾ì•„ì„œ ì—…ë°ì´íŠ¸
      const allUnits = document.querySelectorAll('.unit-item[data-page]');
      console.log('ðŸ“‹ DOMì—ì„œ ì°¾ì€ ë‹¨ì› ìˆ˜:', allUnits.length);

      allUnits.forEach(unit => {
        const pageKey = unit.dataset.page;
        if (!pageKey) return;

        // pageKeyì—ì„œ ë‹¨ì› ì½”ë“œ ì¶”ì¶œ
        let unitCode = pageKey;
        const match = pageKey.match(/\/([^\/]+)\.html$/);
        if (match) {
          unitCode = match[1];
        }

        // ì™„ë£Œ ì—¬ë¶€ í™•ì¸
        const completed = isUnitCompleted(pageKey);

        // ë°°ì§€ ì—…ë°ì´íŠ¸
        const badge = unit.querySelector('.status-badge');
        if (badge) {
          badge.classList.remove('status-default', 'status-done');
          if (completed) {
            badge.classList.add('status-done');
            badge.textContent = 'ðŸ† í•™ìŠµì™„ë£Œ';
          } else {
            badge.classList.add('status-default');
            badge.textContent = 'âœï¸ ë¯¸ì™„ë£Œ';
          }
        }

        // ë³„ì  ì—…ë°ì´íŠ¸
        const unitRight = unit.querySelector('.unit-right');
        if (unitRight) {
          // ê¸°ì¡´ ë³„ì  ì œê±°
          const existingStars = unitRight.querySelector('.unit-stars');
          if (existingStars) {
            existingStars.remove();
          }

          // ìƒˆë¡œìš´ ë³„ì  ì¶”ê°€ (ì™„ë£Œëœ ê²½ìš°ë§Œ)
          if (completed) {
            const gradeInfo = unitGradesData[unitCode];
            const stars = gradeInfo ? getStarsForGrade(gradeInfo.grade) : '';

            console.log(`â­ [${unitCode}] completed=${completed}, gradeInfo=`, gradeInfo, 'stars=', stars);

            if (stars) {
              const starsSpan = document.createElement('span');
              starsSpan.className = 'unit-stars';
              starsSpan.textContent = stars;
              // ë°°ì§€ ì•žì— ë³„ì  ì‚½ìž…
              if (badge) {
                unitRight.insertBefore(starsSpan, badge);
              } else {
                unitRight.appendChild(starsSpan);
              }
            }
          }
        }
      });
      console.log('âœ… ë©”ì¸ ë©”ë‰´ í•™ìŠµ ì™„ë£Œ ìƒíƒœ ë° ë³„ì  ì—…ë°ì´íŠ¸ ì™„ë£Œ');
    }

    // ì˜¤ëŠ˜ ì–´íœ˜í€´ì¦ˆ ì™„ë£Œ ì—¬ë¶€ í™•ì¸
    async function checkVocabularyCompletedToday() {
      try {
        const userStr = sessionStorage.getItem('user');
        if (!userStr) {
          console.error('ì‚¬ìš©ìž ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤');
          return false;
        }

        const user = JSON.parse(userStr);

        const response = await fetch(
          `/api/user-progress/vocabulary-history/today?grade=${encodeURIComponent(user.grade)}&name=${encodeURIComponent(user.name)}`
        );

        const result = await response.json();
        if (result.ok) {
          return result.completedToday;
        }
        return false;
      } catch (error) {
        console.error('ì–´íœ˜í€´ì¦ˆ ì™„ë£Œ ì—¬ë¶€ í™•ì¸ ì˜¤ë¥˜:', error);
        return false;
      }
    }

    // ì–´íœ˜í€´ì¦ˆ íŒì—… ì—´ê¸°
    function openVocabularyQuiz() {
      const existingOverlay = document.getElementById('vocabularyQuizOverlay');
      if (existingOverlay) {
        existingOverlay.remove();
      }

      const overlay = document.createElement('div');
      overlay.id = 'vocabularyQuizOverlay';
      overlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10003;
      `;

      // ì»¨í…Œì´ë„ˆ (iframe + X ë²„íŠ¼ì„ í¬í•¨)
      const container = document.createElement('div');
      container.style.cssText = `
        position: relative;
        width: 1000px;
        height: 700px;
        max-width: 90%;
        max-height: 90%;
      `;

      // X ë²„íŠ¼
      const closeBtn = document.createElement('button');
      closeBtn.innerHTML = '&times;';
      closeBtn.style.cssText = `
        position: absolute;
        top: -15px;
        right: -15px;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: #ff4444;
        color: white;
        border: 3px solid white;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10004;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        transition: all 0.2s ease;
      `;
      closeBtn.onmouseover = () => {
        closeBtn.style.background = '#cc0000';
        closeBtn.style.transform = 'scale(1.1)';
      };
      closeBtn.onmouseout = () => {
        closeBtn.style.background = '#ff4444';
        closeBtn.style.transform = 'scale(1)';
      };
      closeBtn.onclick = closeVocabularyQuiz;

      // iframe
      const iframe = document.createElement('iframe');
      iframe.id = 'vocabularyQuizIframe';
      iframe.src = '/demo-vocabulary-quiz.html';
      iframe.style.cssText = `
        width: 100%;
        height: 100%;
        border: none;
        border-radius: 12px;
        background: white;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      `;

      container.appendChild(closeBtn);
      container.appendChild(iframe);
      overlay.appendChild(container);
      document.body.appendChild(overlay);

      // ì˜¤ë²„ë ˆì´ í´ë¦­ ì‹œ ë‹«ê¸° (iframe ì™¸ë¶€ í´ë¦­)
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
          closeVocabularyQuiz();
        }
      });
    }

    // ì–´íœ˜í€´ì¦ˆ íŒì—… ë‹«ê¸°
    function closeVocabularyQuiz() {
      const overlay = document.getElementById('vocabularyQuizOverlay');
      if (overlay) {
        overlay.remove();
      }
    }

    // ë¶€ì—¬ ì‹œê°„ í¬ë§· í•¨ìˆ˜ (11ì›” 25ì¼ 14:30 í˜•íƒœ)
    function formatAssignedTime(dateString) {
      if (!dateString) return '';
      const date = new Date(dateString);
      const month = date.getMonth() + 1;
      const day = date.getDate();
      const hours = String(date.getHours()).padStart(2, '0');
      const minutes = String(date.getMinutes()).padStart(2, '0');
      return `${month}ì›” ${day}ì¼ ${hours}:${minutes}`;
    }

    // í•™ìŠµì‹¤ ëª©ë¡ ë Œë”ë§
    async function renderStudyRoomList() {
      const list = document.getElementById('studyRoomList');
      if (!list) return;

      // ë‹¨ì›ë³„ ë“±ê¸‰ ë°ì´í„° ë¡œë“œ
      unitGradesData = await fetchUnitGrades();

      const allTasks = await getStudyRoomTasks();

      // AI ê³¼ì œì™€ ì¼ë°˜ ê³¼ì œ ë¶„ë¦¬ í›„ ê°ê° ì‹œê°„ìˆœ ì •ë ¬
      const aiTasks = allTasks.filter(t => t.isAI).sort((a, b) => {
        const dateA = new Date(a.assignedAt || 0);
        const dateB = new Date(b.assignedAt || 0);
        return dateB - dateA; // ë‚´ë¦¼ì°¨ìˆœ (ìµœì‹  ìˆœ)
      });

      const normalTasks = allTasks.filter(t => !t.isAI).sort((a, b) => {
        const dateA = new Date(a.assignedAt || 0);
        const dateB = new Date(b.assignedAt || 0);
        return dateB - dateA; // ë‚´ë¦¼ì°¨ìˆœ (ìµœì‹  ìˆœ)
      });

      // AI ê³¼ì œë¥¼ ë¨¼ì €, ì¼ë°˜ ê³¼ì œë¥¼ ë‚˜ì¤‘ì—
      const tasks = [...aiTasks, ...normalTasks];

      list.innerHTML = '';

      // ========== ì–´íœ˜ë ¥ ë°ì¼ë¦¬ ê³¼ì œ ì„¹ì…˜ (ìµœìƒë‹¨ ê³ ì •) ==========
      const vocabDailyHeader = document.createElement('li');
      vocabDailyHeader.className = 'study-room-divider';
      vocabDailyHeader.innerHTML = `
        <div style="display: flex; align-items: center; gap: 12px; padding: 16px 0;">
          <div style="flex: 1; height: 2px; background: linear-gradient(to right, transparent, #10b981, transparent);"></div>
          <span style="color: #10b981; font-size: 13px; font-weight: 600; white-space: nowrap;">ðŸ“– ì–´íœ˜ë ¥ ë°ì¼ë¦¬ ê³¼ì œ</span>
          <div style="flex: 1; height: 2px; background: linear-gradient(to right, transparent, #10b981, transparent);"></div>
        </div>
      `;
      list.appendChild(vocabDailyHeader);

      // ì˜¤ëŠ˜ ì–´íœ˜í€´ì¦ˆ ì™„ë£Œ ì—¬ë¶€ ì²´í¬
      const vocabCompletedToday = await checkVocabularyCompletedToday();

      // ì–´íœ˜ë ¥ í–¥ìƒ í€´ì¦ˆ í•­ëª©
      const vocabItem = document.createElement('li');
      vocabItem.className = 'study-room-item';
      vocabItem.style.cursor = 'pointer';
      vocabItem.dataset.isVocabQuiz = 'true';

      const vocabBadgeClass = vocabCompletedToday ? 'status-done' : 'status-default';
      const vocabBadgeText = vocabCompletedToday ? 'ðŸ† í•™ìŠµì™„ë£Œ' : 'âœï¸ ë¯¸ì™„ë£Œ';

      vocabItem.innerHTML = `
        <div class="task-info">
          <div class="task-title" style="font-weight: 600;">ì–´íœ˜ë ¥ í–¥ìƒ í€´ì¦ˆ</div>
          <div class="task-meta" style="font-size: 12px; color: #6b7280; margin-top: 4px;">
            ë§¤ì¼ í•™ìŠµìœ¼ë¡œ ì–´íœ˜ë ¥ì„ í‚¤ì›Œë³´ì„¸ìš”!
          </div>
        </div>
        <div class="task-status">
          <span class="status-badge ${vocabBadgeClass}">${vocabBadgeText}</span>
        </div>
      `;

      // í´ë¦­ ì‹œ ì–´íœ˜í€´ì¦ˆ íŒì—… ì—´ê¸°
      vocabItem.addEventListener('click', openVocabularyQuiz);

      list.appendChild(vocabItem);

      // ========== ë…ì„œ ê°ìƒë¬¸ ì›”ê°„ ê³¼ì œ ì„¹ì…˜ ==========
      const readingReportHeader = document.createElement('li');
      readingReportHeader.className = 'study-room-divider';
      readingReportHeader.innerHTML = `
        <div style="display: flex; align-items: center; gap: 12px; padding: 16px 0;">
          <div style="flex: 1; height: 2px; background: linear-gradient(to right, transparent, #f59e0b, transparent);"></div>
          <span style="color: #f59e0b; font-size: 13px; font-weight: 600; white-space: nowrap;">ðŸ“ ë…ì„œ ê°ìƒë¬¸ ì›”ê°„ ê³¼ì œ</span>
          <div style="flex: 1; height: 2px; background: linear-gradient(to right, transparent, #f59e0b, transparent);"></div>
        </div>
      `;
      list.appendChild(readingReportHeader);

      // ì´ë²ˆ ë‹¬ ì œì¶œ ê°œìˆ˜ í™•ì¸
      const monthlyReportCount = await getMonthlyReportCount();

      // ë…ì„œ ê°ìƒë¬¸ í•­ëª©
      const reportItem = document.createElement('li');
      reportItem.className = 'study-room-item';
      reportItem.style.cursor = 'pointer';
      reportItem.dataset.isReadingReport = 'true';

      const reportBadgeClass = monthlyReportCount > 0 ? 'status-done' : 'status-default';
      const reportBadgeText = monthlyReportCount > 0 ? `ðŸ† ì´ë²ˆ ë‹¬ ${monthlyReportCount}ê°œ ì œì¶œì™„ë£Œ` : 'âœï¸ ë¯¸ì œì¶œ';

      reportItem.innerHTML = `
        <div class="task-info">
          <div class="task-title" style="font-weight: 600;">ê³ ëž˜ ë„ì„œê´€ ë…ì„œ ê°ìƒë¬¸</div>
          <div class="task-meta" style="font-size: 12px; color: #6b7280; margin-top: 4px;">
            ì‹ ë‚˜ëŠ” ê³ ëž˜ë„ì„œê´€ ì´ì•¼ê¸°ë¥¼ ì½ê³  ê°ìƒë¬¸ì„ ì œì¶œí•´ë³´ì„¸ìš”!
          </div>
        </div>
        <div class="task-status">
          <span class="status-badge ${reportBadgeClass}">${reportBadgeText}</span>
        </div>
      `;

      // í´ë¦­ ì‹œ ë…ì„œ ê°ìƒë¬¸ íŒì—… ì—´ê¸°
      reportItem.addEventListener('click', openReadingReportModal);

      list.appendChild(reportItem);

      // AI ì¶”ì²œ ê³¼ì œ í—¤ë” ì¶”ê°€ (AI ê³¼ì œê°€ ìžˆì„ ë•Œë§Œ)
      if (aiTasks.length > 0) {
        const aiHeader = document.createElement('li');
        aiHeader.className = 'study-room-divider';
        aiHeader.innerHTML = `
          <div style="display: flex; align-items: center; gap: 12px; padding: 16px 0;">
            <div style="flex: 1; height: 2px; background: linear-gradient(to right, transparent, #a855f7, transparent);"></div>
            <span style="color: #a855f7; font-size: 13px; font-weight: 600; white-space: nowrap;">ðŸ¤– AI ì¶”ì²œ ê³¼ì œ</span>
            <div style="flex: 1; height: 2px; background: linear-gradient(to right, transparent, #a855f7, transparent);"></div>
          </div>
        `;
        list.appendChild(aiHeader);
      }

      // ì¼ë°˜ ê³¼ì œ í—¤ë” ì¶”ê°€ (AI ê³¼ì œê°€ ì—†ê³  ì¼ë°˜ ê³¼ì œë§Œ ìžˆì„ ë•Œ)
      if (aiTasks.length === 0 && normalTasks.length > 0) {
        const normalHeader = document.createElement('li');
        normalHeader.className = 'study-room-divider';
        normalHeader.innerHTML = `
          <div style="display: flex; align-items: center; gap: 12px; padding: 16px 0;">
            <div style="flex: 1; height: 2px; background: linear-gradient(to right, transparent, #e5e7eb, transparent);"></div>
            <span style="color: #9ca3af; font-size: 13px; font-weight: 500; white-space: nowrap;">ðŸ“š ì¼ë°˜ ê³¼ì œ</span>
            <div style="flex: 1; height: 2px; background: linear-gradient(to right, transparent, #e5e7eb, transparent);"></div>
          </div>
        `;
        list.appendChild(normalHeader);
      }

      // ëª¨ë“  ê³¼ì œë¥¼ ìˆœíšŒí•˜ë©° ë Œë”ë§ (ì œí•œ ì—†ìŒ)
      tasks.forEach((task, i) => {
        // AI ê³¼ì œì™€ ì¼ë°˜ ê³¼ì œ ì‚¬ì´ì— êµ¬ë¶„ì„  ì¶”ê°€ (ë‘˜ ë‹¤ ìžˆì„ ë•Œë§Œ)
        if (i === aiTasks.length && aiTasks.length > 0 && normalTasks.length > 0) {
          const divider = document.createElement('li');
          divider.className = 'study-room-divider';
          divider.innerHTML = `
            <div style="display: flex; align-items: center; gap: 12px; padding: 16px 0;">
              <div style="flex: 1; height: 2px; background: linear-gradient(to right, transparent, #e5e7eb, transparent);"></div>
              <span style="color: #9ca3af; font-size: 13px; font-weight: 500; white-space: nowrap;">ðŸ“š ì¼ë°˜ ê³¼ì œ</span>
              <div style="flex: 1; height: 2px; background: linear-gradient(to right, transparent, #e5e7eb, transparent);"></div>
            </div>
          `;
          list.appendChild(divider);
        }
        const li = document.createElement('li');
        li.className = 'study-room-item';

        // AI ê³¼ì œëŠ” id, ê´€ë¦¬ìž ê³¼ì œëŠ” unitId ì‚¬ìš©
        const unitId = task.id || task.unitId;
        const isCompleted = isUnitCompleted(unitId);

        li.dataset.unitId = unitId;
        li.dataset.taskIndex = i; // ê³¼ì œ ì¸ë±ìŠ¤ ì €ìž¥ (ë³µìŠµ ì™„ë£Œ ì²˜ë¦¬ìš©)
        li.style.cursor = 'pointer';

        // unitIdì—ì„œ ë‹¨ì› ì½”ë“œ ì¶”ì¶œ (./BRAINUP/social/geo_03.html -> geo_03)
        let unitCode = unitId;
        const match = unitId.match(/\/([^\/]+)\.html$/);
        if (match) {
          unitCode = match[1];
        }

        // AI ê³¼ì œì™€ ì¼ë°˜ ê³¼ì œì˜ ë°°ì§€ êµ¬ë¶„
        let badgeClass = '';
        let badgeText = '';

        if (task.isAI) {
          // AI ì¶”ì²œ ê³¼ì œ - task.statusë¡œ ë³µìŠµ ì™„ë£Œ ì—¬ë¶€ í™•ì¸
          if (task.status === 'completed') {
            badgeClass = 'status-ai-done';
            badgeText = 'âœ… ë³µìŠµì™„ë£Œ';
          } else {
            badgeClass = 'status-ai-pending';
            badgeText = 'ðŸ”„ ë³µìŠµí•„ìš”';
          }
        } else {
          // ì¼ë°˜ ê³¼ì œ - LearningLogë¡œ í•™ìŠµ ì™„ë£Œ ì—¬ë¶€ í™•ì¸
          if (isCompleted) {
            badgeClass = 'status-done';
            badgeText = 'ðŸ† í•™ìŠµì™„ë£Œ';
          } else {
            badgeClass = 'status-default';
            badgeText = 'âœï¸ ë¯¸ì™„ë£Œ';
          }
        }

        // í•™ìŠµì´ ì™„ë£Œëœ ê³¼ì œëŠ” ë³„ì  ì¶”ê°€ (unitCode ì‚¬ìš©)
        const gradeInfo = unitGradesData[unitCode];
        const stars = (task.status === 'completed' || isCompleted) && gradeInfo
          ? getStarsForGrade(gradeInfo.grade)
          : '';

        // ë””ë²„ê¹…: ë³„ì´ ì•ˆ ë‚˜ì˜¤ëŠ” ì´ìœ  í™•ì¸
        if ((task.status === 'completed' || isCompleted) && !stars) {
          console.log(`â­ [ë””ë²„ê¹…] ë³„ì´ ì—†ëŠ” ì™„ë£Œ ê³¼ì œ:`, {
            title: task.title,
            unitId: unitId,
            unitCode: unitCode,
            isCompleted: isCompleted,
            taskStatus: task.status,
            hasGradeInfo: !!gradeInfo,
            gradeInfo: gradeInfo
          });
        }

        const assignedTimeText = formatAssignedTime(task.assignedAt);

        li.innerHTML = `
          <div class="study-room-item-left">
            <div class="study-room-item-title">
              ${task.isAI ? 'ðŸ¤– ' : ''}${task.title}${task.isAI ? ' <span style="color: #667eea; font-size: 12px;">(AI ì¶”ì²œ)</span>' : ''}
            </div>
            <div class="study-room-item-meta">${task.series} > ${task.field || task.domain} > ${task.subject}</div>
            ${assignedTimeText ? `<div class="study-room-item-assigned-time" style="font-size: 11px; color: #9ca3af; margin-top: 4px;">ðŸ“… ë¶€ì—¬ì‹œê°„: ${assignedTimeText}</div>` : ''}
          </div>
          <div class="study-room-item-right">
            ${stars ? `<span class="unit-stars">${stars}</span>` : ''}
            <span class="status-badge ${badgeClass}">
              ${badgeText}
            </span>
            <button class="trash-btn" data-task-id="${task.id || task.unitId || task.taskId}" title="ì‚­ì œ">ðŸ—‘ï¸</button>
          </div>
        `;

        // ê³¼ì œ í´ë¦­ ì‹œ í•™ìŠµ íŽ˜ì´ì§€ ì—´ê¸°
        li.addEventListener('click', (e) => {
          // íœ´ì§€í†µ ë²„íŠ¼ í´ë¦­ ì‹œì—ëŠ” ì—´ë¦¬ì§€ ì•Šë„ë¡
          if (e.target.classList.contains('trash-btn') || e.target.closest('.trash-btn')) {
            return;
          }
          // í•™ìŠµì‹¤ ëª¨ë‹¬ ë¨¼ì € ë‹«ê¸°
          closeStudyRoomModal();
          // ì•½ê°„ì˜ ë”œë ˆì´ í›„ í•™ìŠµ íŽ˜ì´ì§€ ì—´ê¸°
          setTimeout(() => {
            openUnitModal(unitId);
          }, 200);
        });

        list.appendChild(li);
      });

      // íœ´ì§€í†µ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      list.querySelectorAll('.trash-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const taskId = btn.getAttribute('data-task-id');
          showAdminPasswordModal(taskId);
        });
      });
    }

    // ê³¼ì œ ì¶”ê°€
    async function addTaskToStudyRoom(taskData) {
      const tasks = await getStudyRoomTasks();

      // 10ê°œ ì œí•œ ì²´í¬
      if (tasks.length >= 10) {
        showMessage('âš ï¸', 'í•™ìŠµì‹¤ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤', 'ê³¼ì œë¥¼ ì‚­ì œí•´ ì£¼ì„¸ìš”.');
        return false;
      }

      // ì¤‘ë³µ ì²´í¬ (AI ê³¼ì œëŠ” id, ê´€ë¦¬ìž ê³¼ì œëŠ” unitId ì‚¬ìš©)
      const isDuplicate = tasks.some(t =>
        (t.id && t.id === taskData.unitId) ||
        (t.unitId && t.unitId === taskData.unitId)
      );
      if (isDuplicate) {
        showMessage('âš ï¸', 'ì¤‘ë³µëœ ê³¼ì œìž…ë‹ˆë‹¤', 'ì´ë¯¸ í•™ìŠµì‹¤ì— ì¶”ê°€ëœ ê³¼ì œìž…ë‹ˆë‹¤.');
        return false;
      }

      // ê³¼ì œ ì¶”ê°€
      tasks.push(taskData);
      await saveStudyRoomTasks(tasks);

      // í•™ìŠµì‹¤ ëª¨ë‹¬ì´ ì—´ë ¤ìžˆìœ¼ë©´ ëª©ë¡ ê°±ì‹ 
      const modal = document.getElementById('studyRoomModal');
      if (modal && modal.classList.contains('show')) {
        renderStudyRoomList();
      }

      showMessage('âœ…', 'ê³¼ì œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤', `"${taskData.title}"ì´(ê°€) í•™ìŠµì‹¤ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
      return true;
    }

    // ê³¼ì œ ì‚­ì œ
    async function removeTaskFromStudyRoom(taskId) {
      const tasks = await getStudyRoomTasks();
      const taskIndex = tasks.findIndex(t =>
        (t.id && t.id === taskId) ||
        (t.unitId && t.unitId === taskId) ||
        (t.taskId && t.taskId === taskId)
      );

      if (taskIndex >= 0) {
        const removedTask = tasks.splice(taskIndex, 1)[0];
        await saveStudyRoomTasks(tasks);
        renderStudyRoomList();
        showMessage('âœ…', 'ê³¼ì œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', `"${removedTask.title}"ì´(ê°€) í•™ìŠµì‹¤ì—ì„œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
      }
    }

    // ê´€ë¦¬ìž ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬ í‘œì‹œ
    let pendingDeleteTaskId = null;
    function showAdminPasswordModal(taskId) {
      pendingDeleteTaskId = taskId;
      const overlay = document.getElementById('adminPasswordOverlay');
      const input = document.getElementById('adminPasswordInput');
      if (overlay && input) {
        input.value = '';
        overlay.classList.add('show');
        setTimeout(() => input.focus(), 100);
      }
    }

    // ê´€ë¦¬ìž ë¹„ë°€ë²ˆí˜¸ í™•ì¸
    function verifyAdminPassword() {
      const input = document.getElementById('adminPasswordInput');
      const overlay = document.getElementById('adminPasswordOverlay');

      if (input && overlay) {
        const password = input.value.trim();
        if (password === ADMIN_PASSWORD) {
          overlay.classList.remove('show');
          input.value = '';
          // ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ ì„±ê³µ í›„ ìµœì¢… í™•ì¸ íŒì—…
          showDeleteConfirmModal();
        } else {
          showMessage('ðŸš«', 'ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜', 'ê´€ë¦¬ìž ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
          input.value = '';
          input.focus();
        }
      }
    }

    // ì‚­ì œ ìµœì¢… í™•ì¸ ëª¨ë‹¬
    function showDeleteConfirmModal() {
      const overlay = document.getElementById('deleteConfirmOverlay');
      if (overlay) {
        overlay.classList.add('show');
      }
    }

    function confirmDeleteTask() {
      const overlay = document.getElementById('deleteConfirmOverlay');
      if (overlay) {
        overlay.classList.remove('show');
      }
      if (pendingDeleteTaskId !== null) {
        removeTaskFromStudyRoom(pendingDeleteTaskId);
        pendingDeleteTaskId = null;
      }
    }

    function cancelDeleteTask() {
      const overlay = document.getElementById('deleteConfirmOverlay');
      if (overlay) {
        overlay.classList.remove('show');
      }
      pendingDeleteTaskId = null;
    }

    // ë©”ì‹œì§€ í‘œì‹œ (ì˜¤ë¥˜ ì•Œë¦¼ íŒì—…)
    function showMessage(emoji, title, msg) {
      const overlay = document.getElementById('errorMessageOverlay');
      const emojiEl = document.getElementById('errorEmoji');
      const titleEl = document.getElementById('errorTitle');
      const msgEl = document.getElementById('errorMsg');

      if (overlay && emojiEl && titleEl && msgEl) {
        emojiEl.textContent = emoji;
        titleEl.textContent = title;
        msgEl.textContent = msg;
        overlay.classList.add('show');
      }
    }

    function closeErrorMessage() {
      const overlay = document.getElementById('errorMessageOverlay');
      if (overlay) {
        overlay.classList.remove('show');
      }
    }

    // ë‹¨ì› ì™„ë£Œ ìƒíƒœ í™•ì¸
    function isUnitCompleted(unitId) {
      // unitIdê°€ ì—†ìœ¼ë©´ false ë°˜í™˜
      if (!unitId) return false;

      // í•™ìƒ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (sessionStorage ìš°ì„ , localStorage fallback)
      let stu = JSON.parse(sessionStorage.getItem('user') || '{}');
      if (!stu.grade || !stu.name) {
        stu = getCurrentStudent();
      }
      if (!stu || !stu.grade || !stu.name) return false;

      // gradeì—ì„œ "í•™ë…„" ì œê±° í›„ í‚¤ ìƒì„± (í•™ìŠµ íŽ˜ì´ì§€ì™€ ë™ì¼í•œ í˜•ì‹)
      const gradeNum = String(stu.grade).replace('í•™ë…„', '');
      const stuKey = `${gradeNum}í•™ë…„_${stu.name}`;

      // unitIdì—ì„œ ë‹¨ì› ì½”ë“œ ì¶”ì¶œ (./BRAINUP/social/geo_02.html -> geo_02)
      let unitCode = unitId;
      const match = unitId.match(/\/([^\/]+)\.html$/);
      if (match) {
        unitCode = match[1];
      }

      // í•™ìŠµ íŽ˜ì´ì§€ì™€ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ì²´í¬
      const storageKey = `dan-progress:${stuKey}:${unitCode}`;
      let saved = [];
      try {
        const data = localStorage.getItem(storageKey);
        if (data) {
          saved = JSON.parse(data);
          if (!Array.isArray(saved)) saved = [];
        }
      } catch(e) {
        saved = [];
      }

      console.log(`[isUnitCompleted] unitCode=${unitCode}, stuKey=${stuKey}, storageKey=${storageKey}, saved.length=${saved.length}`);

      // ë°°ì—´ì— ë°ì´í„°ê°€ ìžˆìœ¼ë©´ ì™„ë£Œëœ ê²ƒ
      return saved.length > 0;
    }

    // ê³¼ì œë¶€ì—¬ ëª¨ë‹¬ í‘œì‹œ (ëª¨ë°”ì¼ìš©)
    let pendingTaskData = null;
    function showAssignTaskModal(taskDataStr) {
      try {
        pendingTaskData = JSON.parse(taskDataStr);
        const overlay = document.getElementById('assignTaskOverlay');
        const msgEl = document.getElementById('assignTaskMsg');

        if (overlay && msgEl) {
          msgEl.textContent = `"${pendingTaskData.title}"ì„(ë¥¼) í•™ìŠµì‹¤ì— ì¶”ê°€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
          overlay.classList.add('show');
        }
      } catch (err) {
        console.error('ê³¼ì œ ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', err);
      }
    }

    // ê³¼ì œë¶€ì—¬ í™•ì¸
    function confirmAssignTask() {
      if (pendingTaskData) {
        addTaskToStudyRoom(pendingTaskData);
        pendingTaskData = null;
      }
      const overlay = document.getElementById('assignTaskOverlay');
      if (overlay) {
        overlay.classList.remove('show');
      }
    }

    // í•™ìŠµì‹¤ ëª¨ë‹¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    document.addEventListener('DOMContentLoaded', () => {
      // í•™ìŠµì‹¤ ì•„ì´ì½˜ í´ë¦­
      const studyRoomIcon = document.getElementById('studyRoomIcon');
      if (studyRoomIcon) {
        studyRoomIcon.addEventListener('click', openStudyRoomModal);

        // í•™ìŠµì‹¤ ì•„ì´ì½˜ì— ë“œëž˜ê·¸ ì•¤ ë“œë¡­ ê¸°ëŠ¥ ì¶”ê°€
        studyRoomIcon.addEventListener('dragover', (e) => {
          e.preventDefault();
          e.dataTransfer.dropEffect = 'copy';
          studyRoomIcon.style.transform = 'scale(1.15)';
          studyRoomIcon.style.filter = 'drop-shadow(0 8px 24px rgba(255, 107, 107, 0.6))';
        });

        studyRoomIcon.addEventListener('dragleave', (e) => {
          studyRoomIcon.style.transform = '';
          studyRoomIcon.style.filter = '';
        });

        studyRoomIcon.addEventListener('drop', (e) => {
          e.preventDefault();
          studyRoomIcon.style.transform = '';
          studyRoomIcon.style.filter = '';

          const taskDataStr = e.dataTransfer.getData('text/plain');
          if (taskDataStr) {
            try {
              const taskData = JSON.parse(taskDataStr);
              addTaskToStudyRoom(taskData);
            } catch (err) {
              console.error('ê³¼ì œ ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', err);
            }
          }
        });
      }

      // í•™ìŠµì‹¤ ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼
      const closeBtn = document.getElementById('closeStudyRoomModal');
      if (closeBtn) {
        closeBtn.addEventListener('click', closeStudyRoomModal);
      }

      // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
      const modal = document.getElementById('studyRoomModal');
      if (modal) {
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            closeStudyRoomModal();
          }
        });
      }

      // ê´€ë¦¬ìž ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬ ë²„íŠ¼
      const cancelPasswordBtn = document.getElementById('cancelPasswordBtn');
      const confirmPasswordBtn = document.getElementById('confirmPasswordBtn');

      if (cancelPasswordBtn) {
        cancelPasswordBtn.addEventListener('click', () => {
          document.getElementById('adminPasswordOverlay').classList.remove('show');
          pendingDeleteIndex = null;
        });
      }

      if (confirmPasswordBtn) {
        confirmPasswordBtn.addEventListener('click', verifyAdminPassword);
      }

      // Enter í‚¤ë¡œ ë¹„ë°€ë²ˆí˜¸ í™•ì¸
      const passwordInput = document.getElementById('adminPasswordInput');
      if (passwordInput) {
        passwordInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            verifyAdminPassword();
          }
        });
      }

      // ê³¼ì œë¶€ì—¬ ëª¨ë‹¬ ë²„íŠ¼
      const cancelAssignBtn = document.getElementById('cancelAssignBtn');
      const confirmAssignBtn = document.getElementById('confirmAssignBtn');

      if (cancelAssignBtn) {
        cancelAssignBtn.addEventListener('click', () => {
          document.getElementById('assignTaskOverlay').classList.remove('show');
          pendingTaskData = null;
        });
      }

      if (confirmAssignBtn) {
        confirmAssignBtn.addEventListener('click', confirmAssignTask);
      }

      // ì‚­ì œ ìµœì¢… í™•ì¸ ëª¨ë‹¬ ë²„íŠ¼
      const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
      const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');

      if (cancelDeleteBtn) {
        cancelDeleteBtn.addEventListener('click', cancelDeleteTask);
      }

      if (confirmDeleteBtn) {
        confirmDeleteBtn.addEventListener('click', confirmDeleteTask);
      }

      // ì¤€ë¹„ ì¤‘ íŒì—… ë‹«ê¸° ë²„íŠ¼
      const closeComingSoonBtn = document.getElementById('closeComingSoonBtn');
      if (closeComingSoonBtn) {
        closeComingSoonBtn.addEventListener('click', closeComingSoonPopup);
      }

      // ì¤€ë¹„ ì¤‘ íŒì—… ë°°ê²½ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
      const comingSoonOverlay = document.getElementById('comingSoonOverlay');
      if (comingSoonOverlay) {
        comingSoonOverlay.addEventListener('click', (e) => {
          if (e.target === comingSoonOverlay) {
            closeComingSoonPopup();
          }
        });
      }

      // ì˜¤ë¥˜ ë©”ì‹œì§€ ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼
      const closeErrorBtn = document.getElementById('closeErrorBtn');
      if (closeErrorBtn) {
        closeErrorBtn.addEventListener('click', closeErrorMessage);
      }

      // ì˜¤ë¥˜ ë©”ì‹œì§€ ë°°ê²½ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
      const errorOverlay = document.getElementById('errorMessageOverlay');
      if (errorOverlay) {
        errorOverlay.addEventListener('click', (e) => {
          if (e.target === errorOverlay) {
            closeErrorMessage();
          }
        });
      }

      // ì´ˆê¸° ë±ƒì§€ ì—…ë°ì´íŠ¸
      updateStudyRoomBadge();
      updateVocabAvgBadge();

      // storage ì´ë²¤íŠ¸ë¡œ ì‹¤ì‹œê°„ ë™ê¸°í™”
      window.addEventListener('storage', (e) => {
        if (e.key && e.key.startsWith('studyRoom_')) {
          updateStudyRoomBadge();
          const modal = document.getElementById('studyRoomModal');
          if (modal && modal.classList.contains('show')) {
            renderStudyRoomList();
          }
        }
        // í•™ìŠµ ì™„ë£Œ ìƒíƒœ ë³€ê²½ ì‹œì—ë„ í•™ìŠµì‹¤ ëª©ë¡ ì—…ë°ì´íŠ¸
        if (e.key && (e.key.startsWith('completed_') || e.key.startsWith('dan-progress:'))) {
          const modal = document.getElementById('studyRoomModal');
          if (modal && modal.classList.contains('show')) {
            renderStudyRoomList();
          }
        }
      });
    });

    // í‘¸ë¥¸ ê³ ëž˜ì„¬ ì´ì•¼ê¸° íŒì—… ì—´ê¸°
    function goToWhaleStory() {
      const modal = document.getElementById('whaleStoryModal');
      modal.classList.add('show');
      // Reset carousel to first slide
      currentSlide = 0;
      updateCarousel();
    }

    // ì‹œì¦Œ ì„ íƒ íŒì—… ë‹«ê¸° í•¨ìˆ˜
    function closeWhaleStoryModal() {
      const modal = document.getElementById('whaleStoryModal');
      console.log('ì‹œì¦Œ ì„ íƒ íŒì—… ë‹«ê¸°');
      modal.classList.remove('show');
    }

    // ì‹œì¦Œ ì„ íƒ - íŒì—…ìœ¼ë¡œ ì—´ê¸°
    // Carousel state
    let currentSlide = 0;
    const totalSlides = 6;

    function updateCarousel() {
      const carousel = document.getElementById('storyCarousel');
      const prevBtn = document.getElementById('carouselPrev');
      const nextBtn = document.getElementById('carouselNext');

      carousel.style.transform = `translateX(-${currentSlide * 100}%)`;

      // Update button states
      prevBtn.disabled = currentSlide === 0;
      nextBtn.disabled = currentSlide === totalSlides - 1;
    }

    function moveCarousel(direction) {
      currentSlide += direction;
      if (currentSlide < 0) currentSlide = 0;
      if (currentSlide >= totalSlides) currentSlide = totalSlides - 1;
      updateCarousel();
    }

    function goToSeason(storyType, season) {
      const urls = {
        whale: {
          1: '/whale_island_journey.html',
          2: '/whale_island_season2_quiz.html',
          3: '/whale_island_season3_quiz.html'
        },
        jungle: {
          1: '/jungle_journey_season1.html',
          2: '/jungle_season2_quiz.html',
          3: '/jungle_season3_quiz.html'
        },
        library: {
          1: '/library/library_season1.html',
          2: '/library_season2_quiz.html',
          3: '/library_season3_quiz.html'
        },
        timeLibrary: {
          1: '/time-library/time_library_season1.html',
          2: '/time_library_season2_quiz.html',
          3: '/time_library_season3_quiz.html'
        },
        catIsland: {
          1: '/cat-island/cat_island_season1.html',
          2: '/cat-island/cat_island_season2.html',
          3: '/cat-island/cat_island_season3.html'
        },
        catTransform: {
          1: '/cat-transform/cat_transform_season1.html',
          2: '/cat-transform/cat_transform_season2_quiz.html',
          3: '/cat-transform/cat_transform_season3_quiz.html'
        }
      };

      if (urls[storyType] && urls[storyType][season]) {
        // ì‹œì¦Œ ì„ íƒ ëª¨ë‹¬ ë‹«ê¸°
        document.getElementById('whaleStoryModal').classList.remove('show');

        // ìŠ¤í† ë¦¬ ì½˜í…ì¸  ëª¨ë‹¬ ì—´ê¸°
        const storyModal = document.getElementById('storyContentModal');
        const storyIframe = document.getElementById('storyContentIframe');

        storyIframe.src = urls[storyType][season];
        storyModal.classList.add('show');
      }
    }

    // ìŠ¤í† ë¦¬ ì½˜í…ì¸  ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
    function closeStoryModal() {
      const storyModal = document.getElementById('storyContentModal');
      const storyIframe = document.getElementById('storyContentIframe');

      console.log('ë‹«ê¸° ë²„íŠ¼ í´ë¦­ë¨');
      storyModal.classList.remove('show');

      // iframe ì •ë¦¬
      setTimeout(() => {
        storyIframe.src = '';
      }, 300);
    }

    // DOMContentLoaded í›„ ì´ë²¤íŠ¸ ë“±ë¡
    document.addEventListener('DOMContentLoaded', function() {
      // ì‹œì¦Œ ì„ íƒ íŒì—… ë‹«ê¸° ë²„íŠ¼
      const closeWhaleBtn = document.getElementById('closeWhaleStoryModal');
      if (closeWhaleBtn) {
        closeWhaleBtn.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          console.log('ì‹œì¦Œ ì„ íƒ X ë²„íŠ¼ í´ë¦­');
          closeWhaleStoryModal();
        });
      }

      // ì‹œì¦Œ ì„ íƒ íŒì—… ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
      const whaleModal = document.getElementById('whaleStoryModal');
      if (whaleModal) {
        whaleModal.addEventListener('click', function(e) {
          if (e.target === this) {
            closeWhaleStoryModal();
          }
        });
      }

      // ìŠ¤í† ë¦¬ ì½˜í…ì¸  ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼
      const closeBtn = document.getElementById('closeStoryContentModal');
      if (closeBtn) {
        closeBtn.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          console.log('ìŠ¤í† ë¦¬ X ë²„íŠ¼ í´ë¦­');
          closeStoryModal();
        });
      }

      // ìŠ¤í† ë¦¬ ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
      const storyModal = document.getElementById('storyContentModal');
      if (storyModal) {
        storyModal.addEventListener('click', function(e) {
          if (e.target === this) {
            closeStoryModal();
          }
        });
      }

      // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          const storyModal = document.getElementById('storyContentModal');
          const whaleModal = document.getElementById('whaleStoryModal');
          const readingModal = document.getElementById('readingReportModal');

          if (storyModal && storyModal.classList.contains('show')) {
            closeStoryModal();
          } else if (whaleModal && whaleModal.classList.contains('show')) {
            closeWhaleStoryModal();
          } else if (readingModal && readingModal.classList.contains('show')) {
            closeReadingReportModal();
          }
        }
      });
    });

    // ========== ë…ì„œ ê°ìƒë¬¸ ê¸°ëŠ¥ ==========
    let currentEditingReport = null; // í˜„ìž¬ íŽ¸ì§‘ ì¤‘ì¸ ë¦¬í¬íŠ¸ ID
    let autoSaveTimer = null;
    let historyDisplayLimit = 5; // ì´ˆê¸° í‘œì‹œ ê°œìˆ˜

    // ìŠ¤í† ë¦¬ ë°ì´í„° ì •ì˜ (ì¤‘ì•™ ê´€ë¦¬)
    const STORY_DATA = {
      whale: {
        title: 'ðŸ‹ í‘¸ë¥¸ ê³ ëž˜ì„¬ì˜ ë¹„ë°€ ëª¨í—˜ë‹¨',
        seasons: [
          { id: 'whale_island', season: 1, subtitle: 'í‘¸ë¥¸ ê³ ëž˜ì„¬ íƒí—˜' },
          { id: 'whale_island_season2', season: 2, subtitle: 'íŒŒë„ ê³¨ì§œê¸°ì˜ ë¹„ë°€' },
          { id: 'whale_island_season3', season: 3, subtitle: 'ë¹›ì˜ ê¸°ì–µ' }
        ]
      },
      jungle: {
        title: 'ðŸŒ¿ ê¹Šì€ ì •ê¸€ì˜ ìžŠížŒ ë„ì‹œ',
        seasons: [
          { id: 'jungle_journey', season: 1, subtitle: 'ìžŠížŒ ë„ì‹œ ë°œê²¬' },
          { id: 'jungle_journey_season2', season: 2, subtitle: 'ë„ì‹œì˜ ê· í˜• íšŒë³µ' },
          { id: 'jungle_journey_season3', season: 3, subtitle: 'ì•”ë…¹ë¦¼ì˜ ìˆ˜í˜¸ìž' }
        ]
      },
      library: {
        title: 'ðŸ“š ì‚´ì•„ ìžˆëŠ” ì‹ ë¹„ì˜ ë„ì„œê´€',
        seasons: [
          { id: 'library_season1', season: 1, subtitle: 'ì§€í˜œì™€ ìš©ê¸°ë¡œ ê°€ë“í•œ ë„ì„œê´€ ì—¬ì •ì˜ ì‹œìž‘' },
          { id: 'library_season2', season: 2, subtitle: 'ë¹›ê³¼ ì–´ë‘ ì˜ ê· í˜•ì„ ì°¾ëŠ” ëª¨í—˜' },
          { id: 'library_season3', season: 3, subtitle: 'íŒŒê´´ì™€ ë§ˆë²•ì„ ë„˜ë‚˜ë“œëŠ” ëŒ€ ëª¨í—˜' }
        ]
      },
      timeLibrary: {
        title: 'â° ì‹œê°„ë„ì„œê´€',
        seasons: [
          { id: 'time_library_season1', season: 1, subtitle: 'ê³¼ê±°ì˜ ë¬¸ì„ ì—´ë‹¤ - ìžŠížŒ ì‹œëŒ€ì˜ ìˆ˜í˜¸ìžë“¤' },
          { id: 'time_library_season2', season: 2, subtitle: 'í˜„ìž¬ì˜ ê· ì—´ - ì‹œê°„ì´ ë’¤í‹€ë¦° ë„ì„œê´€' },
          { id: 'time_library_season3', season: 3, subtitle: 'ë¯¸ëž˜ì˜ ì‹¬ìž¥ - ì‹œê°„ì„ ì§€í‚¤ëŠ” ë§ˆì§€ë§‰ ì•„ì´ë“¤' }
        ]
      },
      catIsland: {
        title: 'ðŸ± ë¯¸ì§€ì˜ ê³ ì–‘ì´ ì„¬ í‘œë¥˜ê¸°',
        seasons: [
          { id: 'cat_island_season1', season: 1, subtitle: 'ë°”ëžŒì´ ë°ë ¤ì˜¨ ì„¬' },
          { id: 'cat_island_season2', season: 2, subtitle: 'ë°”ëžŒê³ ì–‘ì´ë“¤ì˜ ìˆ¨ê²¨ì§„ ë‚ ê°œ' },
          { id: 'cat_island_season3', season: 3, subtitle: 'ë§ˆìŒì˜ ì™•êµ­ê³¼ ê°ì •ì˜ ë¶ˆê½ƒ' }
        ]
      },
      catTransform: {
        title: 'ðŸˆ ê³ ì–‘ì´ê°€ ë˜ì–´ë²„ë¦° ë‚ ',
        seasons: [
          { id: 'cat_transform_season1', season: 1, subtitle: 'ê³ ì–‘ì´ì˜ ëˆˆìœ¼ë¡œ ë³¸ ì²« ì„¸ê³„' },
          { id: 'cat_transform_season2', season: 2, subtitle: 'ëª©ê±¸ì´ì˜ ë¹„ë°€ê³¼ ê·¸ë¦¼ìž ì™•êµ­' },
          { id: 'cat_transform_season3', season: 3, subtitle: 'ê·¸ë¦¼ìžì™•êµ­ì˜ ì‹¬ìž¥' }
        ]
      }
    };

    // ìŠ¤í† ë¦¬ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
    function initStoryDropdown() {
      const storySelect = document.getElementById('reportStory');
      if (!storySelect) return;

      // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²« ë²ˆì§¸ placeholder ì œì™¸)
      while (storySelect.options.length > 1) {
        storySelect.remove(1);
      }

      // ìŠ¤í† ë¦¬ ë°ì´í„°ë¡œë¶€í„° ì˜µì…˜ ìƒì„±
      Object.values(STORY_DATA).forEach(story => {
        story.seasons.forEach(season => {
          const option = document.createElement('option');
          option.value = season.id;
          option.textContent = `${story.title.replace(/ðŸ‹|ðŸŒ¿|ðŸ±|ðŸˆ/g, '').trim()} ì‹œì¦Œ ${season.season}: ${season.subtitle}`;
          option.setAttribute('data-title', `${story.title.replace(/ðŸ‹|ðŸŒ¿|ðŸ±|ðŸˆ/g, '').trim()} ì‹œì¦Œ ${season.season}: ${season.subtitle}`);
          storySelect.appendChild(option);
        });
      });
    }

    // ë…ì„œ ê°ìƒë¬¸ ëª¨ë‹¬ ì—´ê¸°
    async function openReadingReportModal() {
      const modal = document.getElementById('readingReportModal');
      modal.classList.add('show');

      // ìŠ¤í† ë¦¬ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
      initStoryDropdown();

      // ì‚¬ìš©ìž ì •ë³´ë¡œ í•™ë…„/ì´ë¦„ ìžë™ ìž…ë ¥
      const userStr = sessionStorage.getItem('user');
      if (userStr) {
        const user = JSON.parse(userStr);
        document.getElementById('reportGrade').value = user.grade || '';
        document.getElementById('reportName').value = user.name || '';
      }

      // localStorageì—ì„œ ìž„ì‹œ ì €ìž¥ëœ ë‚´ìš© ë¶ˆëŸ¬ì˜¤ê¸°
      loadDraft();

      // ížˆìŠ¤í† ë¦¬ ë¡œë“œ
      await loadReadingHistory();

      // ìžë™ ì €ìž¥ ì‹œìž‘
      startAutoSave();
    }

    // ë…ì„œ ê°ìƒë¬¸ ëª¨ë‹¬ ë‹«ê¸°
    function closeReadingReportModal() {
      const modal = document.getElementById('readingReportModal');
      modal.classList.remove('show');

      // ìžë™ ì €ìž¥ ì¤‘ì§€
      stopAutoSave();
    }

    // ì´ë²ˆ ë‹¬ ì œì¶œ ê°œìˆ˜ í™•ì¸
    async function getMonthlyReportCount() {
      try {
        const userStr = sessionStorage.getItem('user');
        if (!userStr) return 0;

        const user = JSON.parse(userStr);
        const response = await fetch(
          `/api/user-progress/reading-reports/monthly-count?grade=${encodeURIComponent(user.grade)}&name=${encodeURIComponent(user.name)}`
        );

        const result = await response.json();
        return result.ok ? result.count : 0;
      } catch (error) {
        console.error('ì›”ê°„ ì œì¶œ ê°œìˆ˜ í™•ì¸ ì˜¤ë¥˜:', error);
        return 0;
      }
    }

    // ížˆìŠ¤í† ë¦¬ ë¡œë“œ
    async function loadReadingHistory(showAll = false) {
      try {
        const userStr = sessionStorage.getItem('user');
        if (!userStr) return;

        const user = JSON.parse(userStr);
        const response = await fetch(
          `/api/user-progress/reading-reports/history?grade=${encodeURIComponent(user.grade)}&name=${encodeURIComponent(user.name)}`
        );

        const result = await response.json();
        if (!result.ok) return;

        const historyList = document.getElementById('readingHistoryList');
        historyList.innerHTML = '';

        const reports = result.reports || [];
        const limit = showAll ? reports.length : historyDisplayLimit;
        const displayReports = reports.slice(0, limit);

        // ë¦¬í¬íŠ¸ í•­ëª© ë Œë”ë§
        displayReports.forEach(report => {
          const item = document.createElement('div');
          item.className = 'history-item';

          const date = new Date(report.submittedAt);
          const dateStr = `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, '0')}.${String(date.getDate()).padStart(2, '0')}`;
          const monthStr = `${date.getFullYear()}ë…„ ${date.getMonth() + 1}ì›”`;

          // ìŠ¤í† ë¦¬ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ê¸°ë³¸ê°’: ì‹œì¦Œ1)
          const storyId = report.storyId || 'whale_island';
          const storyInfo = report.storyTitle || 'í‘¸ë¥¸ ê³ ëž˜ì„¬ì˜ ë¹„ë°€ ëª¨í—˜ë‹¨ ì‹œì¦Œ 1: í‘¸ë¥¸ ê³ ëž˜ì„¬ íƒí—˜';

          console.log('ðŸ“š Report:', report.title, '| storyId:', storyId, '| storyTitle:', storyInfo);

          item.innerHTML = `
            <div class="history-item-title">${report.title}</div>
            <div class="history-item-date">${dateStr}</div>
            <div class="history-item-month">${monthStr}</div>
            <div class="history-item-story">${storyInfo}</div>
          `;

          // í´ë¦­ ì‹œ í•´ë‹¹ ë¦¬í¬íŠ¸ ë¡œë“œ
          item.addEventListener('click', () => loadReport(report));

          historyList.appendChild(item);
        });

        // "ë”ë³´ê¸°" ë²„íŠ¼ ì¶”ê°€
        if (!showAll && reports.length > historyDisplayLimit) {
          const loadMoreBtn = document.createElement('button');
          loadMoreBtn.className = 'history-load-more';
          loadMoreBtn.textContent = `ë”ë³´ê¸° (${reports.length - historyDisplayLimit}ê°œ ë”)`;
          loadMoreBtn.onclick = () => loadReadingHistory(true);
          historyList.appendChild(loadMoreBtn);
        }
      } catch (error) {
        console.error('ížˆìŠ¤í† ë¦¬ ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    // ë¦¬í¬íŠ¸ ë¡œë“œ (íŽ¸ì§‘/ìž¬ê³µìœ ìš©)
    function loadReport(report) {
      document.getElementById('reportStory').value = report.storyId || 'whale_island';
      document.getElementById('reportTitle').value = report.title;
      document.getElementById('reportContent').value = report.content;
      currentEditingReport = report._id;
    }

    // localStorage ìž„ì‹œ ì €ìž¥
    function saveDraft() {
      const userStr = sessionStorage.getItem('user');
      if (!userStr) return;

      const user = JSON.parse(userStr);
      const draft = {
        title: document.getElementById('reportTitle').value,
        content: document.getElementById('reportContent').value,
        timestamp: new Date().toISOString()
      };

      const key = `readingReportDraft_${user.grade}_${user.name}`;
      localStorage.setItem(key, JSON.stringify(draft));

      // ìžë™ ì €ìž¥ í‘œì‹œ
      const indicator = document.getElementById('autoSaveIndicator');
      indicator.textContent = 'âœ“ ìžë™ ì €ìž¥ë¨';
      setTimeout(() => {
        indicator.textContent = '';
      }, 2000);
    }

    // localStorageì—ì„œ ìž„ì‹œ ì €ìž¥ ë¶ˆëŸ¬ì˜¤ê¸°
    function loadDraft() {
      const userStr = sessionStorage.getItem('user');
      if (!userStr) return;

      const user = JSON.parse(userStr);
      const key = `readingReportDraft_${user.grade}_${user.name}`;
      const draftStr = localStorage.getItem(key);

      if (draftStr) {
        const draft = JSON.parse(draftStr);
        document.getElementById('reportTitle').value = draft.title || '';
        document.getElementById('reportContent').value = draft.content || '';
      }
    }

    // ìžë™ ì €ìž¥ ì‹œìž‘
    function startAutoSave() {
      const titleInput = document.getElementById('reportTitle');
      const contentInput = document.getElementById('reportContent');

      titleInput.addEventListener('input', saveDraft);
      contentInput.addEventListener('input', saveDraft);
    }

    // ìžë™ ì €ìž¥ ì¤‘ì§€
    function stopAutoSave() {
      const titleInput = document.getElementById('reportTitle');
      const contentInput = document.getElementById('reportContent');

      titleInput.removeEventListener('input', saveDraft);
      contentInput.removeEventListener('input', saveDraft);
    }

    // í¼ ì´ˆê¸°í™”
    function clearForm() {
      if (!confirm('ìž‘ì„± ì¤‘ì¸ ë‚´ìš©ì„ ì§€ìš°ê³  ìƒˆë¡œ ìž‘ì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
      }

      document.getElementById('reportStory').value = '';
      document.getElementById('reportTitle').value = '';
      document.getElementById('reportContent').value = '';
      currentEditingReport = null;

      // localStorage ìž„ì‹œ ì €ìž¥ë„ ì‚­ì œ
      const userStr = sessionStorage.getItem('user');
      if (userStr) {
        const user = JSON.parse(userStr);
        const key = `readingReportDraft_${user.grade}_${user.name}`;
        localStorage.removeItem(key);
      }
    }

    // PDF ë‹¤ìš´ë¡œë“œ (html2canvas ì‚¬ìš©í•˜ì—¬ í•œê¸€ ì§€ì›)
    async function downloadPDF() {
      const storySelect = document.getElementById('reportStory');
      const title = document.getElementById('reportTitle').value.trim();
      const content = document.getElementById('reportContent').value.trim();

      if (!storySelect.value) {
        alert('ì´ì•¼ê¸°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }

      if (!title || !content) {
        alert('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ìž…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      // ë§žì¶¤ë²• ê²€ì‚¬ ë¨¼ì € ìˆ˜í–‰
      await checkSpelling(content);
      return; // ë§žì¶¤ë²• ê²€ì‚¬ ëª¨ë‹¬ì—ì„œ "ì œì¶œí•˜ê¸°" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ submitFinal()ì´ í˜¸ì¶œë©ë‹ˆë‹¤
    }

    // ë§žì¶¤ë²• ê²€ì‚¬ í›„ ì‹¤ì œ ì œì¶œ í•¨ìˆ˜
    async function submitFinal() {
      const storySelect = document.getElementById('reportStory');
      const title = document.getElementById('reportTitle').value.trim();
      const content = document.getElementById('reportContent').value.trim();

      const selectedOption = storySelect.options[storySelect.selectedIndex];
      const storyId = storySelect.value;
      const storyTitle = selectedOption.getAttribute('data-title');

      const userStr = sessionStorage.getItem('user');
      if (!userStr) {
        alert('ë¡œê·¸ì¸ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      const user = JSON.parse(userStr);
      const today = new Date();
      const dateStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;

      // ë§žì¶¤ë²• ê²€ì‚¬ ì¸ë¼ì¸ ë‹«ê¸°
      closeSpellCheckInline();

      // ìž„ì‹œ PDF í…œí”Œë¦¿ ìƒì„±
      const pdfTemplate = document.createElement('div');
      pdfTemplate.style.cssText = `
        width: 794px;
        min-height: 1123px;
        background: #fcfaf5;
        padding: 60px;
        font-family: 'Noto Sans KR', 'Malgun Gothic', sans-serif;
        position: absolute;
        left: -9999px;
        top: 0;
      `;

      pdfTemplate.innerHTML = `
        <div style="text-align: center; margin-bottom: 40px;">
          <img src="https://cdn.jsdelivr.net/gh/kukicoollevitt-hash/dan-dan-app@main/public/images/rudolph.png" style="width: 80px; height: 80px; margin-bottom: 20px;" crossorigin="anonymous">
          <h1 style="font-size: 32px; color: #2c3e50; margin: 0 0 10px 0;">ê³ ëž˜ ë„ì„œê´€ ë…ì„œ ê°ìƒë¬¸</h1>
          <p style="font-size: 18px; color: #6b7280; margin: 0;">${user.grade} ${user.name}</p>
          <p style="font-size: 14px; color: #9ca3af; margin: 5px 0 0 0;">${dateStr}</p>
        </div>

        <div style="margin-bottom: 30px;">
          <h2 style="font-size: 24px; color: #2c3e50; text-align: center; margin: 0 0 20px 0; padding-bottom: 10px; border-bottom: 2px solid #e9ecef;">${title}</h2>
        </div>

        <div style="background: white; padding: 30px; border-radius: 10px; position: relative; min-height: 600px;">
          <!-- ì›ê³ ì§€ ì„  -->
          <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none;">
            ${Array.from({length: 40}, (_, i) => `<div style="position: absolute; left: 30px; right: 30px; top: ${30 + i * 20}px; height: 1px; background: #e9ecef;"></div>`).join('')}
          </div>

          <!-- ë‚´ìš© -->
          <div style="position: relative; z-index: 1; line-height: 2; font-size: 16px; color: #2c3e50; white-space: pre-wrap; word-wrap: break-word;">
${content}
          </div>

          <!-- ì›Œí„°ë§ˆí¬ -->
          <img src="https://cdn.jsdelivr.net/gh/kukicoollevitt-hash/dan-dan-app@main/public/images/rudolph.png" style="position: absolute; bottom: 50px; right: 50px; width: 200px; height: 200px; opacity: 0.05; z-index: 0;" crossorigin="anonymous">
        </div>
      `;

      document.body.appendChild(pdfTemplate);

      try {
        // html2canvasë¡œ ì´ë¯¸ì§€ ìƒì„±
        const canvas = await html2canvas(pdfTemplate, {
          scale: 2,
          useCORS: true,
          allowTaint: true,
          backgroundColor: '#fcfaf5'
        });

        // PDF ìƒì„±
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF({
          orientation: 'portrait',
          unit: 'mm',
          format: 'a4'
        });

        const imgData = canvas.toDataURL('image/png');
        const pdfWidth = 210;
        const pdfHeight = (canvas.height * pdfWidth) / canvas.width;

        pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);

        // íŒŒì¼ëª… ìƒì„± ë° ì €ìž¥
        const filename = `ê³ ëž˜ë„ì„œê´€_ê°ìƒë¬¸_${user.name}_${dateStr}.pdf`;
        pdf.save(filename);

        // ì„œë²„ì— ì œì¶œ ê¸°ë¡ ì €ìž¥
        console.log('ðŸ“ ê°ìƒë¬¸ ì œì¶œ ì‹œìž‘...');
        console.log('ðŸ” storyId:', storyId, '| storyTitle:', storyTitle);
        const saved = await saveReportToServer({
          grade: user.grade,
          name: user.name,
          title: title,
          content: content,
          type: 'pdf',
          storyId: storyId,
          storyTitle: storyTitle
        });

        console.log('ðŸ“ ì œì¶œ ê²°ê³¼:', saved);

        if (saved) {
          alert('ê°ìƒë¬¸ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!\nPDFê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');

          // ížˆìŠ¤í† ë¦¬ ìƒˆë¡œê³ ì¹¨
          console.log('ðŸ“ ížˆìŠ¤í† ë¦¬ ìƒˆë¡œê³ ì¹¨ ì‹œìž‘...');
          await loadReadingHistory();
          console.log('ðŸ“ ížˆìŠ¤í† ë¦¬ ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');

          // í•™ìŠµì‹¤ ìƒˆë¡œê³ ì¹¨
          console.log('ðŸ“ í•™ìŠµì‹¤ ìƒˆë¡œê³ ì¹¨ ì‹œìž‘...');
          await renderStudyRoomList();
          console.log('ðŸ“ í•™ìŠµì‹¤ ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
        } else {
          alert('ì œì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        }
      } catch (error) {
        console.error('PDF ìƒì„± ì˜¤ë¥˜:', error);
        alert('PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      } finally {
        // ìž„ì‹œ ìš”ì†Œ ì œê±°
        document.body.removeChild(pdfTemplate);
      }
    }

    // ì¹´ì¹´ì˜¤í†¡ ê³µìœ  (ì´ë¯¸ì§€ë¡œ ê³µìœ )
    async function shareKakao() {
      const storySelect = document.getElementById('reportStory');
      const title = document.getElementById('reportTitle').value.trim();
      const content = document.getElementById('reportContent').value.trim();

      if (!storySelect.value) {
        alert('ì´ì•¼ê¸°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }

      if (!title || !content) {
        alert('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ìž…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      const selectedOption = storySelect.options[storySelect.selectedIndex];
      const storyId = storySelect.value;
      const storyTitle = selectedOption.getAttribute('data-title');

      const userStr = sessionStorage.getItem('user');
      if (!userStr) {
        alert('ë¡œê·¸ì¸ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      const user = JSON.parse(userStr);
      const today = new Date();
      const dateStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;

      // ìž„ì‹œ ì´ë¯¸ì§€ í…œí”Œë¦¿ ìƒì„± (PDFì™€ ë™ì¼)
      const imageTemplate = document.createElement('div');
      imageTemplate.style.cssText = `
        width: 794px;
        min-height: 1123px;
        background: #fcfaf5;
        padding: 60px;
        font-family: 'Noto Sans KR', 'Malgun Gothic', sans-serif;
        position: absolute;
        left: -9999px;
        top: 0;
      `;

      imageTemplate.innerHTML = `
        <div style="text-align: center; margin-bottom: 40px;">
          <img src="https://cdn.jsdelivr.net/gh/kukicoollevitt-hash/dan-dan-app@main/public/images/rudolph.png" style="width: 80px; height: 80px; margin-bottom: 20px;" crossorigin="anonymous">
          <h1 style="font-size: 32px; color: #2c3e50; margin: 0 0 10px 0;">ê³ ëž˜ ë„ì„œê´€ ë…ì„œ ê°ìƒë¬¸</h1>
          <p style="font-size: 18px; color: #6b7280; margin: 0;">${user.grade} ${user.name}</p>
          <p style="font-size: 14px; color: #9ca3af; margin: 5px 0 0 0;">${dateStr}</p>
        </div>

        <div style="margin-bottom: 30px;">
          <h2 style="font-size: 24px; color: #2c3e50; text-align: center; margin: 0 0 20px 0; padding-bottom: 10px; border-bottom: 2px solid #e9ecef;">${title}</h2>
        </div>

        <div style="background: white; padding: 30px; border-radius: 10px; position: relative; min-height: 600px;">
          <!-- ì›ê³ ì§€ ì„  -->
          <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none;">
            ${Array.from({length: 40}, (_, i) => `<div style="position: absolute; left: 30px; right: 30px; top: ${30 + i * 20}px; height: 1px; background: #e9ecef;"></div>`).join('')}
          </div>

          <!-- ë‚´ìš© -->
          <div style="position: relative; z-index: 1; line-height: 2; font-size: 16px; color: #2c3e50; white-space: pre-wrap; word-wrap: break-word;">
${content}
          </div>

          <!-- ì›Œí„°ë§ˆí¬ -->
          <img src="https://cdn.jsdelivr.net/gh/kukicoollevitt-hash/dan-dan-app@main/public/images/rudolph.png" style="position: absolute; bottom: 50px; right: 50px; width: 200px; height: 200px; opacity: 0.05; z-index: 0;" crossorigin="anonymous">
        </div>
      `;

      document.body.appendChild(imageTemplate);

      try {
        // html2canvasë¡œ ì´ë¯¸ì§€ ìƒì„±
        const canvas = await html2canvas(imageTemplate, {
          scale: 2,
          useCORS: true,
          allowTaint: true,
          backgroundColor: '#fcfaf5'
        });

        // ì´ë¯¸ì§€ë¥¼ Blobìœ¼ë¡œ ë³€í™˜
        canvas.toBlob(async (blob) => {
          // ìž„ì‹œ ìš”ì†Œ ì œê±°
          document.body.removeChild(imageTemplate);

          if (!blob) {
            alert('ì´ë¯¸ì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            return;
          }

          // ì´ë¯¸ì§€ë¥¼ ì„œë²„ì— ì—…ë¡œë“œ (ìž„ì‹œ ì €ìž¥ì†Œ)
          const formData = new FormData();
          formData.append('image', blob, `reading-report-${user.name}-${Date.now()}.png`);

          try {
            const uploadResponse = await fetch('/api/upload-temp-image', {
              method: 'POST',
              body: formData
            });

            if (!uploadResponse.ok) {
              throw new Error('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨');
            }

            const { imageUrl } = await uploadResponse.json();

            // ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ì´ë¯¸ì§€ ê³µìœ  (ì´ë¯¸ì§€ë§Œ ê³µìœ , ë§í¬ ì—†ìŒ)
            if (typeof Kakao !== 'undefined' && Kakao.isInitialized()) {
              Kakao.Share.sendDefault({
                objectType: 'feed',
                content: {
                  title: `ðŸ“– ${title}`,
                  description: `${user.name}ë‹˜ì˜ ë…ì„œ ê°ìƒë¬¸`,
                  imageUrl: imageUrl,
                  link: {
                    mobileWebUrl: imageUrl,
                    webUrl: imageUrl
                  }
                }
              });
              console.log('âœ… ì¹´ì¹´ì˜¤í†¡ ì´ë¯¸ì§€ ê³µìœ  ì„±ê³µ');

              // ì„œë²„ì— ì œì¶œ ê¸°ë¡ ì €ìž¥
              console.log('ðŸ“ ê°ìƒë¬¸ ì œì¶œ ì‹œìž‘...');
              const saved = await saveReportToServer({
                grade: user.grade,
                name: user.name,
                title: title,
                content: content,
                type: 'kakao',
                storyId: storyId,
                storyTitle: storyTitle
              });

              console.log('ðŸ“ ì œì¶œ ê²°ê³¼:', saved);

              if (saved) {
                alert('ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ê°ìƒë¬¸ ì´ë¯¸ì§€ê°€ ê³µìœ ë˜ì—ˆìŠµë‹ˆë‹¤!');

                // ížˆìŠ¤í† ë¦¬ ìƒˆë¡œê³ ì¹¨
                console.log('ðŸ“ ížˆìŠ¤í† ë¦¬ ìƒˆë¡œê³ ì¹¨ ì‹œìž‘...');
                await loadReadingHistory();
                console.log('ðŸ“ ížˆìŠ¤í† ë¦¬ ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');

                // í•™ìŠµì‹¤ ìƒˆë¡œê³ ì¹¨
                console.log('ðŸ“ í•™ìŠµì‹¤ ìƒˆë¡œê³ ì¹¨ ì‹œìž‘...');
                await renderStudyRoomList();
                console.log('ðŸ“ í•™ìŠµì‹¤ ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
              } else {
                alert('ì¹´ì¹´ì˜¤í†¡ ê³µìœ ëŠ” ì„±ê³µí–ˆìœ¼ë‚˜ ì œì¶œ ê¸°ë¡ ì €ìž¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
              }
            } else {
              // Fallback: ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
              const link = document.createElement('a');
              link.href = URL.createObjectURL(blob);
              link.download = `ê³ ëž˜ë„ì„œê´€_ê°ìƒë¬¸_${user.name}_${dateStr}.png`;
              link.click();
              alert('ì¹´ì¹´ì˜¤í†¡ SDKë¥¼ ì°¾ì„ ìˆ˜ ì—†ì–´ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œí–ˆìŠµë‹ˆë‹¤.');
            }
          } catch (uploadError) {
            console.error('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì˜¤ë¥˜:', uploadError);
            // Fallback: ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `ê³ ëž˜ë„ì„œê´€_ê°ìƒë¬¸_${user.name}_${dateStr}.png`;
            link.click();
            alert('ì„œë²„ ì—…ë¡œë“œì— ì‹¤íŒ¨í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œí–ˆìŠµë‹ˆë‹¤.');
          }
        }, 'image/png');

      } catch (error) {
        console.error('ì´ë¯¸ì§€ ìƒì„± ì˜¤ë¥˜:', error);
        document.body.removeChild(imageTemplate);
        alert('ì´ë¯¸ì§€ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // ì„œë²„ì— ë¦¬í¬íŠ¸ ì €ìž¥
    async function saveReportToServer(data) {
      try {
        console.log('ðŸ“¤ ì„œë²„ì— ë¦¬í¬íŠ¸ ì „ì†¡ ì¤‘...', data);

        const response = await fetch('/api/user-progress/reading-reports/submit', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        console.log('ðŸ“¥ ì„œë²„ ì‘ë‹µ ìƒíƒœ:', response.status);

        const result = await response.json();
        console.log('ðŸ“¥ ì„œë²„ ì‘ë‹µ ê²°ê³¼:', result);

        if (result.ok) {
          console.log('âœ… ë…ì„œ ê°ìƒë¬¸ ì œì¶œ ì™„ë£Œ');

          // localStorage ìž„ì‹œ ì €ìž¥ ì‚­ì œ
          const key = `readingReportDraft_${data.grade}_${data.name}`;
          localStorage.removeItem(key);
          console.log('ðŸ—‘ï¸ localStorage ìž„ì‹œ ì €ìž¥ ì‚­ì œ:', key);

          return true;
        } else {
          console.error('âŒ ì„œë²„ ì œì¶œ ì‹¤íŒ¨:', result.message);
          return false;
        }
      } catch (error) {
        console.error('âŒ ë¦¬í¬íŠ¸ ì €ìž¥ ì˜¤ë¥˜:', error);
        return false;
      }
    }

    // ë§žì¶¤ë²• ê²€ì‚¬ í•¨ìˆ˜
    async function checkSpelling(text) {
      const loadingDiv = document.getElementById('spellCheckLoading');
      const inlineContainer = document.getElementById('spellCheckInline');

      try {
        console.log('ðŸ” ë§žì¶¤ë²• ê²€ì‚¬ ì‹œìž‘...');

        // ê¸°ì¡´ ê²°ê³¼ ìˆ¨ê¸°ê¸°
        inlineContainer.style.display = 'none';

        // ë¡œë”© í‘œì‹œ
        loadingDiv.style.display = 'block';

        const response = await fetch('/api/spell-check', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text })
        });

        const result = await response.json();
        console.log('âœ… ë§žì¶¤ë²• ê²€ì‚¬ ì™„ë£Œ:', result);

        // ë¡œë”© ìˆ¨ê¸°ê¸°
        loadingDiv.style.display = 'none';

        // ê²°ê³¼ ì¸ë¼ì¸ í‘œì‹œ
        showSpellCheckResult(result);
      } catch (error) {
        console.error('âŒ ë§žì¶¤ë²• ê²€ì‚¬ ì˜¤ë¥˜:', error);

        // ë¡œë”© ìˆ¨ê¸°ê¸°
        loadingDiv.style.display = 'none';

        alert('ë§žì¶¤ë²• ê²€ì‚¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ê·¸ëž˜ë„ ì œì¶œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
        // ì˜¤ë¥˜ ë°œìƒ ì‹œì—ë„ ì œì¶œ ê°€ëŠ¥í•˜ë„ë¡
        submitFinal();
      }
    }

    // ë§žì¶¤ë²• ê²€ì‚¬ ê²°ê³¼ ì¸ë¼ì¸ í‘œì‹œ ë° ìžë™ ì œì¶œ
    function showSpellCheckResult(result) {
      const inlineContainer = document.getElementById('spellCheckInline');

      inlineContainer.innerHTML = '';

      if (result.errata_count === 0) {
        // ì˜¤ë¥˜ ì—†ìŒ
        inlineContainer.innerHTML = `
          <div class="no-error-message">
            âœ… ë§žì¶¤ë²• ë° ë„ì–´ì“°ê¸° ì˜¤ë¥˜ê°€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!<br>
            PDF ì œì¶œì„ ì§„í–‰í•©ë‹ˆë‹¤...
          </div>
        `;
      } else {
        // ì˜¤ë¥˜ ë°œê²¬
        let errorsHTML = `
          <div class="error-section">
            <h4>ë§žì¶¤ë²•/ë„ì–´ì“°ê¸° ì˜¤ë¥˜ ${result.errata_count}ê°œ ë°œê²¬</h4>
        `;

        if (result.errors && result.errors.length > 0) {
          result.errors.forEach((error, index) => {
            errorsHTML += `
              <div class="error-item">
                ì˜ˆì‹œ ${index + 1}) <span class="wrong-text">${error.wrong}</span> â†’ <strong>${error.correct}</strong>
              </div>
            `;
          });
        }

        errorsHTML += `</div>`;

        let correctHTML = `
          <div class="correct-section">
            <h4>âœ“ ì˜¬ë°”ë¥¸ ë§žì¶¤ë²•</h4>
            <div class="correct-text">${result.corrected_html || result.notag_html}</div>
          </div>
        `;

        inlineContainer.innerHTML = errorsHTML + correctHTML;
      }

      // ì¸ë¼ì¸ ì»¨í…Œì´ë„ˆ í‘œì‹œ
      inlineContainer.style.display = 'block';

      // ìŠ¤í¬ë¡¤í•˜ì—¬ ê²°ê³¼ ë³´ì—¬ì£¼ê¸°
      setTimeout(() => {
        inlineContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }, 100);

      // 2ì´ˆ í›„ ìžë™ìœ¼ë¡œ PDF ì œì¶œ
      setTimeout(() => {
        submitFinal();
      }, 2000);
    }

    // ë§žì¶¤ë²• ê²€ì‚¬ ì¸ë¼ì¸ ë‹«ê¸°
    function closeSpellCheckInline() {
      const inlineContainer = document.getElementById('spellCheckInline');
      inlineContainer.style.display = 'none';
    }
  </script>

  <!-- ë ˆì´ë” ì°¨íŠ¸ ì•„ì´ì½˜ -->
  <div class="radar-chart-icon" id="radarChartIcon" title="ë‚˜ì˜ í•™ìŠµ ë¶„ì„ ë³´ê¸°">
    <img src="https://cdn.jsdelivr.net/gh/kukicoollevitt-hash/dan-dan-app@main/public/images/total-radar-chart-v2.png" alt="í•™ìŠµ ë¶„ì„ ë ˆì´ë” ì°¨íŠ¸">
    <div class="radar-grade-badge" id="radarGradeBadge">-</div>
  </div>

  <!-- ë…¸íŠ¸ ì•„ì´ì½˜ -->
  <div class="note-icon" id="noteIcon" title="í•™ìŠµ ë…¸íŠ¸">
    <img src="https://cdn.jsdelivr.net/gh/kukicoollevitt-hash/dan-dan-app@main/public/images/note-icon-v2.png" alt="í•™ìŠµ ë…¸íŠ¸">
    <div class="vocab-avg-badge" id="vocabAvgBadge">0</div>
  </div>

  <!-- í•™ìŠµ ë¶„ì„ ëª¨ë‹¬ -->
  <div class="learning-modal" id="learningModal">
    <div class="learning-modal-content">
      <div class="learning-modal-header">
        <div class="learning-modal-title">ë‚˜ì˜ í•™ìŠµ ë¶„ì„</div>
        <button class="learning-modal-close" id="closeLearningModal">&times;</button>
      </div>
      <iframe class="learning-modal-iframe" id="learningIframe"></iframe>
      <div class="learning-modal-footer">
        <button class="learning-action-btn send-btn" id="sendLearningBtn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
          </svg>
          ì´ë©”ì¼ ì „ì†¡
        </button>
        <button class="learning-action-btn kakao-btn" id="kakaoShareBtn" style="background: linear-gradient(135deg, #FEE500 0%, #FFCD00 100%); color: #3C1E1E;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 3C6.5 3 2 6.6 2 11c0 2.8 1.9 5.3 4.7 6.7-.2.8-.7 2.8-.8 3.2-.1.5.2.5.4.4.3-.1 3.5-2.3 4-2.7.5.1 1 .1 1.7.1 5.5 0 10-3.6 10-8S17.5 3 12 3z"/>
          </svg>
          ì¹´ì¹´ì˜¤í†¡ ì „ì†¡
        </button>
        <button class="learning-action-btn download-btn" id="downloadLearningBtn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
          </svg>
          ë‹¤ìš´ë¡œë“œ
        </button>
      </div>
    </div>
  </div>

  <!-- ë‹¨ì› í•™ìŠµ ëª¨ë‹¬ -->
  <div class="unit-modal" id="unitModal">
    <div class="unit-modal-content">
      <div class="unit-modal-header">
        <button class="unit-modal-close" id="closeUnitModal">&times;</button>
      </div>
      <iframe class="unit-modal-iframe" id="unitIframe"></iframe>
    </div>
  </div>

  <!-- AI ì±—ë´‡ í”Œë¡œíŒ… ë²„íŠ¼ -->
  <div class="ai-chatbot-floating-btn" id="aiChatbotBtn">
    <img src="https://cdn.jsdelivr.net/gh/kukicoollevitt-hash/dan-dan-app@main/public/images/whale-ai-teacher-v2.png" alt="AI êµ­ì–´ ì±—ë´‡">
  </div>

  <!-- AI ì±—ë´‡ ëª¨ë‹¬ -->
  <div class="ai-chatbot-modal" id="aiChatbotModal">
    <div class="ai-chatbot-modal-content">
      <div class="ai-chatbot-modal-header">
        <button class="ai-chatbot-modal-close" id="closeAiChatbotModal">&times;</button>
      </div>
      <iframe class="ai-chatbot-modal-iframe" id="aiChatbotIframe"></iframe>
    </div>
  </div>

  <!-- ì–´íœ˜ë ¥ í€´ì¦ˆì‡¼ ëª¨ë‹¬ -->
  <div class="vocab-quiz-modal" id="vocabQuizModal">
    <div class="vocab-quiz-modal-content">
      <div class="vocab-quiz-modal-header">
        <button class="vocab-quiz-modal-close" id="closeVocabModal">&times;</button>
      </div>
      <iframe class="vocab-quiz-modal-iframe" id="vocabQuizIframe"></iframe>
    </div>
  </div>

  <!-- í•™ìŠµì‹¤ ì•„ì´ì½˜ (ì¢Œì¸¡ í•˜ë‹¨) -->
  <div class="study-room-icon" id="studyRoomIcon">
    <img src="https://cdn.jsdelivr.net/gh/kukicoollevitt-hash/dan-dan-app@main/public/images/student-study-room.png" alt="í•™ìŠµì‹¤">
    <div class="study-room-badge" id="studyRoomBadge">0/10</div>
  </div>

  <!-- í•™ìŠµì‹¤ ëª¨ë‹¬ -->
  <div class="study-room-modal" id="studyRoomModal">
    <div class="study-room-modal-content">
      <div class="study-room-modal-header">
        <h2>ðŸ“š ë‚˜ì˜ í•™ìŠµì‹¤</h2>
        <button class="study-room-modal-close" id="closeStudyRoomModal" onclick="closeStudyRoomModal()">&times;</button>
      </div>
      <div class="study-room-modal-body">
        <ul class="study-room-list" id="studyRoomList">
          <!-- ê³¼ì œ ëª©ë¡ì´ ì—¬ê¸°ì— ë Œë”ë§ë©ë‹ˆë‹¤ -->
        </ul>
      </div>
    </div>
  </div>

  <!-- ê´€ë¦¬ìž ë¹„ë°€ë²ˆí˜¸ ìž…ë ¥ ëª¨ë‹¬ -->
  <div class="overlay" id="adminPasswordOverlay">
    <div class="password-modal">
      <div class="password-modal-header">
        <h3>ðŸ”’ ê´€ë¦¬ìž ì¸ì¦</h3>
      </div>
      <div class="password-modal-body">
        <p>ê³¼ì œë¥¼ ì‚­ì œí•˜ë ¤ë©´ ê´€ë¦¬ìž ë¹„ë°€ë²ˆí˜¸ë¥¼ ìž…ë ¥í•˜ì„¸ìš”</p>
        <input type="password" id="adminPasswordInput" placeholder="ë¹„ë°€ë²ˆí˜¸ ìž…ë ¥" maxlength="4">
      </div>
      <div class="password-modal-footer">
        <button class="btn-cancel" id="cancelPasswordBtn">ì·¨ì†Œ</button>
        <button class="btn-confirm" id="confirmPasswordBtn">í™•ì¸</button>
      </div>
    </div>
  </div>

  <!-- ê³¼ì œ ì¶”ê°€ í™•ì¸ íŒì—… -->
  <div class="overlay" id="assignTaskOverlay">
    <div class="assign-modal">
      <div class="assign-modal-header">
        <h3>ðŸ“ ê³¼ì œ ì¶”ê°€</h3>
      </div>
      <div class="assign-modal-body">
        <p id="assignTaskMessage">ì´ ê³¼ì œë¥¼ í•™ìŠµì‹¤ì— ì¶”ê°€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
      </div>
      <div class="assign-modal-footer">
        <button class="btn-cancel" id="cancelAssignBtn">ì·¨ì†Œ</button>
        <button class="btn-confirm" id="confirmAssignBtn">ì¶”ê°€í•˜ê¸°</button>
      </div>
    </div>
  </div>

  <!-- ì‚­ì œ ìµœì¢… í™•ì¸ íŒì—… -->
  <div class="overlay" id="deleteConfirmOverlay">
    <div class="assign-modal">
      <div class="assign-modal-header">
        <h3>âš ï¸ ì‚­ì œ í™•ì¸</h3>
      </div>
      <div class="assign-modal-body">
        <p>ì‚­ì œ í›„ ë³µêµ¬ê°€ ì•ˆë©ë‹ˆë‹¤.<br>ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
      </div>
      <div class="assign-modal-footer">
        <button class="btn-cancel" id="cancelDeleteBtn">ì·¨ì†Œ</button>
        <button class="btn-confirm" id="confirmDeleteBtn">ì‚­ì œí•˜ê¸°</button>
      </div>
    </div>
  </div>

  <!-- ì¤€ë¹„ ì¤‘ íŒì—… -->
  <div class="overlay" id="comingSoonOverlay">
    <div class="assign-modal">
      <div class="assign-modal-header">
        <h3>ðŸ“šâœ¨ ì•„ì§ ì¤€ë¹„ ì¤‘ìž…ë‹ˆë‹¤</h3>
      </div>
      <div class="assign-modal-body">
        <p>ê³§ ì§€ë¬¸ì´ ì˜¤í”ˆë©ë‹ˆë‹¤. ê¸°ëŒ€í•´ì£¼ì„¸ìš”!</p>
      </div>
      <div class="assign-modal-footer">
        <button class="btn-confirm" id="closeComingSoonBtn">í™•ì¸</button>
      </div>
    </div>
  </div>

  <!-- ì˜¤ë¥˜ ë©”ì‹œì§€ íŒì—… -->
  <div class="overlay" id="errorMessageOverlay">
    <div class="assign-modal">
      <div class="assign-modal-header">
        <h3><span id="errorEmoji">ðŸš«</span> <span id="errorTitle">ì˜¤ë¥˜</span></h3>
      </div>
      <div class="assign-modal-body">
        <p id="errorMsg">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
      </div>
      <div class="assign-modal-footer">
        <button class="btn-confirm" id="closeErrorBtn">í™•ì¸</button>
      </div>
    </div>
  </div>

  <!-- ê³ ëž˜ì„¬ ì´ì•¼ê¸° íŒì—… ëª¨ë‹¬ -->
  <div class="whale-story-modal" id="whaleStoryModal">
    <div class="whale-story-modal-content">
      <button class="whale-story-modal-close" id="closeWhaleStoryModal" onclick="closeWhaleStoryModal()" type="button">&times;</button>

      <!-- Carousel Navigation Arrows -->
      <button class="carousel-nav prev" id="carouselPrev" onclick="moveCarousel(-1)" type="button">â€¹</button>
      <button class="carousel-nav next" id="carouselNext" onclick="moveCarousel(1)" type="button">â€º</button>

      <!-- Carousel Wrapper -->
      <div class="story-carousel-wrapper">
        <div class="story-carousel-container" id="storyCarousel">

          <!-- Slide 1: Whale Island Story -->
          <div class="story-slide whale-story">
            <div class="whale-story-header">
              <h2>ðŸ‹ í‘¸ë¥¸ ê³ ëž˜ì„¬ì˜ ë¹„ë°€ ëª¨í—˜ë‹¨</h2>
              <p>ì–´ë–¤ ì‹œì¦Œìœ¼ë¡œ ëª¨í—˜ì„ ë– ë‚˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            </div>

            <div class="whale-story-seasons">
              <!-- ì‹œì¦Œ 1 -->
              <div class="season-card" onclick="goToSeason('whale', 1)">
                <div class="season-number">ðŸï¸</div>
                <div class="season-title">ì‹œì¦Œ 1</div>
                <div class="season-subtitle">í‘¸ë¥¸ ê³ ëž˜ì„¬ íƒí—˜</div>
                <div class="season-desc">ì‹ ë¹„ë¡œìš´ ì„¬ì—ì„œ ì‹œìž‘ë˜ëŠ” ì²« ë²ˆì§¸ ëª¨í—˜</div>
              </div>

              <!-- ì‹œì¦Œ 2 -->
              <div class="season-card" onclick="goToSeason('whale', 2)">
                <div class="season-number">ðŸŒŠ</div>
                <div class="season-title">ì‹œì¦Œ 2</div>
                <div class="season-subtitle">íŒŒë„ ê³¨ì§œê¸°ì˜ ë¹„ë°€</div>
                <div class="season-desc">ê³ ëž˜ ì™•êµ­ì˜ ê¸°ì–µì„ ë˜ì°¾ëŠ” ì—¬ì •</div>
              </div>

              <!-- ì‹œì¦Œ 3 -->
              <div class="season-card" onclick="goToSeason('whale', 3)">
                <div class="season-number">âœ¨</div>
                <div class="season-title">ì‹œì¦Œ 3</div>
                <div class="season-subtitle">ë¹›ì˜ ê¸°ì–µ</div>
                <div class="season-desc">ê¸°ì–µì˜ ìˆ˜í˜¸ìžê°€ ë˜ëŠ” ë§ˆì§€ë§‰ ëª¨í—˜</div>
              </div>
            </div>
          </div>

          <!-- Slide 2: Jungle Story -->
          <div class="story-slide jungle-story">
            <div class="whale-story-header">
              <h2>ðŸŒ¿ ê¹Šì€ ì •ê¸€ì˜ ìžŠížŒ ë„ì‹œ</h2>
              <p>ì–´ë–¤ ì‹œì¦Œìœ¼ë¡œ ëª¨í—˜ì„ ë– ë‚˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            </div>

            <div class="whale-story-seasons">
              <!-- ì‹œì¦Œ 1 -->
              <div class="season-card" onclick="goToSeason('jungle', 1)">
                <div class="season-number">ðŸï¸</div>
                <div class="season-title">ì‹œì¦Œ 1</div>
                <div class="season-subtitle">ìžŠížŒ ë„ì‹œ ë°œê²¬</div>
                <div class="season-desc">ì‹ ë¹„ë¡œìš´ ì •ê¸€ì—ì„œ ì‹œìž‘ë˜ëŠ” ì²« ë²ˆì§¸ ëª¨í—˜</div>
              </div>

              <!-- ì‹œì¦Œ 2 -->
              <div class="season-card" onclick="goToSeason('jungle', 2)">
                <div class="season-number">ðŸŒ¿</div>
                <div class="season-title">ì‹œì¦Œ 2</div>
                <div class="season-subtitle">ë„ì‹œì˜ ê· í˜• íšŒë³µ</div>
                <div class="season-desc">ê³ ëŒ€ ìž¥ì¹˜ì˜ ë¹„ë°€ì„ í‘¸ëŠ” ì—¬ì •</div>
              </div>

              <!-- ì‹œì¦Œ 3 -->
              <div class="season-card" onclick="goToSeason('jungle', 3)">
                <div class="season-number">ðŸ‰</div>
                <div class="season-title">ì‹œì¦Œ 3</div>
                <div class="season-subtitle">ì•”ë…¹ë¦¼ì˜ ìˆ˜í˜¸ìž</div>
                <div class="season-desc">ì •ê¸€ì˜ ì§„ì •í•œ ê· í˜•ì„ ì§€í‚¤ëŠ” ë§ˆì§€ë§‰ ëª¨í—˜</div>
              </div>
            </div>
          </div>

          <!-- Slide 3: Library Story -->
          <div class="story-slide library-story">
            <div class="whale-story-header">
              <h2>ðŸ“š ì‚´ì•„ ìžˆëŠ” ì‹ ë¹„ì˜ ë„ì„œê´€</h2>
              <p>ì–´ë–¤ ì‹œì¦Œìœ¼ë¡œ ëª¨í—˜ì„ ë– ë‚˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            </div>

            <div class="whale-story-seasons">
              <!-- ì‹œì¦Œ 1 -->
              <div class="season-card" onclick="goToSeason('library', 1)">
                <div class="season-number">ðŸ›ï¸</div>
                <div class="season-title">ì‹œì¦Œ 1</div>
                <div class="season-subtitle">ì‹ ë¹„í•œ ë„ì„œê´€ì˜ ë°œê²¬</div>
                <div class="season-desc">ì§€í˜œì™€ ìš©ê¸°ë¡œ ê°€ë“í•œ ë„ì„œê´€ ì—¬ì •ì˜ ì‹œìž‘</div>
              </div>

              <!-- ì‹œì¦Œ 2 -->
              <div class="season-card" onclick="goToSeason('library', 2)">
                <div class="season-number">ðŸ”</div>
                <div class="season-title">ì‹œì¦Œ 2</div>
                <div class="season-subtitle">ê¸ˆì§€ëœ ì„œê³ ì˜ ë¹„ë°€</div>
                <div class="season-desc">ë¹›ê³¼ ì–´ë‘ ì˜ ê· í˜•ì„ ì°¾ëŠ” ëª¨í—˜</div>
              </div>

              <!-- ì‹œì¦Œ 3 -->
              <div class="season-card" onclick="goToSeason('library', 3)">
                <div class="season-number">â³</div>
                <div class="season-title">ì‹œì¦Œ 3</div>
                <div class="season-subtitle">ì‹œê°„ ì—¬í–‰ìžì˜ ë„ì„œê´€</div>
                <div class="season-desc">íŒŒê´´ì™€ ë§ˆë²•ì„ ë„˜ë‚˜ë“œëŠ” ëŒ€ ëª¨í—˜</div>
              </div>
            </div>
          </div>

          <!-- Slide 4: Time Library Story -->
          <div class="story-slide time-library-story">
            <div class="whale-story-header">
              <h2>â° ì‹œê°„ë„ì„œê´€</h2>
              <p>ì–´ë–¤ ì‹œì¦Œìœ¼ë¡œ ëª¨í—˜ì„ ë– ë‚˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            </div>

            <div class="whale-story-seasons">
              <!-- ì‹œì¦Œ 1 -->
              <div class="season-card" onclick="goToSeason('timeLibrary', 1)">
                <div class="season-number">ðŸ•°ï¸</div>
                <div class="season-title">ì‹œì¦Œ 1</div>
                <div class="season-subtitle">ê³¼ê±°ì˜ ë¬¸ì„ ì—´ë‹¤</div>
                <div class="season-desc">ìžŠížŒ ì‹œëŒ€ì˜ ìˆ˜í˜¸ìžë“¤</div>
              </div>

              <!-- ì‹œì¦Œ 2 -->
              <div class="season-card" onclick="goToSeason('timeLibrary', 2)">
                <div class="season-number">âš¡</div>
                <div class="season-title">ì‹œì¦Œ 2</div>
                <div class="season-subtitle">í˜„ìž¬ì˜ ê· ì—´</div>
                <div class="season-desc">ì‹œê°„ì´ ë’¤í‹€ë¦° ë„ì„œê´€</div>
              </div>

              <!-- ì‹œì¦Œ 3 -->
              <div class="season-card" onclick="goToSeason('timeLibrary', 3)">
                <div class="season-number">ðŸ’«</div>
                <div class="season-title">ì‹œì¦Œ 3</div>
                <div class="season-subtitle">ë¯¸ëž˜ì˜ ì‹¬ìž¥</div>
                <div class="season-desc">ì‹œê°„ì„ ì§€í‚¤ëŠ” ë§ˆì§€ë§‰ ì•„ì´ë“¤</div>
              </div>
            </div>
          </div>

          <!-- Slide 5: Cat Island Story -->
          <div class="story-slide cat-island-story">
            <div class="whale-story-header">
              <h2>ðŸ± ë¯¸ì§€ì˜ ê³ ì–‘ì´ ì„¬ í‘œë¥˜ê¸°</h2>
              <p>ì–´ë–¤ ì‹œì¦Œìœ¼ë¡œ ëª¨í—˜ì„ ë– ë‚˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            </div>

            <div class="whale-story-seasons">
              <!-- ì‹œì¦Œ 1 -->
              <div class="season-card" onclick="goToSeason('catIsland', 1)">
                <div class="season-number">ðŸŒŠ</div>
                <div class="season-title">ì‹œì¦Œ 1</div>
                <div class="season-subtitle">ë°”ëžŒì´ ë°ë ¤ì˜¨ ì„¬</div>
                <div class="season-desc">ë§í•˜ëŠ” ê³ ì–‘ì´ë“¤ì˜ ì‹ ë¹„í•œ ì„¬</div>
              </div>

              <!-- ì‹œì¦Œ 2 -->
              <div class="season-card" onclick="goToSeason('catIsland', 2)">
                <div class="season-number">ðŸŒªï¸</div>
                <div class="season-title">ì‹œì¦Œ 2</div>
                <div class="season-subtitle">ë°”ëžŒê³ ì–‘ì´ë“¤ì˜ ìˆ¨ê²¨ì§„ ë‚ ê°œ</div>
                <div class="season-desc">ìžƒì–´ë²„ë¦° ê³ ì–‘ì´ë“¤ì„ ì°¾ì•„ì„œ</div>
              </div>

              <!-- ì‹œì¦Œ 3 -->
              <div class="season-card" onclick="goToSeason('catIsland', 3)">
                <div class="season-number">ðŸ’–</div>
                <div class="season-title">ì‹œì¦Œ 3</div>
                <div class="season-subtitle">ë§ˆìŒì˜ ì™•êµ­ê³¼ ê°ì •ì˜ ë¶ˆê½ƒ</div>
                <div class="season-desc">ìž ë“  ì™•êµ­ì„ ê¹¨ìš°ëŠ” ë§ˆì§€ë§‰ ëª¨í—˜</div>
              </div>
            </div>
          </div>

          <!-- Slide 6: Cat Transform Story -->
          <div class="story-slide cat-transform-story">
            <div class="whale-story-header">
              <h2>ðŸˆ ê³ ì–‘ì´ê°€ ë˜ì–´ë²„ë¦° ë‚ </h2>
              <p>ì–´ë–¤ ì‹œì¦Œìœ¼ë¡œ ëª¨í—˜ì„ ë– ë‚˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            </div>

            <div class="whale-story-seasons">
              <!-- ì‹œì¦Œ 1 -->
              <div class="season-card" onclick="goToSeason('catTransform', 1)">
                <div class="season-number">ðŸ’«</div>
                <div class="season-title">ì‹œì¦Œ 1</div>
                <div class="season-subtitle">ê³ ì–‘ì´ì˜ ëˆˆìœ¼ë¡œ ë³¸ ì²« ì„¸ê³„</div>
                <div class="season-desc">ë‚¯ì„¤ì§€ë§Œ ì•„ë¦„ë‹¤ìš´ ìƒˆë¡œìš´ ì‚¶</div>
              </div>

              <!-- ì‹œì¦Œ 2 -->
              <div class="season-card" onclick="goToSeason('catTransform', 2)">
                <div class="season-number">ðŸ›ï¸</div>
                <div class="season-title">ì‹œì¦Œ 2</div>
                <div class="season-subtitle">ëª©ê±¸ì´ì˜ ë¹„ë°€ê³¼ ê·¸ë¦¼ìž ì™•êµ­</div>
                <div class="season-desc">ìžƒì–´ë²„ë¦° ì™•êµ­ì˜ ë¹„ë°€ì´ ë“œëŸ¬ë‚œë‹¤</div>
              </div>

              <!-- ì‹œì¦Œ 3 -->
              <div class="season-card" onclick="goToSeason('catTransform', 3)">
                <div class="season-number">âš–ï¸</div>
                <div class="season-title">ì‹œì¦Œ 3</div>
                <div class="season-subtitle">ê·¸ë¦¼ìžì™•êµ­ì˜ ì‹¬ìž¥</div>
                <div class="season-desc">ë¹›ê³¼ ê·¸ë¦¼ìžì˜ ë§ˆì§€ë§‰ ê· í˜•ì„ ì°¾ì•„ì„œ</div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- ìŠ¤í† ë¦¬ ì½˜í…ì¸  íŒì—… ëª¨ë‹¬ -->
  <div class="story-content-modal" id="storyContentModal">
    <div class="story-content-modal-inner">
      <button class="story-content-close" id="closeStoryContentModal" onclick="closeStoryModal()" type="button">&times;</button>
      <iframe class="story-content-iframe" id="storyContentIframe"></iframe>
    </div>
  </div>

  <!-- ë…ì„œ ê°ìƒë¬¸ íŒì—… ëª¨ë‹¬ -->
  <div class="reading-report-modal" id="readingReportModal">
    <div class="reading-report-container">
      <button class="reading-report-close" onclick="closeReadingReportModal()" type="button">&times;</button>

      <!-- ì™¼ìª½ ížˆìŠ¤í† ë¦¬ ì‚¬ì´ë“œë°” -->
      <div class="reading-history-sidebar">
        <div class="history-header">
          ðŸ“š ì œì¶œ ì´ë ¥
        </div>
        <div class="history-list" id="readingHistoryList">
          <!-- ížˆìŠ¤í† ë¦¬ í•­ëª©ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>
      </div>

      <!-- ì˜¤ë¥¸ìª½ ë©”ì¸ ìž‘ì„± ì˜ì—­ -->
      <div class="reading-report-main">
        <div class="report-form-header">
          <h2>ðŸ‹ ê³ ëž˜ ë„ì„œê´€ ë…ì„œ ê°ìƒë¬¸</h2>
          <p>ì‹ ë‚˜ëŠ” ê³ ëž˜ë„ì„œê´€ ì´ì•¼ê¸°ë¥¼ ì½ê³  ê°ìƒë¬¸ì„ ìž‘ì„±í•´ë³´ì„¸ìš”!</p>
        </div>

        <form class="report-form" id="reportForm">
          <div class="form-row">
            <div class="form-group">
              <label for="reportGrade">í•™ë…„</label>
              <input type="text" id="reportGrade" disabled>
            </div>
            <div class="form-group">
              <label for="reportName">ì´ë¦„</label>
              <input type="text" id="reportName" disabled>
            </div>
          </div>

          <div class="form-group">
            <label for="reportStory">ðŸ“š ì´ì•¼ê¸° ì„ íƒ</label>
            <select id="reportStory" required>
              <option value="">ì½ì€ ì´ì•¼ê¸°ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
            </select>
          </div>

          <div class="form-group">
            <label for="reportTitle">ì œëª©</label>
            <input type="text" id="reportTitle" placeholder="ê°ìƒë¬¸ ì œëª©ì„ ìž…ë ¥í•˜ì„¸ìš”" required>
          </div>

          <div class="form-group">
            <label for="reportContent">ë‚´ìš©</label>
            <textarea id="reportContent" placeholder="ê³ ëž˜ë„ì„œê´€ ì´ì•¼ê¸°ë¥¼ ì½ê³  ëŠë‚€ ì ì„ ìžìœ ë¡­ê²Œ ìž‘ì„±í•´ë³´ì„¸ìš”..." required></textarea>
          </div>

          <!-- ë§žì¶¤ë²• ê²€ì‚¬ ë¡œë”© -->
          <div class="spell-check-loading" id="spellCheckLoading" style="display: none;">
            <div class="loading-spinner"></div>
            <p>ë§žì¶¤ë²• ê²€ì‚¬ ì¤‘...</p>
          </div>

          <!-- ë§žì¶¤ë²• ê²€ì‚¬ ê²°ê³¼ ì¸ë¼ì¸ í‘œì‹œ (ë°•ìŠ¤ ì—†ì´) -->
          <div class="spell-check-inline" id="spellCheckInline" style="display: none;">
            <!-- ë§žì¶¤ë²• ê²€ì‚¬ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
          </div>

          <div class="auto-save-indicator" id="autoSaveIndicator"></div>

          <div class="form-actions">
            <button type="button" class="btn-submit" onclick="downloadPDF()">ðŸ“„ ì œì¶œí•˜ê¸°</button>
            <button type="button" class="btn-kakao" onclick="shareKakao()">ðŸ’¬ ì¹´ì¹´ì˜¤í†¡ ê³µìœ </button>
            <button type="button" class="btn-new" onclick="clearForm()">ðŸ”„ ìƒˆë¡œ ìž‘ì„±</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- ë§žì¶¤ë²• ê²€ì‚¬ ê²°ê³¼ ëª¨ë‹¬ -->
  <div class="spell-check-modal" id="spellCheckModal">
    <div class="spell-check-modal-content">
      <div class="spell-check-header">
        <h3>ë§žì¶¤ë²• ê²€ì‚¬ ê²°ê³¼</h3>
        <button class="spell-check-close" onclick="closeSpellCheckModal()">&times;</button>
      </div>

      <div class="spell-check-body" id="spellCheckBody">
        <!-- ê²°ê³¼ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
      </div>

      <div class="spell-check-footer">
        <button class="btn-recheck" onclick="closeSpellCheckModal()">ìž¬ì í•˜ê¸°</button>
        <button class="btn-submit-final" onclick="submitFinal()">ì œì¶œí•˜ê¸°</button>
      </div>
    </div>
  </div>

  <!-- ðŸ”„ ë¡œë”© ìŠ¤í”¼ë„ˆ ì œì–´ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    // íŽ˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ ìŠ¤í”¼ë„ˆ ìˆ¨ê¹€
    window.addEventListener('load', function() {
      const loadingOverlay = document.getElementById('loading-overlay');
      if (loadingOverlay) {
        loadingOverlay.classList.add('fade-out');
        setTimeout(() => {
          loadingOverlay.style.display = 'none';
        }, 500);
      }

      // ðŸ”¥ iPad/iOS ë¹„ë””ì˜¤ ìžë™ìž¬ìƒ ê°•ì œ ì‹¤í–‰
      const bgVideo = document.querySelector('.menu-bg-video');
      if (bgVideo) {
        // iOS Safariì—ì„œëŠ” autoplay ì†ì„±ë§Œìœ¼ë¡œ ë¶€ì¡±í•  ìˆ˜ ìžˆì–´ ëª…ì‹œì ìœ¼ë¡œ play() í˜¸ì¶œ
        bgVideo.play().catch(err => {
          console.log('ë¹„ë””ì˜¤ ìžë™ìž¬ìƒ ì‹¤íŒ¨ (ì‚¬ìš©ìž ì¸í„°ëž™ì…˜ í•„ìš”):', err);
          // ì‚¬ìš©ìžê°€ í™”ë©´ì„ í„°ì¹˜í•˜ë©´ ìž¬ìƒë˜ë„ë¡ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
          document.body.addEventListener('click', function playOnce() {
            bgVideo.play();
            document.body.removeEventListener('click', playOnce);
          }, { once: true });
        });
      }
    });
  </script>

</body>
</html>
