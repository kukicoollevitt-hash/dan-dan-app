<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë‹¨ë‹¨êµ­ì–´ BRAIN ë¬¸í•´ì› | ë©”ì¸</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --btn-bg: #ffb400;
      --btn-text: #2f2f2f;
    }
    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Apple SD Gothic Neo", "Noto Sans KR", -apple-system,
        BlinkMacSystemFont, system-ui, sans-serif;
      background: #000;
    }

    /* âœ… ë©”ì¸ íˆì–´ë¡œ ì „ì²´ ì˜ì—­ */
    .hero-root {
      position: relative;
      width: 100%;
      min-height: 100vh;
      overflow: hidden;           /* ì˜ìƒì´ ë„˜ì¹˜ëŠ” ë¶€ë¶„ ê°€ë¦¬ê¸° */
      display: flex;
      align-items: flex-end;      /* í•˜ë‹¨ ì •ë ¬ */
      justify-content: center;    /* ê°€ë¡œ ì¤‘ì•™ */
      padding: 40px 16px 64px;
    }

    /* âœ… MP4 ì˜ìƒ ë°°ê²½ */
    .hero-video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: -1; /* ë²„íŠ¼/ëª¨ë‹¬ ë’¤ë¡œ ë³´ë‚´ê¸° */
    }

    /* âœ… ì¤‘ì•™ í•˜ë‹¨ ë¡œê·¸ì¸ ë²„íŠ¼ */
    .hero-login-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 14px 32px;
      border-radius: 999px;
      border: none;
      background: var(--btn-bg);
      color: var(--btn-text);
      font-size: 30px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.35);
      text-decoration: none;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      margin-bottom: 3vh;  /* í™”ë©´ ë§¨ ì•„ë˜ì—ì„œ ì‚´ì§ ìœ„ë¡œ ë„ì›€ */
    }
    .hero-login-btn .whale {
      font-size: 20px;
    }
    .hero-login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.45);
    }
    .hero-login-btn:active {
      transform: translateY(0);
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.35);
    }

    /* ===== ë¡œê·¸ì¸ ëª¨ë‹¬ (ë”°ëœ»í•œ ì˜¤ë Œì§€í†¤) ===== */
    .modal-overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: radial-gradient(
        circle at top,
        rgba(255, 215, 180, 0.65) 0,
        rgba(0, 0, 0, 0.55) 55%
      );
      z-index: 50;
    }
    .modal-overlay.active {
      display: flex;
    }

    .modal-card {
      width: min(420px, 92vw);
      background: linear-gradient(145deg, #fff7ea 0%, #ffe7cc 45%, #ffe0c0 100%);
      border-radius: 22px;
      padding: 20px 22px 24px;
      box-shadow:
        0 18px 40px rgba(0, 0, 0, 0.35),
        0 0 0 1px rgba(255, 196, 150, 0.7);
      position: relative;
      color: #4b3123;
      font-family: "Apple SD Gothic Neo", "Noto Sans KR", -apple-system,
        BlinkMacSystemFont, system-ui, sans-serif;
      overflow: hidden;
    }

    .modal-card::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background:
        radial-gradient(circle at top left, rgba(255, 255, 255, 0.9) 0, transparent 45%),
        radial-gradient(circle at bottom right, rgba(255, 202, 150, 0.6) 0, transparent 55%);
      opacity: 0.9;
      pointer-events: none;
      z-index: -1;
    }

    .modal-header-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .modal-close {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      border: 1px solid rgba(120, 78, 44, 0.25);
      background: #fbe6d2;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 16px;
      color: #8b5a3a;
    }
    .modal-close:hover {
      background: #f7d8bf;
    }

    .modal-title-wrap {
      flex: 1;
    }
    .modal-title {
      margin: 0;
      font-size: 18px;
      font-weight: 700;
      color: #4b3123;
    }
    .modal-subtitle {
      margin: 2px 0 0;
      font-size: 12px;
      color: #7b5b45;
    }

    .admin-pill {
      border-radius: 999px;
      padding: 5px 12px;
      font-size: 11px;
      border: 1px solid rgba(133, 88, 57, 0.3);
      background: #fff5e6;
      color: #75452a;
      cursor: pointer;
      white-space: nowrap;
      text-decoration: none;
    }
    .admin-pill:hover {
      background: #ffe8c9;
    }

    .modal-form {
      margin-top: 14px;
    }
    .modal-form label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      margin: 10px 0 4px;
      color: #5a3a25;
    }
    .modal-input {
      width: 100%;
      padding: 9px 10px;
      border-radius: 10px;
      border: 1px solid #f0c8a9;
      font-size: 14px;
      outline: none;
      background: rgba(255, 255, 255, 0.95);
    }
    .modal-input::placeholder {
      color: #c0a08a;
    }
    .modal-input:focus {
      border-color: #f29b5a;
      box-shadow: 0 0 0 1px rgba(242, 155, 90, 0.3);
    }

    .modal-btn {
      margin-top: 18px;
      width: 100%;
      border: none;
      border-radius: 999px;
      padding: 11px 0;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      background: linear-gradient(135deg, #e67645 0%, #d45a35 45%, #b7462a 100%);
      color: #fffaf5;
      box-shadow: 0 10px 20px rgba(178, 72, 45, 0.5);
    }
    .modal-btn:hover {
      filter: brightness(1.03);
      transform: translateY(-1px);
      box-shadow: 0 12px 24px rgba(178, 72, 45, 0.55);
    }

    .modal-footer {
      margin-top: 10px;
      font-size: 12px;
      text-align: center;
      color: #7b5b45;
    }
    .modal-footer a,
    .modal-footer button {
      color: #c45c3a;
      font-weight: 600;
      text-decoration: none;
      border: none;
      background: none;
      cursor: pointer;
      padding: 0 4px;
      font-size: 12px;
    }
    .modal-footer a:hover,
    .modal-footer button:hover {
      text-decoration: underline;
    }

    /* âœ… ë¡œê·¸ì¸/íšŒì›ê°€ì… íŒ¨ë„ í† ê¸€ ê³µí†µ */
    .panel {
      display: none;
    }
    .panel.active {
      display: block;
    }

    /* ===== ë¡œê·¸ì¸ ì˜¤ë¥˜/ìŠ¹ì¸ ëŒ€ê¸° ëª¨ë‹¬ ===== */
    .login-error-overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.55);
      backdrop-filter: blur(3px);
      z-index: 60; /* ë¡œê·¸ì¸ ëª¨ë‹¬ë³´ë‹¤ ìœ„ */
    }
    .login-error-overlay.active {
      display: flex;
    }

    .login-error-card {
      width: min(420px, 90vw);
      background: #fff5e6;
      border-radius: 24px;
      padding: 26px 26px 22px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
      text-align: center;
      color: #5a3a25;
    }

    .login-error-icon {
      width: 52px;
      height: 52px;
      border-radius: 50%;
      margin: 0 auto 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #fbe1d4;
      color: #c54632;
      font-size: 26px;
    }

    .login-error-title {
      margin: 0 0 6px;
      font-size: 18px;
      font-weight: 700;
    }

    .login-error-msg {
      margin: 0 0 18px;
      font-size: 14px;
      line-height: 1.5;
      color: #7b5b45;
    }

    .login-error-btn-row {
      display: flex;
      gap: 8px;
      justify-content: center;
    }

    .login-error-btn {
      flex: 1;
      border-radius: 999px;
      padding: 9px 0;
      border: none;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }
    .login-error-btn.cancel {
      background: #f4e2cf;
      color: #7b5b45;
    }
    .login-error-btn.cancel:hover {
      background: #ecd4bd;
    }
    .login-error-btn.retry {
      background: #b7462a;
      color: #fffaf5;
    }
    .login-error-btn.retry:hover {
      filter: brightness(1.05);
    }

    .login-error-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      backdrop-filter: blur(2px);
    }
    .login-error-overlay.show {
      display: flex;
    }
    .login-error-modal {
      background: #fffaf3;
      border-radius: 18px;
      padding: 24px 26px 22px;
      width: 320px;
      text-align: center;
      box-shadow: 0 15px 45px rgba(0,0,0,0.16);
      border: 1px solid rgba(139,47,47,0.1);
    }
    .login-error-icon {
      font-size: 42px;
      margin-bottom: 8px;
    }
    .login-error-title {
      font-weight: 700;
      font-size: 17px;
      margin-bottom: 6px;
      color: #6f2e2e;
    }
    .login-error-msg {
      font-size: 13px;
      color: #8d6f51;
      line-height: 1.6;
      margin-bottom: 18px;
    }
    .login-error-actions {
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    .login-error-btn {
      min-width: 90px;
      border-radius: 999px;
      border: none;
      padding: 7px 14px 8px;
      font-size: 13px;
      cursor: pointer;
    }
    .login-error-btn.primary {
      background: #8b2f2f;
      color: #fff;
    }

    /* âœ… ì§„ë‹¨í…ŒìŠ¤íŠ¸ ë°”ë¡œê°€ê¸° ì´ë¯¸ì§€ (ì¢Œì¸¡ í•˜ë‹¨) */
    .diagnostic-link {
      position: fixed;
      bottom: 30px;
      left: 30px;
      z-index: 1000;
      cursor: pointer;
      transition: transform 0.3s ease;
      animation: float 3s ease-in-out infinite;
    }
    .diagnostic-link img {
      width: 120px;
      height: auto;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
    }
    .diagnostic-link:hover {
      transform: scale(1.05);
    }

    /* ë‘¥ì‹¤ë‘¥ì‹¤ ë– ë‹¤ë‹ˆëŠ” ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes float {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-15px);
      }
    }

    @media (max-width: 768px) {
      .diagnostic-link {
        bottom: 20px;
        left: 20px;
      }
      .diagnostic-link img {
        width: 80px;
      }
    }
  </style>
</head>
<body>
  <!-- âœ… ë©”ì¸ íˆì–´ë¡œ í™”ë©´ -->
  <main class="hero-root">
    <!-- ğŸ”¥ MP4 ë°°ê²½ ì˜ìƒ -->
    <video class="hero-video" autoplay muted loop playsinline>
      <source src="https://cdn.jsdelivr.net/gh/kukicoollevitt-hash/dan-dan-app@main/public/images/brain-main-hero.mp4" type="video/mp4" />
    </video>

    <!-- ğŸ”¥ ì¤‘ì•™ ë²„íŠ¼ì€ ê·¸ëŒ€ë¡œ -->
    <button type="button" class="hero-login-btn" id="openLoginBtn">
      <span>ì‹œì‘í•˜ê¸°</span>
    </button>
  </main>

  <!-- âœ… ë¡œê·¸ì¸ / íšŒì›ê°€ì… ëª¨ë‹¬ -->
  <div class="modal-overlay" id="loginOverlay">
    <div class="modal-card">
      <div class="modal-header-row">
        <button type="button" class="modal-close" id="closeLoginBtn">âœ•</button>

        <div class="modal-title-wrap">
          <h1 class="modal-title" id="modalTitle">ë¸Œë ˆì¸ ë¬¸í•´ì›ì— ì˜¤ì‹  ê±¸ í™˜ì˜í•©ë‹ˆë‹¤</h1>
          <p class="modal-subtitle" id="modalSubtitle">
            ê°€ì…í–ˆë˜ ì´ë¦„Â·í•™ë…„Â·ì „í™”ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.
          </p>
        </div>

        <a href="/admin-login" class="admin-pill">ê´€ë¦¬ìëª¨ë“œ</a>
      </div>

      <!-- ğŸ”¹ ë¡œê·¸ì¸ íŒ¨ë„ -->
      <div id="login-panel" class="panel active">
        <!-- ì„œë²„: POST /login -->
        <form action="/login" method="post" class="modal-form" id="login-form">
          <label>
            í•™ë…„
            <input
              type="text"
              name="grade"
              class="modal-input"
              placeholder="ì˜ˆ) 3í•™ë…„"
              required
            />
          </label>

          <label>
            ì´ë¦„
            <input
              type="text"
              name="name"
              class="modal-input"
              placeholder="ì˜ˆ) í™ê¸¸ë™"
              required
            />
          </label>

          <label>
            ë¹„ë°€ë²ˆí˜¸(ì „í™”ë²ˆí˜¸)
            <input
              type="tel"
              name="phone"
              class="modal-input"
              placeholder="ì „í™”ë²ˆí˜¸ ì…ë ¥"
              required
            />
          </label>

          <button type="submit" class="modal-btn">ë¡œê·¸ì¸</button>
        </form>

        <div class="modal-footer">
          ì²˜ìŒì´ì‹ ê°€ìš”?
          <button type="button" id="open-register">íšŒì›ê°€ì…</button>
        </div>
      </div>

      <!-- ğŸ”¹ íšŒì›ê°€ì… íŒ¨ë„ -->
      <div id="register-panel" class="panel">
        <form action="/register" method="post" class="modal-form" id="register-form">
          <label>
            í•™ë…„
            <input
              type="text"
              name="grade"
              class="modal-input"
              placeholder="ì˜ˆ) 3í•™ë…„"
              required
            />
          </label>

          <label>
            ì´ë¦„
            <input
              type="text"
              name="name"
              class="modal-input"
              placeholder="ì˜ˆ) í™ê¸¸ë™"
              required
            />
          </label>

          <label>
            ì „í™”ë²ˆí˜¸(ë¹„ë°€ë²ˆí˜¸ë¡œ ì‚¬ìš©)
            <input
              type="tel"
              name="phone"
              class="modal-input"
              placeholder="ì˜ˆ) 01012345678"
              required
            />
          </label>

          <label>
            í•™êµëª…
            <input
              type="text"
              name="academyName"
              class="modal-input"
              placeholder="ì˜ˆ) 00ì´ˆì¤‘ê³ ë“±í•™êµ"
              required
            />
          </label>

          <button type="submit" class="modal-btn">íšŒì›ê°€ì… ì™„ë£Œ</button>
        </form>

        <div class="modal-footer">
          ì´ë¯¸ ê°€ì…í•˜ì…¨ë‚˜ìš”?
          <button type="button" id="back-to-login">ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
      </div>
    </div>
  </div>

  <!-- âœ… ë¡œê·¸ì¸ ì˜¤ë¥˜ / ìŠ¹ì¸ ëŒ€ê¸° ëª¨ë‹¬ -->
  <div id="loginErrorOverlay" class="login-error-overlay">
    <div class="login-error-card">
      <div class="login-error-icon">ğŸš«</div>
      <h2 class="login-error-title" id="loginErrorTitle">ë¡œê·¸ì¸ ì˜¤ë¥˜ì…ë‹ˆë‹¤</h2>
      <p class="login-error-msg" id="loginErrorMsg">
        ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ í•œ ë²ˆ í™•ì¸í•´ ì£¼ì„¸ìš”.
      </p>
      <div class="login-error-btn-row">
        <button type="button" class="login-error-btn cancel" id="loginErrorCloseBtn">
          ë‹«ê¸°
        </button>
        <button type="button" class="login-error-btn retry" id="loginErrorRetryBtn">
          ë‹¤ì‹œ ì…ë ¥í•˜ê¸°
        </button>
      </div>
    </div>
  </div>

  <script>
    // ğŸ”§ í•™ìƒ key ìƒì„± (ë¡œê·¸ì¸ ì‹œ localStorageìš©)
    function buildStudentKey(stu) {
      const cleanPhone = (stu.phone || "").replace(/\D/g, "");
      const cleanName  = (stu.name  || "").trim();
      const cleanGrade = (stu.grade || "").trim();
      return `${cleanGrade}_${cleanName}_${cleanPhone}`;
    }

    // ğŸ”§ ë¡œê·¸ì¸/íšŒì›ê°€ì… íŒ¨ë„ í† ê¸€
    function showPanel(which) {
      const loginPanel    = document.getElementById("login-panel");
      const registerPanel = document.getElementById("register-panel");
      const titleEl       = document.getElementById("modalTitle");
      const subtitleEl    = document.getElementById("modalSubtitle");

      if (!loginPanel || !registerPanel) return;

      if (which === "register") {
        registerPanel.classList.add("active");
        loginPanel.classList.remove("active");
        if (titleEl)    titleEl.textContent    = "íšŒì›ê°€ì… í›„ ë‹¤ì‹œ ë§Œë‚˜ìš”!";
        if (subtitleEl) subtitleEl.textContent = "í•™ë…„Â·ì´ë¦„Â·ì „í™”ë²ˆí˜¸Â·í•™êµëª…ì„ ì •í™•íˆ ì…ë ¥í•´ ì£¼ì„¸ìš”.";
      } else {
        loginPanel.classList.add("active");
        registerPanel.classList.remove("active");
        if (titleEl)    titleEl.textContent    = "ë¸Œë ˆì¸ ë¬¸í•´ì›ì— ì˜¤ì‹  ê±¸ í™˜ì˜í•©ë‹ˆë‹¤";
        if (subtitleEl) subtitleEl.textContent = "ê°€ì…í–ˆë˜ ì´ë¦„Â·í•™ë…„Â·ì „í™”ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.";
      }
    }

    // ğŸ”§ URL ì¿¼ë¦¬ì—ì„œ loginError íƒ€ì… ê°€ì ¸ì˜¤ê¸°
    function getLoginErrorType() {
      const params = new URLSearchParams(window.location.search);
      return params.get("loginError"); // 'pending' | 'trashed' | '1' | null
    }

    // ğŸ”§ ì˜¤ë¥˜ ëª¨ë‹¬ ì—´ê¸°
    function openLoginErrorModal(type) {
      const overlay = document.getElementById("loginErrorOverlay");
      const titleEl = document.getElementById("loginErrorTitle");
      const msgEl   = document.getElementById("loginErrorMsg");
      if (!overlay || !titleEl || !msgEl) return;

      if (type === "pending") {
        titleEl.textContent = "ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ ê³„ì •ì…ë‹ˆë‹¤";
        msgEl.innerHTML =
          "ì•„ì§ ê´€ë¦¬ì ìŠ¹ì¸ ì „ì´ë¼ ë¡œê·¸ì¸í•  ìˆ˜ ì—†ì–´ìš”.<br>" +
          "ë‹´ë‹¹ ì„ ìƒë‹˜ê»˜ íšŒì› ìŠ¹ì¸ ìš”ì²­ì„ í•´ ì£¼ì„¸ìš” ğŸ™‚";
      } else if (type === "trashed") {
        titleEl.textContent = "íœ´ì§€ ìƒíƒœ ê³„ì •ì…ë‹ˆë‹¤";
        msgEl.innerHTML =
          "í˜„ì¬ ì‚¬ìš© ì¤‘ì§€ëœ ê³„ì •ì´ì—ìš”.<br>" +
          "ë‹´ë‹¹ ì„ ìƒë‹˜ê»˜ ë‹¤ì‹œ ë³µêµ¬ê°€ ê°€ëŠ¥í•œì§€ ë¬¸ì˜í•´ ì£¼ì„¸ìš”.";
      } else if (type === "1") {
        titleEl.textContent = "ë¡œê·¸ì¸ ì •ë³´ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤";
        msgEl.innerHTML =
          "í•™ë…„Â·ì´ë¦„Â·ì „í™”ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ í•œ ë²ˆ í™•ì¸í•´ ì£¼ì„¸ìš”.";
      } else {
        // ê¸°ë³¸ ë©”ì‹œì§€
        titleEl.textContent = "ë¡œê·¸ì¸ ì˜¤ë¥˜ì…ë‹ˆë‹¤";
        msgEl.textContent = "ë‹¤ì‹œ í•œ ë²ˆ ì…ë ¥í•´ ì£¼ì„¸ìš”.";
      }

      overlay.classList.add("active");
    }

    document.addEventListener("DOMContentLoaded", () => {
      const openBtn      = document.getElementById("openLoginBtn");
      const overlay      = document.getElementById("loginOverlay");
      const closeBtn     = document.getElementById("closeLoginBtn");
      const openRegBtn   = document.getElementById("open-register");
      const backLoginBtn = document.getElementById("back-to-login");
      const loginForm    = document.getElementById("login-form");

      const errOverlay   = document.getElementById("loginErrorOverlay");
      const errCloseBtn  = document.getElementById("loginErrorCloseBtn");
      const errRetryBtn  = document.getElementById("loginErrorRetryBtn");

      // âœ… ê¸°ë³¸ ë¡œê·¸ì¸ ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸°
      if (openBtn && overlay && closeBtn) {
        overlay.classList.remove("active");

        openBtn.addEventListener("click", () => {
          overlay.classList.add("active");
          showPanel("login");
        });

        closeBtn.addEventListener("click", () => {
          overlay.classList.remove("active");
        });

        overlay.addEventListener("click", (e) => {
          if (e.target === overlay) {
            overlay.classList.remove("active");
          }
        });
      }

      // âœ… "íšŒì›ê°€ì…" í´ë¦­ â†’ ê°™ì€ ëª¨ë‹¬ ì•ˆì—ì„œ íšŒì›ê°€ì… íŒ¨ë„ë¡œ ì „í™˜
      if (openRegBtn && overlay) {
        openRegBtn.addEventListener("click", (e) => {
          e.preventDefault();
          overlay.classList.add("active");
          showPanel("register");
        });
      }

      // âœ… "ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°"
      if (backLoginBtn) {
        backLoginBtn.addEventListener("click", (e) => {
          e.preventDefault();
          showPanel("login");
        });
      }

      // âœ… ë¡œê·¸ì¸ ì‹œ localStorageì— í•™ìƒ ì •ë³´ ì €ì¥
      if (loginForm) {
        loginForm.addEventListener("submit", () => {
          const formData = new FormData(loginForm);
          const student = {
            grade: formData.get("grade") || "",
            name:  formData.get("name")  || "",
            phone: formData.get("phone") || ""
          };
          localStorage.setItem("currentStudent", JSON.stringify(student));
          localStorage.setItem("currentStudentKey", buildStudentKey(student));

          // âœ… ë¡œê·¸ì¸ í›„ AI ì¸ì‹ í™”ë©´ í‘œì‹œë¥¼ ìœ„í•œ í”Œë˜ê·¸ ì„¤ì •
          sessionStorage.setItem("justLoggedIn", "true");
        });
      }

      // âœ… ë¡œê·¸ì¸ ì˜¤ë¥˜ / ìŠ¹ì¸ ëŒ€ê¸° ì¿¼ë¦¬ ì²˜ë¦¬
      const errType = getLoginErrorType();
      if (errType) {
        openLoginErrorModal(errType);

        // í•œ ë²ˆ ë³´ì—¬ì¤€ ë’¤ì—” URLì—ì„œ ì¿¼ë¦¬ ì œê±° (ìƒˆë¡œê³ ì¹¨ ì‹œ ì¬ë…¸ì¶œ ë°©ì§€)
        const url = new URL(window.location.href);
        url.searchParams.delete("loginError");
        window.history.replaceState({}, "", url.pathname + url.search);
      }

      // âœ… ì˜¤ë¥˜ ëª¨ë‹¬ ë²„íŠ¼ ë™ì‘
      if (errOverlay && errCloseBtn) {
        errCloseBtn.addEventListener("click", () => {
          errOverlay.classList.remove("active");
        });
      }
      if (errOverlay && errRetryBtn && overlay) {
        errRetryBtn.addEventListener("click", () => {
          errOverlay.classList.remove("active");
          overlay.classList.add("active");
          showPanel("login");
        });
      }
    });
  </script>

  <!-- ìŠ¹ì¸ ëŒ€ê¸° ì•ˆë‚´ ëª¨ë‹¬ -->
  <div class="login-error-overlay" id="signupPendingOverlay">
    <div class="login-error-modal">
      <div class="login-error-icon">ğŸš«</div>
      <div class="login-error-title">ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ ê³„ì •ì…ë‹ˆë‹¤</div>
      <div class="login-error-msg">
        í˜„ì¬ íšŒì›ë‹˜ì€ â€˜ìŠ¹ì¸ ëŒ€ê¸°â€™ ìƒíƒœì…ë‹ˆë‹¤.<br />
        ë‹´ë‹¹ ì„ ìƒë‹˜ê»˜ íšŒì› ìŠ¹ì¸ ìš”ì²­ì„ í•´ ì£¼ì„¸ìš” ğŸ™‚
      </div>
      <div class="login-error-actions">
        <button type="button" class="login-error-btn primary" id="signupPendingCloseBtn">
          í™•ì¸
        </button>
      </div>
    </div>
  </div>

  <script>
    function getSignupStatus() {
      const params = new URLSearchParams(window.location.search);
      return params.get("signup");
    }

    function openSignupPendingModal() {
      const overlay = document.getElementById("signupPendingOverlay");
      if (!overlay) return;
      overlay.classList.add("show");

      // URLì—ì„œ ?signup=pending ì œê±° (ìƒˆë¡œê³ ì¹¨ ì‹œ ì¬ë“±ì¥ ë°©ì§€)
      if (window.history && window.history.replaceState) {
        const clean = window.location.origin + window.location.pathname;
        window.history.replaceState({}, document.title, clean);
      }
    }

    function closeSignupPendingModal() {
      const overlay = document.getElementById("signupPendingOverlay");
      if (overlay) overlay.classList.remove("show");
    }

    document.addEventListener("DOMContentLoaded", function () {
      const status = getSignupStatus();

      if (status === "pending") {
        openSignupPendingModal();
      }

      const closeBtn = document.getElementById("signupPendingCloseBtn");
      if (closeBtn) {
        closeBtn.addEventListener("click", closeSignupPendingModal);
      }

      const overlay = document.getElementById("signupPendingOverlay");
      if (overlay) {
        overlay.addEventListener("click", function (e) {
          if (e.target === overlay) closeSignupPendingModal();
        });
      }
    });
  </script>

  <!-- âœ… ì§„ë‹¨í…ŒìŠ¤íŠ¸ ë°”ë¡œê°€ê¸° ì´ë¯¸ì§€ -->
  <a href="/diagnostic_reading_test.html" class="diagnostic-link">
    <img src="https://cdn.jsdelivr.net/gh/kukicoollevitt-hash/dan-dan-app@main/public/images/test.png" alt="ì§„ë‹¨í…ŒìŠ¤íŠ¸ ë°”ë¡œê°€ê¸°">
  </a>
</body>
</html>
