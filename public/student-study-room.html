<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í•™ìŠµì‹¤ - ë‹¨ë‹¨êµì‹¤</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
      background: linear-gradient(135deg, #a8e6cf 0%, #56c596 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    }

    h1 {
      font-size: 32px;
      color: #333;
      margin-bottom: 10px;
      text-align: center;
    }

    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 40px;
      font-size: 14px;
    }

    .student-info {
      text-align: center;
      margin-bottom: 30px;
      font-size: 18px;
      color: #333;
      font-weight: 600;
    }

    /* ì£¼ê°„ ë‹¬ë ¥ */
    .calendar-container {
      margin-bottom: 40px;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 0 20px;
    }

    .calendar-nav {
      background: #f0f0f0;
      border: none;
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    .calendar-nav:hover {
      background: #e0e0e0;
    }

    .calendar-title {
      font-size: 20px;
      font-weight: 700;
      color: #56c596;
    }

    .week-calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      margin-bottom: 40px;
    }

    .week-day {
      text-align: center;
      padding: 20px 10px;
      background: #f9f9f9;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .week-day:hover {
      background: #e8f5e9;
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(86, 197, 150, 0.2);
    }

    .week-day.has-tasks {
      background: linear-gradient(135deg, #a8e6cf 0%, #56c596 100%);
      color: white;
      font-weight: 600;
    }

    .week-day.has-tasks:hover {
      background: linear-gradient(135deg, #56c596 0%, #3a8755 100%);
    }

    .week-day.selected {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-weight: 700;
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .week-day.today {
      border: 3px solid #ff6b6b;
    }

    .day-name {
      font-size: 14px;
      margin-bottom: 8px;
      opacity: 0.9;
    }

    .day-date {
      font-size: 20px;
      font-weight: 700;
    }

    .task-count {
      position: absolute;
      top: -8px;
      right: -8px;
      background: #ff6b6b;
      color: white;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
      box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4);
    }

    .incomplete-marker {
      position: absolute;
      bottom: 8px;
      left: 50%;
      transform: translateX(-50%);
      background: #ffa726;
      color: white;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 11px;
      font-weight: 600;
    }

    /* ê³¼ì œ ëª©ë¡ */
    .tasks-section {
      display: none;
    }

    .tasks-section.show {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .tasks-header {
      font-size: 22px;
      font-weight: 700;
      color: #333;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 3px solid #56c596;
    }

    .task-card {
      background: linear-gradient(135deg, #f9f9f9 0%, #ffffff 100%);
      border: 2px solid #e0e0e0;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 16px;
      transition: all 0.3s ease;
    }

    .task-card:hover {
      border-color: #56c596;
      box-shadow: 0 4px 16px rgba(86, 197, 150, 0.2);
      transform: translateX(5px);
    }

    .task-card.completed {
      background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
      border-color: #4caf50;
      opacity: 0.8;
    }

    .task-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .task-subject {
      font-size: 18px;
      font-weight: 700;
      color: #333;
    }

    .task-status {
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
    }

    .task-status.pending {
      background: #fff3e0;
      color: #f57c00;
    }

    .task-status.completed {
      background: #e8f5e9;
      color: #2e7d32;
    }

    .task-units {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    .unit-badge {
      background: white;
      border: 2px solid #56c596;
      color: #56c596;
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .unit-badge:hover {
      background: #56c596;
      color: white;
    }

    .unit-badge.completed {
      background: #4caf50;
      border-color: #4caf50;
      color: white;
    }

    .no-tasks {
      text-align: center;
      padding: 60px 20px;
      color: #999;
      font-size: 16px;
    }

    .back-btn {
      display: inline-block;
      padding: 10px 20px;
      background: #f0f0f0;
      color: #333;
      text-decoration: none;
      border-radius: 8px;
      font-size: 14px;
      margin-bottom: 20px;
      transition: all 0.2s ease;
    }

    .back-btn:hover {
      background: #e0e0e0;
    }

    /* ì¤€ë¹„ ì¤‘ íŒì—… */
    .coming-soon-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .coming-soon-modal.show {
      display: flex;
    }

    .coming-soon-content {
      background: white;
      padding: 40px;
      border-radius: 20px;
      text-align: center;
      max-width: 400px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      animation: modalSlideIn 0.3s ease;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .coming-soon-icon {
      font-size: 60px;
      margin-bottom: 20px;
    }

    .coming-soon-title {
      font-size: 24px;
      font-weight: 700;
      color: #333;
      margin-bottom: 10px;
    }

    .coming-soon-message {
      font-size: 16px;
      color: #666;
      margin-bottom: 30px;
    }

    .coming-soon-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 40px;
      border-radius: 25px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .coming-soon-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="/student-menu.html" class="back-btn">â† ë’¤ë¡œ ê°€ê¸°</a>

    <h1>ğŸ“š ë‚˜ì˜ í•™ìŠµì‹¤</h1>
    <p class="subtitle">ì´ë²ˆ ì£¼ í•™ìŠµ ê³¼ì œë¥¼ í™•ì¸í•˜ê³  ì§„í–‰í•´ë³´ì„¸ìš”</p>

    <div class="student-info" id="studentInfo">
      <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
    </div>

    <div class="calendar-container">
      <div class="calendar-header">
        <button class="calendar-nav" id="prevWeek">â—€ ì´ì „ ì£¼</button>
        <div class="calendar-title" id="weekTitle">2025ë…„ 1ì›” 3ì£¼ì°¨</div>
        <button class="calendar-nav" id="nextWeek">ë‹¤ìŒ ì£¼ â–¶</button>
      </div>

      <div class="week-calendar" id="weekCalendar">
        <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
      </div>
    </div>

    <div class="tasks-section" id="tasksSection">
      <div class="tasks-header" id="tasksHeader">1ì›” 20ì¼ (ì›”) ê³¼ì œ</div>
      <div id="tasksList">
        <!-- ë™ì ìœ¼ë¡œ ì±„ì›Œì§ -->
      </div>
    </div>
  </div>

  <!-- ì¤€ë¹„ ì¤‘ íŒì—… -->
  <div class="coming-soon-modal" id="comingSoonModal">
    <div class="coming-soon-content">
      <div class="coming-soon-icon">ğŸ“šâœ¨</div>
      <div class="coming-soon-title">ì•„ì§ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤</div>
      <div class="coming-soon-message">ê³§ ì§€ë¬¸ì´ ì˜¤í”ˆë©ë‹ˆë‹¤. ê¸°ëŒ€í•´ì£¼ì„¸ìš”!</div>
      <button class="coming-soon-btn" onclick="closeComingSoonModal()">í™•ì¸</button>
    </div>
  </div>

  <script>
    let currentWeekStart = new Date();
    let selectedDate = null;
    let studentName = '';
    let studentGrade = '';
    let allAssignments = [];

    // ì›”ìš”ì¼ë¡œ ì„¤ì •
    function setToMonday(date) {
      const d = new Date(date);
      const day = d.getDay();
      const diff = day === 0 ? -6 : 1 - day;
      d.setDate(d.getDate() + diff);
      d.setHours(0, 0, 0, 0);
      return d;
    }

    // ì£¼ ì‹œì‘ì¼ ì„¤ì •
    currentWeekStart = setToMonday(new Date());

    // ============ ì„œë²„ ë™ê¸°í™” í•¨ìˆ˜ ============

    // ì„œë²„ì—ì„œ í•™ìŠµì‹¤ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadStudyRoomDataFromServer() {
      const userStr = sessionStorage.getItem('user');
      if (!userStr) return;

      try {
        const user = JSON.parse(userStr);
        const response = await fetch(`/api/user-progress?grade=${encodeURIComponent(user.grade)}&name=${encodeURIComponent(user.name)}`);
        const result = await response.json();

        if (result.ok && result.data && result.data.studyRoom) {
          const studyRoom = result.data.studyRoom;

          // ì„œë²„ì˜ ê³¼ì œ ë°ì´í„°ë¥¼ localStorageì— ë™ê¸°í™”
          if (studyRoom.assignedTasks && studyRoom.assignedTasks.length > 0) {
            const tasksKey = `studyRoom_tasks_${user.grade}_${user.name}`;
            localStorage.setItem(tasksKey, JSON.stringify(studyRoom.assignedTasks));
            console.log('âœ… ì„œë²„ì—ì„œ í•™ìŠµì‹¤ ë°ì´í„° ë¶ˆëŸ¬ì˜´:', studyRoom.assignedTasks.length, 'ê°œ ê³¼ì œ');
          }
        }
      } catch (error) {
        console.error('ì„œë²„ í•™ìŠµì‹¤ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
      }
    }

    // ì„œë²„ì— í•™ìŠµì‹¤ ë°ì´í„° ì €ì¥í•˜ê¸°
    async function saveStudyRoomDataToServer() {
      const userStr = sessionStorage.getItem('user');
      if (!userStr) return;

      try {
        const user = JSON.parse(userStr);
        const tasksKey = `studyRoom_tasks_${user.grade}_${user.name}`;
        const tasksStr = localStorage.getItem(tasksKey);

        let assignedTasks = [];
        if (tasksStr) {
          try {
            assignedTasks = JSON.parse(tasksStr);
          } catch(e) {
            console.error('ê³¼ì œ ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', e);
          }
        }

        const studyRoomData = { assignedTasks };

        const response = await fetch('/api/user-progress/study-room', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            grade: user.grade,
            name: user.name,
            studyRoomData
          })
        });

        const result = await response.json();
        if (result.ok) {
          console.log('âœ… ì„œë²„ì— í•™ìŠµì‹¤ ë°ì´í„° ì €ì¥ ì™„ë£Œ');
        }
      } catch (error) {
        console.error('ì„œë²„ í•™ìŠµì‹¤ ë°ì´í„° ì €ì¥ ì˜¤ë¥˜:', error);
      }
    }

    // í•™ìƒ ì •ë³´ ë¡œë“œ
    function loadStudentInfo() {
      // sessionStorageì—ì„œ ë¨¼ì € í™•ì¸
      const userStr = sessionStorage.getItem('user');
      if (userStr) {
        try {
          const user = JSON.parse(userStr);
          studentGrade = user.grade || 'ì´ˆ4';
          studentName = user.name || 'í•™ìƒ';
        } catch(e) {
          // íŒŒì‹± ì‹¤íŒ¨ì‹œ localStorage ì‚¬ìš©
          studentGrade = localStorage.getItem('studentGrade') || 'ì´ˆ4';
          studentName = localStorage.getItem('studentName') || 'í•™ìƒ';
        }
      } else {
        // localStorage ë˜ëŠ” sessionì—ì„œ í•™ìƒ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        studentGrade = localStorage.getItem('studentGrade') || 'ì´ˆ4';
        studentName = localStorage.getItem('studentName') || 'í•™ìƒ';
      }

      document.getElementById('studentInfo').textContent = `${studentGrade} ${studentName}`;
    }

    // ì£¼ê°„ ë‹¬ë ¥ ë Œë”ë§
    function renderWeekCalendar() {
      const calendar = document.getElementById('weekCalendar');
      const weekDays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];

      // ì£¼ì°¨ ì œëª© ì—…ë°ì´íŠ¸
      const weekTitle = document.getElementById('weekTitle');
      const year = currentWeekStart.getFullYear();
      const month = currentWeekStart.getMonth() + 1;
      const weekNumber = Math.ceil((currentWeekStart.getDate() + currentWeekStart.getDay()) / 7);
      weekTitle.textContent = `${year}ë…„ ${month}ì›” ${weekNumber}ì£¼ì°¨`;

      calendar.innerHTML = '';

      for (let i = 0; i < 7; i++) {
        const date = new Date(currentWeekStart);
        date.setDate(currentWeekStart.getDate() + i);

        const dayDiv = document.createElement('div');
        dayDiv.className = 'week-day';

        // ì˜¤ëŠ˜ ë‚ ì§œ í‘œì‹œ
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        if (date.getTime() === today.getTime()) {
          dayDiv.classList.add('today');
        }

        // ì„ íƒëœ ë‚ ì§œ í‘œì‹œ
        if (selectedDate && date.getTime() === selectedDate.getTime()) {
          dayDiv.classList.add('selected');
        }

        // í•´ë‹¹ ë‚ ì§œì˜ ê³¼ì œ í™•ì¸
        const tasksForDay = allAssignments.filter(a => {
          const dueDate = new Date(a.dueDate);
          dueDate.setHours(0, 0, 0, 0);
          return dueDate.getTime() === date.getTime();
        });

        if (tasksForDay.length > 0) {
          dayDiv.classList.add('has-tasks');

          const countBadge = document.createElement('div');
          countBadge.className = 'task-count';
          countBadge.textContent = tasksForDay.length;
          dayDiv.appendChild(countBadge);

          // ë¯¸ì™„ë£Œ ê³¼ì œ í™•ì¸
          const incompleteTasks = tasksForDay.filter(t => !isTaskCompleted(t));
          if (incompleteTasks.length > 0) {
            const marker = document.createElement('div');
            marker.className = 'incomplete-marker';
            marker.textContent = 'ë¯¸ì™„ë£Œ';
            dayDiv.appendChild(marker);
          }
        }

        dayDiv.innerHTML += `
          <div class="day-name">${weekDays[date.getDay()]}</div>
          <div class="day-date">${date.getDate()}</div>
        ` + dayDiv.innerHTML;

        dayDiv.addEventListener('click', () => selectDate(date));
        calendar.appendChild(dayDiv);
      }
    }

    // ë‚ ì§œ ì„ íƒ
    function selectDate(date) {
      selectedDate = new Date(date);
      selectedDate.setHours(0, 0, 0, 0);
      renderWeekCalendar();
      renderTasks();
    }

    // ê³¼ì œ ì™„ë£Œ ì—¬ë¶€ í™•ì¸
    function isTaskCompleted(assignment) {
      const studentId = `${studentGrade} ${studentName}`;
      return assignment.completedBy && assignment.completedBy.some(c => c.studentName === studentId);
    }

    // ê³¼ì œ ëª©ë¡ ë Œë”ë§
    function renderTasks() {
      if (!selectedDate) return;

      const tasksSection = document.getElementById('tasksSection');
      const tasksList = document.getElementById('tasksList');
      const tasksHeader = document.getElementById('tasksHeader');

      const month = selectedDate.getMonth() + 1;
      const day = selectedDate.getDate();
      const weekDays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
      const dayName = weekDays[selectedDate.getDay()];

      tasksHeader.textContent = `${month}ì›” ${day}ì¼ (${dayName}) ê³¼ì œ`;

      // í•´ë‹¹ ë‚ ì§œì˜ ê³¼ì œ í•„í„°ë§
      const tasksForDay = allAssignments.filter(a => {
        const dueDate = new Date(a.dueDate);
        dueDate.setHours(0, 0, 0, 0);
        return dueDate.getTime() === selectedDate.getTime();
      });

      if (tasksForDay.length === 0) {
        tasksList.innerHTML = '<div class="no-tasks">ğŸ“­ ì´ ë‚ ì§œì—ëŠ” ê³¼ì œê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        tasksSection.classList.add('show');
        return;
      }

      tasksList.innerHTML = tasksForDay.map(task => {
        const completed = isTaskCompleted(task);
        const seriesName = task.series === 'BRAINUP' ? 'BRAINì—…' : 'BRAINì˜¨';
        const categoryName = getCategoryName(task.category);
        const subjectName = getSubjectName(task.category, task.subject);

        return `
          <div class="task-card ${completed ? 'completed' : ''}">
            <div class="task-header">
              <div class="task-subject">
                ${seriesName} - ${categoryName} - ${subjectName}
              </div>
              <div class="task-status ${completed ? 'completed' : 'pending'}">
                ${completed ? 'âœ“ ì™„ë£Œ' : 'ì§„í–‰ì¤‘'}
              </div>
            </div>
            <div class="task-units">
              ${task.units.map(unit => `
                <div class="unit-badge ${isUnitCompleted(task, unit) ? 'completed' : ''}"
                     onclick="goToUnit('${task.series}', '${task.category}', '${task.subject}', ${unit})">
                  ${unit}ë‹¨ì›
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }).join('');

      tasksSection.classList.add('show');
    }

    // ë‹¨ì› ì™„ë£Œ ì—¬ë¶€ í™•ì¸
    function isUnitCompleted(assignment, unit) {
      const studentId = `${studentGrade} ${studentName}`;
      return assignment.completedBy && assignment.completedBy.some(
        c => c.studentName === studentId && c.unit === unit
      );
    }

    // ì¹´í…Œê³ ë¦¬ ì´ë¦„
    function getCategoryName(category) {
      const names = {
        social: 'ì‚¬íšŒíƒêµ¬',
        korlit: 'êµ­ì–´ë¬¸í•™',
        worldlit: 'ì„¸ê³„ë¬¸í•™',
        person: 'ì¸ë¬¼íƒêµ¬'
      };
      return names[category] || category;
    }

    // ê³¼ëª© ì´ë¦„
    function getSubjectName(category, subject) {
      const names = {
        geo: 'ì§€ë¦¬',
        law: 'ë²•',
        pol: 'ì •ì¹˜',
        soc: 'ì‚¬íšŒë¬¸í™”',
        classic: 'ê³ ì „ë¬¸í•™',
        modern: 'í˜„ëŒ€ë¬¸í•™',
        world: 'ì„¸ê³„ë¬¸í•™',
        people: 'ì¸ë¬¼'
      };
      return names[subject] || subject;
    }

    // ì¤€ë¹„ ì¤‘ íŒì—… ì—´ê¸°
    function showComingSoonModal() {
      const modal = document.getElementById('comingSoonModal');
      modal.classList.add('show');
    }

    // ì¤€ë¹„ ì¤‘ íŒì—… ë‹«ê¸°
    function closeComingSoonModal() {
      const modal = document.getElementById('comingSoonModal');
      modal.classList.remove('show');
    }

    // ë°°ê²½ í´ë¦­ ì‹œ íŒì—… ë‹«ê¸°
    document.addEventListener('DOMContentLoaded', function() {
      const modal = document.getElementById('comingSoonModal');
      if (modal) {
        modal.addEventListener('click', function(e) {
          if (e.target === modal) {
            closeComingSoonModal();
          }
        });
      }
    });

    // ë‹¨ì› íŒŒì¼ ì¡´ì¬ ì—¬ë¶€ í™•ì¸ (ì¤€ë¹„ëœ ë‹¨ì› ëª©ë¡)
    const availableUnits = {
      'BRAINUP': {
        'social': {
          'geo': [1, 2, 3, 4], // ì§€ë¦¬ 01~04ë§Œ ì¤€ë¹„ë¨
          'soc': [],
          'law': [],
          'pol': []
        }
      }
    };

    // ë‹¨ì›ìœ¼ë¡œ ì´ë™
    function goToUnit(series, category, subject, unit) {
      // í•´ë‹¹ ë‹¨ì›ì´ ì¤€ë¹„ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
      const isAvailable = availableUnits[series] &&
                         availableUnits[series][category] &&
                         availableUnits[series][category][subject] &&
                         availableUnits[series][category][subject].includes(unit);

      if (!isAvailable) {
        // ì¤€ë¹„ë˜ì§€ ì•Šì€ ë‹¨ì› â†’ íŒì—… í‘œì‹œ
        showComingSoonModal();
        return;
      }

      // ì¤€ë¹„ëœ ë‹¨ì› â†’ í˜ì´ì§€ ì´ë™
      const unitStr = unit < 10 ? `0${unit}` : unit;
      const path = `/${series}/${category}/${subject}_${unitStr}.html`;
      window.location.href = path;
    }

    // ê³¼ì œ ë°ì´í„° ë¡œë“œ
    async function loadAssignments() {
      try {
        const studentId = `${studentGrade} ${studentName}`;
        const response = await fetch(`/api/assignments/student/${encodeURIComponent(studentId)}`);
        allAssignments = await response.json();
        renderWeekCalendar();
      } catch (error) {
        console.error('ê³¼ì œ ë¡œë“œ ì‹¤íŒ¨:', error);
      }
    }

    // ì£¼ ì´ë™
    document.getElementById('prevWeek').addEventListener('click', () => {
      currentWeekStart.setDate(currentWeekStart.getDate() - 7);
      selectedDate = null;
      document.getElementById('tasksSection').classList.remove('show');
      renderWeekCalendar();
    });

    document.getElementById('nextWeek').addEventListener('click', () => {
      currentWeekStart.setDate(currentWeekStart.getDate() + 7);
      selectedDate = null;
      document.getElementById('tasksSection').classList.remove('show');
      renderWeekCalendar();
    });

    // ë‹¨ì› ì™„ë£Œ ë©”ì‹œì§€ ìˆ˜ì‹  ì²˜ë¦¬
    window.addEventListener('message', async (event) => {
      if (event.origin !== window.location.origin) return;

      if (event.data.type === 'UNIT_COMPLETED') {
        console.log('ğŸ“š ë‹¨ì› ì™„ë£Œ ë©”ì‹œì§€ ìˆ˜ì‹ ë¨');

        // ì™„ë£Œ ì •ë³´ë¥¼ localStorageì™€ ì„œë²„ì— ì €ì¥
        // (ì‹¤ì œ ì™„ë£Œ ì²˜ë¦¬ëŠ” í•™ìŠµ í˜ì´ì§€ì—ì„œ ì´ë¯¸ ì²˜ë¦¬ë˜ë¯€ë¡œ, ì—¬ê¸°ì„œëŠ” ì„œë²„ ë™ê¸°í™”ë§Œ ìˆ˜í–‰)
        await saveStudyRoomDataToServer();

        // ê³¼ì œ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        await loadAssignments();
        if (selectedDate) {
          renderTasks();
        }
        renderWeekCalendar();
      }
    });

    // ì´ˆê¸°í™”
    (async () => {
      // 1. í•™ìƒ ì •ë³´ ë¡œë“œ
      loadStudentInfo();

      // 2. ì„œë²„ì—ì„œ í•™ìŠµì‹¤ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
      await loadStudyRoomDataFromServer();

      // 3. ê³¼ì œ ëª©ë¡ ë¡œë“œ ë° ë Œë”ë§
      await loadAssignments();
    })();
  </script>
</body>
</html>
